"use strict";function _toArray(e){return _arrayWithHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableRest()}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,a=!0,o=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(o)throw i}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function asyncGeneratorStep(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){function a(e){asyncGeneratorStep(s,r,i,a,o,"next",e)}function o(e){asyncGeneratorStep(s,r,i,a,o,"throw",e)}var s=e.apply(t,n);a(void 0)})}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.Wn=void 0;var Io=function(){function e(e){return"/o/"+e}function t(e,t){if(!e.ok){if(_.isUndefined(t))throw e;return t}return e.data}var n={isFullObjId:function(e){return/^[0-9a-v]{26}(:file:.+)?$/.test(e)},loadMetaBy:function(e){return _asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.isFullObjId(e)){t.next=4;break}return t.next=3,n.loadMetaById(e);case 3:return t.abrupt("return",t.sent);case 4:return t.next=6,n.loadMeta(e);case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}},t)}))()},loadMetaById:function(e){return _asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.loadMeta("id:"+e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t)}))()},loadMeta:function(n){return _asyncToGenerator(regeneratorRuntime.mark(function r(){var i,a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i=e("fetch"),r.next=3,Ti.Http.get(i,{params:{str:n},as:"json"});case 3:return a=r.sent,r.abrupt("return",t(a,null));case 5:case"end":return r.stop()}},r)}))()},loadMetaAt:function(e,t){return _asyncToGenerator(regeneratorRuntime.mark(function r(){var i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i=t,e&&!/^(~\/|\/|id:)/.test(t)&&(i="id:".concat(e.pid,"/").concat(t)),r.next=4,n.loadMeta(i);case 4:return r.abrupt("return",r.sent);case 5:case"end":return r.stop()}},r)}))()},loadAncestors:function(n){return _asyncToGenerator(regeneratorRuntime.mark(function r(){var i,a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i=e("ancestors"),r.next=3,Ti.Http.get(i,{params:{str:n},as:"json"});case 3:return a=r.sent,r.abrupt("return",t(a,[]));case 5:case"end":return r.stop()}},r)}))()},loadChildren:function(r){var i=arguments;return _asyncToGenerator(regeneratorRuntime.mark(function a(){var o,s,u,c,l,d,p,f,m,v,h,g,y,b;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(o=i.length>1&&void 0!==i[1]?i[1]:{},s=o.skip,u=o.limit,c=o.sort,l=void 0===c?{nm:1}:c,d=o.mine,p=o.match,f=void 0===p?{}:p,r){a.next=3;break}return a.abrupt("return",null);case 3:if("DIR"==r.race){a.next=5;break}return a.abrupt("return",[]);case 5:if(!r.mnt&&!r.ln){a.next=11;break}return m=e("children"),a.next=9,Ti.Http.get(m,{params:{str:"id:".concat(r.id),pg:!0},as:"json"});case 9:return v=a.sent,a.abrupt("return",t(v));case 11:return f.pid=r.id,a.next=14,n.find({skip:s,limit:u,sort:l,mine:d,match:f});case 14:if(h=a.sent,r.ph&&h&&_.isArray(h.list)){g=_createForOfIteratorHelper(h.list);try{for(g.s();!(y=g.n()).done;)(b=y.value).ph||(b.ph=Ti.Util.appendPath(r.ph,b.nm))}catch(e){g.e(e)}finally{g.f()}}return a.abrupt("return",h);case 17:case"end":return a.stop()}},a)}))()},find:function(){var n=arguments;return _asyncToGenerator(regeneratorRuntime.mark(function r(){var i,a,o,s,u,c,l,d,p,f,m,v,h;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i=n.length>0&&void 0!==n[0]?n[0]:{},a=i.skip,o=void 0===a?0:a,s=i.limit,u=void 0===s?100:s,c=i.sort,l=void 0===c?{}:c,d=i.mine,p=void 0===d||d,f=i.match,m=void 0===f?{}:f,v=e("find"),r.next=4,Ti.Http.get(v,{params:_.assign({},m,{_l:u,_o:o,_me:p,_s:JSON.stringify(l)}),as:"json"});case 4:return h=r.sent,r.abrupt("return",t(h));case 6:case"end":return r.stop()}},r)}))()},findList:function(){var e=arguments;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var r,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.length>0&&void 0!==e[0]?e[0]:{},t.next=3,n.find(r);case 3:if(!(i=t.sent)||!_.isArray(i.list)){t.next=6;break}return t.abrupt("return",i.list);case 6:return t.abrupt("return",[]);case 7:case"end":return t.stop()}},t)}))()},findInBy:function(e,t){var r=arguments;return _asyncToGenerator(regeneratorRuntime.mark(function i(){var a,o,s,u,c,l,d,p,f,m,v,h,g,y,b,x,T,k,w,O,j,S;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(a=r.length>2&&void 0!==r[2]?r[2]:{},o=a.skip,s=void 0===o?0:o,u=a.limit,c=void 0===u?100:u,l=a.sort,d=void 0===l?{}:l,p=a.mine,f=void 0===p||p,m=a.match,v=void 0===m?{}:m,h=a.keys,g=void 0===h?{"^[0-9a-v]{26}$":["id","${val}"]}:h,y=a.dftKey,b=void 0===y?["nm","^.*${val}.*$"]:y,_.isUndefined(e)){i.next=24;break}x=b,T=_createForOfIteratorHelper(_.keys(g)),i.prev=4,T.s();case 6:if((k=T.n()).done){i.next=13;break}if(w=k.value,!new RegExp(w).test(e)){i.next=11;break}return x=g[w],i.abrupt("break",13);case 11:i.next=6;break;case 13:i.next=18;break;case 15:i.prev=15,i.t0=i.catch(4),T.e(i.t0);case 18:return i.prev=18,T.f(),i.finish(18);case 21:O=x[0],j=Ti.S.renderBy(x[1],{val:e}),v[O]=j;case 24:if(!t){i.next=29;break}return i.next=27,n.loadMeta(t);case 27:S=i.sent,v.pid=S.id;case 29:return i.next=31,n.find({skip:s,limit:c,sort:d,mine:f,match:v});case 31:return i.abrupt("return",i.sent);case 32:case"end":return i.stop()}},i,null,[[4,15,18,21]])}))()},findListInBy:function(e,t){var r=arguments;return _asyncToGenerator(regeneratorRuntime.mark(function i(){var a,o;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return a=r.length>2&&void 0!==r[2]?r[2]:{},i.next=3,n.findInBy(e,t,a);case 3:if(!(o=i.sent)||!_.isArray(o.list)){i.next=6;break}return i.abrupt("return",o.list);case 6:return i.abrupt("return",[]);case 7:case"end":return i.stop()}},i)}))()},loadContent:function(t){var r=arguments;return _asyncToGenerator(regeneratorRuntime.mark(function i(){var a,o,s,u,c,l;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(a=r.length>1&&void 0!==r[1]?r[1]:{},o=a.as,s=void 0===o?"text":o,!_.isString(t)){i.next=5;break}return i.next=4,n.loadMeta(t);case 4:t=i.sent;case 5:if(t&&"DIR"!=t.race){i.next=7;break}return i.abrupt("return",null);case 7:if(u=t.mime||"application/octet-stream",!Wn.Util.isMimeText(u)){i.next=14;break}return c=e("content"),i.next=12,Ti.Http.get(c,{params:{str:"id:"+t.id,d:"raw"},as:s});case 12:return l=i.sent,i.abrupt("return",l);case 14:return i.abrupt("return",t.sha1);case 15:case"end":return i.stop()}},i)}))()},saveContentAsText:function(t,n){return _asyncToGenerator(regeneratorRuntime.mark(function r(){var i,a,o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(t&&"DIR"!=t.race){r.next=2;break}throw Ti.Err.make("e-wn-io-writeNoFile",t.ph||t.nm);case 2:return i={str:"id:"+t.id,content:n},a=e("/save/text"),r.next=6,Ti.Http.post(a,{params:i,as:"json"});case 6:if((o=r.sent).ok){r.next=9;break}throw Ti.Err.make(o.errCode,o.data,o.msg);case 9:return r.abrupt("return",o.data);case 10:case"end":return r.stop()}},r)}))()},uploadFile:function(t){var n=arguments;return _asyncToGenerator(regeneratorRuntime.mark(function r(){var i,a,o,s,u,c,l,d,p,f,m;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i=n.length>1&&void 0!==n[1]?n[1]:{},a=i.target,o=void 0===a?"~":a,s=i.mode,u=void 0===s?"a":s,c=i.tmpl,l=void 0===c?"${major}(${nb})${suffix}":c,d=i.progress,p=void 0===d?_.identity:d,f=e("/save/stream"),r.next=4,Ti.Http.post(f,{file:t,progress:p,params:{str:o,nm:t.name,sz:t.size,mime:t.type,m:u,tmpl:l},as:"json"});case 4:return m=r.sent,r.abrupt("return",m);case 6:case"end":return r.stop()}},r)}))()},getFormedPath:function(e){return _asyncToGenerator(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!_.isString(e)){t.next=4;break}return t.next=3,n.loadMetaBy(e);case 3:e=t.sent;case 4:return r=Wn.Session.getHomePath(),t.abrupt("return",Ti.Util.getRelativePath(r,e.ph));case 6:case"end":return t.stop()}},t)}))()}};return n}(),Obj=function(){var e={id:{title:"i18n:wn-key-id",name:"id"},nm:{title:"i18n:wn-key-nm",name:"nm",display:"<=ti-label>",comType:"ti-input"},title:{title:"i18n:wn-key-title",name:"title",display:"<=ti-label>",comType:"ti-input"},icon:{title:"i18n:wn-key-icon",name:"icon",width:"auto",comType:"ti-input-icon"},ph:{title:"i18n:wn-key-ph",name:"ph",comConf:{className:"is-break-word"}},thumb:{title:"i18n:wn-key-thumb",name:"thumb",checkEquals:!1,serializer:{name:"Ti.Types.toStr",args:"id:${id}"},comType:"wn-imgfile",comConf:{target:"~/.thumbnail/gen/${id}.jpg",filter:"cover(256,256)",quality:.372}},race:{title:"i18n:wn-key-race",name:"race",comConf:{format:"i18n:wn-race-${race}"}},mime:{title:"i18n:wn-key-mime",name:"mime"},tp:{title:"i18n:wn-key-tp",name:"tp"},ct:{title:"i18n:wn-key-ct",name:"ct",type:"AMS"},lm:{title:"i18n:wn-key-lm",name:"lm",type:"AMS"},expi:{title:"i18n:wn-key-expi",name:"expi",type:"AMS"},pid:{title:"i18n:wn-key-pid",name:"pid"},d0:{title:"i18n:wn-key-d0",name:"d0"},d1:{title:"i18n:wn-key-d1",name:"d1"},c:{title:"i18n:wn-key-c",name:"c"},m:{title:"i18n:wn-key-m",name:"m"},g:{title:"i18n:wn-key-g",name:"g"},data:{title:"i18n:wn-key-data",name:"data"},sha1:{title:"i18n:wn-key-sha1",name:"sha1"},md:{title:"i18n:wn-key-md",name:"md"},pvg:{title:"i18n:wn-key-pvg",name:"pvg"},width:{title:"i18n:wn-key-width",name:"width"},height:{title:"i18n:wn-key-height",name:"height"},duration:{title:"i18n:wn-key-duration",name:"duration"},len:{title:"i18n:wn-key-len",name:"len",width:"auto",transformer:function(e){return Ti.S.sizeText(e)}}},t={isBuiltInFields:function(t){return!!e[t]},getGroupTitle:function(e){return/^(basic|privilege|thumb|timestamp|more|advance|customized|others)$/.test(e)?"i18n:wn-key-grp-".concat(e):e},getField:function(t){var n=e[t];return n?_.cloneDeep(n):{title:t,name:t,type:"String"}},evalFields:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_.identity,r={},i=function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return _.forEach(n,function(n){if("..."!=n){var a,o=!1;if(_.isString(n))o=!0,a=Wn.Obj.getField(n);else if(_.isArray(n.fields)){if(a={title:Wn.Obj.getGroupTitle(n.title),type:"Group",fields:[]},t(n.fields,a.fields,i),_.isEmpty(a.fields))return}else a=n;var s=Ti.S.join("-",a.name);i[s]=!0;var u=_.get(e,a.name);r.push(_.assign(a,{quickName:o,uniqKey:s,value:u}))}else r.push(n)}),r}(t,[],r);return i=function t(){var r,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=_createForOfIteratorHelper(i);try{for(s.s();!(r=s.n()).done;){var u=r.value;if("Group"!=u.type)if("..."==u)_.forEach(e,function(e,t){if(!(Ti.Util.isNil(e)||Wn.Obj.isBuiltInFields(t)||o[t]||t.startsWith("_"))){var r=Ti.Types.getJsType(e,"String"),i=n(_objectSpread({title:t,name:t},{Integer:{type:"Number",display:t,comType:"ti-input"},Number:{type:"Number",display:t,comType:"ti-input"},Boolean:{type:"Boolean",comType:"ti-toggle"},Array:{type:"Array",display:t,comType:"ti-input-tags"}}[r]||{type:"String",display:t,comType:"ti-input"}));i&&a.push(i)}});else{var c=n(u);c&&a.push(c)}else u.fields=t(u.fields,[],o),_.isEmpty(u.fields)||a.push(u)}}catch(e){s.e(e)}finally{s.f()}return a}(i,[],r)},isAs:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i=_.get(e,n);if(Ti.Util.isNil(i))return!1;if(_.isArray(r)){var a,o=_createForOfIteratorHelper(r);try{for(o.s();!(a=o.n()).done;){var s=a.value;if(t.isAs(e,n,s))return!0}}catch(e){o.e(e)}finally{o.f()}return!1}return _.isString(r)?r.startsWith("^")?new RegExp(r).test(i):r.startsWith("!^")?!new RegExp(r.substring(1)).test(i):i==r:!!_.isRegExp(r)&&r.test(i)},isMime:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;return t.isAs(e,"mime",n)},isType:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;return t.isAs(e,"type",n)},evalCrumbData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.meta,n=e.ancestors,r=void 0===n?[]:n,i=e.fromIndex,a=void 0===i?0:i,o=e.homePath,s=void 0===o?null:o,u=e.iteratee,c=void 0===u?_.identity:u,l=e.self,d=void 0===l?_.identity:l,p=[];if(t){var f=_.map(r),m=a;if(s)for(;m<f.length;m++){if(f[m].ph==s)break}for(;m<f.length;m++){var v=f[m],h={icon:Wn.Util.getIconObj(v),text:Wn.Util.getObjDisplayName(v),value:v.id,href:Wn.Util.getAppLink(v)+""};(h=c(h,m,t)||h)&&p.push(h)}if(d){var g={icon:Wn.Util.getIconObj(t),text:Wn.Util.getObjDisplayName(t),value:t.id,href:null,asterisk:_.get(this.mainStatus,"changed")};_.isFunction(d)&&(g=d(g,m,t)||g),g&&p.push(g)}}return p}};return t}(),Session=function(){var e={},t={},n={setup:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.id,i=e.uid,a=e.unm,o=e.grp,s=e.envs,u=void 0===s?{}:s;_.assign(t,{id:r,uid:i,unm:a,grp:o}),n.env(u)},env:function(t){if(_.isPlainObject(t))_.assign(e,t);else{if(_.isString(t))return e[t];if(_.isArray(t))return _.pick(e,t)}return _.cloneDeep(e)},getMyId:function(){return t.uid},getMyName:function(){return t.unm},getMyGroup:function(){return t.grp},getHomePath:function(){return n.env("HOME")},getCurrentPath:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"~";return n.env("PWD")||e},getCurrentDomain:function(){var e=n.getHomePath();if(e){if("/root"==e)return"root";var t=/^\/home\/(.+)$/.exec(e);return t?t[1]:void 0}},getApiPrefix:function(){var e=n.getCurrentDomain();return"/api/".concat(e)},getApiUrl:function(e){var t=n.getApiPrefix();return Ti.Util.appendPath(t,e)}};return n}(),Sys=function(){var WnSysRespParsing=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.macroObjSep,r=t.eachLine,i=void 0===r?_.identity:r,a=t.macro,o=void 0===a?{}:a;_classCallCheck(this,e),this.macroObjSep=n,this.lastIndex=0,this.lines=[],this.MACRO={},this.__TO=null,this.eachLine=i,this.macro=o}return _createClass(e,[{key:"init",value:function(e){this.content=e}},{key:"done",value:function(){var e=this;this.updated({isLastCalled:!0}),_.forOwn(this.MACRO,function(t,n){var r=t.join("\n"),i=JSON.parse(r);e.MACRO[n]=i,Ti.InvokeBy(e.macro,n,[i])})}},{key:"__push_line",value:function(e){if(e.startsWith(this.macroObjSep)){var t=e.substring(this.macroObjSep.length).trim(),n=_slicedToArray(_.without(t.split(/ *: */g),""),2),r=n[0],i=n[1],a=this[r];a&&(a[i]=[]),this.__TO={key:r,name:i}}else if(this.__TO){var o=this.__TO,s=o.key,u=o.name;this[s][u].push(e)}else this.lines.push(e),this.eachLine(e)}},{key:"updated",value:function(){for(var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).isLastCalled,t=void 0!==e&&e,n=this.content();this.lastIndex<n.length;){var r=n.indexOf("\n",this.lastIndex);if(r>=this.lastIndex){var i=r+1;r>0&&"\r"==n[r-1]&&r--;var a=n.substring(this.lastIndex,r);this.__push_line(a),this.lastIndex=i}else{if(!t)break;var o=n.substring(this.lastIndex);this.__push_line(o),this.lastIndex=n.length}}}},{key:"getResult",value:function(){return{lines:this.lines,macro:this.MACRO}}}]),e}(),DFT_MACRO_OBJ_SEP="%%wn.meta."+Ti.Random.str(10)+"%%",WnSys={exec:function exec(cmdText){var _arguments8=arguments;return _asyncToGenerator(regeneratorRuntime.mark(function _callee15(){var _ref10,_ref10$vars,vars,_ref10$input,input,_ref10$appName,appName,_ref10$eachLine,eachLine,_ref10$as,as,_ref10$macroObjSep,macroObjSep,_ref10$autoRunMacro,autoRunMacro,errorBy,_ref10$PWD,PWD,url,params,ing,parsing,re,str,_str$split,_str$split2,code,datas,data,msgKey;return regeneratorRuntime.wrap(function _callee15$(_context15){for(;;)switch(_context15.prev=_context15.next){case 0:return _ref10=_arguments8.length>1&&void 0!==_arguments8[1]?_arguments8[1]:{},_ref10$vars=_ref10.vars,vars=void 0===_ref10$vars?{}:_ref10$vars,_ref10$input=_ref10.input,input=void 0===_ref10$input?"":_ref10$input,_ref10$appName=_ref10.appName,appName=void 0===_ref10$appName?Ti.GetAppName():_ref10$appName,_ref10$eachLine=_ref10.eachLine,eachLine=void 0===_ref10$eachLine?_.identity:_ref10$eachLine,_ref10$as=_ref10.as,as=void 0===_ref10$as?"text":_ref10$as,_ref10$macroObjSep=_ref10.macroObjSep,macroObjSep=void 0===_ref10$macroObjSep?DFT_MACRO_OBJ_SEP:_ref10$macroObjSep,_ref10$autoRunMacro=_ref10.autoRunMacro,autoRunMacro=void 0===_ref10$autoRunMacro||_ref10$autoRunMacro,errorBy=_ref10.errorBy,_ref10$PWD=_ref10.PWD,PWD=void 0===_ref10$PWD?Wn.Session.getCurrentPath():_ref10$PWD,cmdText=Ti.S.renderBy(cmdText,vars),url="/a/run/".concat(appName),params={mos:macroObjSep,PWD:PWD,cmd:cmdText,in:input},ing={eachLine:eachLine,macroObjSep:macroObjSep},autoRunMacro&&(ing.macro={update_envs:function(e){Wn.Session.env(e),Wn.doHook("update_envs",e)}}),parsing=new WnSysRespParsing(ing),_context15.next=9,Ti.Http.send(url,{method:"POST",params:params,as:"text",created:function(e){parsing.init(function(){return e.responseText})}}).catch(function(e){parsing.isError=!0}).finally(function(){parsing.done()});case 9:if(re=parsing.getResult(),Ti.IsInfo("Wn.Sys")&&console.log("Wn.Sys.exec@return",re),!parsing.isError){_context15.next=21;break}if(str=re.lines.join("\n"),!_.isFunction(errorBy)){_context15.next=20;break}return _str$split=str.split(/ *: */),_str$split2=_toArray(_str$split),code=_str$split2[0],datas=_str$split2.slice(1),data=datas.join(" : "),msgKey=code.replace(/[.]/g,"-"),_context15.abrupt("return",errorBy({code:code,msgKey:msgKey,data:data}));case 20:throw str;case 21:return _context15.abrupt("return",{raw:function(){return re},lines:function(){return re.lines},macro:function(){return re.macro},text:function(){return re.lines.join("\n")},json:function(){var e=re.lines.join("\n");return JSON.parse(e)},jso:function jso(){var json=re.lines.join("\n");return eval("("+json+")")}}[as]());case 22:case"end":return _context15.stop()}},_callee15)}))()},exec2:function(e){var t=arguments;return _asyncToGenerator(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.length>1&&void 0!==t[1]?t[1]:{},_.defaults(r,{errorBy:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,i,a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.code,i=t.msgKey,a=t.data,o=Ti.I18n.get(i),Ti.Util.isNil(a)||(o+=" : "+Ti.Types.toStr(a)),e.next=5,Ti.Alert(o,{title:"i18n:warn",type:"error"});case 5:if(!_.isFunction(r.errorAs)){e.next=7;break}return e.abrupt("return",r.errorAs({code:n,msgKey:i,data:a}));case 7:return e.abrupt("return",Ti.Err.make(n,a));case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}),n.next=4,Wn.Sys.exec(e,r);case 4:return n.abrupt("return",n.sent);case 5:case"end":return n.stop()}},n)}))()},execJson:function(e){var t=arguments;return _asyncToGenerator(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.length>1&&void 0!==t[1]?t[1]:{as:"json"},n.next=3,WnSys.exec(e,r);case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}},n)}))()},exec2Json:function(e){var t=arguments;return _asyncToGenerator(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.length>1&&void 0!==t[1]?t[1]:{as:"json"},n.next=3,WnSys.exec2(e,r);case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}},n)}))()}};return WnSys}(),Util=function(){var e={isMimeText:function(e){return/^text\//.test(e)||"application/x-javascript"==e||"application/json"==e},isMimeJson:function(e){return"text/json"==e||"application/json"==e},getIconName:function(e){var t=/^<i +class=["'] *(fa|zmdi|im) +(fa|zmdi|im)-([^" ]+) *["']> *<\/i>$/.exec(e);return t?t[3]:e},genPreviewObj:function(t){if(t.thumb)return{type:"image",value:"/o/thumbnail/id:"+t.id};if(t.icon){var n=e.getIconName(t.icon);return Ti.Icons.get(n,{type:"font",value:n})}return Ti.Icons.get(t)},getIconObj:function(t){return t&&t.icon?_.isPlainObject(t.icon)?_.assign(Ti.Icons.get(),t.icon):{type:"font",value:e.getIconName(t.icon)}:Ti.Icons.get(t)},getObjIcon:function(e,t){return e?e.icon||Ti.Icons.get(e):t},getObjThumbIcon:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.icon,n=e.thumb,r=e.mime,i=e.type,a=e.race,o=e.candidateIcon,s=e.timestamp,u=void 0===s?0:s,c=arguments.length>1?arguments[1]:void 0;if(n){var l="/o/content?str=".concat(n);return u>0&&(l+="&_t=".concat(u)),{type:"image",value:l}}return t?{type:"font",value:t}:o||(i||r||a?Ti.Icons.get({type:i,mime:r,race:a}):c)},getObjThumbIcon2:function(t,n){return e.getObjThumbIcon(_.defaults({candidateIcon:t},n))},getObjDisplayName:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Ti.Util.getFallback(e,t,"title","nm")},getAppLink:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.appName,i=void 0===r?"wn.manager":r;n.encoded;return e.getLink("/a/open/".concat(i),t,{pathKey:"ph",encoded:!0})},getAppLinkStr:function(t,n){return e.getAppLink(t,n).toString()},getObjBadges:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.NW,r=void 0===n?null:n,i=t.NE,a=void 0===i?["ln","zmdi-open-in-new"]:i,o=t.SW,s=void 0===o?null:o,u=t.SE,c=void 0===u?null:u,l={};return r&&e[r[0]]&&(l.NW=r[1]),a&&e[a[0]]&&(l.NE=a[1]),s&&e[s[0]]&&(l.SW=s[1]),c&&e[c[0]]&&(l.SE=c[1]),l},getObjThumbInfo:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.exposeHidden,i=void 0!==r&&r,a=n.status,o=void 0===a?{}:a,s=n.progress,u=void 0===s?{}:s,c=n.badges,l=void 0===c?void 0:c;if(t&&t.nm){var d="show";return t.nm.startsWith(".")&&i&&(d=i?"weak":"hide"),{id:t.id,title:e.getObjDisplayName(t),preview:e.genPreviewObj(t),href:e.getAppLinkStr(t),visibility:d,status:o[t.id],progress:u[t.id],badges:e.getObjBadges(t,l)}}},getDownloadLink:function(t){var n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).mode,r=void 0===n?"force":n;return e.getLink("/o/content",t,{pathKey:"str",encoded:!0,params:{d:r}})},getLink:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.pathKey,i=void 0===r?"ph":r,a=n.encoded,o=void 0!==a&&a,s=n.params,u=_objectSpread({},void 0===s?{}:s);if(!t)return{url:e,params2:u};var c=function(e){return o?encodeURIComponent(e):e};return/^(\/|~)/.test(t)?u[i]=c(t):_.isString(t)?u[i]="id:".concat(t):t.id?u[i]="id:".concat(t.id):t.ph&&(u[i]=c(t.ph)),Ti.Util.Link({url:e,params:u})},wrapTreeNode:function(e){if(_.isPlainObject(e)){var t={id:e.id,name:e.nm,leaf:"DIR"!=e.race,rawData:e};if(t.leaf||(t.children=[]),t.id&&t.name)return t}},genQuery:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.vkey,r=void 0===n?"val":n,i=t.wrapArray,a=void 0!==i&&i,o=t.errorAs;return _.isFunction(e)?e:_.isArray(e)?a?function(){return e}:e:_.isString(e)?r?function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(n){var i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=Ti.S.renderBy(e,_defineProperty({},r,n)),t.next=3,Wn.Sys.exec2(i,{as:"json",input:n,errorAs:o});case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}():function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(n){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Wn.Sys.exec2(e,{as:"json",errorAs:o});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}():void 0}};return e}(),Dict={evalOptionsDict:function(e,t){var n=e.options,r=e.findBy,i=e.itemBy,a=e.valueBy,o=e.textBy,s=e.iconBy,u=e.dictShadowed,c=void 0===u||u,l=Ti.DictFactory.DictReferName(n);return l?Ti.DictFactory.CheckDict(l,t):Ti.DictFactory.CreateDict({data:Wn.Util.genQuery(n,{vkey:null}),query:Wn.Util.genQuery(r),item:Wn.Util.genQuery(i,{errorAs:null}),getValue:Ti.Util.genGetter(a||"id|value"),getText:Ti.Util.genGetter(o||"title|text|nm"),getIcon:Ti.Util.genGetter(s||Wn.Util.getObjThumbIcon)},{shadowed:c,hooks:t})},setup:function(e){_.forEach(e,function(e,t){Ti.DictFactory.GetDict(t)||Ti.DictFactory.CreateDict({data:Wn.Util.genQuery(e.data,{vkey:null}),query:Wn.Util.genQuery(e.query),item:Wn.Util.genQuery(e.item),getValue:Ti.Util.genGetter(e.value),getText:Ti.Util.genGetter(e.text),getIcon:Ti.Util.genGetter(e.icon),shadowed:Ti.Util.fallback(e.shadowed,!0)},{name:t})})},hMakerComponents:function(){return Ti.DictFactory.GetOrCreate({data:Wn.Util.genQuery("ti coms -cqn",{vkey:null}),getValue:function(e){return e.name},getText:function(e){return e.title||e.name},getIcon:function(e){return e.icon||"im-plugin"},isMatched:function(e,t){if(e.name==t||e.title==t)return!0;if(e.name&&e.name.indexOf(t)>=0)return!0;if(e.title){if(e.title.indexOf(t)>=0)return!0;var n=Ti.I18n.text(e.title);if(n&&n.indexOf(t)>=0)return!0}return!1},shadowed:!0},{name:"hMakerComponents"})}},OpenObjSelector=function(){function e(){return(e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n,r,i,a,o,s,u,c,l,d,p,f,m,v,h,g,y,b,x,T,k,w,O,j,S,I,R,A,W,C,P=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=P.length>0&&void 0!==P[0]?P[0]:"~",n=P.length>1&&void 0!==P[1]?P[1]:{},r=n.title,i=void 0===r?"i18n:select":r,a=n.icon,o=void 0===a?"im-folder-open":a,s=n.type,u=void 0===s?"info":s,c=n.closer,l=void 0===c||c,d=n.textOk,p=void 0===d?"i18n:ok":d,f=n.textCancel,m=void 0===f?"i18n:cancel":f,v=n.position,h=void 0===v?"top":v,g=n.width,y=void 0===g?"80%":g,b=n.height,x=void 0===b?"90%":b,T=n.spacing,k=n.multi,w=void 0===k||k,O=n.fromIndex,j=void 0===O?0:O,S=n.homePath,I=void 0===S?Wn.Session.getHomePath():S,R=n.selected,A=void 0===R?[]:R,e.next=4,Wn.Io.loadMeta(t);case 4:if(W=e.sent){e.next=7;break}return e.abrupt("return",Ti.Toast.Open({content:"i18n:e-io-obj-noexistsf",vars:_.isString(t)?{ph:t,nm:Ti.Util.getFileName(t)}:t.ph},"warn"));case 7:return e.next=9,Ti.App.Open({type:u,width:y,height:x,spacing:T,position:h,closer:l,icon:o,title:i,actions:[{text:p,handler:function(e){return e.$main.myChecked}},{text:m,handler:function(){}}],modules:{current:"@mod:wn/obj-meta",main:"@mod:wn/obj-current"},comType:"modal-inner-body",components:[{name:"modal-inner-body",globally:!1,data:{myChecked:[],myShown:{}},props:{icon:void 0,text:void 0,trimed:void 0,placeholder:void 0,valueCase:void 0,value:void 0},template:'<ti-gui\n          :layout="theLayout"\n          :schema="theSchema"\n          :shown="myShown"\n          :can-loading="true"\n          :loading-as="status.reloading"\n          @sky::item:active="OnCurrentMetaChange"\n          @arena::open="OnCurrentMetaChange"\n          @arena::select="OnArenaSelect"/>',computed:_objectSpread({},Vuex.mapGetters("current",{obj:"get",objHome:"getHome",objIsHome:"isHome",objHasParent:"hasParent",objParentIsHome:"parentIsHome"}),{},Vuex.mapState("main",["data","status"]),{theCrumbData:function(){var e=this;return Wn.Obj.evalCrumbData({meta:_.get(this.obj,"meta"),ancestors:_.get(this.obj,"ancestors"),fromIndex:j,homePath:I},function(t){t.asterisk=_.get(e.mainStatus,"changed")})},theLayout:function(){return{type:"rows",border:!0,blocks:[{name:"sky",size:".5rem",body:"sky"},{name:"arena",body:"main"}]}},theSchema:function(){return{sky:{comType:"ti-crumb",comConf:{data:this.theCrumbData}},main:{comType:"wn-adaptlist",comConf:{meta:this.obj,data:this.data,status:this.status,multi:w,listConf:{resizeDelay:200}}}}}}),methods:{OnCurrentMetaChange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.id,n=e.path,r=e.value;this.open(t||n||r)},OnArenaSelect:function(e){var t=e.checked;this.myChecked=_.filter(t,function(e){return"FILE"==e.race})},open:function(e){var t=this;return _asyncToGenerator(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return");case 2:if(!_.isString(e)){n.next=6;break}return n.next=5,Wn.Io.loadMetaBy(e);case 5:e=n.sent;case 6:e&&"DIR"==e.race&&((r=Ti.App(t)).dispatch("current/reload",e),r.dispatch("main/reload",e));case 7:case"end":return n.stop()}},n)}))()}},mounted:function(){this.open(W)}}]});case 9:return C=e.sent,e.abrupt("return",C);case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}return function(){return e.apply(this,arguments)}}(),OpenThingManager=function(){function e(){return(e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,r,i,a,o,s,u,c,l,d,p,f,m,v,h,g,y,b,x,T=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=T.length>1&&void 0!==T[1]?T[1]:{},r=n.textOk,i=void 0===r?"i18n:ok":r,a=n.icon,o=void 0===a?"fas-database":a,s=n.title,u=n.ok,c=void 0===u?function(e){return e.result}:u,l=n.textCancel,d=void 0===l?"i18n:close":l,p=n.position,f=void 0===p?"top":p,m=n.width,v=void 0===m?"96%":m,h=n.height,g=void 0===h?"96%":h,y=n.spacing,!Ti.Util.isNil(t)){e.next=5;break}return e.next=4,Ti.Toast.Open("ThingSet path is nil","warn");case 4:return e.abrupt("return",e.sent);case 5:if(!_.isString(t)){e.next=11;break}return e.next=8,Wn.Io.loadMeta(t);case 8:e.t0=e.sent,e.next=12;break;case 11:e.t0=t;case 12:if(b=e.t0){e.next=17;break}return e.next=16,Ti.Toast.Open("Fail to found ThingSet: ".concat(t),"warn");case 16:return e.abrupt("return",e.sent);case 17:return b.th_auto_select=!1,e.next=20,Wn.Sys.exec("ti views id:".concat(b.id," -cqn"),{as:"json"});case 20:return x=e.sent,e.next=23,Ti.App.Open({icon:o,title:s||b.title||b.nm,position:f,width:v,height:g,escape:!1,topActions:x.actions,textOk:i,textCancel:d,ok:c,modules:{current:"@mod:wn/obj-current",main:"@mod:wn/thing"},comType:"wn-thing-manager",comConf:{"...":"=Main",emitChange:!0},components:["@com:wn/thing/manager"],preload:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.commit("current/setMeta",b),e.next=3,t.dispatch("main/reload",b);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()});case 23:return e.abrupt("return",e.sent);case 24:case"end":return e.stop()}},e)}))).apply(this,arguments)}return function(t){return e.apply(this,arguments)}}(),EditObjMeta=function(){function e(){return(e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n,r,i,a,o,s,u,c,l,d,p,f,m,v,h,g,y,b,x,T,k,w,O,j,S,I,R,A,W,C,P,$,M,D,U,G,N,E,F,H,L,B=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=B.length>0&&void 0!==B[0]?B[0]:"~",n=B.length>1&&void 0!==B[1]?B[1]:{},r=n.icon,i=n.title,a=n.type,o=void 0===a?"info":a,s=n.closer,u=void 0===s||s,c=n.textOk,l=void 0===c?"i18n:ok":c,d=n.textCancel,p=void 0===d?"i18n:cancel":d,f=n.position,m=void 0===f?"top":f,v=n.width,h=void 0===v?640:v,g=n.height,y=void 0===g?"80%":g,b=n.spacing,x=n.currentTab,T=void 0===x?0:x,k=n.fields,w=void 0===k?[]:k,O=n.fixedKeys,j=void 0===O?["thumb"]:O,S=n.saveKeys,I=void 0===S?["thumb"]:S,R=n.autoSave,A=void 0===R||R,W=t,!_.isString(W)){e.next=7;break}return e.next=6,Wn.Io.loadMeta(t);case 6:W=e.sent;case 7:if(C={},_.forEach(j,function(e){return C[e]=!0}),P={},_.forEach(I,function(e){return P[e]=!0}),"auto"!=w){e.next=16;break}return e.next=14,Wn.Sys.exec2("ti metas id:".concat(W.id," -cqn"),{as:"json"});case 14:($=e.sent)&&(w=$.fields,T=$.currentTab||T||0);case 16:return!_.isEmpty(w)&&_.isArray(w)||(w=[{title:"basic",fields:["id","nm","title","icon","thumb","ph","race","tp","mime","width","height","len"]},{title:"privilege",fields:["c","m","g","md","pvg"]},{title:"timestamp",fields:["ct","lm","expi"]},{title:"others",fields:["..."]}]),M=Wn.Obj.evalFields(W,w,function(e){if(C[e.uniqKey])return e;if(!e.quickName||!_.isUndefined(e.value))return e}),D=r||Wn.Util.getObjIcon(W,"zmdi-info-outline"),U=i||Wn.Util.getObjDisplayName(W),e.next=22,Ti.App.Open({type:o,width:h,height:y,spacing:b,position:m,closer:u,icon:D,title:U,actions:[{text:l,handler:function(e){var t=e.$main;return _.cloneDeep({updates:t.updates,data:t.meta})}},{text:p,handler:function(e){var t,n=e.$main,r=_createForOfIteratorHelper(_.keys(n.updates));try{for(r.s();!(t=r.n()).done;){var i=t.value;if(P[i])return _.cloneDeep({updates:n.updates,data:n.meta})}}catch(e){r.e(e)}finally{r.f()}}}],comType:"modal-inner-body",components:[{name:"modal-inner-body",globally:!1,data:{myFormFields:M,currentTab:T,meta:W,updates:{}},template:'<ti-form\n          mode="tab"\n          :current-tab="currentTab"\n          :fields="myFormFields"\n          :data="meta"\n          @field:change="onFieldChange"\n          @change="onChange"\n          />',methods:{onChange:function(e){this.meta=e},onFieldChange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name,n=e.value,r=Ti.Types.toObjByPair({name:t,value:n});this.updates=_.assign({},this.updates,r)}}},"@com:ti/form","@com:wn/imgfile"]});case 22:if(G=e.sent){e.next=25;break}return e.abrupt("return");case 25:if(N=G.updates,E=!1,!A||_.isEmpty(N)){e.next=37;break}return F=JSON.stringify(N),H="obj 'id:".concat(W.id,"' -ocqn -u"),e.next=32,Wn.Sys.exec2(H,{input:F,as:"json"});case 32:return L=e.sent,e.next=35,Ti.Toast.Open("i18n:save-done","success");case 35:return E=!0,e.abrupt("return",{updates:N,data:L,saved:E});case 37:return e.abrupt("return",G);case 38:case"end":return e.stop()}},e)}))).apply(this,arguments)}return function(){return e.apply(this,arguments)}}(),EditObjContent=function(){function e(){return(e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n,r,i,a,o,s,u,c,l,d,p,f,m,v,h,g,y,b,x,T,k,w,O,j,S,I,R,A,W,C,P,$=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=$.length>0&&void 0!==$[0]?$[0]:"~",n=$.length>1&&void 0!==$[1]?$[1]:{},r=n.title,i=n.icon,a=n.type,o=void 0===a?"info":a,s=n.closer,u=void 0===s||s,c=n.textOk,l=void 0===c?void 0:c,d=n.textCancel,p=void 0===d?"i18n:cancel":d,f=n.position,m=void 0===f?"top":f,v=n.width,h=void 0===v?640:v,g=n.height,y=void 0===g?"80%":g,b=n.spacing,x=n.readonly,T=void 0!==x&&x,k=n.showEditorTitle,w=void 0===k||k,O=n.content,j=n.blankText,S=void 0===j?"i18n:blank":j,I=t,!_.isString(I)){e.next=7;break}return e.next=6,Wn.Io.loadMeta(t);case 6:I=e.sent;case 7:if(_.isUndefined(l)&&(l=this.saveBy?"i18n:save":"i18n:ok"),R=Ti.Util.isNil(O),A=i||Wn.Util.getObjIcon(I,"zmdi-receipt"),W=r||"i18n:edit",!R){e.next=17;break}return e.next=14,Wn.Io.loadContent(I);case 14:e.t0=e.sent,e.next=18;break;case 17:e.t0=O;case 18:return C=e.t0,e.next=21,Ti.App.Open({type:o,width:h,height:y,spacing:b,position:m,closer:u,title:W,result:C,comType:"ti-text-raw",comConf:{readonly:T,blankText:S,icon:A,title:Wn.Util.getObjDisplayName(I),content:C,showTitle:w,ignoreKeyUp:!0},components:["@com:ti/text/raw"]});case 21:if(P=e.sent,!R||_.isUndefined(P)||P==C){e.next=27;break}return e.next=25,Wn.Io.saveContentAsText(I,P);case 25:return e.next=27,Ti.Toast.Open("i18n:save-done","success");case 27:return e.abrupt("return",P);case 28:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}return function(){return e.apply(this,arguments)}}(),EditTiComponent=function(){function e(){return(e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n,r,i,a,o,s,u,c,l,d,p,f,m,v,h,g,y,b,x,T,k,w,O=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=O.length>0&&void 0!==O[0]?O[0]:{},n=t.comType,r=t.comConf,i=O.length>1&&void 0!==O[1]?O[1]:{},a=i.icon,o=void 0===a?"fas-pencil-ruler":a,s=i.title,u=void 0===s?"i18n:edit-com":s,c=i.type,l=void 0===c?"info":c,d=i.closer,p=void 0===d||d,f=i.textOk,m=void 0===f?"i18n:ok":f,v=i.textCancel,h=void 0===v?"i18n:cancel":v,g=i.position,y=void 0===g?"top":g,b=i.width,x=void 0===b?800:b,T=i.height,k=void 0===T?"90%":T,w=i.spacing,e.next=4,Ti.App.Open({type:l,width:x,height:k,spacing:w,position:y,closer:p,icon:o,title:u,textOk:m,textCancel:h,comType:"hmaker-edit-com",comConf:{value:{comType:n,comConf:r}},result:{comType:n,comConf:_.cloneDeep(r)},components:["@com:hmaker/edit-com"]});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}return function(){return e.apply(this,arguments)}}(),WALNUT_VERSION="1.0",HOOKs={},Wn={Version:WALNUT_VERSION,Io:Io,Obj:Obj,Session:Session,Sys:Sys,Util:Util,Dict:Dict,OpenObjSelector:OpenObjSelector,EditObjMeta:EditObjMeta,EditObjContent:EditObjContent,EditTiComponent:EditTiComponent,OpenThingManager:OpenThingManager,addHook:function(e,t){Ti.Util.pushValue(HOOKs,e,t)},doHook:function(e,t){var n=HOOKs[e];if(_.isArray(n)&&n.length>0){var r,i=_createForOfIteratorHelper(n);try{for(i.s();!(r=i.n()).done;){(0,r.value)(t)}}catch(e){i.e(e)}finally{i.f()}}}};exports.Wn=Wn;var _default=Wn;exports.default=_default,window&&(window.Wn=Wn);