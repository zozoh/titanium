"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = exports.Wn = void 0;

function _toArray(arr) { return _arrayWithHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableRest(); }

function _iterableToArray(iter) { if (typeof Symbol !== "undefined" && Symbol.iterator in Object(iter)) return Array.from(iter); }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _iterableToArrayLimit(arr, i) { if (typeof Symbol === "undefined" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _createForOfIteratorHelper(o) { if (typeof Symbol === "undefined" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (o = _unsupportedIterableToArray(o))) { var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e11) { throw _e11; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var it, normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e12) { didErr = true; err = _e12; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(n); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

var Io = function () {
  function e(e) {
    return "/o/" + e;
  }

  function t(e, t) {
    if (!e.ok) {
      if (_.isUndefined(t)) throw e;
      return t;
    }

    return e.data;
  }

  var i = {
    isFullObjId: function isFullObjId(e) {
      return /^[0-9a-v]{26}(:.+)?$/.test(e);
    },
    isFullObjIdPath: function isFullObjIdPath(e) {
      return /^id:[0-9a-v]{26}(:.+)?$/.test(e);
    },
    loadMetaBy: function loadMetaBy(e, t) {
      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {
        var n, a;
        return regeneratorRuntime.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                if (!i.isFullObjId(e)) {
                  _context.next = 4;
                  break;
                }

                _context.next = 3;
                return i.loadMetaById(e);

              case 3:
                return _context.abrupt("return", _context.sent);

              case 4:
                if (!/^(id:|\/|~)/.test(e)) {
                  _context.next = 8;
                  break;
                }

                _context.next = 7;
                return i.loadMeta(e);

              case 7:
                return _context.abrupt("return", _context.sent);

              case 8:
                n = t ? _.isString(t) ? Ti.Util.getParentPath(t) : "FILE" == t.race ? "id:" + t.pid : "id:" + t.id : "~";
                a = Ti.Util.appendPath(n, e);
                _context.next = 12;
                return i.loadMeta(a);

              case 12:
                return _context.abrupt("return", _context.sent);

              case 13:
              case "end":
                return _context.stop();
            }
          }
        }, _callee);
      }))();
    },
    loadMetaById: function () {
      var _loadMetaById = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(e) {
        return regeneratorRuntime.wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                _context2.next = 2;
                return i.loadMeta("id:" + e);

              case 2:
                return _context2.abrupt("return", _context2.sent);

              case 3:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2);
      }));

      function loadMetaById(_x) {
        return _loadMetaById.apply(this, arguments);
      }

      return loadMetaById;
    }(),
    loadMeta: function loadMeta(i) {
      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {
        var n;
        return regeneratorRuntime.wrap(function _callee3$(_context3) {
          while (1) {
            switch (_context3.prev = _context3.next) {
              case 0:
                n = e("fetch");
                _context3.t0 = t;
                _context3.next = 4;
                return Ti.Http.get(n, {
                  params: {
                    str: i
                  },
                  as: "json"
                });

              case 4:
                _context3.t1 = _context3.sent;
                return _context3.abrupt("return", (0, _context3.t0)(_context3.t1, null));

              case 6:
              case "end":
                return _context3.stop();
            }
          }
        }, _callee3);
      }))();
    },
    loadMetaAt: function loadMetaAt(e, t) {
      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4() {
        var n;
        return regeneratorRuntime.wrap(function _callee4$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                n = t;
                e && !/^(~\/|\/|id:)/.test(t) && (n = "id:".concat(e.pid, "/").concat(t));
                _context4.next = 4;
                return i.loadMeta(n);

              case 4:
                return _context4.abrupt("return", _context4.sent);

              case 5:
              case "end":
                return _context4.stop();
            }
          }
        }, _callee4);
      }))();
    },
    loadAncestors: function loadAncestors(i) {
      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee5() {
        var n;
        return regeneratorRuntime.wrap(function _callee5$(_context5) {
          while (1) {
            switch (_context5.prev = _context5.next) {
              case 0:
                n = e("ancestors");
                _context5.t0 = t;
                _context5.next = 4;
                return Ti.Http.get(n, {
                  params: {
                    str: i
                  },
                  as: "json"
                });

              case 4:
                _context5.t1 = _context5.sent;
                _context5.t2 = [];
                return _context5.abrupt("return", (0, _context5.t0)(_context5.t1, _context5.t2));

              case 7:
              case "end":
                return _context5.stop();
            }
          }
        }, _callee5);
      }))();
    },
    loadChildren: function loadChildren(n) {
      var _arguments = arguments;
      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee6() {
        var _ref, a, r, _ref$sort, s, o, _ref$match, l, _i, c, _iterator, _step, _e;

        return regeneratorRuntime.wrap(function _callee6$(_context6) {
          while (1) {
            switch (_context6.prev = _context6.next) {
              case 0:
                _ref = _arguments.length > 1 && _arguments[1] !== undefined ? _arguments[1] : {}, a = _ref.skip, r = _ref.limit, _ref$sort = _ref.sort, s = _ref$sort === void 0 ? {
                  nm: 1
                } : _ref$sort, o = _ref.mine, _ref$match = _ref.match, l = _ref$match === void 0 ? {} : _ref$match;

                if (n) {
                  _context6.next = 3;
                  break;
                }

                return _context6.abrupt("return", null);

              case 3:
                if (!("DIR" != n.race)) {
                  _context6.next = 5;
                  break;
                }

                return _context6.abrupt("return", []);

              case 5:
                if (!(n.mnt || n.ln)) {
                  _context6.next = 12;
                  break;
                }

                _i = e("children");
                _context6.t0 = t;
                _context6.next = 10;
                return Ti.Http.get(_i, {
                  params: {
                    str: "id:".concat(n.id),
                    pg: !0
                  },
                  as: "json"
                });

              case 10:
                _context6.t1 = _context6.sent;
                return _context6.abrupt("return", (0, _context6.t0)(_context6.t1));

              case 12:
                l.pid = n.id;
                _context6.next = 15;
                return i.find({
                  skip: a,
                  limit: r,
                  sort: s,
                  mine: o,
                  match: l
                });

              case 15:
                c = _context6.sent;

                if (n.ph && c && _.isArray(c.list)) {
                  _iterator = _createForOfIteratorHelper(c.list);

                  try {
                    for (_iterator.s(); !(_step = _iterator.n()).done;) {
                      _e = _step.value;
                      _e.ph || (_e.ph = Ti.Util.appendPath(n.ph, _e.nm));
                    }
                  } catch (err) {
                    _iterator.e(err);
                  } finally {
                    _iterator.f();
                  }
                }

                return _context6.abrupt("return", c);

              case 18:
              case "end":
                return _context6.stop();
            }
          }
        }, _callee6);
      }))();
    },
    find: function find() {
      var _arguments2 = arguments;
      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee7() {
        var _ref2, _ref2$skip, i, _ref2$limit, n, _ref2$sort, a, _ref2$mine, r, _ref2$match, s, o;

        return regeneratorRuntime.wrap(function _callee7$(_context7) {
          while (1) {
            switch (_context7.prev = _context7.next) {
              case 0:
                _ref2 = _arguments2.length > 0 && _arguments2[0] !== undefined ? _arguments2[0] : {}, _ref2$skip = _ref2.skip, i = _ref2$skip === void 0 ? 0 : _ref2$skip, _ref2$limit = _ref2.limit, n = _ref2$limit === void 0 ? 100 : _ref2$limit, _ref2$sort = _ref2.sort, a = _ref2$sort === void 0 ? {} : _ref2$sort, _ref2$mine = _ref2.mine, r = _ref2$mine === void 0 ? !0 : _ref2$mine, _ref2$match = _ref2.match, s = _ref2$match === void 0 ? {} : _ref2$match;
                o = e("find");
                _context7.t0 = t;
                _context7.next = 5;
                return Ti.Http.get(o, {
                  params: _.assign({}, s, {
                    _l: n,
                    _o: i,
                    _me: r,
                    _s: JSON.stringify(a)
                  }),
                  as: "json"
                });

              case 5:
                _context7.t1 = _context7.sent;
                return _context7.abrupt("return", (0, _context7.t0)(_context7.t1));

              case 7:
              case "end":
                return _context7.stop();
            }
          }
        }, _callee7);
      }))();
    },
    findList: function findList() {
      var _arguments3 = arguments;
      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee8() {
        var e, t;
        return regeneratorRuntime.wrap(function _callee8$(_context8) {
          while (1) {
            switch (_context8.prev = _context8.next) {
              case 0:
                e = _arguments3.length > 0 && _arguments3[0] !== undefined ? _arguments3[0] : {};
                _context8.next = 3;
                return i.find(e);

              case 3:
                t = _context8.sent;
                return _context8.abrupt("return", t && _.isArray(t.list) ? t.list : []);

              case 5:
              case "end":
                return _context8.stop();
            }
          }
        }, _callee8);
      }))();
    },
    findInBy: function findInBy(e, t) {
      var _arguments4 = arguments;
      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee9() {
        var _ref3, _ref3$skip, n, _ref3$limit, a, _ref3$sort, r, _ref3$mine, s, _ref3$match, o, _ref3$keys, l, _ref3$dftKey, c, _t, _iterator2, _step2, _i3, _i2, _n, _e2;

        return regeneratorRuntime.wrap(function _callee9$(_context9) {
          while (1) {
            switch (_context9.prev = _context9.next) {
              case 0:
                _ref3 = _arguments4.length > 2 && _arguments4[2] !== undefined ? _arguments4[2] : {}, _ref3$skip = _ref3.skip, n = _ref3$skip === void 0 ? 0 : _ref3$skip, _ref3$limit = _ref3.limit, a = _ref3$limit === void 0 ? 100 : _ref3$limit, _ref3$sort = _ref3.sort, r = _ref3$sort === void 0 ? {} : _ref3$sort, _ref3$mine = _ref3.mine, s = _ref3$mine === void 0 ? !0 : _ref3$mine, _ref3$match = _ref3.match, o = _ref3$match === void 0 ? {} : _ref3$match, _ref3$keys = _ref3.keys, l = _ref3$keys === void 0 ? {
                  "^[0-9a-v]{26}$": ["id", "${val}"]
                } : _ref3$keys, _ref3$dftKey = _ref3.dftKey, c = _ref3$dftKey === void 0 ? ["nm", "^.*${val}.*$"] : _ref3$dftKey;

                if (_.isUndefined(e)) {
                  _context9.next = 23;
                  break;
                }

                _t = c;
                _iterator2 = _createForOfIteratorHelper(_.keys(l));
                _context9.prev = 4;

                _iterator2.s();

              case 6:
                if ((_step2 = _iterator2.n()).done) {
                  _context9.next = 13;
                  break;
                }

                _i3 = _step2.value;

                if (!new RegExp(_i3).test(e)) {
                  _context9.next = 11;
                  break;
                }

                _t = l[_i3];
                return _context9.abrupt("break", 13);

              case 11:
                _context9.next = 6;
                break;

              case 13:
                _context9.next = 18;
                break;

              case 15:
                _context9.prev = 15;
                _context9.t0 = _context9["catch"](4);

                _iterator2.e(_context9.t0);

              case 18:
                _context9.prev = 18;

                _iterator2.f();

                return _context9.finish(18);

              case 21:
                _i2 = _t[0], _n = Ti.S.renderBy(_t[1], {
                  val: e
                });
                o[_i2] = _n;

              case 23:
                if (!t) {
                  _context9.next = 28;
                  break;
                }

                _context9.next = 26;
                return i.loadMeta(t);

              case 26:
                _e2 = _context9.sent;
                o.pid = _e2.id;

              case 28:
                _context9.next = 30;
                return i.find({
                  skip: n,
                  limit: a,
                  sort: r,
                  mine: s,
                  match: o
                });

              case 30:
                return _context9.abrupt("return", _context9.sent);

              case 31:
              case "end":
                return _context9.stop();
            }
          }
        }, _callee9, null, [[4, 15, 18, 21]]);
      }))();
    },
    findListInBy: function findListInBy(e, t) {
      var _arguments5 = arguments;
      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee10() {
        var n, a;
        return regeneratorRuntime.wrap(function _callee10$(_context10) {
          while (1) {
            switch (_context10.prev = _context10.next) {
              case 0:
                n = _arguments5.length > 2 && _arguments5[2] !== undefined ? _arguments5[2] : {};
                _context10.next = 3;
                return i.findInBy(e, t, n);

              case 3:
                a = _context10.sent;
                return _context10.abrupt("return", a && _.isArray(a.list) ? a.list : []);

              case 5:
              case "end":
                return _context10.stop();
            }
          }
        }, _callee10);
      }))();
    },
    loadContent: function loadContent(t) {
      var _arguments6 = arguments;
      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee11() {
        var _ref4, _ref4$as, n, a, _i4;

        return regeneratorRuntime.wrap(function _callee11$(_context11) {
          while (1) {
            switch (_context11.prev = _context11.next) {
              case 0:
                _ref4 = _arguments6.length > 1 && _arguments6[1] !== undefined ? _arguments6[1] : {}, _ref4$as = _ref4.as, n = _ref4$as === void 0 ? "text" : _ref4$as;
                _context11.t0 = _.isString(t);

                if (!_context11.t0) {
                  _context11.next = 6;
                  break;
                }

                _context11.next = 5;
                return i.loadMeta(t);

              case 5:
                t = _context11.sent;

              case 6:
                if (!(!t || "DIR" == t.race)) {
                  _context11.next = 8;
                  break;
                }

                return _context11.abrupt("return", null);

              case 8:
                a = t.mime || "application/octet-stream";

                if (!Wn.Util.isMimeText(a)) {
                  _context11.next = 14;
                  break;
                }

                _i4 = e("content");
                _context11.next = 13;
                return Ti.Http.get(_i4, {
                  params: {
                    str: "id:" + t.id,
                    d: "raw"
                  },
                  as: n
                });

              case 13:
                return _context11.abrupt("return", _context11.sent);

              case 14:
                return _context11.abrupt("return", t.sha1);

              case 15:
              case "end":
                return _context11.stop();
            }
          }
        }, _callee11);
      }))();
    },
    saveContentAsText: function saveContentAsText(t, i) {
      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee12() {
        var n, a, r;
        return regeneratorRuntime.wrap(function _callee12$(_context12) {
          while (1) {
            switch (_context12.prev = _context12.next) {
              case 0:
                if (!(!t || "DIR" == t.race)) {
                  _context12.next = 2;
                  break;
                }

                throw Ti.Err.make("e-wn-io-writeNoFile", t.ph || t.nm);

              case 2:
                n = {
                  str: "id:" + t.id,
                  content: i
                };
                a = e("/save/text");
                _context12.next = 6;
                return Ti.Http.post(a, {
                  params: n,
                  as: "json"
                });

              case 6:
                r = _context12.sent;

                if (r.ok) {
                  _context12.next = 9;
                  break;
                }

                throw Ti.Err.make(r.errCode, r.data, r.msg);

              case 9:
                return _context12.abrupt("return", r.data);

              case 10:
              case "end":
                return _context12.stop();
            }
          }
        }, _callee12);
      }))();
    },
    uploadFile: function uploadFile(t) {
      var _arguments7 = arguments;
      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee13() {
        var _ref5, _ref5$target, i, _ref5$mode, n, _ref5$tmpl, a, _ref5$progress, r, s;

        return regeneratorRuntime.wrap(function _callee13$(_context13) {
          while (1) {
            switch (_context13.prev = _context13.next) {
              case 0:
                _ref5 = _arguments7.length > 1 && _arguments7[1] !== undefined ? _arguments7[1] : {}, _ref5$target = _ref5.target, i = _ref5$target === void 0 ? "~" : _ref5$target, _ref5$mode = _ref5.mode, n = _ref5$mode === void 0 ? "a" : _ref5$mode, _ref5$tmpl = _ref5.tmpl, a = _ref5$tmpl === void 0 ? "${major}(${nb})${suffix}" : _ref5$tmpl, _ref5$progress = _ref5.progress, r = _ref5$progress === void 0 ? _.identity : _ref5$progress;
                s = e("/save/stream");
                _context13.next = 4;
                return Ti.Http.post(s, {
                  file: t,
                  progress: r,
                  params: {
                    str: i,
                    nm: t.name,
                    sz: t.size,
                    mime: t.type,
                    m: n,
                    tmpl: a
                  },
                  as: "json"
                });

              case 4:
                return _context13.abrupt("return", _context13.sent);

              case 5:
              case "end":
                return _context13.stop();
            }
          }
        }, _callee13);
      }))();
    },
    getFormedPath: function getFormedPath(e) {
      var t = e.ph ? e.ph : e,
          i = Wn.Session.getHomePath(),
          n = Ti.Util.getRelativePath(i, t, "");
      return Ti.Util.appendPath("~", n);
    },
    formatObjPath: function formatObjPath(e, t, n) {
      var a = {
        path: function path() {
          return n ? Ti.Util.getRelativePath(n.ph, e.ph) : i.getFormedPath(e.ph);
        },
        fullPath: function fullPath() {
          return e.ph;
        },
        idPath: function idPath() {
          return "id:".concat(e.id);
        },
        id: function id() {
          return e.id;
        },
        obj: function obj() {
          var t = n || ["id", "nm", "thumb", "title", "mime", "tp", "sha1", "len"];
          return _.pick(e, t);
        }
      }[t];
      if (!a) throw "Invalid mode : " + t;
      return a();
    }
  };
  return i;
}(),
    Obj = function () {
  var e = {
    id: {
      title: "i18n:wn-key-id",
      name: "id"
    },
    nm: {
      title: "i18n:wn-key-nm",
      name: "nm",
      display: "<=ti-label>",
      comType: "ti-input"
    },
    title: {
      title: "i18n:wn-key-title",
      name: "title",
      display: "<=ti-label>",
      comType: "ti-input"
    },
    icon: {
      title: "i18n:wn-key-icon",
      name: "icon",
      width: "auto",
      comType: "ti-input-icon"
    },
    ph: {
      title: "i18n:wn-key-ph",
      name: "ph",
      comConf: {
        className: "is-break-word"
      }
    },
    thumb: {
      title: "i18n:wn-key-thumb",
      name: "thumb",
      checkEquals: !1,
      serializer: {
        name: "Ti.Types.toStr",
        args: "id:${id}"
      },
      comType: "wn-imgfile",
      comConf: {
        target: "~/.thumbnail/gen/${id}.jpg",
        filter: "cover(256,256)",
        quality: .372
      }
    },
    race: {
      title: "i18n:wn-key-race",
      name: "race",
      comConf: {
        format: "i18n:wn-race-${race}"
      }
    },
    mime: {
      title: "i18n:wn-key-mime",
      name: "mime"
    },
    tp: {
      title: "i18n:wn-key-tp",
      name: "tp"
    },
    ct: {
      title: "i18n:wn-key-ct",
      name: "ct",
      type: "AMS"
    },
    lm: {
      title: "i18n:wn-key-lm",
      name: "lm",
      type: "AMS"
    },
    expi: {
      title: "i18n:wn-key-expi",
      name: "expi",
      type: "AMS"
    },
    pid: {
      title: "i18n:wn-key-pid",
      name: "pid"
    },
    d0: {
      title: "i18n:wn-key-d0",
      name: "d0"
    },
    d1: {
      title: "i18n:wn-key-d1",
      name: "d1"
    },
    c: {
      title: "i18n:wn-key-c",
      name: "c"
    },
    m: {
      title: "i18n:wn-key-m",
      name: "m"
    },
    g: {
      title: "i18n:wn-key-g",
      name: "g"
    },
    data: {
      title: "i18n:wn-key-data",
      name: "data"
    },
    sha1: {
      title: "i18n:wn-key-sha1",
      name: "sha1"
    },
    md: {
      title: "i18n:wn-key-md",
      name: "md"
    },
    pvg: {
      title: "i18n:wn-key-pvg",
      name: "pvg"
    },
    width: {
      title: "i18n:wn-key-width",
      name: "width"
    },
    height: {
      title: "i18n:wn-key-height",
      name: "height"
    },
    duration: {
      title: "i18n:wn-key-duration",
      name: "duration"
    },
    len: {
      title: "i18n:wn-key-len",
      name: "len",
      width: "auto",
      transformer: function transformer(e) {
        return Ti.S.sizeText(e, {
          bytes: !0
        });
      }
    }
  },
      t = {
    isBuiltInFields: function isBuiltInFields(t) {
      return !!e[t];
    },
    getGroupTitle: function getGroupTitle(e) {
      return /^(basic|privilege|thumb|timestamp|more|advance|customized|others)$/.test(e) ? "i18n:wn-key-grp-".concat(e) : e;
    },
    getField: function getField(t) {
      var i = e[t];
      return i ? _.cloneDeep(i) : {
        title: t,
        name: t,
        type: "String"
      };
    },
    evalFields: function evalFields() {
      var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
      var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];
      var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : _.identity;

      var n = function n() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
        var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];
        var a = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
        return _.forEach(t, function (t) {
          if ("..." == t) return void i.push(t);
          var r,
              s = !1;
          if (_.isString(t)) s = !0, r = Wn.Obj.getField(t);else if (_.isArray(t.fields)) {
            if (r = {
              title: Wn.Obj.getGroupTitle(t.title),
              type: "Group",
              fields: []
            }, n(t.fields, r.fields, a), _.isEmpty(r.fields)) return;
          } else r = t;
          var o = Ti.S.join([r.name], "-");
          a[o] = !0;

          var l = _.get(e, r.name);

          i.push(_.assign(r, {
            quickName: s,
            uniqKey: o,
            value: l
          }));
        }), i;
      },
          a = function a() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
        var n = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];
        var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

        var _iterator3 = _createForOfIteratorHelper(t),
            _step3;

        try {
          for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {
            var _s = _step3.value;
            if ("Group" != _s.type) {
              if ("..." == _s) _.forEach(e, function (e, t) {
                if (Ti.Util.isNil(e) || Wn.Obj.isBuiltInFields(t) || r[t] || t.startsWith("_")) return;
                var a = {
                  Integer: {
                    type: "Number",
                    display: t,
                    comType: "ti-input"
                  },
                  Number: {
                    type: "Number",
                    display: t,
                    comType: "ti-input"
                  },
                  Boolean: {
                    type: "Boolean",
                    comType: "ti-toggle"
                  },
                  Array: {
                    type: "Array",
                    display: {
                      key: t
                    },
                    transformer: "JSON.stringify(null, '  ')",
                    comType: "ti-input-text",
                    comConf: {
                      height: 240
                    }
                  }
                }[Ti.Types.getJsType(e, "String")] || {
                  type: "String",
                  display: {
                    key: t,
                    comConf: {
                      width: "100%",
                      className: _.isString(e) && e.length > 20 ? "is-break-word" : "is-nowrap"
                    }
                  },
                  comType: "ti-input"
                },
                    s = i(_objectSpread({
                  title: t,
                  name: t
                }, a));
                s && n.push(s);
              });else {
                var _e3 = i(_s);

                _e3 && n.push(_e3);
              }
            } else _s.fields = a(_s.fields, [], r), _.isEmpty(_s.fields) || n.push(_s);
          }
        } catch (err) {
          _iterator3.e(err);
        } finally {
          _iterator3.f();
        }

        return n;
      };

      var r = {},
          s = n(t, [], r);
      return s = a(s, [], r);
    },
    isAs: function isAs() {
      var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
      var i = arguments.length > 1 ? arguments[1] : undefined;
      var n = arguments.length > 2 ? arguments[2] : undefined;

      var a = _.get(e, i);

      if (Ti.Util.isNil(a)) return !1;

      if (_.isArray(n)) {
        var _iterator4 = _createForOfIteratorHelper(n),
            _step4;

        try {
          for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {
            var _a = _step4.value;
            if (t.isAs(e, i, _a)) return !0;
          }
        } catch (err) {
          _iterator4.e(err);
        } finally {
          _iterator4.f();
        }

        return !1;
      }

      return _.isString(n) ? n.startsWith("^") ? new RegExp(n).test(a) : n.startsWith("!^") ? !new RegExp(n.substring(1)).test(a) : a == n : !!_.isRegExp(n) && n.test(a);
    },
    isMime: function isMime() {
      var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
      var i = arguments.length > 1 ? arguments[1] : undefined;
      return t.isAs(e, "mime", i);
    },
    isType: function isType() {
      var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
      var i = arguments.length > 1 ? arguments[1] : undefined;
      return t.isAs(e, "type", i);
    },
    evalCrumbData: function evalCrumbData() {
      var _ref6 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
          e = _ref6.meta,
          _ref6$ancestors = _ref6.ancestors,
          t = _ref6$ancestors === void 0 ? [] : _ref6$ancestors,
          _ref6$fromIndex = _ref6.fromIndex,
          i = _ref6$fromIndex === void 0 ? 0 : _ref6$fromIndex,
          _ref6$homePath = _ref6.homePath,
          n = _ref6$homePath === void 0 ? null : _ref6$homePath,
          _ref6$iteratee = _ref6.iteratee,
          a = _ref6$iteratee === void 0 ? _.identity : _ref6$iteratee,
          _ref6$self = _ref6.self,
          r = _ref6$self === void 0 ? _.identity : _ref6$self;

      var s = [];

      if (e) {
        var o = _.map(t),
            l = i;

        if (n) for (n.endsWith("/") && (n = n.substring(0, n.length - 1)); l < o.length; l++) {
          if (o[l].ph == n) break;
        }

        for (; l < o.length; l++) {
          var _t2 = o[l],
              _i5 = {
            icon: Wn.Util.getIconObj(_t2),
            text: Wn.Util.getObjDisplayName(_t2),
            value: _t2.id,
            href: Wn.Util.getAppLink(_t2) + ""
          };
          (_i5 = a(_i5, l, e) || _i5) && s.push(_i5);
        }

        if (r) {
          var _t3 = {
            icon: Wn.Util.getIconObj(e),
            text: Wn.Util.getObjDisplayName(e),
            value: e.id,
            href: null,
            asterisk: _.get(this.mainStatus, "changed")
          };
          _.isFunction(r) && (_t3 = r(_t3, l, e) || _t3), _t3 && s.push(_t3);
        }
      }

      return s;
    }
  };
  return t;
}(),
    Session = function () {
  var e = {},
      t = {},
      i = {
    setup: function setup() {
      var _ref7 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
          e = _ref7.id,
          n = _ref7.uid,
          a = _ref7.unm,
          r = _ref7.grp,
          _ref7$envs = _ref7.envs,
          s = _ref7$envs === void 0 ? {} : _ref7$envs;

      _.assign(t, {
        id: e,
        uid: n,
        unm: a,
        grp: r
      }), i.env(s);
    },
    env: function env(t) {
      if (_.isPlainObject(t)) _.assign(e, t);else {
        if (_.isString(t)) return e[t];
        if (_.isArray(t)) return _.pick(e, t);
      }
      return _.cloneDeep(e);
    },
    getMyId: function getMyId() {
      return t.uid;
    },
    getMyName: function getMyName() {
      return t.unm;
    },
    getMyGroup: function getMyGroup() {
      return t.grp;
    },
    getHomePath: function getHomePath() {
      return i.env("HOME");
    },
    getCurrentPath: function getCurrentPath() {
      var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "~";
      return i.env("PWD") || e;
    },
    getCurrentDomain: function getCurrentDomain() {
      var e = i.getHomePath();
      if (!e) return;
      if ("/root" == e) return "root";
      var t = /^\/home\/(.+)$/.exec(e);
      return t ? t[1] : void 0;
    },
    getApiPrefix: function getApiPrefix() {
      return "/api/".concat(i.getCurrentDomain());
    },
    getApiUrl: function getApiUrl(e) {
      var t = i.getApiPrefix();
      return Ti.Util.appendPath(t, e);
    }
  };
  return i;
}(),
    Sys = function () {
  var WnSysRespParsing = function () {
    var e = /*#__PURE__*/function () {
      function e() {
        var _ref8 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
            _e4 = _ref8.macroObjSep,
            _ref8$eachLine = _ref8.eachLine,
            t = _ref8$eachLine === void 0 ? _.identity : _ref8$eachLine,
            _ref8$macro = _ref8.macro,
            i = _ref8$macro === void 0 ? {} : _ref8$macro;

        _classCallCheck(this, e);

        this.macroObjSep = _e4, this.lastIndex = 0, this.lines = [], this.MACRO = {}, this.__TO = null, this.eachLine = t, this.macro = i;
      }

      _createClass(e, [{
        key: "init",
        value: function init(e) {
          this.content = e;
        }
      }, {
        key: "done",
        value: function done() {
          var _this = this;

          this.updated({
            isLastCalled: !0
          }), _.forOwn(this.MACRO, function (e, t) {
            var i = e.join("\n"),
                n = JSON.parse(i);
            _this.MACRO[t] = n, Ti.InvokeBy(_this.macro, t, [n]);
          });
        }
      }, {
        key: "__push_line",
        value: function __push_line(e) {
          if (e.startsWith(this.macroObjSep)) {
            var t = e.substring(this.macroObjSep.length).trim(),
                _$without = _.without(t.split(/ *: */g), ""),
                _$without2 = _slicedToArray(_$without, 2),
                i = _$without2[0],
                n = _$without2[1],
                a = this[i];

            a && (a[n] = []), this.__TO = {
              key: i,
              name: n
            };
          } else if (this.__TO) {
            var _this$__TO = this.__TO,
                _t4 = _this$__TO.key,
                _i6 = _this$__TO.name;

            this[_t4][_i6].push(e);
          } else this.lines.push(e), this.eachLine(e);
        }
      }, {
        key: "updated",
        value: function updated() {
          var _ref9 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
              _ref9$isLastCalled = _ref9.isLastCalled,
              e = _ref9$isLastCalled === void 0 ? !1 : _ref9$isLastCalled;

          var t = this.content();

          for (; this.lastIndex < t.length;) {
            var i = t.indexOf("\n", this.lastIndex);

            if (i >= this.lastIndex) {
              var _e5 = i + 1;

              i > 0 && "\r" == t[i - 1] && i--;
              var n = t.substring(this.lastIndex, i);
              this.__push_line(n), this.lastIndex = _e5;
            } else {
              if (!e) break;
              {
                var _e6 = t.substring(this.lastIndex);

                this.__push_line(_e6), this.lastIndex = t.length;
              }
            }
          }
        }
      }, {
        key: "getResult",
        value: function getResult() {
          return {
            lines: this.lines,
            macro: this.MACRO
          };
        }
      }]);

      return e;
    }();

    return e;
  }(),
      DFT_MACRO_OBJ_SEP = "%%wn.meta." + Ti.Random.str(10) + "%%",
      WnSys = {
    exec: function exec(cmdText) {
      var _arguments8 = arguments;
      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee14() {
        var _ref10, _ref10$vars, vars, _ref10$input, input, _ref10$appName, appName, _ref10$eachLine, eachLine, _ref10$as, as, _ref10$blankAs, blankAs, _ref10$macroObjSep, macroObjSep, _ref10$autoRunMacro, autoRunMacro, errorBy, _ref10$PWD, PWD, url, params, ing, parsing, re, e, _e$split, _e$split2, t, i, n, a;

        return regeneratorRuntime.wrap(function _callee14$(_context14) {
          while (1) {
            switch (_context14.prev = _context14.next) {
              case 0:
                _ref10 = _arguments8.length > 1 && _arguments8[1] !== undefined ? _arguments8[1] : {}, _ref10$vars = _ref10.vars, vars = _ref10$vars === void 0 ? {} : _ref10$vars, _ref10$input = _ref10.input, input = _ref10$input === void 0 ? "" : _ref10$input, _ref10$appName = _ref10.appName, appName = _ref10$appName === void 0 ? Ti.GetAppName() : _ref10$appName, _ref10$eachLine = _ref10.eachLine, eachLine = _ref10$eachLine === void 0 ? _.identity : _ref10$eachLine, _ref10$as = _ref10.as, as = _ref10$as === void 0 ? "text" : _ref10$as, _ref10$blankAs = _ref10.blankAs, blankAs = _ref10$blankAs === void 0 ? "" : _ref10$blankAs, _ref10$macroObjSep = _ref10.macroObjSep, macroObjSep = _ref10$macroObjSep === void 0 ? DFT_MACRO_OBJ_SEP : _ref10$macroObjSep, _ref10$autoRunMacro = _ref10.autoRunMacro, autoRunMacro = _ref10$autoRunMacro === void 0 ? !0 : _ref10$autoRunMacro, errorBy = _ref10.errorBy, _ref10$PWD = _ref10.PWD, PWD = _ref10$PWD === void 0 ? Wn.Session.getCurrentPath() : _ref10$PWD;
                cmdText = Ti.S.renderBy(cmdText, vars);
                url = "/a/run/".concat(appName), params = {
                  mos: macroObjSep,
                  PWD: PWD,
                  cmd: cmdText,
                  "in": input
                }, ing = {
                  eachLine: eachLine,
                  macroObjSep: macroObjSep
                };
                autoRunMacro && (ing.macro = {
                  update_envs: function update_envs(e) {
                    Wn.Session.env(e), Wn.doHook("update_envs", e);
                  }
                });
                parsing = new WnSysRespParsing(ing);
                _context14.next = 7;
                return Ti.Http.send(url, {
                  method: "POST",
                  params: params,
                  as: "text",
                  created: function created(e) {
                    parsing.init(function () {
                      return e.responseText;
                    });
                  }
                })["catch"](function (e) {
                  parsing.isError = !0;
                })["finally"](function () {
                  parsing.done();
                });

              case 7:
                re = parsing.getResult();

                if (!(Ti.IsInfo("Wn.Sys") && console.log("Wn.Sys.exec@return", re), parsing.isError)) {
                  _context14.next = 16;
                  break;
                }

                e = re.lines.join("\n");

                if (!_.isFunction(errorBy)) {
                  _context14.next = 15;
                  break;
                }

                _e$split = e.split(/ *: */), _e$split2 = _toArray(_e$split), t = _e$split2[0], i = _e$split2.slice(1), n = i.join(" : ");
                t = _.trim(t);
                a = t.replace(/[.]/g, "-");
                return _context14.abrupt("return", errorBy({
                  code: t,
                  msgKey: a,
                  data: n
                }));

              case 15:
                throw e;

              case 16:
                return _context14.abrupt("return", {
                  raw: function raw() {
                    return re;
                  },
                  lines: function lines() {
                    return re.lines;
                  },
                  macro: function macro() {
                    return re.macro;
                  },
                  text: function text() {
                    return re.lines.join("\n");
                  },
                  json: function json() {
                    var e = re.lines.join("\n");
                    Ti.S.isBlank(e) && (e = blankAs);

                    try {
                      return JSON.parse(e);
                    } catch (t) {
                      throw console.error("Error [".concat(cmdText, "] for parse JSON:"), e), t;
                    }
                  },
                  jso: function jso() {
                    var json = re.lines.join("\n");
                    Ti.S.isBlank(json) && (json = blankAs);

                    try {
                      return eval("(" + json + ")");
                    } catch (e) {
                      throw console.error("Error [".concat(cmdText, "] for eval JSO:"), json), e;
                    }
                  }
                }[as]());

              case 17:
              case "end":
                return _context14.stop();
            }
          }
        }, _callee14);
      }))();
    },
    exec2: function () {
      var _exec = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee16(e) {
        var t,
            _args16 = arguments;
        return regeneratorRuntime.wrap(function _callee16$(_context16) {
          while (1) {
            switch (_context16.prev = _context16.next) {
              case 0:
                t = _args16.length > 1 && _args16[1] !== undefined ? _args16[1] : {};

                _.defaults(t, {
                  errorBy: function () {
                    var _errorBy = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee15(_ref11) {
                      var e, i, n, a;
                      return regeneratorRuntime.wrap(function _callee15$(_context15) {
                        while (1) {
                          switch (_context15.prev = _context15.next) {
                            case 0:
                              e = _ref11.code, i = _ref11.msgKey, n = _ref11.data;
                              a = Ti.I18n.get(i);
                              Ti.Util.isNil(n) || _.isString(n) && !n || (a += " : " + Ti.Types.toStr(n));
                              _context15.next = 5;
                              return Ti.Alert(a, {
                                title: "i18n:warn",
                                type: "error"
                              });

                            case 5:
                              return _context15.abrupt("return", _.isFunction(t.errorAs) ? t.errorAs({
                                code: e,
                                msgKey: i,
                                data: n
                              }) : Ti.Err.make(e, n));

                            case 6:
                            case "end":
                              return _context15.stop();
                          }
                        }
                      }, _callee15);
                    }));

                    function errorBy(_x3) {
                      return _errorBy.apply(this, arguments);
                    }

                    return errorBy;
                  }()
                });

                _context16.next = 4;
                return Wn.Sys.exec(e, t);

              case 4:
                return _context16.abrupt("return", _context16.sent);

              case 5:
              case "end":
                return _context16.stop();
            }
          }
        }, _callee16);
      }));

      function exec2(_x2) {
        return _exec.apply(this, arguments);
      }

      return exec2;
    }(),
    execJson: function () {
      var _execJson = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee17(e) {
        var t,
            _args17 = arguments;
        return regeneratorRuntime.wrap(function _callee17$(_context17) {
          while (1) {
            switch (_context17.prev = _context17.next) {
              case 0:
                t = _args17.length > 1 && _args17[1] !== undefined ? _args17[1] : {
                  as: "json"
                };
                _context17.next = 3;
                return WnSys.exec(e, t);

              case 3:
                return _context17.abrupt("return", _context17.sent);

              case 4:
              case "end":
                return _context17.stop();
            }
          }
        }, _callee17);
      }));

      function execJson(_x4) {
        return _execJson.apply(this, arguments);
      }

      return execJson;
    }(),
    exec2Json: function () {
      var _exec2Json = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee18(e) {
        var t,
            _args18 = arguments;
        return regeneratorRuntime.wrap(function _callee18$(_context18) {
          while (1) {
            switch (_context18.prev = _context18.next) {
              case 0:
                t = _args18.length > 1 && _args18[1] !== undefined ? _args18[1] : {
                  as: "json"
                };
                _context18.next = 3;
                return WnSys.exec2(e, t);

              case 3:
                return _context18.abrupt("return", _context18.sent);

              case 4:
              case "end":
                return _context18.stop();
            }
          }
        }, _callee18);
      }));

      function exec2Json(_x5) {
        return _exec2Json.apply(this, arguments);
      }

      return exec2Json;
    }()
  };

  return WnSys;
}(),
    Util = function () {
  var e = {
    isMimeText: function isMimeText(e) {
      return /^text\//.test(e) || "application/x-javascript" == e || "application/json" == e;
    },
    isMimeJson: function isMimeJson(e) {
      return "text/json" == e || "application/json" == e;
    },
    getIconName: function getIconName(e) {
      var t = /^<i +class=["'] *(fa|zmdi|im) +(fa|zmdi|im)-([^" ]+) *["']> *<\/i>$/.exec(e);
      return t ? t[3] : e;
    },
    genPreviewObj: function genPreviewObj(t) {
      if (t.thumb) return {
        type: "image",
        value: "/o/thumbnail/id:" + t.id
      };

      if (t.icon) {
        var i = e.getIconName(t.icon);
        return Ti.Icons.get(i, {
          type: "font",
          value: i
        });
      }

      return Ti.Icons.get(t);
    },
    getIconObj: function getIconObj(t) {
      return t && t.icon ? _.isPlainObject(t.icon) ? _.assign(Ti.Icons.get(), t.icon) : {
        type: "font",
        value: e.getIconName(t.icon)
      } : Ti.Icons.get(t);
    },
    getObjIcon: function getObjIcon(e, t) {
      return e ? e.icon || Ti.Icons.get(e) : t;
    },
    getObjThumbIcon: function getObjThumbIcon() {
      var _ref12 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
          e = _ref12.icon,
          t = _ref12.thumb,
          i = _ref12.mime,
          n = _ref12.type,
          a = _ref12.race,
          r = _ref12.candidateIcon,
          _ref12$timestamp = _ref12.timestamp,
          s = _ref12$timestamp === void 0 ? 0 : _ref12$timestamp;

      var o = arguments.length > 1 ? arguments[1] : undefined;

      if (t) {
        var _e7 = "/o/content?str=".concat(t);

        return s > 0 && (_e7 += "&_t=".concat(s)), {
          type: "image",
          value: _e7
        };
      }

      return e ? {
        type: "font",
        value: e
      } : r || (n || i || a ? Ti.Icons.get({
        type: n,
        mime: i,
        race: a
      }) : o);
    },
    getObjThumbIcon2: function getObjThumbIcon2(e, t) {
      if (e.thumb) {
        return {
          type: "image",
          value: "/o/content?str=".concat(e.thumb)
        };
      }

      return e.icon ? e.icon : t || Ti.Icons.get(e);
    },
    getObjDisplayName: function getObjDisplayName(e) {
      var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];
      return Ti.Util.getFallbackEmpty(e, t, "title", "nm");
    },
    getAppLink: function getAppLink(t) {
      var _ref13 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
          _ref13$appName = _ref13.appName,
          i = _ref13$appName === void 0 ? "wn.manager" : _ref13$appName,
          _ref13$encoded = _ref13.encoded,
          n = _ref13$encoded === void 0 ? !0 : _ref13$encoded;

      return e.getLink("/a/open/".concat(i), t, {
        pathKey: "ph",
        encoded: !0
      });
    },
    getAppLinkStr: function getAppLinkStr(t, i) {
      return e.getAppLink(t, i).toString();
    },
    getObjBadges: function getObjBadges() {
      var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

      var _ref14 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
          _ref14$NW = _ref14.NW,
          t = _ref14$NW === void 0 ? null : _ref14$NW,
          _ref14$NE = _ref14.NE,
          i = _ref14$NE === void 0 ? ["ln", "zmdi-open-in-new"] : _ref14$NE,
          _ref14$SW = _ref14.SW,
          n = _ref14$SW === void 0 ? null : _ref14$SW,
          _ref14$SE = _ref14.SE,
          a = _ref14$SE === void 0 ? null : _ref14$SE;

      var r = {},
          s = function s(t, i) {
        i && (_.isString(i) && (r[t] = i), 1 == i.length ? r[t] = i[0] : i.length > 1 && e[i[0]] && (r[t] = i[1]));
      };

      return s("NW", t), s("NE", i), s("SW", n), s("SE", a), r;
    },
    getObjThumbInfo: function getObjThumbInfo() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

      var _ref15 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
          _ref15$exposeHidden = _ref15.exposeHidden,
          i = _ref15$exposeHidden === void 0 ? !1 : _ref15$exposeHidden,
          _ref15$status = _ref15.status,
          n = _ref15$status === void 0 ? {} : _ref15$status,
          _ref15$progress = _ref15.progress,
          a = _ref15$progress === void 0 ? {} : _ref15$progress,
          r = _ref15.badges;

      if (!t || !t.nm) return;
      var s = "show";
      return t.nm.startsWith(".") && i && (s = i ? "weak" : "hide"), {
        id: t.id,
        nm: t.nm,
        title: e.getObjDisplayName(t),
        preview: e.genPreviewObj(t),
        href: e.getAppLinkStr(t),
        visibility: s,
        status: n[t.id],
        progress: a[t.id],
        badges: e.getObjBadges(t, r)
      };
    },
    getDownloadLink: function getDownloadLink(t) {
      var _ref16 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
          _ref16$mode = _ref16.mode,
          i = _ref16$mode === void 0 ? "force" : _ref16$mode;

      return e.getLink("/o/content", t, {
        pathKey: "str",
        encoded: !0,
        params: {
          d: i
        }
      });
    },
    getLink: function getLink(e, t) {
      var _ref17 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
          _ref17$pathKey = _ref17.pathKey,
          i = _ref17$pathKey === void 0 ? "ph" : _ref17$pathKey,
          _ref17$encoded = _ref17.encoded,
          n = _ref17$encoded === void 0 ? !1 : _ref17$encoded,
          _ref17$params = _ref17.params,
          a = _ref17$params === void 0 ? {} : _ref17$params;

      var r = _objectSpread({}, a);

      if (!t) return {
        url: e,
        params2: r
      };

      var s = function s(e) {
        return n ? encodeURIComponent(e) : e;
      };

      return /^(\/|~)/.test(t) ? r[i] = s(t) : _.isString(t) ? r[i] = "id:".concat(t) : t.id ? r[i] = "id:".concat(t.id) : t.ph && (r[i] = s(t.ph)), Ti.Util.Link({
        url: e,
        params: r
      });
    },
    wrapTreeNode: function wrapTreeNode(e) {
      if (_.isPlainObject(e)) {
        var t = {
          id: e.id,
          name: e.nm,
          leaf: "DIR" != e.race,
          rawData: e
        };
        if (t.leaf || (t.children = []), t.id && t.name) return t;
      }
    },
    genQuery: function genQuery(e) {
      var _ref18 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
          _ref18$vkey = _ref18.vkey,
          t = _ref18$vkey === void 0 ? "val" : _ref18$vkey,
          _ref18$wrapArray = _ref18.wrapArray,
          i = _ref18$wrapArray === void 0 ? !1 : _ref18$wrapArray,
          n = _ref18.errorAs,
          _ref18$blankAs = _ref18.blankAs,
          a = _ref18$blankAs === void 0 ? "[]" : _ref18$blankAs;

      return _.isFunction(e) ? e : _.isArray(e) ? i ? function () {
        return e;
      } : e : _.isString(e) ? t ? /*#__PURE__*/function () {
        var _ref19 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee19(i) {
          var r;
          return regeneratorRuntime.wrap(function _callee19$(_context19) {
            while (1) {
              switch (_context19.prev = _context19.next) {
                case 0:
                  r = Ti.S.renderBy(e, _defineProperty({}, t, i));
                  _context19.next = 3;
                  return Wn.Sys.exec2(r, {
                    as: "json",
                    input: i,
                    errorAs: n,
                    blankAs: a
                  });

                case 3:
                  return _context19.abrupt("return", _context19.sent);

                case 4:
                case "end":
                  return _context19.stop();
              }
            }
          }, _callee19);
        }));

        return function (_x6) {
          return _ref19.apply(this, arguments);
        };
      }() : /*#__PURE__*/function () {
        var _ref20 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee20(t) {
          return regeneratorRuntime.wrap(function _callee20$(_context20) {
            while (1) {
              switch (_context20.prev = _context20.next) {
                case 0:
                  _context20.next = 2;
                  return Wn.Sys.exec2(e, {
                    as: "json",
                    errorAs: n,
                    blankAs: a
                  });

                case 2:
                  return _context20.abrupt("return", _context20.sent);

                case 3:
                case "end":
                  return _context20.stop();
              }
            }
          }, _callee20);
        }));

        return function (_x7) {
          return _ref20.apply(this, arguments);
        };
      }() : void 0;
    }
  };
  return e;
}(),
    Dict = {
  evalOptionsDict: function evalOptionsDict(_ref21, l) {
    var e = _ref21.options,
        t = _ref21.findBy,
        i = _ref21.itemBy,
        n = _ref21.childrenBy,
        a = _ref21.valueBy,
        r = _ref21.textBy,
        s = _ref21.iconBy,
        _ref21$dictShadowed = _ref21.dictShadowed,
        o = _ref21$dictShadowed === void 0 ? !0 : _ref21$dictShadowed;
    var c = Ti.DictFactory.DictReferName(e);
    return c ? Ti.DictFactory.CheckDict(c, l) : Ti.DictFactory.CreateDict({
      data: Wn.Util.genQuery(e, {
        vkey: null,
        blankAs: "[]"
      }),
      query: Wn.Util.genQuery(t, {
        blankAs: "[]"
      }),
      item: Wn.Util.genQuery(i, {
        errorAs: null,
        blankAs: "{}"
      }),
      children: Wn.Util.genQuery(n, {
        errorAs: null,
        blankAs: "[]"
      }),
      getValue: Ti.Util.genGetter(a || "id|value"),
      getText: Ti.Util.genGetter(r || "title|text|nm"),
      getIcon: Ti.Util.genGetter(s || Wn.Util.getObjThumbIcon)
    }, {
      shadowed: o,
      hooks: l
    });
  },
  setup: function setup(e) {
    _.forEach(e, function (e, t) {
      Ti.DictFactory.GetDict(t) || Ti.DictFactory.CreateDict({
        data: Wn.Util.genQuery(e.data, {
          vkey: null
        }),
        query: Wn.Util.genQuery(e.query),
        item: Wn.Util.genQuery(e.item, {
          blankAs: "{}"
        }),
        children: Wn.Util.genQuery(e.children),
        getValue: Ti.Util.genGetter(e.value),
        getText: Ti.Util.genGetter(e.text),
        getIcon: Ti.Util.genGetter(e.icon),
        shadowed: Ti.Util.fallback(e.shadowed, !0)
      }, {
        name: t
      });
    });
  },
  hMakerComponents: function hMakerComponents() {
    return Ti.DictFactory.GetOrCreate({
      data: Wn.Util.genQuery("ti coms -cqn", {
        vkey: null
      }),
      getValue: function getValue(e) {
        return e.name;
      },
      getText: function getText(e) {
        return e.title || e.name;
      },
      getIcon: function getIcon(e) {
        return e.icon || "im-plugin";
      },
      isMatched: function isMatched(e, t) {
        if (e.name == t || e.title == t) return !0;
        if (e.name && e.name.indexOf(t) >= 0) return !0;

        if (e.title) {
          if (e.title.indexOf(t) >= 0) return !0;
          var i = Ti.I18n.text(e.title);
          if (i && i.indexOf(t) >= 0) return !0;
        }

        return !1;
      },
      shadowed: !0
    }, {
      name: "hMakerComponents"
    });
  }
},
    OpenObjSelector = function () {
  return /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee22() {
    var e,
        _ref23,
        _ref23$title,
        t,
        _ref23$icon,
        i,
        _ref23$type,
        n,
        _ref23$closer,
        a,
        _ref23$textOk,
        r,
        _ref23$textCancel,
        s,
        _ref23$position,
        o,
        _ref23$width,
        l,
        _ref23$height,
        c,
        d,
        _ref23$multi,
        m,
        _ref23$fromIndex,
        p,
        _ref23$homePath,
        u,
        _ref23$fallbackPath,
        h,
        _ref23$filter,
        g,
        _ref23$selected,
        y,
        f,
        _args22 = arguments;

    return regeneratorRuntime.wrap(function _callee22$(_context22) {
      while (1) {
        switch (_context22.prev = _context22.next) {
          case 0:
            e = _args22.length > 0 && _args22[0] !== undefined ? _args22[0] : "~";
            _ref23 = _args22.length > 1 && _args22[1] !== undefined ? _args22[1] : {}, _ref23$title = _ref23.title, t = _ref23$title === void 0 ? "i18n:select" : _ref23$title, _ref23$icon = _ref23.icon, i = _ref23$icon === void 0 ? "im-folder-open" : _ref23$icon, _ref23$type = _ref23.type, n = _ref23$type === void 0 ? "info" : _ref23$type, _ref23$closer = _ref23.closer, a = _ref23$closer === void 0 ? !0 : _ref23$closer, _ref23$textOk = _ref23.textOk, r = _ref23$textOk === void 0 ? "i18n:ok" : _ref23$textOk, _ref23$textCancel = _ref23.textCancel, s = _ref23$textCancel === void 0 ? "i18n:cancel" : _ref23$textCancel, _ref23$position = _ref23.position, o = _ref23$position === void 0 ? "top" : _ref23$position, _ref23$width = _ref23.width, l = _ref23$width === void 0 ? "80%" : _ref23$width, _ref23$height = _ref23.height, c = _ref23$height === void 0 ? "90%" : _ref23$height, d = _ref23.spacing, _ref23$multi = _ref23.multi, m = _ref23$multi === void 0 ? !0 : _ref23$multi, _ref23$fromIndex = _ref23.fromIndex, p = _ref23$fromIndex === void 0 ? 0 : _ref23$fromIndex, _ref23$homePath = _ref23.homePath, u = _ref23$homePath === void 0 ? Wn.Session.getHomePath() : _ref23$homePath, _ref23$fallbackPath = _ref23.fallbackPath, h = _ref23$fallbackPath === void 0 ? Wn.Session.getHomePath() : _ref23$fallbackPath, _ref23$filter = _ref23.filter, g = _ref23$filter === void 0 ? function (e) {
              return "FILE" == e.race;
            } : _ref23$filter, _ref23$selected = _ref23.selected, y = _ref23$selected === void 0 ? [] : _ref23$selected;
            f = e;
            _context22.t0 = _.isString(e);

            if (!_context22.t0) {
              _context22.next = 8;
              break;
            }

            _context22.next = 7;
            return Wn.Io.loadMeta(e);

          case 7:
            f = _context22.sent;

          case 8:
            _context22.t1 = !f && h && e != h;

            if (!_context22.t1) {
              _context22.next = 13;
              break;
            }

            _context22.next = 12;
            return Wn.Io.loadMeta(h);

          case 12:
            f = _context22.sent;

          case 13:
            if (!f) {
              _context22.next = 31;
              break;
            }

            _context22.t3 = "DIR" == f.race;

            if (_context22.t3) {
              _context22.next = 19;
              break;
            }

            _context22.next = 18;
            return Wn.Io.loadMetaById(f.pid);

          case 18:
            _context22.t3 = f = _context22.sent;

          case 19:
            if (!_context22.t3) {
              _context22.next = 25;
              break;
            }

            _context22.next = 22;
            return Ti.App.Open({
              type: n,
              width: l,
              height: c,
              spacing: d,
              position: o,
              closer: a,
              icon: i,
              title: t,
              actions: [{
                text: r,
                handler: function handler(_ref24) {
                  var e = _ref24.$main;
                  return e.myChecked;
                }
              }, {
                text: s,
                handler: function handler() {
                  return void 0;
                }
              }],
              modules: {
                current: "@mod:wn/obj-meta",
                main: "@mod:wn/obj-current"
              },
              comType: "modal-inner-body",
              components: [{
                name: "modal-inner-body",
                globally: !1,
                data: {
                  myChecked: [],
                  myShown: {}
                },
                props: {
                  icon: void 0,
                  text: void 0,
                  trimed: void 0,
                  placeholder: void 0,
                  valueCase: void 0,
                  value: void 0
                },
                template: '<ti-gui\n          :layout="theLayout"\n          :schema="theSchema"\n          :shown="myShown"\n          :can-loading="true"\n          :loading-as="status.reloading"\n          @sky::item:active="OnCurrentMetaChange"\n          @arena::open="OnCurrentMetaChange"\n          @arena::select="OnArenaSelect"/>',
                computed: _objectSpread({}, Vuex.mapGetters("current", {
                  obj: "get",
                  objHome: "getHome",
                  objIsHome: "isHome",
                  objHasParent: "hasParent",
                  objParentIsHome: "parentIsHome"
                }), {}, Vuex.mapState("main", ["data", "status"]), {
                  theCrumbData: function theCrumbData() {
                    var _this2 = this;

                    return Wn.Obj.evalCrumbData({
                      meta: _.get(this.obj, "meta"),
                      ancestors: _.get(this.obj, "ancestors"),
                      fromIndex: p,
                      homePath: u
                    }, function (e) {
                      e.asterisk = _.get(_this2.mainStatus, "changed");
                    });
                  },
                  theLayout: function theLayout() {
                    return {
                      type: "rows",
                      border: !0,
                      blocks: [{
                        name: "sky",
                        size: ".5rem",
                        body: "sky"
                      }, {
                        name: "arena",
                        body: "main"
                      }]
                    };
                  },
                  theSchema: function theSchema() {
                    return {
                      sky: {
                        comType: "ti-crumb",
                        comConf: {
                          style: {
                            padding: "0 .1rem"
                          },
                          data: this.theCrumbData
                        }
                      },
                      main: {
                        comType: "wn-adaptlist",
                        comConf: {
                          meta: this.obj,
                          data: this.data,
                          status: this.status,
                          multi: m,
                          listConf: {
                            resizeDelay: 200
                          }
                        }
                      }
                    };
                  }
                }),
                methods: {
                  OnCurrentMetaChange: function OnCurrentMetaChange() {
                    var _ref25 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
                        e = _ref25.id,
                        t = _ref25.path,
                        i = _ref25.value;

                    this.open(e || t || i);
                  },
                  OnArenaSelect: function OnArenaSelect(_ref26) {
                    var e = _ref26.checked;
                    _.isFunction(g) ? this.myChecked = _.filter(e, g) : this.myChecked = e;
                  },
                  open: function open(e) {
                    var _this3 = this;

                    return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee21() {
                      var _t5;

                      return regeneratorRuntime.wrap(function _callee21$(_context21) {
                        while (1) {
                          switch (_context21.prev = _context21.next) {
                            case 0:
                              _context21.t0 = e;

                              if (!_context21.t0) {
                                _context21.next = 8;
                                break;
                              }

                              _context21.t1 = _.isString(e);

                              if (!_context21.t1) {
                                _context21.next = 7;
                                break;
                              }

                              _context21.next = 6;
                              return Wn.Io.loadMetaBy(e);

                            case 6:
                              e = _context21.sent;

                            case 7:
                              _context21.t0 = e && "DIR" == e.race;

                            case 8:
                              if (!_context21.t0) {
                                _context21.next = 11;
                                break;
                              }

                              _t5 = Ti.App(_this3);
                              _t5.dispatch("current/reload", e), _t5.dispatch("main/reload", e);

                            case 11:
                            case "end":
                              return _context21.stop();
                          }
                        }
                      }, _callee21);
                    }))();
                  }
                },
                mounted: function mounted() {
                  this.open(f);
                }
              }]
            });

          case 22:
            _context22.t4 = _context22.sent;
            _context22.next = 28;
            break;

          case 25:
            _context22.next = 27;
            return Ti.Toast.Open({
              content: "i18n:e-io-obj-noexistsf",
              vars: {
                ph: "Parent of id:".concat(f.id, "->pid:").concat(f.pid),
                nm: "Parent of id:".concat(f.nm, "->pid:").concat(f.pid)
              }
            }, "warn");

          case 27:
            _context22.t4 = _context22.sent;

          case 28:
            _context22.t2 = _context22.t4;
            _context22.next = 34;
            break;

          case 31:
            _context22.next = 33;
            return Ti.Toast.Open({
              content: "i18n:e-io-obj-noexistsf",
              vars: _.isString(e) ? {
                ph: e,
                nm: Ti.Util.getFileName(e)
              } : e.ph
            }, "warn");

          case 33:
            _context22.t2 = _context22.sent;

          case 34:
            return _context22.abrupt("return", _context22.t2);

          case 35:
          case "end":
            return _context22.stop();
        }
      }
    }, _callee22);
  }));
}(),
    OpenThingManager = function () {
  return /*#__PURE__*/function () {
    var _ref27 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee24(e) {
      var _ref28,
          _ref28$textOk,
          t,
          _ref28$icon,
          i,
          n,
          _ref28$ok,
          a,
          _ref28$textCancel,
          r,
          _ref28$position,
          s,
          _ref28$width,
          o,
          _ref28$height,
          l,
          c,
          d,
          m,
          _args24 = arguments;

      return regeneratorRuntime.wrap(function _callee24$(_context24) {
        while (1) {
          switch (_context24.prev = _context24.next) {
            case 0:
              _ref28 = _args24.length > 1 && _args24[1] !== undefined ? _args24[1] : {}, _ref28$textOk = _ref28.textOk, t = _ref28$textOk === void 0 ? "i18n:ok" : _ref28$textOk, _ref28$icon = _ref28.icon, i = _ref28$icon === void 0 ? "fas-database" : _ref28$icon, n = _ref28.title, _ref28$ok = _ref28.ok, a = _ref28$ok === void 0 ? function (_ref29) {
                var e = _ref29.result;
                return e;
              } : _ref28$ok, _ref28$textCancel = _ref28.textCancel, r = _ref28$textCancel === void 0 ? "i18n:close" : _ref28$textCancel, _ref28$position = _ref28.position, s = _ref28$position === void 0 ? "top" : _ref28$position, _ref28$width = _ref28.width, o = _ref28$width === void 0 ? "96%" : _ref28$width, _ref28$height = _ref28.height, l = _ref28$height === void 0 ? "96%" : _ref28$height, c = _ref28.spacing;

              if (!Ti.Util.isNil(e)) {
                _context24.next = 5;
                break;
              }

              _context24.next = 4;
              return Ti.Toast.Open("ThingSet path is nil", "warn");

            case 4:
              return _context24.abrupt("return", _context24.sent);

            case 5:
              if (!_.isString(e)) {
                _context24.next = 11;
                break;
              }

              _context24.next = 8;
              return Wn.Io.loadMeta(e);

            case 8:
              _context24.t0 = _context24.sent;
              _context24.next = 12;
              break;

            case 11:
              _context24.t0 = e;

            case 12:
              d = _context24.t0;

              if (d) {
                _context24.next = 17;
                break;
              }

              _context24.next = 16;
              return Ti.Toast.Open("Fail to found ThingSet: ".concat(e), "warn");

            case 16:
              return _context24.abrupt("return", _context24.sent);

            case 17:
              d.th_auto_select = !1;
              _context24.next = 20;
              return Wn.Sys.exec("ti views id:".concat(d.id, " -cqn"), {
                as: "json"
              });

            case 20:
              m = _context24.sent;
              _context24.next = 23;
              return Ti.App.Open({
                icon: i,
                title: n || d.title || d.nm,
                position: s,
                width: o,
                height: l,
                escape: !1,
                topActions: m.actions,
                textOk: t,
                textCancel: r,
                ok: a,
                modules: {
                  current: "@mod:wn/obj-current",
                  main: "@mod:wn/thing"
                },
                comType: "wn-thing-manager",
                comConf: {
                  "...": "=Main",
                  emitChange: !0
                },
                components: ["@com:wn/thing/manager"],
                preload: function () {
                  var _preload = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee23(e) {
                    return regeneratorRuntime.wrap(function _callee23$(_context23) {
                      while (1) {
                        switch (_context23.prev = _context23.next) {
                          case 0:
                            e.commit("current/setMeta", d);
                            _context23.next = 3;
                            return e.dispatch("main/reload", d);

                          case 3:
                          case "end":
                            return _context23.stop();
                        }
                      }
                    }, _callee23);
                  }));

                  function preload(_x9) {
                    return _preload.apply(this, arguments);
                  }

                  return preload;
                }()
              });

            case 23:
              return _context24.abrupt("return", _context24.sent);

            case 24:
            case "end":
              return _context24.stop();
          }
        }
      }, _callee24);
    }));

    return function (_x8) {
      return _ref27.apply(this, arguments);
    };
  }();
}(),
    EditObjMeta = function () {
  return /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee25() {
    var e,
        _ref31,
        t,
        i,
        _ref31$type,
        n,
        _ref31$closer,
        a,
        _ref31$escape,
        r,
        _ref31$textOk,
        s,
        _ref31$textCancel,
        o,
        _ref31$position,
        l,
        _ref31$width,
        c,
        _ref31$height,
        d,
        m,
        _ref31$currentTab,
        p,
        _ref31$fields,
        u,
        _ref31$fixedKeys,
        h,
        _ref31$saveKeys,
        g,
        _ref31$autoSave,
        y,
        f,
        w,
        T,
        _e8,
        b,
        k,
        O,
        x,
        j,
        S,
        _e9,
        _t6,
        _i8,
        _args25 = arguments;

    return regeneratorRuntime.wrap(function _callee25$(_context25) {
      while (1) {
        switch (_context25.prev = _context25.next) {
          case 0:
            e = _args25.length > 0 && _args25[0] !== undefined ? _args25[0] : "~";
            _ref31 = _args25.length > 1 && _args25[1] !== undefined ? _args25[1] : {}, t = _ref31.icon, i = _ref31.title, _ref31$type = _ref31.type, n = _ref31$type === void 0 ? "info" : _ref31$type, _ref31$closer = _ref31.closer, a = _ref31$closer === void 0 ? !0 : _ref31$closer, _ref31$escape = _ref31.escape, r = _ref31$escape === void 0 ? !0 : _ref31$escape, _ref31$textOk = _ref31.textOk, s = _ref31$textOk === void 0 ? "i18n:ok" : _ref31$textOk, _ref31$textCancel = _ref31.textCancel, o = _ref31$textCancel === void 0 ? "i18n:cancel" : _ref31$textCancel, _ref31$position = _ref31.position, l = _ref31$position === void 0 ? "top" : _ref31$position, _ref31$width = _ref31.width, c = _ref31$width === void 0 ? 640 : _ref31$width, _ref31$height = _ref31.height, d = _ref31$height === void 0 ? "90%" : _ref31$height, m = _ref31.spacing, _ref31$currentTab = _ref31.currentTab, p = _ref31$currentTab === void 0 ? 0 : _ref31$currentTab, _ref31$fields = _ref31.fields, u = _ref31$fields === void 0 ? [] : _ref31$fields, _ref31$fixedKeys = _ref31.fixedKeys, h = _ref31$fixedKeys === void 0 ? ["thumb"] : _ref31$fixedKeys, _ref31$saveKeys = _ref31.saveKeys, g = _ref31$saveKeys === void 0 ? ["thumb"] : _ref31$saveKeys, _ref31$autoSave = _ref31.autoSave, y = _ref31$autoSave === void 0 ? !0 : _ref31$autoSave;
            f = e;
            _context25.t0 = _.isString(f);

            if (!_context25.t0) {
              _context25.next = 8;
              break;
            }

            _context25.next = 7;
            return Wn.Io.loadMeta(e);

          case 7:
            f = _context25.sent;

          case 8:
            w = {};

            _.forEach(h, function (e) {
              return w[e] = !0;
            });

            T = {};

            if (!(_.forEach(g, function (e) {
              return T[e] = !0;
            }), "auto" == u)) {
              _context25.next = 16;
              break;
            }

            _context25.next = 14;
            return Wn.Sys.exec2("ti metas id:".concat(f.id, " -cqn"), {
              as: "json"
            });

          case 14:
            _e8 = _context25.sent;
            _e8 && (u = _e8.fields, p = _e8.currentTab || p || 0);

          case 16:
            !_.isEmpty(u) && _.isArray(u) || (u = [{
              title: "basic",
              fields: ["id", "nm", "title", "icon", "thumb", "ph", "race", "tp", "mime", "width", "height", "len", "sha1"]
            }, {
              title: "privilege",
              fields: ["c", "m", "g", "md", "pvg"]
            }, {
              title: "timestamp",
              fields: ["ct", "lm", "expi"]
            }, {
              title: "others",
              fields: ["..."]
            }]);
            b = Wn.Obj.evalFields(f, u, function (e) {
              return w[e.uniqKey] ? e : e.quickName && _.isUndefined(e.value) ? void 0 : e;
            });
            k = t || Wn.Util.getObjIcon(f, "zmdi-info-outline");
            O = i || Wn.Util.getObjDisplayName(f);
            _context25.next = 22;
            return Ti.App.Open({
              type: n,
              width: c,
              height: d,
              spacing: m,
              position: l,
              closer: a,
              escape: r,
              icon: k,
              title: O,
              actions: [{
                text: s,
                handler: function handler(_ref32) {
                  var e = _ref32.$main;
                  return _.cloneDeep({
                    updates: e.updates,
                    data: e.meta
                  });
                }
              }, {
                text: o,
                handler: function handler(_ref33) {
                  var e = _ref33.$main;

                  var t = _.keys(e.updates);

                  var _iterator5 = _createForOfIteratorHelper(t),
                      _step5;

                  try {
                    for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {
                      var _i7 = _step5.value;
                      if (T[_i7]) return _.cloneDeep({
                        updates: e.updates,
                        data: e.meta
                      });
                    }
                  } catch (err) {
                    _iterator5.e(err);
                  } finally {
                    _iterator5.f();
                  }
                }
              }],
              comType: "modal-inner-body",
              components: [{
                name: "modal-inner-body",
                globally: !1,
                data: {
                  myFormFields: b,
                  currentTab: p,
                  meta: f,
                  updates: {}
                },
                template: '<ti-form\n          mode="tab"\n          :current-tab="currentTab"\n          :fields="myFormFields"\n          :data="meta"\n          @field:change="onFieldChange"\n          @change="onChange"\n          />',
                methods: {
                  onChange: function onChange(e) {
                    this.meta = e;
                  },
                  onFieldChange: function onFieldChange() {
                    var _ref34 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
                        e = _ref34.name,
                        t = _ref34.value;

                    var i = Ti.Types.toObjByPair({
                      name: e,
                      value: t
                    });
                    this.updates = _.assign({}, this.updates, i);
                  }
                }
              }, "@com:ti/form", "@com:wn/imgfile"]
            });

          case 22:
            x = _context25.sent;

            if (x) {
              _context25.next = 25;
              break;
            }

            return _context25.abrupt("return");

          case 25:
            j = x.updates, S = !1;

            if (!(y && !_.isEmpty(j))) {
              _context25.next = 36;
              break;
            }

            _e9 = JSON.stringify(j);
            _t6 = "obj 'id:".concat(f.id, "' -ocqn -u");
            _context25.next = 31;
            return Wn.Sys.exec2(_t6, {
              input: _e9,
              as: "json"
            });

          case 31:
            _i8 = _context25.sent;
            _context25.next = 34;
            return Ti.Toast.Open("i18n:save-done", "success");

          case 34:
            S = !0;
            return _context25.abrupt("return", {
              updates: j,
              data: _i8,
              saved: S
            });

          case 36:
            return _context25.abrupt("return", x);

          case 37:
          case "end":
            return _context25.stop();
        }
      }
    }, _callee25);
  }));
}(),
    EditObjContent = function () {
  return /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee26() {
    var e,
        _ref36,
        t,
        i,
        _ref36$type,
        n,
        _ref36$closer,
        a,
        r,
        _ref36$textCancel,
        s,
        _ref36$position,
        o,
        _ref36$width,
        l,
        _ref36$height,
        c,
        d,
        _ref36$readonly,
        m,
        _ref36$showEditorTitl,
        p,
        u,
        _ref36$placeholder,
        h,
        g,
        y,
        f,
        w,
        T,
        b,
        _args26 = arguments;

    return regeneratorRuntime.wrap(function _callee26$(_context26) {
      while (1) {
        switch (_context26.prev = _context26.next) {
          case 0:
            e = _args26.length > 0 && _args26[0] !== undefined ? _args26[0] : "~";
            _ref36 = _args26.length > 1 && _args26[1] !== undefined ? _args26[1] : {}, t = _ref36.title, i = _ref36.icon, _ref36$type = _ref36.type, n = _ref36$type === void 0 ? "info" : _ref36$type, _ref36$closer = _ref36.closer, a = _ref36$closer === void 0 ? !0 : _ref36$closer, r = _ref36.textOk, _ref36$textCancel = _ref36.textCancel, s = _ref36$textCancel === void 0 ? "i18n:cancel" : _ref36$textCancel, _ref36$position = _ref36.position, o = _ref36$position === void 0 ? "top" : _ref36$position, _ref36$width = _ref36.width, l = _ref36$width === void 0 ? 640 : _ref36$width, _ref36$height = _ref36.height, c = _ref36$height === void 0 ? "80%" : _ref36$height, d = _ref36.spacing, _ref36$readonly = _ref36.readonly, m = _ref36$readonly === void 0 ? !1 : _ref36$readonly, _ref36$showEditorTitl = _ref36.showEditorTitle, p = _ref36$showEditorTitl === void 0 ? !0 : _ref36$showEditorTitl, u = _ref36.content, _ref36$placeholder = _ref36.placeholder, h = _ref36$placeholder === void 0 ? "i18n:blank" : _ref36$placeholder;
            g = e;
            _context26.t0 = _.isString(g);

            if (!_context26.t0) {
              _context26.next = 8;
              break;
            }

            _context26.next = 7;
            return Wn.Io.loadMeta(e);

          case 7:
            g = _context26.sent;

          case 8:
            _.isUndefined(r) && (r = this.saveBy ? "i18n:save" : "i18n:ok");
            y = Ti.Util.isNil(u);
            f = i || Wn.Util.getObjIcon(g, "zmdi-receipt");
            w = t || "i18n:edit";

            if (!y) {
              _context26.next = 18;
              break;
            }

            _context26.next = 15;
            return Wn.Io.loadContent(g);

          case 15:
            _context26.t1 = _context26.sent;
            _context26.next = 19;
            break;

          case 18:
            _context26.t1 = u;

          case 19:
            T = _context26.t1;
            _context26.next = 22;
            return Ti.App.Open({
              type: n,
              width: l,
              height: c,
              spacing: d,
              position: o,
              closer: a,
              title: w,
              result: T,
              comType: "ti-text-raw",
              comConf: {
                readonly: m,
                placeholder: h,
                icon: f,
                title: Wn.Util.getObjDisplayName(g),
                content: T,
                showTitle: p,
                ignoreKeyUp: !0
              },
              components: ["@com:ti/text/raw"]
            });

          case 22:
            b = _context26.sent;
            _context26.t2 = y && !_.isUndefined(b) && b != T;

            if (!_context26.t2) {
              _context26.next = 29;
              break;
            }

            _context26.next = 27;
            return Wn.Io.saveContentAsText(g, b);

          case 27:
            _context26.next = 29;
            return Ti.Toast.Open("i18n:save-done", "success");

          case 29:
            return _context26.abrupt("return", b);

          case 30:
          case "end":
            return _context26.stop();
        }
      }
    }, _callee26, this);
  }));
}(),
    EditTiComponent = function () {
  return /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee27() {
    var _ref38,
        e,
        t,
        _ref39,
        _ref39$icon,
        i,
        _ref39$title,
        n,
        _ref39$type,
        a,
        _ref39$closer,
        r,
        _ref39$textOk,
        s,
        _ref39$textCancel,
        o,
        _ref39$position,
        l,
        _ref39$width,
        c,
        _ref39$height,
        d,
        m,
        _args27 = arguments;

    return regeneratorRuntime.wrap(function _callee27$(_context27) {
      while (1) {
        switch (_context27.prev = _context27.next) {
          case 0:
            _ref38 = _args27.length > 0 && _args27[0] !== undefined ? _args27[0] : {}, e = _ref38.comType, t = _ref38.comConf;
            _ref39 = _args27.length > 1 && _args27[1] !== undefined ? _args27[1] : {}, _ref39$icon = _ref39.icon, i = _ref39$icon === void 0 ? "fas-pencil-ruler" : _ref39$icon, _ref39$title = _ref39.title, n = _ref39$title === void 0 ? "i18n:edit-com" : _ref39$title, _ref39$type = _ref39.type, a = _ref39$type === void 0 ? "info" : _ref39$type, _ref39$closer = _ref39.closer, r = _ref39$closer === void 0 ? !0 : _ref39$closer, _ref39$textOk = _ref39.textOk, s = _ref39$textOk === void 0 ? "i18n:ok" : _ref39$textOk, _ref39$textCancel = _ref39.textCancel, o = _ref39$textCancel === void 0 ? "i18n:cancel" : _ref39$textCancel, _ref39$position = _ref39.position, l = _ref39$position === void 0 ? "top" : _ref39$position, _ref39$width = _ref39.width, c = _ref39$width === void 0 ? 800 : _ref39$width, _ref39$height = _ref39.height, d = _ref39$height === void 0 ? "90%" : _ref39$height, m = _ref39.spacing;
            _context27.next = 4;
            return Ti.App.Open({
              type: a,
              width: c,
              height: d,
              spacing: m,
              position: l,
              closer: r,
              icon: i,
              title: n,
              textOk: s,
              textCancel: o,
              comType: "hmaker-edit-com",
              comConf: {
                value: {
                  comType: e,
                  comConf: t
                }
              },
              result: {
                comType: e,
                comConf: _.cloneDeep(t)
              },
              components: ["@com:hmaker/edit-com"]
            });

          case 4:
            return _context27.abrupt("return", _context27.sent);

          case 5:
          case "end":
            return _context27.stop();
        }
      }
    }, _callee27);
  }));
}(),
    OpenCmdPanel = function () {
  return /*#__PURE__*/function () {
    var _ref40 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee28(e) {
      var _ref41,
          _ref41$title,
          t,
          _ref41$icon,
          i,
          _ref41$type,
          n,
          _ref41$closer,
          a,
          _ref41$textCancel,
          r,
          _ref41$position,
          s,
          _ref41$width,
          o,
          _ref41$height,
          l,
          c,
          d,
          _args28 = arguments;

      return regeneratorRuntime.wrap(function _callee28$(_context28) {
        while (1) {
          switch (_context28.prev = _context28.next) {
            case 0:
              _ref41 = _args28.length > 1 && _args28[1] !== undefined ? _args28[1] : {}, _ref41$title = _ref41.title, t = _ref41$title === void 0 ? "i18n:run" : _ref41$title, _ref41$icon = _ref41.icon, i = _ref41$icon === void 0 ? "fas-running" : _ref41$icon, _ref41$type = _ref41.type, n = _ref41$type === void 0 ? "info" : _ref41$type, _ref41$closer = _ref41.closer, a = _ref41$closer === void 0 ? !0 : _ref41$closer, _ref41$textCancel = _ref41.textCancel, r = _ref41$textCancel === void 0 ? "i18n:close" : _ref41$textCancel, _ref41$position = _ref41.position, s = _ref41$position === void 0 ? "top" : _ref41$position, _ref41$width = _ref41.width, o = _ref41$width === void 0 ? "80%" : _ref41$width, _ref41$height = _ref41.height, l = _ref41$height === void 0 ? "90%" : _ref41$height, c = _ref41.spacing, d = _ref41.vars;
              _context28.next = 3;
              return Ti.App.Open({
                type: n,
                width: o,
                height: l,
                spacing: c,
                position: s,
                closer: a,
                icon: i,
                title: t,
                textCancel: r,
                textOk: null,
                model: null,
                comType: "WnCmdPanel",
                comConf: {
                  value: e,
                  vars: d
                },
                components: ["@com:wn/cmd/panel"]
              });

            case 3:
            case "end":
              return _context28.stop();
          }
        }
      }, _callee28);
    }));

    return function (_x10) {
      return _ref40.apply(this, arguments);
    };
  }();
}(),
    WALNUT_VERSION = "2.1-20201027.205544",
    HOOKs = {};

var Wn = {
  Version: WALNUT_VERSION,
  Io: Io,
  Obj: Obj,
  Session: Session,
  Sys: Sys,
  Util: Util,
  Dict: Dict,
  OpenObjSelector: OpenObjSelector,
  EditObjMeta: EditObjMeta,
  EditObjContent: EditObjContent,
  EditTiComponent: EditTiComponent,
  OpenThingManager: OpenThingManager,
  OpenCmdPanel: OpenCmdPanel,
  addHook: function addHook(e, t) {
    Ti.Util.pushValue(HOOKs, e, t);
  },
  doHook: function doHook(e, t) {
    var i = HOOKs[e];

    if (_.isArray(i) && i.length > 0) {
      var _iterator6 = _createForOfIteratorHelper(i),
          _step6;

      try {
        for (_iterator6.s(); !(_step6 = _iterator6.n()).done;) {
          var _e10 = _step6.value;

          _e10(t);
        }
      } catch (err) {
        _iterator6.e(err);
      } finally {
        _iterator6.f();
      }
    }
  }
};
exports.Wn = Wn;
var _default = Wn;
exports["default"] = _default;
window && (window.Wn = Wn);