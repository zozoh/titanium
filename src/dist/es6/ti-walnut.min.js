const Io=function(){function e(e){return"/o/"+e}function t(e,t){if(!e.ok){if(_.isUndefined(t))throw e;return t}return e.data}const i={isFullObjId:e=>/^[0-9a-v]{26}(:file:.+)?$/.test(e),isFullObjIdPath:e=>/^id:[0-9a-v]{26}(:file:.+)?$/.test(e),async loadMetaBy(e,t){if(i.isFullObjId(e))return await i.loadMetaById(e);if(/^(id:|\/|~)/.test(e))return await i.loadMeta(e);let n;n=t?_.isString(t)?Ti.Util.getParentPath(t):"FILE"==t.race?"id:"+t.pid:"id:"+t.id:"~";let a=Ti.Util.appendPath(n,e);return await i.loadMeta(a)},loadMetaById:async e=>await i.loadMeta("id:"+e),async loadMeta(i){let n=e("fetch");return t(await Ti.Http.get(n,{params:{str:i},as:"json"}),null)},async loadMetaAt(e,t){let n=t;return e&&!/^(~\/|\/|id:)/.test(t)&&(n=`id:${e.pid}/${t}`),await i.loadMeta(n)},async loadAncestors(i){let n=e("ancestors");return t(await Ti.Http.get(n,{params:{str:i},as:"json"}),[])},async loadChildren(n,{skip:a,limit:r,sort:s={nm:1},mine:o,match:l={}}={}){if(!n)return null;if("DIR"!=n.race)return[];if(n.mnt||n.ln){let i=e("children");return t(await Ti.Http.get(i,{params:{str:`id:${n.id}`,pg:!0},as:"json"}))}l.pid=n.id;let c=await i.find({skip:a,limit:r,sort:s,mine:o,match:l});if(n.ph&&c&&_.isArray(c.list))for(let e of c.list)e.ph||(e.ph=Ti.Util.appendPath(n.ph,e.nm));return c},async find({skip:i=0,limit:n=100,sort:a={},mine:r=!0,match:s={}}={}){let o=e("find");return t(await Ti.Http.get(o,{params:_.assign({},s,{_l:n,_o:i,_me:r,_s:JSON.stringify(a)}),as:"json"}))},async findList(e={}){let t=await i.find(e);return t&&_.isArray(t.list)?t.list:[]},async findInBy(e,t,{skip:n=0,limit:a=100,sort:r={},mine:s=!0,match:o={},keys:l={"^[0-9a-v]{26}$":["id","${val}"]},dftKey:c=["nm","^.*${val}.*$"]}={}){if(!_.isUndefined(e)){let t=c;for(let i of _.keys(l))if(new RegExp(i).test(e)){t=l[i];break}let i=t[0],n=Ti.S.renderBy(t[1],{val:e});o[i]=n}if(t){let e=await i.loadMeta(t);o.pid=e.id}return await i.find({skip:n,limit:a,sort:r,mine:s,match:o})},async findListInBy(e,t,n={}){let a=await i.findInBy(e,t,n);return a&&_.isArray(a.list)?a.list:[]},async loadContent(t,{as:n="text"}={}){if(_.isString(t)&&(t=await i.loadMeta(t)),!t||"DIR"==t.race)return null;let a=t.mime||"application/octet-stream";if(Wn.Util.isMimeText(a)){let i=e("content");return await Ti.Http.get(i,{params:{str:"id:"+t.id,d:"raw"},as:n})}return t.sha1},async saveContentAsText(t,i){if(!t||"DIR"==t.race)throw Ti.Err.make("e-wn-io-writeNoFile",t.ph||t.nm);let n={str:"id:"+t.id,content:i},a=e("/save/text"),r=await Ti.Http.post(a,{params:n,as:"json"});if(!r.ok)throw Ti.Err.make(r.errCode,r.data,r.msg);return r.data},async uploadFile(t,{target:i="~",mode:n="a",tmpl:a="${major}(${nb})${suffix}",progress:r=_.identity}={}){let s=e("/save/stream");return await Ti.Http.post(s,{file:t,progress:r,params:{str:i,nm:t.name,sz:t.size,mime:t.type,m:n,tmpl:a},as:"json"})},getFormedPath(e){let t=e.ph?e.ph:e,i=Wn.Session.getHomePath(),n=Ti.Util.getRelativePath(i,t,"");return Ti.Util.appendPath("~",n)},formatObjPath(e,t,n){let a={path:()=>n?Ti.Util.getRelativePath(n.ph,e.ph):i.getFormedPath(e.ph),fullPath:()=>e.ph,idPath:()=>`id:${e.id}`,id:()=>e.id,obj:()=>_.pick(e,"id","nm","thumb","title","mime","tp","sha1","len")}[t];if(!a)throw"Invalid mode : "+t;return a()}};return i}(),Obj=function(){const e={id:{title:"i18n:wn-key-id",name:"id"},nm:{title:"i18n:wn-key-nm",name:"nm",display:"<=ti-label>",comType:"ti-input"},title:{title:"i18n:wn-key-title",name:"title",display:"<=ti-label>",comType:"ti-input"},icon:{title:"i18n:wn-key-icon",name:"icon",width:"auto",comType:"ti-input-icon"},ph:{title:"i18n:wn-key-ph",name:"ph",comConf:{className:"is-break-word"}},thumb:{title:"i18n:wn-key-thumb",name:"thumb",checkEquals:!1,serializer:{name:"Ti.Types.toStr",args:"id:${id}"},comType:"wn-imgfile",comConf:{target:"~/.thumbnail/gen/${id}.jpg",filter:"cover(256,256)",quality:.372}},race:{title:"i18n:wn-key-race",name:"race",comConf:{format:"i18n:wn-race-${race}"}},mime:{title:"i18n:wn-key-mime",name:"mime"},tp:{title:"i18n:wn-key-tp",name:"tp"},ct:{title:"i18n:wn-key-ct",name:"ct",type:"AMS"},lm:{title:"i18n:wn-key-lm",name:"lm",type:"AMS"},expi:{title:"i18n:wn-key-expi",name:"expi",type:"AMS"},pid:{title:"i18n:wn-key-pid",name:"pid"},d0:{title:"i18n:wn-key-d0",name:"d0"},d1:{title:"i18n:wn-key-d1",name:"d1"},c:{title:"i18n:wn-key-c",name:"c"},m:{title:"i18n:wn-key-m",name:"m"},g:{title:"i18n:wn-key-g",name:"g"},data:{title:"i18n:wn-key-data",name:"data"},sha1:{title:"i18n:wn-key-sha1",name:"sha1"},md:{title:"i18n:wn-key-md",name:"md"},pvg:{title:"i18n:wn-key-pvg",name:"pvg"},width:{title:"i18n:wn-key-width",name:"width"},height:{title:"i18n:wn-key-height",name:"height"},duration:{title:"i18n:wn-key-duration",name:"duration"},len:{title:"i18n:wn-key-len",name:"len",width:"auto",transformer:e=>Ti.S.sizeText(e,{bytes:!0})}},t={isBuiltInFields:t=>!!e[t],getGroupTitle:e=>/^(basic|privilege|thumb|timestamp|more|advance|customized|others)$/.test(e)?`i18n:wn-key-grp-${e}`:e,getField(t){let i=e[t];return i?_.cloneDeep(i):{title:t,name:t,type:"String"}},evalFields(e={},t=[],i=_.identity){const n=function(t=[],i=[],a={}){return _.forEach(t,t=>{if("..."==t)return void i.push(t);let r,s=!1;if(_.isString(t))s=!0,r=Wn.Obj.getField(t);else if(_.isArray(t.fields)){if(r={title:Wn.Obj.getGroupTitle(t.title),type:"Group",fields:[]},n(t.fields,r.fields,a),_.isEmpty(r.fields))return}else r=t;let o=Ti.S.join([r.name],"-");a[o]=!0;let l=_.get(e,r.name);i.push(_.assign(r,{quickName:s,uniqKey:o,value:l}))}),i},a=function(t=[],n=[],r={}){for(let s of t)if("Group"!=s.type)if("..."==s)_.forEach(e,(e,t)=>{if(Ti.Util.isNil(e)||Wn.Obj.isBuiltInFields(t)||r[t]||t.startsWith("_"))return;let a={Integer:{type:"Number",display:t,comType:"ti-input"},Number:{type:"Number",display:t,comType:"ti-input"},Boolean:{type:"Boolean",comType:"ti-toggle"},Array:{type:"Array",display:{key:t},transformer:"JSON.stringify(null, '  ')",comType:"ti-input-text",comConf:{height:240}}}[Ti.Types.getJsType(e,"String")]||{type:"String",display:{key:t,comConf:{width:"100%",className:_.isString(e)&&e.length>20?"is-break-word":"is-nowrap"}},comType:"ti-input"},s=i({title:t,name:t,...a});s&&n.push(s)});else{let e=i(s);e&&n.push(e)}else s.fields=a(s.fields,[],r),_.isEmpty(s.fields)||n.push(s);return n};let r={},s=n(t,[],r);return s=a(s,[],r)},isAs(e={},i,n){let a=_.get(e,i);if(Ti.Util.isNil(a))return!1;if(_.isArray(n)){for(let a of n)if(t.isAs(e,i,a))return!0;return!1}return _.isString(n)?n.startsWith("^")?new RegExp(n).test(a):n.startsWith("!^")?!new RegExp(n.substring(1)).test(a):a==n:!!_.isRegExp(n)&&n.test(a)},isMime:(e={},i)=>t.isAs(e,"mime",i),isType:(e={},i)=>t.isAs(e,"type",i),evalCrumbData({meta:e,ancestors:t=[],fromIndex:i=0,homePath:n=null,iteratee:a=_.identity,self:r=_.identity}={}){let s=[];if(e){let o=_.map(t),l=i;if(n)for(;l<o.length;l++){if(o[l].ph==n)break}for(;l<o.length;l++){let t=o[l],i={icon:Wn.Util.getIconObj(t),text:Wn.Util.getObjDisplayName(t),value:t.id,href:Wn.Util.getAppLink(t)+""};(i=a(i,l,e)||i)&&s.push(i)}if(r){let t={icon:Wn.Util.getIconObj(e),text:Wn.Util.getObjDisplayName(e),value:e.id,href:null,asterisk:_.get(this.mainStatus,"changed")};_.isFunction(r)&&(t=r(t,l,e)||t),t&&s.push(t)}}return s}};return t}(),Session=function(){const e={},t={},i={setup({id:e,uid:n,unm:a,grp:r,envs:s={}}={}){_.assign(t,{id:e,uid:n,unm:a,grp:r}),i.env(s)},env(t){if(_.isPlainObject(t))_.assign(e,t);else{if(_.isString(t))return e[t];if(_.isArray(t))return _.pick(e,t)}return _.cloneDeep(e)},getMyId:()=>t.uid,getMyName:()=>t.unm,getMyGroup:()=>t.grp,getHomePath:()=>i.env("HOME"),getCurrentPath:(e="~")=>i.env("PWD")||e,getCurrentDomain(){let e=i.getHomePath();if(!e)return;if("/root"==e)return"root";let t=/^\/home\/(.+)$/.exec(e);return t?t[1]:void 0},getApiPrefix:()=>`/api/${i.getCurrentDomain()}`,getApiUrl(e){let t=i.getApiPrefix();return Ti.Util.appendPath(t,e)}};return i}(),Sys=function(){const WnSysRespParsing=function(){class e{constructor({macroObjSep:e,eachLine:t=_.identity,macro:i={}}={}){this.macroObjSep=e,this.lastIndex=0,this.lines=[],this.MACRO={},this.__TO=null,this.eachLine=t,this.macro=i}init(e){this.content=e}done(){this.updated({isLastCalled:!0}),_.forOwn(this.MACRO,(e,t)=>{let i=e.join("\n"),n=JSON.parse(i);this.MACRO[t]=n,Ti.InvokeBy(this.macro,t,[n])})}__push_line(e){if(e.startsWith(this.macroObjSep)){let t=e.substring(this.macroObjSep.length).trim(),[i,n]=_.without(t.split(/ *: */g),""),a=this[i];a&&(a[n]=[]),this.__TO={key:i,name:n}}else if(this.__TO){let{key:t,name:i}=this.__TO;this[t][i].push(e)}else this.lines.push(e),this.eachLine(e)}updated({isLastCalled:e=!1}={}){let t=this.content();for(;this.lastIndex<t.length;){let i=t.indexOf("\n",this.lastIndex);if(i>=this.lastIndex){let e=i+1;i>0&&"\r"==t[i-1]&&i--;let n=t.substring(this.lastIndex,i);this.__push_line(n),this.lastIndex=e}else{if(!e)break;{let e=t.substring(this.lastIndex);this.__push_line(e),this.lastIndex=t.length}}}}getResult(){return{lines:this.lines,macro:this.MACRO}}}return e}(),DFT_MACRO_OBJ_SEP="%%wn.meta."+Ti.Random.str(10)+"%%",WnSys={async exec(cmdText,{vars:vars={},input:input="",appName:appName=Ti.GetAppName(),eachLine:eachLine=_.identity,as:as="text",blankAs:blankAs="",macroObjSep:macroObjSep=DFT_MACRO_OBJ_SEP,autoRunMacro:autoRunMacro=!0,errorBy:errorBy,PWD:PWD=Wn.Session.getCurrentPath()}={}){cmdText=Ti.S.renderBy(cmdText,vars);let url=`/a/run/${appName}`,params={mos:macroObjSep,PWD:PWD,cmd:cmdText,in:input},ing={eachLine:eachLine,macroObjSep:macroObjSep};autoRunMacro&&(ing.macro={update_envs:e=>{Wn.Session.env(e),Wn.doHook("update_envs",e)}});let parsing=new WnSysRespParsing(ing);await Ti.Http.send(url,{method:"POST",params:params,as:"text",created:e=>{parsing.init(()=>e.responseText)}}).catch(e=>{parsing.isError=!0}).finally(()=>{parsing.done()});let re=parsing.getResult();if(Ti.IsInfo("Wn.Sys")&&console.log("Wn.Sys.exec@return",re),parsing.isError){let e=re.lines.join("\n");if(_.isFunction(errorBy)){let[t,...i]=e.split(/ *: */),n=i.join(" : ");t=_.trim(t);let a=t.replace(/[.]/g,"-");return errorBy({code:t,msgKey:a,data:n})}throw e}return{raw:()=>re,lines:()=>re.lines,macro:()=>re.macro,text:()=>re.lines.join("\n"),json:()=>{let e=re.lines.join("\n");Ti.S.isBlank(e)&&(e=blankAs);try{return JSON.parse(e)}catch(t){throw console.error(`Error [${cmdText}] for parse JSON:`,e),t}},jso:()=>{let json=re.lines.join("\n");Ti.S.isBlank(json)&&(json=blankAs);try{return eval("("+json+")")}catch(e){throw console.error(`Error [${cmdText}] for eval JSO:`,json),e}}}[as]()},exec2:async(e,t={})=>(_.defaults(t,{errorBy:async function({code:e,msgKey:i,data:n}){let a=Ti.I18n.get(i);return Ti.Util.isNil(n)||_.isString(n)&&!n||(a+=" : "+Ti.Types.toStr(n)),await Ti.Alert(a,{title:"i18n:warn",type:"error"}),_.isFunction(t.errorAs)?t.errorAs({code:e,msgKey:i,data:n}):Ti.Err.make(e,n)}}),await Wn.Sys.exec(e,t)),execJson:async(e,t={as:"json"})=>await WnSys.exec(e,t),exec2Json:async(e,t={as:"json"})=>await WnSys.exec2(e,t)};return WnSys}(),Util=function(){const e={isMimeText:e=>/^text\//.test(e)||"application/x-javascript"==e||"application/json"==e,isMimeJson:e=>"text/json"==e||"application/json"==e,getIconName(e){let t=/^<i +class=["'] *(fa|zmdi|im) +(fa|zmdi|im)-([^" ]+) *["']> *<\/i>$/.exec(e);return t?t[3]:e},genPreviewObj(t){if(t.thumb)return{type:"image",value:"/o/thumbnail/id:"+t.id};if(t.icon){let i=e.getIconName(t.icon);return Ti.Icons.get(i,{type:"font",value:i})}return Ti.Icons.get(t)},getIconObj:t=>t&&t.icon?_.isPlainObject(t.icon)?_.assign(Ti.Icons.get(),t.icon):{type:"font",value:e.getIconName(t.icon)}:Ti.Icons.get(t),getObjIcon:(e,t)=>e?e.icon||Ti.Icons.get(e):t,getObjThumbIcon({icon:e,thumb:t,mime:i,type:n,race:a,candidateIcon:r,timestamp:s=0}={},o){if(t){let e=`/o/content?str=${t}`;return s>0&&(e+=`&_t=${s}`),{type:"image",value:e}}return e?{type:"font",value:e}:r||(n||i||a?Ti.Icons.get({type:n,mime:i,race:a}):o)},getObjThumbIcon2(e,t){if(e.thumb){return{type:"image",value:`/o/content?str=${e.thumb}`}}return e.icon?e.icon:t||Ti.Icons.get(e)},getObjDisplayName:(e,t=[])=>Ti.Util.getFallback(e,t,"title","nm"),getAppLink:(t,{appName:i="wn.manager",encoded:n=!0}={})=>e.getLink(`/a/open/${i}`,t,{pathKey:"ph",encoded:!0}),getAppLinkStr:(t,i)=>e.getAppLink(t,i).toString(),getObjBadges(e={},{NW:t=null,NE:i=["ln","zmdi-open-in-new"],SW:n=null,SE:a=null}={}){let r={},s=function(t,i){i&&(_.isString(i)&&(r[t]=i),1==i.length?r[t]=i[0]:i.length>1&&e[i[0]]&&(r[t]=i[1]))};return s("NW",t),s("NE",i),s("SW",n),s("SE",a),r},getObjThumbInfo(t={},{exposeHidden:i=!1,status:n={},progress:a={},badges:r}={}){if(!t||!t.nm)return;let s="show";return t.nm.startsWith(".")&&i&&(s=i?"weak":"hide"),{id:t.id,nm:t.nm,title:e.getObjDisplayName(t),preview:e.genPreviewObj(t),href:e.getAppLinkStr(t),visibility:s,status:n[t.id],progress:a[t.id],badges:e.getObjBadges(t,r)}},getDownloadLink:(t,{mode:i="force"}={})=>e.getLink("/o/content",t,{pathKey:"str",encoded:!0,params:{d:i}}),getLink(e,t,{pathKey:i="ph",encoded:n=!1,params:a={}}={}){let r={...a};if(!t)return{url:e,params2:r};const s=e=>n?encodeURIComponent(e):e;return/^(\/|~)/.test(t)?r[i]=s(t):_.isString(t)?r[i]=`id:${t}`:t.id?r[i]=`id:${t.id}`:t.ph&&(r[i]=s(t.ph)),Ti.Util.Link({url:e,params:r})},wrapTreeNode(e){if(_.isPlainObject(e)){let t={id:e.id,name:e.nm,leaf:"DIR"!=e.race,rawData:e};if(t.leaf||(t.children=[]),t.id&&t.name)return t}},genQuery:(e,{vkey:t="val",wrapArray:i=!1,errorAs:n,blankAs:a="[]"}={})=>_.isFunction(e)?e:_.isArray(e)?i?()=>e:e:_.isString(e)?t?async i=>{let r=Ti.S.renderBy(e,{[t]:i});return await Wn.Sys.exec2(r,{as:"json",input:i,errorAs:n,blankAs:a})}:async t=>await Wn.Sys.exec2(e,{as:"json",errorAs:n,blankAs:a}):void 0};return e}(),Dict={evalOptionsDict({options:e,findBy:t,itemBy:i,childrenBy:n,valueBy:a,textBy:r,iconBy:s,dictShadowed:o=!0},l){let c=Ti.DictFactory.DictReferName(e);return c?Ti.DictFactory.CheckDict(c,l):Ti.DictFactory.CreateDict({data:Wn.Util.genQuery(e,{vkey:null,blankAs:"[]"}),query:Wn.Util.genQuery(t,{blankAs:"[]"}),item:Wn.Util.genQuery(i,{errorAs:null,blankAs:"{}"}),children:Wn.Util.genQuery(n,{errorAs:null,blankAs:"[]"}),getValue:Ti.Util.genGetter(a||"id|value"),getText:Ti.Util.genGetter(r||"title|text|nm"),getIcon:Ti.Util.genGetter(s||Wn.Util.getObjThumbIcon)},{shadowed:o,hooks:l})},setup(e){_.forEach(e,(e,t)=>{Ti.DictFactory.GetDict(t)||Ti.DictFactory.CreateDict({data:Wn.Util.genQuery(e.data,{vkey:null}),query:Wn.Util.genQuery(e.query),item:Wn.Util.genQuery(e.item,{blankAs:"{}"}),children:Wn.Util.genQuery(e.children),getValue:Ti.Util.genGetter(e.value),getText:Ti.Util.genGetter(e.text),getIcon:Ti.Util.genGetter(e.icon),shadowed:Ti.Util.fallback(e.shadowed,!0)},{name:t})})},hMakerComponents:()=>Ti.DictFactory.GetOrCreate({data:Wn.Util.genQuery("ti coms -cqn",{vkey:null}),getValue:e=>e.name,getText:e=>e.title||e.name,getIcon:e=>e.icon||"im-plugin",isMatched:(e,t)=>{if(e.name==t||e.title==t)return!0;if(e.name&&e.name.indexOf(t)>=0)return!0;if(e.title){if(e.title.indexOf(t)>=0)return!0;let i=Ti.I18n.text(e.title);if(i&&i.indexOf(t)>=0)return!0}return!1},shadowed:!0},{name:"hMakerComponents"})},OpenObjSelector=function(){return async function(e="~",{title:t="i18n:select",icon:i="im-folder-open",type:n="info",closer:a=!0,textOk:r="i18n:ok",textCancel:s="i18n:cancel",position:o="top",width:l="80%",height:c="90%",spacing:d,multi:m=!0,fromIndex:p=0,homePath:u=Wn.Session.getHomePath(),fallbackPath:h=Wn.Session.getHomePath(),selected:g=[]}={}){let y=e;return _.isString(e)&&(y=await Wn.Io.loadMeta(e)),!y&&h&&e!=h&&(y=await Wn.Io.loadMeta(h)),y?"DIR"==y.race||(y=await Wn.Io.loadMetaById(y.pid))?await Ti.App.Open({type:n,width:l,height:c,spacing:d,position:o,closer:a,icon:i,title:t,actions:[{text:r,handler:({$main:e})=>e.myChecked},{text:s,handler:()=>void 0}],modules:{current:"@mod:wn/obj-meta",main:"@mod:wn/obj-current"},comType:"modal-inner-body",components:[{name:"modal-inner-body",globally:!1,data:{myChecked:[],myShown:{}},props:{icon:void 0,text:void 0,trimed:void 0,placeholder:void 0,valueCase:void 0,value:void 0},template:'<ti-gui\n          :layout="theLayout"\n          :schema="theSchema"\n          :shown="myShown"\n          :can-loading="true"\n          :loading-as="status.reloading"\n          @sky::item:active="OnCurrentMetaChange"\n          @arena::open="OnCurrentMetaChange"\n          @arena::select="OnArenaSelect"/>',computed:{...Vuex.mapGetters("current",{obj:"get",objHome:"getHome",objIsHome:"isHome",objHasParent:"hasParent",objParentIsHome:"parentIsHome"}),...Vuex.mapState("main",["data","status"]),theCrumbData(){return Wn.Obj.evalCrumbData({meta:_.get(this.obj,"meta"),ancestors:_.get(this.obj,"ancestors"),fromIndex:p,homePath:u},e=>{e.asterisk=_.get(this.mainStatus,"changed")})},theLayout:()=>({type:"rows",border:!0,blocks:[{name:"sky",size:".5rem",body:"sky"},{name:"arena",body:"main"}]}),theSchema(){return{sky:{comType:"ti-crumb",comConf:{style:{padding:"0 .1rem"},data:this.theCrumbData}},main:{comType:"wn-adaptlist",comConf:{meta:this.obj,data:this.data,status:this.status,multi:m,listConf:{resizeDelay:200}}}}}},methods:{OnCurrentMetaChange({id:e,path:t,value:i}={}){this.open(e||t||i)},OnArenaSelect({checked:e}){this.myChecked=_.filter(e,e=>"FILE"==e.race)},async open(e){if(e&&(_.isString(e)&&(e=await Wn.Io.loadMetaBy(e)),e&&"DIR"==e.race)){let t=Ti.App(this);t.dispatch("current/reload",e),t.dispatch("main/reload",e)}}},mounted:function(){this.open(y)}}]}):await Ti.Toast.Open({content:"i18n:e-io-obj-noexistsf",vars:{ph:`Parent of id:${y.id}->pid:${y.pid}`,nm:`Parent of id:${y.nm}->pid:${y.pid}`}},"warn"):await Ti.Toast.Open({content:"i18n:e-io-obj-noexistsf",vars:_.isString(e)?{ph:e,nm:Ti.Util.getFileName(e)}:e.ph},"warn")}}(),OpenThingManager=function(){return async function(e,{textOk:t="i18n:ok",icon:i="fas-database",title:n,ok:a=(({result:e})=>e),textCancel:r="i18n:close",position:s="top",width:o="96%",height:l="96%",spacing:c}={}){if(Ti.Util.isNil(e))return await Ti.Toast.Open("ThingSet path is nil","warn");let d=_.isString(e)?await Wn.Io.loadMeta(e):e;if(!d)return await Ti.Toast.Open(`Fail to found ThingSet: ${e}`,"warn");d.th_auto_select=!1;let m=await Wn.Sys.exec(`ti views id:${d.id} -cqn`,{as:"json"});return await Ti.App.Open({icon:i,title:n||d.title||d.nm,position:s,width:o,height:l,escape:!1,topActions:m.actions,textOk:t,textCancel:r,ok:a,modules:{current:"@mod:wn/obj-current",main:"@mod:wn/thing"},comType:"wn-thing-manager",comConf:{"...":"=Main",emitChange:!0},components:["@com:wn/thing/manager"],preload:async function(e){e.commit("current/setMeta",d),await e.dispatch("main/reload",d)}})}}(),EditObjMeta=function(){return async function(e="~",{icon:t,title:i,type:n="info",closer:a=!0,escape:r=!0,textOk:s="i18n:ok",textCancel:o="i18n:cancel",position:l="top",width:c=640,height:d="80%",spacing:m,currentTab:p=0,fields:u=[],fixedKeys:h=["thumb"],saveKeys:g=["thumb"],autoSave:y=!0}={}){let f=e;_.isString(f)&&(f=await Wn.Io.loadMeta(e));let w={};_.forEach(h,e=>w[e]=!0);let T={};if(_.forEach(g,e=>T[e]=!0),"auto"==u){let e=await Wn.Sys.exec2(`ti metas id:${f.id} -cqn`,{as:"json"});e&&(u=e.fields,p=e.currentTab||p||0)}!_.isEmpty(u)&&_.isArray(u)||(u=[{title:"basic",fields:["id","nm","title","icon","thumb","ph","race","tp","mime","width","height","len","sha1"]},{title:"privilege",fields:["c","m","g","md","pvg"]},{title:"timestamp",fields:["ct","lm","expi"]},{title:"others",fields:["..."]}]);let b=Wn.Obj.evalFields(f,u,e=>w[e.uniqKey]?e:e.quickName&&_.isUndefined(e.value)?void 0:e),k=t||Wn.Util.getObjIcon(f,"zmdi-info-outline"),O=i||Wn.Util.getObjDisplayName(f),j=await Ti.App.Open({type:n,width:c,height:d,spacing:m,position:l,closer:a,escape:r,icon:k,title:O,actions:[{text:s,handler:({$main:e})=>_.cloneDeep({updates:e.updates,data:e.meta})},{text:o,handler:({$main:e})=>{let t=_.keys(e.updates);for(let i of t)if(T[i])return _.cloneDeep({updates:e.updates,data:e.meta})}}],comType:"modal-inner-body",components:[{name:"modal-inner-body",globally:!1,data:{myFormFields:b,currentTab:p,meta:f,updates:{}},template:'<ti-form\n          mode="tab"\n          :current-tab="currentTab"\n          :fields="myFormFields"\n          :data="meta"\n          @field:change="onFieldChange"\n          @change="onChange"\n          />',methods:{onChange(e){this.meta=e},onFieldChange({name:e,value:t}={}){let i=Ti.Types.toObjByPair({name:e,value:t});this.updates=_.assign({},this.updates,i)}}},"@com:ti/form","@com:wn/imgfile"]});if(!j)return;let{updates:x}=j,S=!1;if(y&&!_.isEmpty(x)){let e=JSON.stringify(x),t=`obj 'id:${f.id}' -ocqn -u`,i=await Wn.Sys.exec2(t,{input:e,as:"json"});return await Ti.Toast.Open("i18n:save-done","success"),S=!0,{updates:x,data:i,saved:S}}return j}}(),EditObjContent=function(){return async function(e="~",{title:t,icon:i,type:n="info",closer:a=!0,textOk:r,textCancel:s="i18n:cancel",position:o="top",width:l=640,height:c="80%",spacing:d,readonly:m=!1,showEditorTitle:p=!0,content:u,placeholder:h="i18n:blank"}={}){let g=e;_.isString(g)&&(g=await Wn.Io.loadMeta(e)),_.isUndefined(r)&&(r=this.saveBy?"i18n:save":"i18n:ok");let y=Ti.Util.isNil(u),f=i||Wn.Util.getObjIcon(g,"zmdi-receipt"),w=t||"i18n:edit",T=y?await Wn.Io.loadContent(g):u,b=await Ti.App.Open({type:n,width:l,height:c,spacing:d,position:o,closer:a,title:w,result:T,comType:"ti-text-raw",comConf:{readonly:m,placeholder:h,icon:f,title:Wn.Util.getObjDisplayName(g),content:T,showTitle:p,ignoreKeyUp:!0},components:["@com:ti/text/raw"]});return y&&!_.isUndefined(b)&&b!=T&&(await Wn.Io.saveContentAsText(g,b),await Ti.Toast.Open("i18n:save-done","success")),b}}(),EditTiComponent=function(){return async function({comType:e,comConf:t}={},{icon:i="fas-pencil-ruler",title:n="i18n:edit-com",type:a="info",closer:r=!0,textOk:s="i18n:ok",textCancel:o="i18n:cancel",position:l="top",width:c=800,height:d="90%",spacing:m}={}){return await Ti.App.Open({type:a,width:c,height:d,spacing:m,position:l,closer:r,icon:i,title:n,textOk:s,textCancel:o,comType:"hmaker-edit-com",comConf:{value:{comType:e,comConf:t}},result:{comType:e,comConf:_.cloneDeep(t)},components:["@com:hmaker/edit-com"]})}}(),WALNUT_VERSION="2.1-20200910.013551",HOOKs={};export const Wn={Version:WALNUT_VERSION,Io:Io,Obj:Obj,Session:Session,Sys:Sys,Util:Util,Dict:Dict,OpenObjSelector:OpenObjSelector,EditObjMeta:EditObjMeta,EditObjContent:EditObjContent,EditTiComponent:EditTiComponent,OpenThingManager:OpenThingManager,addHook(e,t){Ti.Util.pushValue(HOOKs,e,t)},doHook(e,t){let i=HOOKs[e];if(_.isArray(i)&&i.length>0)for(let e of i)e(t)}};export default Wn;window&&(window.Wn=Wn);