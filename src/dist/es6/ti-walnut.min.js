const Io=function(){function e(e){return"/o/"+e}function t(e,t){if(!e.ok){if(_.isUndefined(t))throw e;return t}return e.data}const i={OID(e){if(!e)return{};let t=_.trim(e),i=t.indexOf(":");return i<0?{id:t,myId:t}:{id:t,homeId:t.substring(0,i).trim(),myId:t.substring(i+1).trim()}},getObjMyId:e=>i.OID(e).myId,isFullObjId:e=>/^[0-9a-v]{26}(:.+)?$/.test(e),isFullObjIdPath:e=>/^id:[0-9a-v]{26}(:.+)?$/.test(e),async loadMetaBy(e,t,n){if(i.isFullObjId(e))return await i.loadMetaById(e,n);if(/^(id:|\/|~)/.test(e))return await i.loadMeta(e,n);let a;a=t?_.isString(t)?Ti.Util.getParentPath(t):"FILE"==t.race?"id:"+t.pid:"id:"+t.id:"~";let o=Ti.Util.appendPath(a,e);return await i.loadMeta(o)},loadMetaById:async(e,t)=>await i.loadMeta("id:"+e,t),async loadMeta(i,{loadPath:n=!1}={}){let a=e(n?"fetch2":"fetch");return t(await Ti.Http.get(a,{params:{str:i},as:"json"}),null)},async loadMetaAt(e,t){let n=t;return e&&!/^(~\/|\/|id:)/.test(t)&&(n=`id:${e.pid}/${t}`),await i.loadMeta(n)},async loadAncestors(i){let n=e("ancestors");return t(await Ti.Http.get(n,{params:{str:i},as:"json"}),[])},async loadChildren(n,{skip:a,limit:o,sort:s={nm:1},mine:r,match:l={}}={}){if(!n)return null;if("DIR"!=n.race)return 0===o?[]:{};if(n.mnt||n.ln){let i=e("children");return t(await Ti.Http.get(i,{params:{str:`id:${n.id}`,pg:!0},as:"json"}))}l.pid=n.id;let c=await i.find({skip:a,limit:o,sort:s,mine:r,match:l});if(n.ph&&c&&_.isArray(c.list))for(let e of c.list)e.ph||(e.ph=Ti.Util.appendPath(n.ph,e.nm));return c},async find({skip:i=0,limit:n=100,sort:a={},mine:o=!0,match:s={}}={}){let r=e("find");return t(await Ti.Http.get(r,{params:_.assign({},s,{_l:n,_o:i,_me:o,_s:JSON.stringify(a)}),as:"json"}))},async findList(e={}){let t=await i.find(e);return t&&_.isArray(t.list)?t.list:[]},async findInBy(e,t,{skip:n=0,limit:a=100,sort:o={},mine:s=!0,match:r={},keys:l={"^[0-9a-v]{26}(:.+)$":["id","${val}"]},dftKey:c=["nm","^.*${val}.*$"]}={}){if(!_.isUndefined(e)){let t=c;for(let i of _.keys(l))if(new RegExp(i).test(e)){t=l[i];break}let i=t[0],n=Ti.S.renderBy(t[1],{val:e});r[i]=n}if(t&&t.id&&t.ph)r.pid=t.id;else if(_.isString(t)){let e=await i.loadMeta(t);r.pid=e.id}return await i.find({skip:n,limit:a,sort:o,mine:s,match:r})},async findListInBy(e,t,n={}){let a=await i.findInBy(e,t,n);return a&&_.isArray(a.list)?a.list:[]},async loadContent(t,{as:n="text"}={}){if(_.isString(t)&&(t=await i.loadMeta(t)),!t||"DIR"==t.race)return null;let a=t.mime||"application/octet-stream";if(Wn.Util.isMimeText(a)){let i=e("content");return await Ti.Http.get(i,{params:{str:"id:"+t.id,d:"raw"},as:n})}return t.sha1},async update(t,n={}){if(!t||_.isEmpty(n))return;if(_.isString(t)&&(t=await i.loadMetaBy(t)),!_.isPlainObject(t))throw Ti.Err.make("e-wn-io-invalidUpdateTarget",t);let a=e("/update"),o=await Ti.Http.post(a,{params:{str:"id:"+t.id},body:JSON.stringify(n),as:"json"});if(!o.ok)throw Ti.Err.make(o.errCode,o.data,o.msg);return o.data},async saveContentAsText(t,i,{createIfNoExists:n=!1,asBase64:a=!1}={}){if(!t)return;Ti.Util.isNil(i)&&(i="");let o;if(_.isString(t))o=t;else if(t.id){let{id:e,nm:i,ph:n,race:a}=t;if("DIR"==a)throw Ti.Err.make("e-wn-io-writeNoFile",n||i||e);o=`id:${e}`}else{if(!t.ph)throw console.error("Invlaid metaOrPath",t),Ti.Err.make("Invalid metaOrPath",t);{let{ph:e,race:i}=t;if("DIR"==i)throw Ti.Err.make("e-wn-io-writeNoFile",e);o=e}}let s={str:o,content:i,cine:n,base64:a},r=e("/save/text"),l=await Ti.Http.post(r,{params:s,as:"json"});if(!l.ok)throw Ti.Err.make(l.errCode,l.data,l.msg);return l.data},async uploadFile(t,{target:i="~",mode:n="a",tmpl:a="${major}(${nb})${suffix}",progress:o=_.identity}={}){let s=e("/save/stream");return await Ti.Http.post(s,{file:t,progress:o,params:{str:i,nm:t.uploadName||t.name,sz:t.size,mime:t.type,m:n,tmpl:a},as:"json"})},async moveTo(e,{base:t,homePath:i,objMatch:n,objFilter:a,objSort:o,leafBy:s,treeDisplay:r,confirm:l=!1,title:c="i18n:move-to",exposeHidden:m=!1,testBeforeMove:d=((e,t)=>!!(e&&e.id&&e.nm)&&((!e.__is||!e.__is.loading&&!e.__is.removed)&&!t[e.id])),markItemStatus:p=_.identity,doneMove:u=_.identity,successTip:h="i18n:wn-move-to-ok"}={}){if(!t)return;_.isString(t)&&(t=await Wn.Io.loadMeta(t));let y=[];if(e&&(y=_.isArray(e)?e:[e]),_.isEmpty(y))return await Ti.Toast.Open("i18n:wn-move-to-none","warn");if(l&&!await Ti.Confirm({text:"i18n:wn-move-to-confirm",vars:{N:y.length}},{type:"warn"}))return;let g=await Wn.OpenObjTree(t,{title:c,homePath:i,objMatch:n,objFilter:a,objSort:o,leafBy:s,treeDisplay:r,exposeHidden:m});if(!g||!g.id||g.id==t.id)return;let f=0,w={};try{for(let e of y){if(!d(e,w))continue;p(e.id,"loading"),await Wn.Sys.exec(`mv id:${e.id} id:${g.id}`),p(e.id,"moved");let t=/^id:(.+)$/.exec(e.videoc_dir);if(t){let e=t[1];w[e]=!0,this.setItemStatus(e,"moved"),p(e,"moved")}f++}await u()}finally{Ti.Toast.Open(h,{N:f},"success")}},getFormedPath(e){if(!e)return null;let t=_.isString(e)?e:e.ph;if(!t)return null;let i=Wn.Session.getHomePath(),n=Ti.Util.getRelativePath(i,t,"");return Ti.Util.appendPath("~",n)},formatObjPath(e,t,n){let a={path:()=>n?Ti.Util.getRelativePath(n.ph,e.ph):i.getFormedPath(e.ph),fullPath:()=>e.ph,idPath:()=>`id:${e.id}`,id:()=>e.id,nm:()=>e.nm,obj(){let t=n||["id","nm","thumb","title","mime","tp","sha1","len"];return _.pick(e,t)},wnobj:()=>e}[t];if(!a)throw"Invalid mode : "+t;return a()},async loadObjAs(e,t){let n={path:()=>i.loadMeta(e),fullPath:()=>i.loadMeta(e),idPath:()=>i.loadMeta(e),id:()=>i.loadMetaById(e),obj:()=>i.loadMetaById(e.id),wnobj:()=>_.cloneDeep(e)}[t];if(!n)throw"Invalid mode : "+t;return await n()}};return i}(),Obj=function(){const e={thumb:()=>({title:"i18n:wn-key-icon",display:Wn.Obj.getObjThumbDisplay("rawData")}),title:()=>({title:"i18n:wn-key-title",display:"title|nm"}),nm:()=>({title:"i18n:wn-key-nm",display:"nm"}),race:{title:"i18n:wn-key-race",display:{key:"race",comConf:{format:"i18n:wn-race-${race}"}}},tp:{title:"i18n:wn-key-tp",display:"rawData.tp::as-tip"},mime:{title:"i18n:wn-key-mime",display:"rawData.mime::as-tip"},c:{title:"i18n:wn-key-c",display:"rawData.c::as-tip"},m:{title:"i18n:wn-key-m",display:"rawData.m::as-tip"},g:{title:"i18n:wn-key-g",display:"rawData.g::as-tip"},d0:{title:"i18n:wn-key-d0",display:"rawData.d0::as-tip"},d1:{title:"i18n:wn-key-d1",display:"rawData.d1::as-tip"},md:{title:"i18n:wn-key-md",display:{key:"rawData.md",transformer:"Wn.Obj.modeToStr",comConf:{className:"as-tip"}}},sort:{title:"i18n:sort",display:"rawData.sort"},width:{title:"i18n:wn-key-width",display:"rawData.width"},height:{title:"i18n:wn-key-height",display:"rawData.height"},duration:{title:"i18n:wn-key-duration",display:"rawData.duration"},len:{title:"i18n:wn-key-len",display:{key:"rawData.len",transformer:"Ti.S.sizeText",comConf:{className:"as-tip-block align-right"}}},ct:{title:"i18n:wn-key-ct",display:{key:"rawData.ct",transformer:"Ti.DateTime.timeText",comConf:{className:"as-tip-block align-right is-nowrap"}}},lm:{title:"i18n:wn-key-lm",display:{key:"rawData.lm",transformer:"Ti.DateTime.timeText",comConf:{className:"as-tip-block align-right is-nowrap"}}}},t={id:{title:"i18n:wn-key-id",name:"id",comType:"WnObjId"},nm:{title:"i18n:wn-key-nm",name:"nm",display:"<=ti-label>",comType:"ti-input"},title:{title:"i18n:wn-key-title",name:"title",emptyAs:null,display:"<=ti-label>.is-nowrap",comType:"ti-input"},sort:{title:"i18n:sort",name:"sort",type:"Integer",comType:"ti-input-num",comConf:{width:140}},icon:{title:"i18n:wn-key-icon",name:"icon",width:"auto",comType:"ti-input-icon"},ph:{title:"i18n:wn-key-ph",name:"ph",comConf:{className:"is-break-word"}},thumb:{title:"i18n:wn-key-thumb",name:"thumb",checkEquals:!1,rowSpan:3,nameVAlign:"top",comType:"wn-upload-file",comConf:{valueType:"idPath",exlink:!1,target:"~/.thumbnail/gen/${id}.jpg",filter:"cover(256,256)",quality:.372}},race:{title:"i18n:wn-key-race",name:"race",comConf:{format:"i18n:wn-race-${race}"}},mime:{title:"i18n:wn-key-mime",name:"mime",comConf:{className:"is-nowrap",editable:!0}},tp:{title:"i18n:wn-key-tp",name:"tp",comConf:{className:"is-nowrap",editable:!0}},ct:{title:"i18n:wn-key-ct",name:"ct",type:"AMS"},lm:{title:"i18n:wn-key-lm",name:"lm",type:"AMS"},expi:{title:"i18n:wn-key-expi",name:"expi",type:"AMS"},pid:{title:"i18n:wn-key-pid",name:"pid",comType:"WnObjId"},d0:{title:"i18n:wn-key-d0",name:"d0"},d1:{title:"i18n:wn-key-d1",name:"d1"},c:{title:"i18n:wn-key-c",name:"c"},m:{title:"i18n:wn-key-m",name:"m"},g:{title:"i18n:wn-key-g",name:"g"},data:{title:"i18n:wn-key-data",name:"data"},sha1:{title:"i18n:wn-key-sha1",name:"sha1",comConf:{className:"is-nowrap",fullField:!1}},md:{title:"i18n:wn-key-md",name:"md",type:"Integer",colSpan:2,comType:"WnObjMode",comConf:{valueType:"decimal"}},pvg:[{title:"i18n:wn-key-pvg"},{name:"pvg",type:"Object",colSpan:3,comType:"TiInputText",comConf:{autoJsValue:!0,height:200}}],width:{title:"i18n:wn-key-width",name:"width"},height:{title:"i18n:wn-key-height",name:"height"},duration:{title:"i18n:wn-key-duration",name:"duration",width:"auto",comConf:{suffixText:"i18n:tu-sec"}},len:{title:"i18n:wn-key-len",name:"len",width:"auto",transformer:e=>Ti.S.sizeText(e,{bytes:!0})}},i={isValidName:e=>!e||e.search(/[%;:"'*?`\t^<>\/\\]/)>=0?(Ti.Alert("i18n:wn-rename-invalid",{type:"warn"}),!1):!(e.length>256)||(Ti.Alert("i18n:wn-rename-too-long",{type:"warn"}),!1),octalModeToStr(e){let t=parseInt(e,8);return i.modeToStr(t)},modeToStr(e){let t=[];for(let i=2;i>=0;i--){let n=e>>3*i&7;t.push((4&n)>0?"r":"-"),t.push((2&n)>0?"w":"-"),t.push((1&n)>0?"x":"-")}return t.join("")},modeToOctal:e=>e.toString(8),octalModeFromStr:e=>i.modeFromStr(e).toString(8),modeFromOctalMode:e=>parseInt(e,8),modeFromStr(e){let t=0;for(let n=0;n<3;n++){let a=3*(2-n),o=e.substring(a,a+3);t|=i.modeFromStr0(o)<<3*n}return t},modeFromStr0(e){let t=0;return"r"==e[0]&&(t|=4),"w"==e[1]&&(t|=2),"x"==e[2]&&(t|=1),t},modeToObj(e){let t=["other","member","owner"],n={mode:e,text:i.modeToStr(e),octal:e.toString(8)};for(let i=2;i>=0;i--){let a=e>>3*i&7;n[t[i]]={readable:(4&a)>0,writable:(2&a)>0,excutable:(1&a)>0}}return n},modeFromObj:({owner:e,member:t,other:n}={})=>i.mode0FromObj(e)<<6|i.mode0FromObj(t)<<3|i.mode0FromObj(n),mode0FromObj({readable:e,writable:t,excutable:i}={}){let n=0;return e&&(n|=4),t&&(n|=2),i&&(n|=1),n},parseMode(e,t=!1){if(/^\{.+\}$/.test(e)&&(e=JSON.parse(e)),_.isPlainObject(e))return e.readable?{owner:_.cloneDeep(e),member:_.cloneDeep(e),other:_.cloneDeep(e)}:e;let n="DEFAULT";if(_.isNumber(e)&&e<0)n="WEAK",e=Math.abs(e);else if(_.isString(e)){let t=/^([!~])(.+)$/.exec(e);t&&(n={"~":"WEAK","!":"STRONG"}[t[1]],e=t[2])}let a=0;/^[rwx-]{3,9}$/.test(e)?a=3==e.length?i.modeFromStr0(e):i.modeFromStr(e):/^0[0-7]{3}$/.test(e)?a=i.modeFromOctalMode(e.substring(1)):t?a=i.modeFromOctalMode(e):(a=parseInt(e))<=7&&(a|=a<<6|a<<3);let o=i.modeToObj(a);return o.blend=n,o},isBuiltInFields:e=>!!t[e],getGroupTitle:e=>/^(basic|privilege|thumb|timestamp|more|advance|customized|others)$/.test(e)?`i18n:wn-key-grp-${e}`:e,getObjThumbDisplay:(e="..",{dftIcon:t="fas-birthday-cake",className:i}={})=>({key:e,type:"Object",transformer:{name:"Ti.Types.toObject",args:{icon:"icon",thumb:"thumb",type:"tp",mime:"mime",race:"race",timestamp:"__updated_time"}},comType:"wn-obj-icon",comConf:{className:i,"...":"${=value}",defaultIcon:t}}),getTableFieldAs(e,t,i=_.identity){_.isFunction(t)&&(i=t,t=null);let n={title:e};return n.display="size"==t?{key:`rawData.${e}`,transformer:"Ti.S.sizeText",comConf:{className:"as-tip-block align-right"}}:"AMS"==t?{key:`rawData.${e}`,transformer:"Ti.DateTime.timeText",comConf:{className:"as-tip-block align-right is-nowrap"}}:{key:`rawData.${e}`},i(n)||n},getTableField(t,i={}){let n;if(_.isString(t)?((n=_.get(e,t))||(n={title:t,display:t}),_.isFunction(n)&&(n=n(t))):n=_.isFunction(t)?t():t,!_.isEmpty(i)){let e=_.cloneDeep(n);return _.assign(e,i)}return n},getField(e){let i=t[e];return i?_.cloneDeep(i):{title:e,name:e,type:"String",comConf:{className:"is-break-word"}}},evalFields(e={},t=[],i=_.identity){const n=function(t=[],i=[],a={}){return _.forEach(t,t=>{if("..."==t)return void i.push(t);let o,s=!1;if(_.isString(t))s=!0,o=Wn.Obj.getField(t);else if(_.isArray(t.fields)){if(o={..._.omit(t,"title","type","fields"),title:Wn.Obj.getGroupTitle(t.title),type:"Group",fields:[]},n(t.fields,o.fields,a),_.isEmpty(o.fields))return}else o=t;const r=function(t){let n=Ti.S.join([t.name],"-");a[n]=!0;let o=_.get(e,t.name);i.push(_.assign(t,{quickName:s,uniqKey:n,value:o}))};if(_.isArray(o))for(let e of o)r(e);else r(o)}),i},a=function(t=[],n=[],o={}){for(let s of t)if("Group"!=s.type)if("..."==s)_.forEach(e,(e,t)=>{if(Ti.Util.isNil(e)||Wn.Obj.isBuiltInFields(t)||o[t]||"children"==t||t.startsWith("_"))return;let a,s=Ti.Types.getJsType(e,"String");a=_.isNumber(e)&&parseInt(e)===e&&e>2436192e5?{type:"AMS",display:{key:t,transformer:"Ti.DateTime.format",comConf:{className:"ass-tip"}},comType:"TiInputDatetime"}:{Integer:{type:"Number",display:t,comType:"ti-input"},Number:{type:"Number",display:t,comType:"ti-input"},Boolean:{type:"Boolean",comType:"ti-toggle"},Array:{type:"Array",display:{key:t},transformer:"JSON.stringify(null, '  ')",comType:"ti-input-text",comConf:{height:240}}}[s]||{type:"String",display:{key:t,comConf:{className:"is-nowrap"}},comType:"ti-input"};let r=i({title:t,name:t,...a});r&&n.push(r)});else{let e=i(s);e&&n.push(e)}else s.fields=a(s.fields,[],o),_.isEmpty(s.fields)||n.push(s);return n};let o={},s=n(t,[],o);return s=a(s,[],o)},async genObjFormFields({meta:e,fields:t=[],currentTab:n=0,fixedKeys:a=["icon","thumb","title"]}={}){let o={};if(_.forEach(a,e=>o[e]=!0),"auto"==t){let i=await Wn.Sys.exec2(`ti metas id:${e.id} -cqn`,{as:"json"});i&&(t=i.fields,n=i.currentTab||n||0)}!_.isEmpty(t)&&_.isArray(t)||(t=[{title:"basic",fields:["id","nm","title","icon","thumb","sort","width","height","ph","race","tp","mime","len","sha1","pid"]},{title:"privilege",fields:["c","m","g","md","pvg"]},{title:"timestamp",fields:["ct","lm","expi"]},{title:"others",gridColumnHint:[[1,400],0],fields:["..."]}]);return{currentTab:n,fields:i.evalFields(e,t,e=>{if(o[e.uniqKey])return e;if(!e.quickName||!_.isUndefined(e.value))return e})}},isAs(e={},t,n){let a=_.get(e,t);if(Ti.Util.isNil(a))return!1;if(_.isArray(n)){for(let a of n)if(i.isAs(e,t,a))return!0;return!1}return _.isString(n)?n.startsWith("^")?new RegExp(n).test(a):n.startsWith("!^")?!new RegExp(n.substring(1)).test(a):a==n:!!_.isRegExp(n)&&n.test(a)},isMime:(e={},t)=>i.isAs(e,"mime",t),isType:(e={},t)=>i.isAs(e,"type",t),evalCrumbData({meta:e,ancestors:t=[],fromIndex:i=0,homePath:n=null,titleBy:a,iteratee:o=_.identity,self:s=_.identity}={}){let r=[];if(e){let l=_.map(t),c=i;if(n)for(n.endsWith("/")&&(n=n.substring(0,n.length-1));c<l.length;c++){if(l[c].ph==n)break}for(;c<l.length;c++){let e=l[c],t={icon:Wn.Util.getIconObj(e),text:Wn.Util.getObjDisplayName(e,a),value:e.id,href:Wn.Util.getAppLink(e)+""};(t=o(t,c,e))&&r.push(t)}if(s){let t={icon:Wn.Util.getIconObj(e),text:Wn.Util.getObjDisplayName(e,a),value:e.id,href:null,asterisk:_.get(this.mainStatus,"changed")};_.isFunction(s)&&(t=s(t,c,e)||t),t&&r.push(t)}}return r}};return i}(),Session=function(){const e={},t={},i={},n={async setup({id:e,uid:t,unm:a,me:o,grp:s,by_tp:r,by_val:l,envs:c={}}={}){_.assign(i,{id:e,uid:t,unm:a,me:o,grp:s,by_tp:r,by_val:l}),n.env(c),Ti.Env("theme",c.THEME),Ti.Env("REMOTE_TIME_OFFSET_IN_MS",0);let m=_.trim(await Wn.Sys.exec2("date -zone")),d=/^(GMT)([+-][\d:]+)\/(\d+)$/.exec(m);if(d){let e=1*d[3];Ti.Env("TIMEZONE_OFFSET_REMOTE",e);let t=-6e4*(new Date).getTimezoneOffset();Ti.Env("TIMEZONE_OFFSET_LOCAL",t),Ti.Env("TIMEZONE_DIFF",e-t)}},env(e){if(_.isPlainObject(e))_.assign(t,e);else{if(_.isString(e))return t[e];if(_.isArray(e))return _.pick(t,e)}return _.cloneDeep(t)},getLang:()=>n.env("LANG"),getMyId:()=>i.uid,getMyName:()=>i.unm,getMyGroup:()=>i.grp,getMyJobs:()=>i.me.jobs||[],getMyDepts:()=>i.me.depts||[],getByType:()=>i.by_tp,isByType:e=>_.isRegExp(e)?e.test(i.by_tp):_.isString(e)&&e.startsWith("^")?new RegExp(e).test(i.by_tp):e==i.by_tp,getByValue:()=>i.by_val,isByValue:e=>_.isRegExp(e)?e.test(i.by_val):_.isString(e)&&e.startsWith("^")?new RegExp(e).test(i.by_val):e==i.by_val,getMe:()=>i.me,I_am_SysAccount:()=>!_.get(i.me,"roleInDomain"),I_am_domain_ADMIN:()=>"ADMIN"==_.get(i.me,"roleInDomain"),I_am_domain_MEMBER(){let e=_.get(i.me,"roleInDomain");return/^(ADMIN|MEMEBER)$/.test(e)},I_am_op_ADMIN:()=>"ADMIN"==_.get(i.me,"roleInOp"),I_am_op_MEMBER(){let e=_.get(i.me,"roleInOp");return/^(ADMIN|MEMEBER)$/.test(e)},async loadMyPvg(){let t=await Wn.Sys.exec2("www pvg -cqn",{as:"json"});return _.assign(e,t),e},getAllPvgs:()=>_.cloneDeep(e),isPvgCanOne(...t){if(e.$SYS_USR&&/^(admin|memeber)$/.test(i.me.role))return!0;for(let i of t)if(e[i])return!0;return!1},isPvgCanAll(...t){if(e.$SYS_USR&&/^(admin|memeber)$/.test(i.me.role))return!0;for(let i of t)if(!e[i])return!1;return!0},isPvgCan(e,t=!0){if(_.isEmpty(e))return t;let i=_.concat(e);for(let e of i){let t=e.split("+");if(t=_.map(t,e=>_.trim(e)),!n.isPvgCanAll(t))return!1}return!0},getHomePath:()=>n.env("HOME"),getCurrentPath:(e="~")=>n.env("PWD")||e,getCurrentDomain(){let e=n.getHomePath();if(!e)return;if("/root"==e)return"root";let t=/^\/home\/(.+)$/.exec(e);return t?t[1]:void 0},getApiPrefix:()=>`/api/${n.getCurrentDomain()}`,getApiUrl(e){let t=n.getApiPrefix();return Ti.Util.appendPath(t,e)}};return n}(),Sys=function(){const WnSysRespParsing=function(){class e{constructor({macroObjSep:e,eachLine:t=_.identity,macro:i={}}={}){this.macroObjSep=e,this.lastIndex=0,this.lines=[],this.MACRO={},this.__TO=null,this.eachLine=t,this.macro=i}init(e){this.content=e}done(){this.updated({isLastCalled:!0}),_.forOwn(this.MACRO,(e,t)=>{let i=e.join("\n"),n=JSON.parse(i);this.MACRO[t]=n,Ti.InvokeBy(this.macro,t,[n])})}__push_line(e){if(e.startsWith(this.macroObjSep)){let t=e.substring(this.macroObjSep.length).trim(),[i,n]=_.without(t.split(/ *: */g),""),a=this[i];a&&(a[n]=[]),this.__TO={key:i,name:n}}else if(this.__TO){let{key:t,name:i}=this.__TO;this[t][i].push(e)}else this.lines.push(e),this.eachLine(e)}updated({isLastCalled:e=!1}={}){let t=this.content();for(;this.lastIndex<t.length;){let i=t.indexOf("\n",this.lastIndex);if(i>=this.lastIndex){let e=i+1;i>0&&"\r"==t[i-1]&&i--;let n=t.substring(this.lastIndex,i);this.__push_line(n),this.lastIndex=e}else{if(!e)break;{let e=t.substring(this.lastIndex);this.__push_line(e),this.lastIndex=t.length}}}}getResult(){return{lines:this.lines,macro:this.MACRO}}}return e}(),DFT_MACRO_OBJ_SEP="%%wn.meta."+Ti.Random.str(10)+"%%",WnSys={async exec(cmdText,{vars:vars,input:input="",appName:appName=Ti.GetAppName(),eachLine:eachLine,as:as="text",blankAs:blankAs="",macroObjSep:macroObjSep=DFT_MACRO_OBJ_SEP,autoRunMacro:autoRunMacro=!0,forceFlushBuffer:forceFlushBuffer=!1,errorBy:errorBy,PWD:PWD=Wn.Session.getCurrentPath()}={}){vars&&(cmdText=Ti.S.renderBy(cmdText,vars));let url=`/a/run/${appName}`,params={mos:macroObjSep,PWD:PWD,cmd:cmdText,in:input,ffb:forceFlushBuffer},ing={eachLine:eachLine,macroObjSep:macroObjSep};autoRunMacro&&(ing.macro={update_envs:e=>{Wn.Session.env(e),Wn.doHook("update_envs",e)}});let parsing=new WnSysRespParsing(ing),readyStateChanged=void 0;forceFlushBuffer&&_.isFunction(eachLine)&&(readyStateChanged=(()=>{parsing.updated()})),await Ti.Http.send(url,{method:"POST",params:params,as:"text",created:e=>{parsing.init(()=>e.responseText)},readyStateChanged:readyStateChanged}).catch(e=>{parsing.isError=!0}).finally(()=>{parsing.done()});let re=parsing.getResult();if(Ti.IsInfo("Wn.Sys")&&console.log("Wn.Sys.exec@return",re),parsing.isError){let e=re.lines.join("\n");if(_.isFunction(errorBy)){let[t,...i]=e.split(/ *: */),n=i.join(" : ");t=_.trim(t);let a=t.replace(/[.]/g,"-");return errorBy({code:t,msgKey:a,data:n})}throw e}return{raw:()=>re,lines:()=>re.lines,macro:()=>re.macro,text:()=>re.lines.join("\n"),json:()=>{let e=re.lines.join("\n");Ti.S.isBlank(e)&&(e=blankAs);try{return JSON.parse(e)}catch(t){throw console.error(`Error [${cmdText}] for parse JSON:`,e),t}},jso:()=>{let json=re.lines.join("\n");Ti.S.isBlank(json)&&(json=blankAs);try{return eval("("+json+")")}catch(e){throw console.error(`Error [${cmdText}] for eval JSO:`,json),e}}}[as]()},exec2:async(e,t={})=>(_.defaults(t,{errorBy:async function({code:e,msgKey:i,data:n}){let a=Ti.I18n.get(i);return Ti.Util.isNil(n)||_.isString(n)&&!n||(a+=" : "+Ti.Types.toStr(n)),await Ti.Alert(a,{title:"i18n:warn",type:"error"}),_.isFunction(t.errorAs)?t.errorAs({code:e,msgKey:i,data:n}):Ti.Err.make(e,n)}}),await Wn.Sys.exec(e,t)),execJson:async(e,t={as:"json"})=>await WnSys.exec(e,t),exec2Json:async(e,t={as:"json"})=>await WnSys.exec2(e,t),nowInMs:async()=>1*await WnSys.exec2("date -ms"),async timeOffsetInMs(){let e=Date.now();return await WnSys.nowInMs()-e}};return WnSys}(),Util=function(){const e={toFuzzyStr:(e,t=!1)=>!e||e.startsWith("^")?e:t?"^"+e:"^.*"+e,fromFuzzyStr(e){let t=/^(\^(\.\*)?)(.+)((\.\*)?\$)?$/.exec(e);return t?t[3]:e},isMimeText:e=>/^text\//.test(e)||"application/x-javascript"==e||"application/json"==e,isMimeJson:e=>"text/json"==e||"application/json"==e,getIconName(e){let t=/^<i +class=["'] *(fa|zmdi|im) +(fa|zmdi|im)-([^" ]+) *["']> *<\/i>$/.exec(e);return t?t[3]:e},genPreviewObj(t){if(t.thumb)return/https?:\/\//.test(t.thumb)?{type:"image",value:t.thumb}:{type:"image",value:"/o/thumbnail/id:"+t.id};if(t.icon){let i=e.getIconName(t.icon);return Ti.Icons.get(i,{type:"font",value:i})}return Ti.Icons.get(t)},getIconObj:e=>e&&e.icon?e.icon:Ti.Icons.get(e),getObjIcon:(e,t)=>e?e.icon||Ti.Icons.get(e,t):t,getObjThumbIcon({icon:e,thumb:t,mime:i,type:n,race:a,candidateIcon:o,timestamp:s=0}={},r){if(t){let e=`/o/content?str=${t}`;return s>0&&(e+=`&_t=${s}`),{type:"image",value:e}}return e?{type:"font",value:e}:o||(n||i||a?Ti.Icons.get({type:n,mime:i,race:a}):r)},getObjThumbIcon2(e,t){if(e){if(e.thumb){let t;return t=/^https?:\/\//.test(e.thumb)?e.thumb:`/o/content?str=${e.thumb}`,{type:"image",value:t}}if(e.icon)return e.icon}return t||Ti.Icons.get(e)},getObjDisplayName:(e,t=[])=>Ti.Util.getFallbackEmpty(e,t,"title","nm"),getAppLink(t,{appName:i="wn.manager",encoded:n=!1}={}){let a;return/^(\/|~|id:)/.test(t)?a="ph":_.isString(t)?a="id":t.id?a="id":t.ph&&(a="ph"),e.getLink(`/a/open/${i}`,t,{pathKey:a,encoded:n})},getAppLinkStr(t,i){if(t)return e.getAppLink(t,i).toString()},getObjBadges(e={},t){if(_.isFunction(t))return t(e);let{NW:i=null,NE:n=["ln","zmdi-open-in-new"],SW:a=null,SE:o=null}=t||{},s={},r=function(t,i){if(_.isFunction(i)&&(i=i(e)),i)if(_.isArray(i)&&i.length>0)2==i.length&&_.isString(i[0])&&(s[t]=i[1]);else if(_.isPlainObject(i)){if(i.value){if(i.test&&!Ti.AutoMatch.test(i.test,e))return;let n=Ti.Util.explainObj(e,{type:i.type||"icon",className:i.className,style:i.style,value:i.value});n&&(s[t]=n)}else if(i.key,i.badges){let n=_.get(e,i.key),a=i.badges[n];a&&(_.isString(a)&&(a={value:a}),s[t]={type:"icon",className:"as-label-70 is-primary",...a})}}else s[t]=i};return r("NW",i),r("NE",n),r("SW",a),r("SE",o),s},getObjThumbInfo(t={},{exposeHidden:i=!1,status:n={},progress:a={},badges:o,titleKey:s}={}){if(!t||!t.nm)return;let r="show";t.nm.startsWith(".")&&i&&(r=i?"weak":"hide");let l=s;return _.isFunction(s)&&(l=s()),{id:t.id,nm:t.nm,title:e.getObjDisplayName(t,l),preview:e.genPreviewObj(t),href:e.getAppLinkStr(t),visibility:r,status:n[t.id],progress:a[t.id],badges:e.getObjBadges(t,o),rawData:t}},getDownloadLink:(t,{mode:i="force",timestamp:n}={})=>e.getLink("/o/content",t,{pathKey:"str",encoded:!0,params:{d:i,_ts:n}}),getDownloadLinkStr(t,i){if(t)return e.getDownloadLink(t,i).toString()},getMatchByFilter({keyword:e,match:t,majorKey:i,majorValue:n}={},a={}){let o={};if(i=a.majorKey||i,e)if(/"^[\d\w]{26}(:.+)?$"/.test(e))o.id=e;else{let t=a.defaultKey||"nm",i=_.cloneDeep(a.keyword),n=_.keys(i);for(let a of n){let n=i[a];if(new RegExp(n).test(e)){t=a;break}}t.startsWith("=")?o[t.substring(1).trim()]=e:t.startsWith("~")?o[t.substring(1).trim()]="^"+e:o[t]="^.*"+e}_.isEmpty(t)||_.forEach(t,(e,t)=>{Ti.Util.isNil(e)||(o[t]=e)}),i&&!Ti.Util.isNil(n)&&_.set(o,i,n);let s=a.match;return _.isEmpty(s)||_.assign(o,s),o},getLink(e,t,{pathKey:i="ph",encoded:n=!1,params:a={}}={}){if(_.isEmpty(t))return{url:e,params:a};let o={...a};const s=e=>n?encodeURIComponent(e):e;return/^(\/|~|id:)/.test(t)?o[i]=s(t):_.isString(t)?o[i]="id"==i?t:`id:${t}`:t.id?o[i]="id"==i?t.id:`id:${t.id}`:t.ph&&(o[i]=s(t.ph)),Ti.Util.Link({url:e,params:o})},wrapTreeNode(e){if(_.isPlainObject(e)){let t={id:e.id,name:e.nm,leaf:"DIR"!=e.race,rawData:e};if(t.leaf||(t.children=[]),t.id&&t.name)return t}},genQuery:(e,{vkey:t="val",wrapArray:i=!1,errorAs:n,blankAs:a="[]"}={})=>_.isFunction(e)?e:_.isArray(e)?i?()=>e:e:_.isString(e)?t?async i=>{let o=Ti.S.renderBy(e,{[t]:i});return await Wn.Sys.exec2(o,{as:"json",input:i,errorAs:n,blankAs:a})}:async t=>await Wn.Sys.exec2(e,{as:"json",errorAs:n,blankAs:a}):void 0,setFieldStatusBeforeUpdate({commit:e},t){e("setFieldStatus",{name:t,type:"spinning",text:"i18n:saving"})},setFieldStatusAfterUpdate({commit:e},t,i){i instanceof Error?e("setFieldStatus",{name:t,type:"warn",text:i.message||"i18n:fail"}):(e("setFieldStatus",{name:t,type:"ok",text:"i18n:ok"}),_.delay(()=>{e("clearFieldStatus",t)},500))}};return e}(),Dict={evalOptionsDict({options:e,dictVars:t,findBy:i,itemBy:n,childrenBy:a,valueBy:o,textBy:s,iconBy:r,dictShadowed:l=!0},c){let m=Ti.DictFactory.DictReferName(e);if(m){let{name:e,dynamic:i,dictKey:n}=Ti.DictFactory.explainDictName(m);if(i){let i=_.get(t,n);return i?Ti.DictFactory.CheckDynamicDict({name:e,key:i,vars:t}):null}return Ti.DictFactory.CheckDict(m,c)}return Ti.DictFactory.CreateDict({dataChildrenKey:e.dataChildrenKey,data:Wn.Util.genQuery(e,{vkey:null,blankAs:"[]"}),query:Wn.Util.genQuery(i,{blankAs:"[]"}),item:Wn.Util.genQuery(n,{errorAs:null,blankAs:"{}"}),children:Wn.Util.genQuery(a,{errorAs:null,blankAs:"[]"}),getValue:Ti.Util.genGetter(o||"id|value"),getText:Ti.Util.genGetter(s||"title|text|nm"),getIcon:Ti.Util.genGetter(r||Wn.Util.getObjThumbIcon)},{shadowed:l,hooks:c})},setup(e){_.forEach(e,(e,t)=>{if(e.dynamic){let i=_.pick(e,"dataChildrenKey","data","query","item","children","value","text","icon","shadowed");Ti.DictFactory.CreateDynamicDict(function(e={}){let t=Ti.Util.explainObj(e,i);return Ti.DictFactory.CreateDict({dataChildrenKey:t.dataChildrenKey,data:Wn.Util.genQuery(t.data,{vkey:null}),query:Wn.Util.genQuery(t.query),item:Wn.Util.genQuery(t.item,{blankAs:"{}"}),children:Wn.Util.genQuery(t.children),getValue:Ti.Util.genGetter(t.value),getText:Ti.Util.genGetter(t.text),getIcon:Ti.Util.genGetter(t.icon),shadowed:Ti.Util.fallback(t.shadowed,!0)})},t)}else{Ti.DictFactory.GetDict(t)||Ti.DictFactory.CreateDict({dataChildrenKey:e.dataChildrenKey,data:Wn.Util.genQuery(e.data,{vkey:null}),query:Wn.Util.genQuery(e.query),item:Wn.Util.genQuery(e.item,{blankAs:"{}"}),children:Wn.Util.genQuery(e.children),getValue:Ti.Util.genGetter(e.value),getText:Ti.Util.genGetter(e.text),getIcon:Ti.Util.genGetter(e.icon),shadowed:Ti.Util.fallback(e.shadowed,!0)},{name:t})}})},hMakerComponents:()=>Ti.DictFactory.GetOrCreate({data:Wn.Util.genQuery("ti coms -cqn",{vkey:null}),getValue:e=>e.name,getText:e=>e.title||e.name,getIcon:e=>e.icon||"im-plugin",isMatched:(e,t)=>{if(e.name==t||e.title==t)return!0;if(e.name&&e.name.indexOf(t)>=0)return!0;if(e.title){if(e.title.indexOf(t)>=0)return!0;let i=Ti.I18n.text(e.title);if(i&&i.indexOf(t)>=0)return!0}return!1},shadowed:!0},{name:"hMakerComponents"})},Hm=function(){const e={background:{title:"i18n:hmk-css-background",name:"background",comType:"TiInput"},"background-image":{title:"i18n:hmk-css-background-image",name:"background-image",fieldWidth:"100%",comType:"TiInput"},"background-position":{title:"i18n:hmk-css-background-position",name:"background-position",comType:"TiDroplist",comConf:{options:"#CssBackgroundPositions"}},"background-position-x":{title:"i18n:hmk-css-background-position-x",name:"background-position-x",comType:"TiSwitcher",comConf:{options:"#CssBackgroundXPositions"}},"background-position-y":{title:"i18n:hmk-css-background-position-y",name:"background-position-y",comType:"TiSwitcher",comConf:{options:"#CssBackgroundYPositions"}},"background-repeat":{title:"i18n:hmk-css-background-repeat",name:"background-repeat",comType:"TiDroplist",comConf:{placeholder:"i18n:no-set",options:"#CssBackgroundRepeats"}},"background-size":{title:"i18n:hmk-css-background-size",name:"background-size",width:"full",comType:"TiSwitcher",comConf:{options:"#CssBackgroundSizes"}},"background-color":{title:"i18n:hmk-css-background-color",name:"background-color",comType:"ti-input-color"},border:{title:"i18n:hmk-css-border",name:"border",comType:"TiInput"},"border-radius":{title:"i18n:hmk-css-border-radius",name:"border-radius",comType:"TiInput"},"box-shadow":{title:"i18n:hmk-css-box-shadow",name:"box-shadow",comType:"TiInput"},color:{title:"i18n:hmk-css-color",name:"color",comType:"ti-input-color"},float:{title:"i18n:hmk-css-float",name:"float",comType:"TiSwitcher",comConf:{options:[{value:"none",text:"i18n:hmk-css-float-none",icon:"fas-align-justify"},{value:"left",text:"i18n:hmk-css-float-left",icon:"fas-align-left"},{value:"right",text:"i18n:hmk-css-float-right",icon:"fas-align-right"}]}},"font-size":{title:"i18n:hmk-css-font-size",name:"font-size",comType:"TiInput"},"font-weight":{title:"i18n:hmk-css-font-weight",name:"font-weight",comType:"TiInput"},height:{title:"i18n:hmk-css-height",name:"height",comType:"TiInput"},"letter-spacing":{title:"i18n:hmk-css-letter-spacing",name:"letter-spacing",comType:"TiInput"},"line-height":{title:"i18n:hmk-css-line-height",name:"line-height",comType:"TiInput"},margin:{title:"i18n:hmk-css-margin",name:"margin",comType:"TiInput"},"max-height":{title:"i18n:hmk-css-max-height",name:"max-height",comType:"TiInput"},"max-width":{title:"i18n:hmk-css-max-width",name:"max-width",comType:"TiInput"},"min-height":{title:"i18n:hmk-css-min-height",name:"min-height",comType:"TiInput"},"min-width":{title:"i18n:hmk-css-min-width",name:"min-width",comType:"TiInput"},"object-fit":{title:"i18n:hmk-css-object-fit",name:"object-fit",comType:"TiDroplist",comConf:{placeholder:"i18n:no-set",options:[{value:"fill",text:"i18n:hmk-css-object-fit-fill"},{value:"contain",text:"i18n:hmk-css-object-fit-contain"},{value:"cover",text:"i18n:hmk-css-object-fit-cover"},{value:"none",text:"i18n:hmk-css-object-fit-none"},{value:"scale-down",text:"i18n:hmk-css-object-fit-scale-down"}]}},"object-positon":{title:"i18n:hmk-css-object-position",name:"object-position",comType:"TiInput"},opacity:{title:"i18n:hmk-css-opacity",name:"opacity",type:"Float",defaultAs:1,comType:"TiSlideBar",comConf:{className:"hdl-lg inner-color-0 hdl-color-0",width:"100%",textWidth:".5rem",prefixText:!1}},overflow:{title:"i18n:hmk-css-overflow",name:"overflow",fieldWidth:"100%",comType:"TiSwitcher",comConf:{options:[{value:"auto",text:"i18n:hmk-css-c-auto"},{value:"scroll",text:"i18n:hmk-css-overflow-scroll"},{value:"hidden",text:"i18n:hmk-css-overflow-hidden"},{value:"clip",text:"i18n:hmk-css-overflow-clip"},{value:"visible",text:"i18n:hmk-css-overflow-visible"}]}},padding:{title:"i18n:hmk-css-padding",name:"padding",comType:"TiInput"},"text-align":{title:"i18n:hmk-css-text-align",name:"text-align",comType:"TiSwitcher",comConf:{options:[{value:"left",tip:"i18n:hmk-css-align-left",icon:"fas-align-left"},{value:"center",tip:"i18n:hmk-css-align-center",icon:"fas-align-center"},{value:"right",tip:"i18n:hmk-css-align-right",icon:"fas-align-right"},{value:"justify",tip:"i18n:hmk-css-align-justify",icon:"fas-align-justify"}]}},"text-shadow":{title:"i18n:hmk-css-text-shadow",name:"text-shadow",comType:"TiInput"},"text-transform":{title:"i18n:hmk-css-text-transform",name:"text-transform",comType:"TiSwitcher",comConf:{options:[{value:"capitalize",text:"i18n:hmk-css-text-transform-capitalize"},{value:"uppercase",text:"i18n:hmk-css-text-transform-uppercase"},{value:"lowercase",text:"i18n:hmk-css-text-transform-lowercase"}]}},"text-overflow":{title:"i18n:hmk-css-text-overflow",name:"text-overflow",comType:"TiSwitcher",comConf:{options:[{value:"clip",text:"i18n:hmk-css-text-overflow-clip",icon:"fas-cut"},{value:"ellipsis",text:"i18n:hmk-css-text-overflow-ellipsis",icon:"fas-ellipsis-h"}]}},width:{title:"i18n:hmk-css-width",name:"width",comType:"TiInput"},"white-space":{title:"i18n:hmk-css-white-space",name:"white-space",comType:"TiDroplist",comConf:{options:[{value:"normal",text:"i18n:hmk-css-white-space-normal"},{value:"nowrap",text:"i18n:hmk-css-white-space-nowrap"},{value:"pre",text:"i18n:hmk-css-white-space-pre"},{value:"pre-wrap",text:"i18n:hmk-css-white-space-pre-wrap"},{value:"pre-line",text:"i18n:hmk-css-white-space-pre-line"},{value:"break-space",text:"i18n:hmk-css-white-space-break-space"}]}}},t={aspect:["margin","padding","border","border-radius","color","box-shadow","opacity","object-fit","object-positon","float","overflow"],background:["background-color","background-image","background-position-x","background-position-y","background-size","background-repeat"],measure:["width","height","max-width","max-height","min-width","min-height"],texting:["text-align","white-space","text-overflow","text-transform","font-size","font-weight","letter-spacing","line-height","text-shadow"]};return{getCssPropTitle(t){let i=e[t];return i?i.title:t},getCssPropField(t,i={}){let n=_.cloneDeep(e[t]);if(n)return _.merge(n,i)},findCssPropFields(i=!0){let n={"#BLOCK":[/^(margin|padding|border|overflow|background)-?/,/^(box-shadow|float|opacity)$/,/^((max|min)-)?(width|height)$/],"#IMG":[/^(margin|border|object|background)-?/,/^(box-shadow|float|opacity|overflow)$/,/^((max|min)-)?(width|height)$/],"#TEXT":[/^(color|background(-.+)?)$/,/^((text|font)-.+|opacity)$/,/^(line-height|letter-spacing|white-space)$/],"#TEXT-BLOCK":[/^(margin|padding|color||overflow)$/,/^(border|background)(-.+)?/,/^((text|font)-.+|opacity)$/,/^(line-height|letter-spacing|white-space)$/,/^(width|height)$/]}[i];n&&(i=n);let a=Ti.AutoMatch.parse(i),o={};_.forEach(e,(e,t)=>{a(t)&&(o[t]=e)});let s=[];return _.forEach(t,(e,t)=>{let i=[];for(let t of e){let e=o[t];e&&i.push(e)}if(i.length>0){let e={aspect:[[2,720],[1,360],0],background:[[2,720],[1,360],0],measure:[[2,720],[1,360],0],texting:[[2,720],[1,360],0]}[t];s.push({title:`i18n:hmk-css-grp-${t}`,gridColumnHint:e,fields:i})}}),s}}}(),OpenObjSelector=function(){return async function(e="~",{title:t="i18n:select",icon:i="im-folder-open",type:n="info",closer:a=!0,textOk:o="i18n:ok",textCancel:s="i18n:cancel",position:r="top",width:l="80%",height:c="90%",spacing:m,multi:d=!0,titleBy:p="title|nm",fromIndex:u=0,exposeHidden:h=!1,homePath:y=Wn.Session.getHomePath(),fallbackPath:g=Wn.Session.getHomePath(),sideItems:f=[],sideWidth:w="2rem",search:b={filter:{},sorter:{nm:1}},filter:T=(e=>"FILE"==e.race),canOpen:k=(e=>"DIR"==e.race),selected:x=[]}={}){let v=e;if(_.isString(e)&&(v=await Wn.Io.loadMeta(e)),!v&&g&&e!=g&&(v=await Wn.Io.loadMeta(g)),!v)return await Ti.Toast.Open({content:"i18n:e-io-obj-noexistsf",vars:_.isString(e)?{ph:e,nm:Ti.Util.getFileName(e)}:e.ph},"warn");let S=[];for(let e of f){let t=await Wn.Io.loadMeta(e);t&&S.push({depth:0,key:t.id,id:t.id,path:t.ph,icon:Ti.Icons.get(t),title:t.title||t.nm})}return"DIR"==v.race||(v=await Wn.Io.loadMetaById(v.pid))?await Ti.App.Open({type:n,width:l,height:c,spacing:m,position:r,closer:a,icon:i,title:t,actions:[{text:o,handler:({$main:e})=>e.myChecked},{text:s,handler:()=>void 0}],modules:{axis:"@mod:wn/obj-axis",current:"@mod:wn/obj-current",main:"@mod:wn/obj-children"},comType:"modal-inner-body",components:["@com:ti/crumb","@com:wn/adaptlist","@com:wn/gui/side/nav",{name:"modal-inner-body",globally:!1,data:{myChecked:[],myShown:{side:S.length>1}},props:{icon:void 0,text:void 0,trimed:void 0,placeholder:void 0,valueCase:void 0,value:void 0},template:'<ti-gui\n          :layout="TheLayout"\n          :schema="TheSchema"\n          :shown="myShown"\n          :can-loading="true"\n          :loading="status.reloading"\n          @item:active="OnCurrentMetaChange"\n          @arena::open:wn:obj="OnCurrentMetaChange"\n          @arena::select="OnArenaSelect"/>',computed:{...Vuex.mapState("axis",["ancestors","parent"]),...Vuex.mapState("current",["meta","status","fieldStatus"]),...Vuex.mapState("main",["data"]),CrumbData(){let e=Wn.Obj.evalCrumbData({meta:this.meta,ancestors:this.ancestors,fromIndex:u,homePath:y,titleBy:p,iteratee:(e,t,{nm:i}={})=>{if(h||!i||!i.startsWith("."))return e}});return _.isEmpty(e)||(e[0].icon=null),e},SideConfig(){return{items:S,highlightItemId:_.get(this.meta,"id"),highlightItemPath:_.get(this.meta,"ph")}},TheLayout:()=>({type:"rows",border:!0,blocks:[{name:"sky",size:".5rem",body:"sky"},{type:"cols",border:!0,blocks:[{name:"side",size:w,body:"side"},{name:"arena",body:"main"}]}]}),TheSchema(){return{sky:{comType:"ti-crumb",comConf:{style:{padding:"0 .1rem"},data:this.CrumbData}},side:{comType:"wn-gui-side-nav",comConf:this.SideConfig},main:{comType:"wn-adaptlist",comConf:{meta:this.meta,data:this.data,status:this.status,multi:d,listConf:{resizeDelay:200},itemTitleKey:p}}}}},methods:{OnCurrentMetaChange({id:e,path:t,value:i}={}){this.open(e||t||i)},OnArenaSelect({checked:e}){_.isFunction(T)?this.myChecked=_.filter(e,e=>!!T(e)):this.myChecked=e},async open(e){if(e)if(_.isString(e)&&(e=await Wn.Io.loadMetaBy(e)),k(e)){let t=Ti.App(this);b&&(t.commit("main/setFilter",b.filter||{}),t.commit("main/setSorter",b.sorter||{nm:1})),t.commit("current/setMeta",e),t.dispatch("main/reload",e),t.dispatch("axis/reload",e)}else console.log(this.myChecked),this.$notify("ok",this.myChecked)}},mounted:function(){this.open(v)}}]}):await Ti.Toast.Open({content:"i18n:e-io-obj-noexistsf",vars:{ph:`Parent of id:${v.id}->pid:${v.pid}`,nm:`Parent of id:${v.nm}->pid:${v.pid}`}},"warn")}}(),OpenObjTree=function(){return async function(e="~",{title:t="i18n:select",icon:i="zmdi-gamepad",type:n="info",closer:a=!0,textOk:o="i18n:ok",textCancel:s="i18n:cancel",position:r="top",width:l=640,height:c="90%",spacing:m,multi:d=!1,exposeHidden:p=!1,treeDisplay:u,homePath:h=Wn.Session.getHomePath(),fallbackPath:y=Wn.Session.getHomePath(),objMatch:g={race:"DIR"},leafBy:f,objSort:w,objFilter:b}={}){let T=await Wn.Io.loadMeta(h,{loadPath:!0}),k=e;if(_.isString(e)?k=await Wn.Io.loadMeta(e,{loadPath:!0}):k&&k.id&&!k.ph&&(k=await Wn.Io.loadMetaById(k.id,{loadPath:!0})),!k&&y&&e!=y&&(k=await Wn.Io.loadMeta(y)),!k)return await Ti.Toast.Open({content:"i18n:e-io-obj-noexistsf",vars:_.isString(e)?{ph:e,nm:Ti.Util.getFileName(e)}:e.ph},"warn");if("DIR"!=k.race&&!(k=await Wn.Io.loadMetaById(k.pid)))return await Ti.Toast.Open({content:"i18n:e-io-obj-noexistsf",vars:{ph:`Parent of id:${k.id}->pid:${k.pid}`,nm:`Parent of id:${k.nm}->pid:${k.pid}`}},"warn");let x=k,v=Wn.Io.getFormedPath(x);v.startsWith("~/")&&(v=v.substring(2));let S=Ti.Util.splitPathToFullAncestorList(v),O=await Ti.App.Open({type:n,width:l,height:c,spacing:m,position:r,closer:a,icon:i,title:t,textOk:o,textCancel:s,model:{event:"select"},comType:"WnObjTree",comConf:{meta:T,showRoot:!1,multi:d,display:u,currentId:x.id,openedNodePath:S,objMatch:g,leafBy:f,sortBy:w,objFilter:b||function(e){return!(!p&&/^\./.test(e.nm))}},components:["@com:wn/obj/tree"]});return O&&!_.isEmpty(O.selected)?d?O.selected:O.current:void 0}}(),OpenThingManager=function(){return async function(e,{textOk:t="i18n:ok",icon:i="fas-database",title:n,ok:a=(({result:e})=>e),textCancel:o="i18n:close",position:s="top",width:r="96%",height:l="96%",spacing:c}={}){if(Ti.Util.isNil(e))return await Ti.Toast.Open("ThingSet path is nil","warn");let m=_.isString(e)?await Wn.Io.loadMeta(e):e;if(!m)return await Ti.Toast.Open(`Fail to found ThingSet: ${e}`,"warn");m.th_auto_select=!1;let d=await Wn.Sys.exec(`ti views id:${m.id} -cqn`,{as:"json"});return await Ti.App.Open({icon:i,title:n||m.title||m.nm,position:s,width:r,height:l,escape:!1,topActions:d.actions,textOk:t,textCancel:o,ok:a,modules:{current:"@mod:wn/obj-current",main:"@mod:wn/thing"},comType:"wn-thing-manager",comConf:{"...":"=Main",emitChange:!0},components:["@com:wn/thing/manager"],preload:async function(e){e.commit("current/setMeta",m),await e.dispatch("main/reload",m)}})}}(),EditObjMeta=function(){return async function(e="~",{icon:t,title:i,type:n="info",closer:a=!0,escape:o=!0,textOk:s="i18n:ok",textCancel:r="i18n:cancel",position:l="top",width:c=640,height:m="90%",spacing:d,currentTab:p=0,fields:u=[],fixedKeys:h=["icon","thumb","title"],saveKeys:y=["thumb"],autoSave:g=!0}={}){let f=e;_.isString(f)&&(f=await Wn.Io.loadMeta(e));let w={};_.forEach(y,e=>w[e]=!0);let b=await Wn.Obj.genObjFormFields({meta:f,fields:u,currentTab:p,fixedKeys:h}),T=b.fields;p=b.currentTab||p||0;let k=t||Wn.Util.getObjIcon(f,"zmdi-info-outline"),x=i||Wn.Util.getObjDisplayName(f);if(!(b=await Ti.App.Open({type:n,width:c,height:m,spacing:d,position:l,closer:a,escape:o,icon:k,title:x,actions:[{text:s,handler:({$main:e})=>_.cloneDeep({updates:e.updates,data:e.meta})},{text:r,handler:({$main:e})=>{let t=_.keys(e.updates);for(let i of t)if(w[i])return _.cloneDeep({updates:e.updates,data:e.meta})}}],ready(){this.$main.meta=f},comType:"modal-inner-body",components:[{name:"modal-inner-body",globally:!1,data:{myFormFields:T,currentTab:p,meta:void 0,updates:{}},template:'<ti-form\n          mode="tab"\n          :current-tab="currentTab"\n          :fields="myFormFields"\n          :gridColumnHint="[[1,420],0]"\n          :data="meta"\n          @field:change="onFieldChange"\n          @change="onChange"\n          />',methods:{onChange(e){this.meta=e},onFieldChange({name:e,value:t}={}){let i=Ti.Types.toObjByPair({name:e,value:t});this.updates=_.assign({},this.updates,i)}}},"@com:ti/form","@com:ti/input/text","@com:wn/imgfile","@com:wn/obj/mode"]})))return;let{updates:v}=b,S=!1;if(g&&!_.isEmpty(v)){let e=JSON.stringify(v),t=`obj 'id:${f.id}' -ocqn -u`,i=await Wn.Sys.exec2(t,{input:e,as:"json"});return await Ti.Toast.Open("i18n:save-done","success"),S=!0,{updates:v,data:i,saved:S}}return b}}(),EditObjContent=function(){return async function(e="~",{title:t,icon:i,type:n="info",closer:a=!0,textOk:o,textCancel:s="i18n:cancel",position:r="top",width:l="80%",height:c="96%",spacing:m,readonly:d=!1,showEditorTitle:p=!0,content:u,placeholder:h="i18n:blank",autoSave:y}={}){let g=e;_.isString(g)&&(g=await Wn.Io.loadMeta(e)),_.isUndefined(o)&&(o=this.saveBy?"i18n:save":"i18n:ok"),y=Ti.Util.fallback(y,Ti.Util.isNil(u)),i||Wn.Util.getObjIcon(g,"zmdi-receipt");let f=t||"i18n:edit",w=y?await Wn.Io.loadContent(g):u,b="text";if("application/json"==g.mime)b="json";else if("text/plain"==g.mime)b={js:"javascript",json:"json"}[g.tp]||"text";else{let e=/^text\/(.+)$/.exec(g.mime);e&&(b=e[1])}let T=await Ti.App.Open({type:n,width:l,height:c,spacing:m,position:r,closer:a,title:f,result:w,comType:"TiTextCodeAce",comConf:{mode:b},components:["@com:ti/text/code/ace"]});return y&&!_.isUndefined(T)&&T!=w&&(await Wn.Io.saveContentAsText(g,T),await Ti.Toast.Open("i18n:save-done","success")),T}}(),EditObjPrivilege=function(){return async function(e="~",{icon:t="fas-user-lock",title:i="i18n:wn-key-pvg",type:n="info",closer:a=!0,escape:o=!0,position:s="top",width:r="80%",minWidth:l=720,height:c="95%",autoSave:m=!0}={}){let d=e;_.isString(d)&&(d=await Wn.Io.loadMeta(e));let p=Ti.I18n.text(i)+" : "+Ti.I18n.text(d.title||d.nm),u=await Ti.App.Open({type:n,width:r,height:c,position:s,closer:a,escape:o,icon:t,title:p,result:d.pvg,comType:"WnObjPrivilege",components:["@com:wn/obj/privilege"]});if(u&&!_.isEqual(d.pvg,u)){if(m){let e=_.isEmpty(u)?{"!pvg":!0}:{pvg:u},t=JSON.stringify(e),i=`o 'id:${d.id}' @update @json -cqn`,n=await Wn.Sys.exec2(i,{input:t,as:"json"});return await Ti.Toast.Open("i18n:save-done","success"),n}return d.pvg=u,d}}}(),EditObjPvg=function(){return async function(e="~",{icon:t="fas-user-lock",title:i="i18n:wn-key-pvg",type:n="info",closer:a=!0,escape:o=!0,position:s="top",width:r="80%",minWidth:l=720,height:c="95%",autoSave:m=!0}={}){let d=e;_.isString(d)&&(d=await Wn.Io.loadMeta(e));let p=Ti.I18n.text(i)+" : "+Ti.I18n.text(d.title||d.nm),u=await Ti.App.Open({type:n,width:r,height:c,position:s,closer:a,escape:o,icon:t,title:p,result:d.pvg,comType:"WnObjPvg",comConf:{autoRemoveDefault:!0},components:["@com:wn/obj/pvg"]});if(u&&!_.isEqual(d.pvg,u)){if(m){let e=_.isEmpty(u)?{"!pvg":!0}:{pvg:u},t=JSON.stringify(e),i=`o 'id:${d.id}' @update @json -cqn`,n=await Wn.Sys.exec2(i,{input:t,as:"json"});return await Ti.Toast.Open("i18n:save-done","success"),n}return d.pvg=u,d}}}(),EditTiComponent=function(){return async function({comType:e,comConf:t}={},{icon:i="fas-pencil-ruler",title:n="i18n:edit-com",type:a="info",closer:o=!0,textOk:s="i18n:ok",textCancel:r="i18n:cancel",position:l="top",width:c=800,height:m="90%",spacing:d}={}){return await Ti.App.Open({type:a,width:c,height:m,spacing:d,position:l,closer:o,icon:i,title:n,textOk:s,textCancel:r,comType:"hmaker-edit-com",comConf:{value:{comType:e,comConf:t}},result:{comType:e,comConf:_.cloneDeep(t)},components:["@com:hmaker/edit-com"]})}}(),OpenCmdPanel=function(){return async function(e,{title:t="i18n:run",icon:i="fas-running",type:n="info",closer:a=!0,textCancel:o="i18n:close",position:s="top",width:r="80%",height:l="90%",spacing:c,vars:m,input:d,forceFlushBuffer:p,showRunTip:u,showTailRunTip:h,preface:y,epilog:g="i18n:wn-cmd-panel-epilog",cmdTipText:f="i18n:wn-cmd-panel-tip",cmdTipIcon:w="fad-radiation",onBodyReady:b,afterRunCommand:T,whenSuccess:k,whenError:x,beforeClosed:v}={}){await Ti.App.Open({type:n,width:r,height:l,spacing:c,position:s,closer:a,icon:i,title:t,textCancel:o,textOk:null,model:null,ready:e=>{_.isFunction(b)&&b(e)},beforeClosed:v,comType:"WnCmdPanel",comConf:{value:e,tipText:f,tipIcon:w,vars:m,input:d,forceFlushBuffer:p,showRunTip:u,showTailRunTip:h,preface:y,epilog:g,afterRunCommand:T,whenSuccess:k,whenError:x},components:["@com:wn/cmd/panel"]})}}(),Youtube=function(){const e={async getVideoDetails(e,t=[],i=!1){if(!e||_.isEmpty(t))return;let{domain:n,thumbType:a,coverType:o}=e,s=JSON.stringify({id:t.join(","),part:e.videoPart}),r=`xapi send youtube ${n} videos ${i?"-force":""} -vars '${s}'`,l=await Wn.Sys.exec2(r,{as:"json"});if(!l||!_.isArray(l.items))throw"Fail to load youtube playlists by: "+r;let c=[];return _.forEach(l.items,e=>{let{id:t,snippet:i,contentDetails:n}=e,s={id:t,title:i.title,publishedAt:i.publishedAt,description:i.description,thumbUrl:_.get(i,`thumbnails.${a}.url`),coverUrl:_.get(i,`thumbnails.${o}.url`),defaultLanguage:i.defaultLanguage,defaultAudioLanguage:i.defaultAudioLanguage,categoryId:i.categoryId,duration:n.duration,definition:n.definition},r=Ti.DateTime.parseTime(s.duration);s.du_in_sec=r.value,s.du_in_str=r.toString("min"),c.push(s)}),c},async getAllVideos(t,i){if(!t)return;let n=await e.getPlaylistVideos(t,i),a=n.list||[];for(;n.next;)n=await e.getPlaylistVideos(t,i,{pageToken:n.next}),a=_.concat(a,n.list);return a},async getPlaylistVideos(t,i,{pageToken:n,maxResults:a=50,force:o}={}){if(!t)return;let{domain:s}=t;i=i||t.uploadsPlaylistId;let r=JSON.stringify({playlistId:i,part:"contentDetails",pageToken:n,maxResults:a}),l=`xapi send youtube ${s} playlistItems ${o?"-force":""} -vars '${r}'`,c=await Wn.Sys.exec2(l,{as:"json"});if(!c||!_.isArray(c.items))throw"Fail to load youtube playlistItems by: "+l;let m=[];_.forEach(c.items,e=>{let t=_.get(e.contentDetails,"videoId");m.push(t)});return{list:await e.getVideoDetails(t,m),prev:c.prevPageToken,next:c.nextPageToken}},async getAllPlaylists(t,{force:i=!1}={}){if(!t)return;let n=await e.getPlaylists(t),a=n.list||[];for(;n.next;)n=await e.getPlaylists(t,{pageToken:n.next,force:i}),a=_.concat(a,n.list);return a},async getPlaylists(e,{pageToken:t,maxResults:i=50,force:n}={}){if(!e)return;let{domain:a,channelId:o,thumbType:s}=e,r=JSON.stringify({channelId:o,part:e.playlistPart,pageToken:t,maxResults:i}),l=`xapi send youtube ${a} playlists ${n?"-force":""} -vars '${r}'`,c=await Wn.Sys.exec2(l,{as:"json"});if(!c||!_.isArray(c.items))throw"Fail to load youtube playlists by: "+l;let m=[];return _.forEach(c.items,e=>{let{id:t,snippet:i,contentDetails:n}=e,a={id:t,title:i.title,description:i.description,thumbUrl:_.get(i,`thumbnails.${s}.url`),itemCount:n.itemCount};m.push(a)}),{list:m,prev:c.prevPageToken,next:c.nextPageToken}},async loadConfig({domain:e,channelId:t,force:i=!1}={}){e||(e=Wn.Session.getCurrentDomain());let n=`~/.domain/youtube/${e}`,a=await Wn.Io.loadMeta(`${n}/youtube.json`),o=!0,s={};if(a&&(s=await Wn.Io.loadContent(a,{as:"json"}),o=!1),_.defaults(s,{domain:e,thumbType:"high",coverType:"maxres",maxResults:50,channelId:t,channelTitle:"No Title",channelPart:"snippet,contentDetails,statistics",uploadsPlaylistId:null,playlistPart:"snippet,contentDetails,status,id,player,localizations",videoPart:"snippet,contentDetails,status,id,player"}),o||i){let a=JSON.stringify({id:t,part:s.channelPart}),o=`xapi send youtube ${e} channels ${i?"-force":""} -vars '${a}'`,r=await Wn.Sys.exec2(o,{as:"json"});if(!r||!_.isArray(r.items)||_.isEmpty(r.items))throw"Fail to load youtube channels by: "+o;s.channelTitle=_.get(r,"items.0.snippet.title"),s.uploadsPlaylistId=_.get(r,"items.0.contentDetails.relatedPlaylists.uploads"),a=JSON.stringify(s),await Wn.Sys.exec2(`json -qn > ${n}/youtube.json`,{input:a})}return s}};return e}(),FbAlbum=function(){const e={async reloadAllPhotoList({albumId:t,domain:i,force:n}={}){let a=[],o=await e.loadPhotos(i,t,{force:n});if(o&&!_.isEmpty(o.data))for(a.push(...o.data);o&&o.after;)(o=await(await e.loadPhotos(i,t,{force:n,after:o.after})))&&!_.isEmpty(o.data)&&a.push(...o.data);return a},async loadPhotos(e,t,{after:i,force:n}={}){let a=JSON.stringify({id:t,after:i}),o=`xapi send fb-graph ${e} photos ${n?"-force":""} -vars '${a}'`;return await Wn.Sys.exec2(o,{as:"json"})},async loadAlbums(e,t,{after:i,force:n}={}){let a=JSON.stringify({id:t,after:i}),o=`xapi send fb-graph ${e} albums ${n?"-force":""} -vars '${a}'`;return await Wn.Sys.exec2(o,{as:"json"})},async loadPhoto(e,t,i){let n=JSON.stringify({id:t}),a=`xapi send fb-graph ${e} photo ${i?"-force":""} -vars '${n}'`;return await Wn.Sys.exec2(a,{as:"json"})}};return e}(),WALNUT_VERSION="1.2-20230826.192029",HOOKs={};export const Wn={Version:WALNUT_VERSION,Io:Io,Obj:Obj,Session:Session,Sys:Sys,Util:Util,Dict:Dict,Hm:Hm,OpenObjSelector:OpenObjSelector,OpenObjTree:OpenObjTree,EditObjMeta:EditObjMeta,EditObjContent:EditObjContent,EditObjPrivilege:EditObjPrivilege,EditObjPvg:EditObjPvg,EditTiComponent:EditTiComponent,OpenThingManager:OpenThingManager,OpenCmdPanel:OpenCmdPanel,Youtube:Youtube,FbAlbum:FbAlbum,addHook(e,t){Ti.Util.pushValue(HOOKs,e,t)},doHook(e,t){let i=HOOKs[e];if(_.isArray(i)&&i.length>0)for(let e of i)e(t)}};export default Wn;window&&(window.Wn=Wn);