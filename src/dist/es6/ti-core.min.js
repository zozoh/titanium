function Preload(t,e){LOAD_CACHE[t]=e}function AddResourcePrefix(...t){for(let e of t)e&&(e.endsWith("/")?RS_PREFIXs.push(e):RS_PREFIXs.push(e+"/"))}function MatchCache(t){if(t){for(let e of RS_PREFIXs)if(e&&t.startsWith(e)){t=t.substring(e.length);break}return LOAD_CACHE[t]}}function _IS_LOG(t="ROOT",e){let i=ENV.log[t];return _.isUndefined(i)&&(i=ENV.log.ROOT),i>=e}const{Alert:Alert}=function(){return{Alert:async function(t="",{title:e,icon:i,type:s="track",textOk:n="i18n:ok",position:r="center",width:a=480,height:o,vars:l={}}={}){let h=Ti.I18n.textf(t,l),c=i||Ti.Icons.get(s,"zmdi-info"),u=e||Ti.I18n.get(s);return await Ti.App.Open({className:"is-alert in-top-z-index",type:s,width:a,height:o,position:r,title:u,closer:!1,actions:[{text:n,handler:()=>!0}],comType:"modal-inner-body",comConf:{icon:c,text:h},components:{name:"modal-inner-body",globally:!1,props:{icon:void 0,text:void 0},template:'<div class="ti-msg-body as-alert">\n          <div class="as-icon"><ti-icon :value="icon"/></div>\n          <div class="as-text">{{text}}</div>\n        </div>'}})}}}(),{Confirm:Confirm}=function(){return{Confirm:async function(t="",{title:e,icon:i,closer:s=!1,type:n="info",position:r="center",textYes:a="i18n:yes",textNo:o="i18n:no",width:l=480,height:h}={}){let c=Ti.I18n.text(t),u=i||"zmdi-help",d=e||"i18n:confirm";return await Ti.App.Open({type:n,width:l,height:h,position:r,title:d,closer:s,actions:[{text:a,handler:()=>!0},{text:o,handler:()=>!1}],comType:"modal-inner-body",comConf:{icon:u,text:c},components:{name:"modal-inner-body",globally:!1,props:{icon:void 0,text:void 0},template:'<div class="ti-msg-body as-confirm">\n          <div class="as-icon"><ti-icon :value="icon"/></div>\n          <div class="as-text">{{text}}</div>\n        </div>'}})}}}(),{Prompt:Prompt}=function(){return{Prompt:async function(t="",{title:e="i18n:prompt",icon:i,type:s="info",position:n="center",iconOk:r,iconCancel:a,textOk:o="i18n:ok",textCancel:l="i18n:cancel",width:h=480,height:c,trimed:u=!0,placeholder:d="",valueCase:m=null,value:p=""}={}){let f=Ti.I18n.text(t),g=i||"zmdi-keyboard";return await Ti.App.Open({type:s,width:h,height:c,position:n,title:e,closer:!1,result:p,textOk:o,textCancel:l,iconOk:r,iconCancel:a,comType:"modal-inner-body",components:[{name:"modal-inner-body",globally:!1,data:{icon:g,text:f,placeholder:d||p,trimed:u,valueCase:m},props:{value:null},template:'<div class="ti-msg-body as-prompt"\n          v-ti-activable>\n          <div class="as-icon"><ti-icon :value="icon"/></div>\n          <div class="as-text">\n            <div class="as-tip" v-if="text">{{text}}</div>\n            <ti-input\n              :value="value"\n              :trimed="trimed"\n              :placeholder="placeholder"\n              :value-case="valueCase"\n              :focused="true"\n              :auto-select="true"\n              @inputing="onInputing"/>\n          </div>\n        </div>',methods:{onInputing(t){this.$emit("change",t)},__ti_shortcut(t){"ENTER"==t&&Ti.App(this).$vm().close(this.value)}}},"@com:ti/input"]})}}}(),{Captcha:Captcha}=function(){return{Captcha:async function(t="",{title:e="i18n:captcha-tip",type:i="info",position:s="center",iconOk:n,iconCancel:r,textOk:a="i18n:ok",textCancel:o="i18n:cancel",width:l=420,height:h,imgWidth:c,imgHeight:u=50,textChange:d="i18n:captcha-chagne",placeholder:m="i18n:captcha"}={}){return await Ti.App.Open({type:i,width:l,height:h,position:s,title:e,closer:!1,result:"",textOk:a,textCancel:o,iconOk:n,iconCancel:r,comType:"modal-inner-body",components:[{name:"modal-inner-body",globally:!1,data:{src:t,timestamp:Date.now(),imgWidth:c,imgHeight:u,textChange:d,placeholder:m||value},props:{value:null},template:'<div class="web-simple-form">\n          <header style="padding-bottom:0;">\n            <img ref="pic"\n              v-if="src"\n                :style="CaptchaStyle"\n                :src="CaptchaSrc"\n                @load="OnImgLoaded"/>\n          </header>\n          <section>\n            <div class="as-input">\n              <input ref="input"\n                spellcheck="false"\n                :placeholder="placeholder|i18n"\n                :value="value"\n                @input="$emit(\'change\', $refs.input.value)">\n              <span @click="timestamp = Date.now()">\n                <a>{{textChange|i18n}}</a>\n              </span>\n            </div>\n          </section>\n        </div>',computed:{CaptchaStyle(){return Ti.Css.toStyle({width:this.imgWidth,height:this.imgHeight})},CaptchaSrc(){return this.src&&this.timestamp>0?-1==this.src.lastIndexOf("?")?this.src+"?_t="+this.timestamp:this.src+"&_t="+this.timestamp:this.src}},methods:{OnImgLoaded(){Ti.Be.BlinkIt(this.$refs.pic)},__ti_shortcut(t){"ENTER"==t&&Ti.App(this).$vm().close(this.value)}}}]})}}}(),{Toast:Toast}=function(){const{TiRuntimeStack:t}=function(){class t{constructor({setItemViewportMode:t=_.identity}={}){this.viewportMode="desktop",this.stack=[],this.setItemViewportMode=t}push(t){t&&(this.setItemViewportMode(t,this.viewportMode),this.stack.push(t))}remove(t){let e,i=[];for(let s of this.stack)s===t?e=s:i.push(s);return this.stack=i,e}setViewportMode(t){this.viewportMode=t;for(let e of this.stack)this.setItemViewportMode(e,t)}pop(){return this.stack.pop()}}return{TiRuntimeStack:t}}(),e=new t,i=Symbol("toa-options"),s=Symbol("toa-app-instance");class n{constructor(t={}){this[i]=t}async open(){let{position:t="center",icon:n=!0,content:r="i18n:empty",vars:a={},type:o="info",spacing:l=0,duration:h=3e3,closer:c=!0}=this[i],u=Ti.Dom.createElement({$p:document.body,className:"the-stub"});!0===n&&(n=Ti.Icons.get(o));let d={template:'<div class="ti-toast"\n        :class="topClass"\n        :style="topStyle"\n        @click="onClose">\n        <transition :name="transName"\n          @after-leave="onAfterLeave">\n          <div v-if="!hidden"\n            class="toast-con"\n            @click.stop>\n            <div v-if="icon"\n              class="toast-icon">\n              <ti-icon :value="icon"/>\n            </div>\n            <div class="toast-body">{{content|i18n(vars)}}</div>\n            <div v-if="closer && \'center\'!=position"\n              class="toast-closer">\n              <a @click="onClose">{{\'close\'|i18n}}</a>\n            </div>\n          </div>\n        </transition>\n      </div>',data:{position:t,icon:n,content:r,type:o,closer:c,vars:a,hidden:!0},store:{modules:{viewport:"@mod:ti/viewport"}},computed:{topClass(){return Ti.Css.mergeClassName({"as-bar":"center"!=this.position,"as-block":"center"==this.position},[`at-${this.position}`,`is-${this.type}`])},topStyle(){if("center"!=this.position)return{padding:Ti.Css.toSize(l)}},transName(){return`toast-trans-at-${this.position}`}},methods:{onClose(){this.closer&&(this.hidden=!0)},onAfterLeave(){Ti.App(this).$toast.close()},doOpen(){this.hidden=!1},doClose(){this.hidden=!0}}},m=await Ti.App(d);return this[s]=m,await m.init(),m.mountTo(u),m.$toast=this,m.root("doOpen"),e.push(this),h>0&&_.delay(()=>{m.root("doClose")},h),this}$app(){return this[s]}close(){e.remove(this),this.$app().destroy(!0)}}return{Toast:{Open(t,e="info",i="top"){t instanceof Error&&(t=t.errMsg||t+""),_.isString(t)&&(t=_.isPlainObject(e)?_.assign({position:i,type:"info",content:t,vars:e},e):{type:e||"info",position:i||"top",content:t}),/^i18n:/.test(t.content)||(t.content=Ti.I18n.translate(t.content));let s=new n(t);return s.open(),s},Close(){let t=e.pop();t&&t.close()}}}}(),{Be:Be}=function(){const t={Draggable:function(){return function(t,e={}){let{trigger:i,viewport:s,watchZone:n,handler:r=null,speed:a=100,activedRadius:o=0,activedDelay:l=0,dragging:h=_.identity,prepare:c=_.identity,actived:u=_.identity,done:d=_.identity}=e,m={};_.isNumber(o)?(m.x=o,m.y=o):_.assign(m,{x:-1,y:-1},_.pick(o,"x","y"));const p=function(e,i,s){return _.isFunction(i)?i(e)||s:_.isString(i)?Ti.Dom.find(i,t)||s:s};let f={setClientXY:function(t,e){let i=this.getPointerEvent(e);t.clientX=i.clientX,t.clientY=i.clientY}};Ti.Dom.isTouchDevice()?_.assign(f,{POINTER_DOWN:"touchstart",POINTER_MOVE:"touchmove",POINTER_UP:"touchend",getPointerEvent:t=>t.touches[0]}):_.assign(f,{POINTER_DOWN:"mousedown",POINTER_MOVE:"mousemove",POINTER_UP:"mouseup",POINTER_CLICK:"click",getPointerEvent:t=>t}),t.addEventListener(f.POINTER_DOWN,function(e){function o(t){t.preventDefault(),t.stopPropagation()}function g(t){let e={x:C.clientX,y:C.clientY};C.watchZone.hasPoint(e)?(f.setClientXY(C,t),C.evalScale(),C.actived&&(C.__already_call_actived||(u(C),C.__already_call_actived=!0,f.POINTER_CLICK&&C.$src.addEventListener(f.POINTER_CLICK,o,{capture:!0,once:!0})),h(C))):y(t)}function y(t){v.removeEventListener(f.POINTER_MOVE,g,!0),v.removeEventListener(f.POINTER_UP,y,!0),C.clientX=t.clientX,C.clientY=t.clientY,C.actived&&(f.POINTER_CLICK&&C.$src.removeEventListener(f.POINTER_CLICK,o),d(C))}let T=Ti.Dom.eventCurrentTarget(e,i,t);if(!_.isElement(T))return;let v=t.ownerDocument,b=t.ownerDocument.body,w=p(T,s,t),x=p(T,n,t.ownerDocument),S=p(T,r,t),C={};_.assign(C,{$event:e,$doc:v,$body:b,$viewport:w,$handler:S,$trigger:T,$watchZone:x}),f.setClientXY(C,e),C.$src=e.srcElement,_.isElement(w)&&_.isElement(S)&&(C.__already_call_actived=!1,C.watchZone=Ti.Rects.createBy(x),C.viewport=Ti.Rects.createBy(w),C.handler=Ti.Rects.createBy(S),C.startInMs=Date.now(),C.initScale=function(){let{left:t,top:e}=this.viewport;this.nowInMs=Date.now(),this.duInMs=this.nowInMs-this.startInMs;let i=this.clientX-t,s=this.clientY-e;this.startX=i,this.startY=s,this.x=i,this.y=s,this.offsetX=0,this.offsetY=0,this.movetX=0,this.movetY=0,this.scaleX=0,this.scaleY=0},C.evalScale=function(){let{width:t,height:e,left:i,top:s}=this.viewport;this.nowInMs=Date.now(),this.duInMs=this.nowInMs-this.startInMs;let n=this.clientX-i,r=this.clientY-s;if(this.offsetX=n-this.startX,this.offsetY=r-this.startY,this.offsetDistance=Math.sqrt(Math.pow(this.offsetX,2)+Math.pow(this.offsetY,2)),this.moveX=n-this.x,this.moveY=r-this.y,this.moveDistance=Math.sqrt(Math.pow(this.moveX,2)+Math.pow(this.moveY,2)),this.directionX=this.moveX<0?"left":"right",this.directionY=this.moveY<0?"up":"down",this.speed=this.moveDistance*a/this.duInMs,this.x=this.clientX-i,this.y=this.clientY-s,this.scaleX=n/t,this.scaleY=r/e,!this.actived){let t=Math.abs(this.offsetX),e=Math.abs(this.offsetY);this.duInMs>l&&(m.x<0||t>m.x)&&(m.y<0||e>m.y)&&(this.actived=!0)}},C.evalLeftBySpeed=function(t=0){let{viewport:e,$trigger:i,offsetX:s,speed:n}=this;n>1&&(t+=n*s);let r=i.scrollWidth,a=e.width-r;return t=_.clamp(t,a,0)},C.evalTopBySpeed=function(t=0){let{viewport:e,$trigger:i,offsetY:s,speed:n}=this;n>1&&(t+=n*s);let r=i.scrollHeight,a=e.height-r;return t=_.clamp(t,a,0)},C.initScale(),C=c(C)||C,v.addEventListener(f.POINTER_MOVE,g,!0),v.addEventListener(f.POINTER_UP,y,!0))})}}(),Open:(t,{target:e="_blank",method:i="GET",params:s={},delay:n=100}={})=>new Promise(r=>{let a=Ti.Dom.createElement({$p:document.body,tagName:"form",attrs:{target:e,method:i,action:t},props:{style:"display:none;"}});_.forEach(s,(t,e)=>{Ti.Dom.createElement({$p:a,tagName:"input",props:{name:e,value:t,type:"hidden"}})}),_.delay(function(){a.submit(),r({url:t,target:e,method:i,params:s})},n)}),OpenLink:(e,{target:i="_blank",method:s="GET",delay:n=100}={})=>t.Open(e.url,{target:i,method:s,delay:n,params:e.params}),ScrollWindowTo({x:t=0,y:e=0}={}){window.scrollTo(t,e)},writeToClipboard(t){if(_.isString(t)||(t=Ti.Types.toStr(t)),navigator.clipboard)navigator.clipboard.writeText(t);else{let e=Ti.Dom.createElement({tagName:"textarea",style:{position:"fixed",top:"-100000px",left:"0px",width:"300px",height:"300px",opacity:-0,zIndex:1e4},props:{value:t},$p:document.body});e.focus(),e.select();try{document.execCommand("copy")||console.warn('fail to execCommand("copy") for text: ',t)}catch(t){console.warn("fail to copy text: ",t)}Ti.Dom.remove(e)}},BlinkIt:function(t,e){if(0!=(t=$(t)).length){"function"==typeof(e=e||{})?e={after:e}:"number"==typeof e&&(e={speed:e});var i=t.offset(),s=t[0].ownerDocument,n=$(s),r={width:t.outerWidth(),height:t.outerHeight(),"border-color":"#FF0",background:"#FFA",opacity:.8,position:"fixed",top:i.top-n.scrollTop(),left:i.left-n.scrollLeft(),"z-index":9999999},a=$(e.html||'<div class="z_blink_light">&nbsp;</div>');a.css(r).appendTo(s.body),a.animate({opacity:.1},e.speed||500,function(){$(this).remove(),"function"==typeof e.after&&e.after.apply(t)})}},EditIt(t,e={}){var i=$(t);if(0==i.length||i.hasClass("is-be-editing"))return;i.addClass("is-be-editing"),_.defaults(e,{text:null,width:0,height:0,extendWidth:!0,takePlace:!0,selectOnFocus:!0,copyStyle:["letter-spacing","margin","border","font-size","font-family","line-height","text-align"],ok:function(t,e){this.innerText=t},context:i[0]});const s={jEle:i,$el:i[0],options:e,oldValue:Ti.Util.fallback(e.text,i.text()),onCancel(){this.jMask.remove(),this.jDiv.remove(),this.jEle.css({visibility:""}).removeClass("is-be-editing")},onOk(){let t=_.trim(this.jInput.val());t!=this.oldValue&&e.ok.apply(e.context,[t,e.oldValue,e]),this.onCancel()}};let n=Ti.Rects.createBy(s.$el),r=e.width||n.width,a=e.height||n.height;const o=$('<div class="ti-be-editing as-con"><input></div>'),l=o.find("input"),h=$('<div class="ti-be-editing as-mask"></div>');if(_.assign(s,{jDiv:o,jInput:l,jMask:h,$div:o[0],$input:l[0],$mask:h[0],primaryWidth:r,primaryHeight:a}),h.css({position:"fixed",zIndex:999999,top:0,left:0,right:0,bottom:0}),o.css({position:"fixed",zIndex:1e6,top:n.top,left:n.left,width:r,height:a}),l.css({width:"100%",height:"100%",outline:"none",resize:"none",overflow:"hidden",padding:"0 .06rem",background:"rgba(255,255,50,0.8)",color:"#000",lineHeight:a}).attr({spellcheck:!1}).val(s.oldValue),!_.isEmpty(e.copyStyle)){const t=window.getComputedStyle(s.$el);let i=_.pick(t,e.copyStyle);l.css(i)}return s.jMask.appendTo(document.body),s.jDiv.appendTo(document.body),s.jEle.css({visibility:"hidden"}),e.selectOnFocus?s.$input.select():s.$input.focus(),l.one("blur",()=>{s.onOk()}),l.on("keydown",t=>{let e=t.which;27==e?s.onCancel():13==e&&s.onOk()}),s}};return{Be:t}}(),{Alg:Alg}={Alg:{sha1:t=>(_.isString(t)||(t=JSON.stringify(t)),CryptoJS.SHA1(t).toString()),gcd(t,e){return t=Math.round(t),(e=Math.round(e))?this.gcd(e,t%e):t},gcds(){var t=Array.from(arguments),e=_.flatten(t);if(0==e.length)return NaN;if(1==e.length)return e[0];for(var i=this.gcd(e[0],e[1]),s=2;s<e.length;s++)i=this.gcd(i,e[s]);return i},lcm(t,e){return t=Math.round(t),e=Math.round(e),t*e/this.gcd(t,e)},lcms(){var t=Array.from(arguments),e=_.flatten(t);if(0==e.length)return NaN;if(1==e.length)return e[0];for(var i=this.lcm(e[0],e[1]),s=2;s<e.length;s++)i=this.lcm(i,e[s]);return i}}},{S:S}=function(){const CN_NC0="零一二三四五六七八九",CN_NU0="个十百千万亿",TiStr={intToChineseNumber(t){let e="";if(t<0&&(e+="负",t*=-1),0==t)return e+=CN_NC0[0];if(t<10){return e+=CN_NC0[t]}let i=[],s=0,n=t;for(;n>0;){let t=parseInt(n/10);i[s++]=n-10*t,n=t}let r=s-1;console.log(i);let a,o,l;if(s>8){a=-1;for(let t=o=Math.min(r,11);t>=8;t--){if(0==(n=i[t])&&a<=0)continue;if(e+=CN_NC0[n],t>8&&(n>0||a>0)){e+=CN_NU0[t-8]}a=n}e[l=e.length-1]==CN_NC0[0]?e[l]=CN_NU0[5]:e+=CN_NU0[5]}if(s>4){a=-1;for(let t=o=Math.min(r,7);t>=4;t--){if(0==(n=i[t])&&a<=0)continue;if(e+=CN_NC0[n],t>4&&(n>0||a>0)){e+=CN_NU0[t-4]}a=n}a>=0&&(e[l=e.length-1]==CN_NC0[0]?e[l]=CN_NU0[4]:e+=CN_NU0[4])}a=-1;for(let t=o=Math.min(r,3);t>=0;t--){if(0==(n=i[t])&&0==a)continue;let s=CN_NC0[n];if((1!=t||1!=n||o>1)&&(e+=s),t>0&&n>0){e+=CN_NU0[t]}a=n}return l=e.length-1,e[l]==CN_NC0[0]?e.substring(0,l):e},sBlank:(t,e)=>TiStr.isBlank(t)?e:t,isBlank:t=>!_.isNumber(t)&&!_.isBoolean(t)&&(_.isString(t)?!t||/^\s*$/.test(t):!t),splitIgnoreBlank(t,e=","){if(!t||!_.isString(t))return[];let i=t.split(e),s=_.filter(i,t=>!TiStr.isBlank(t));return _.map(s,t=>_.trim(t))},renderVars:(t={},e="",{iteratee:i,regex:s,safe:n}={})=>((_.isString(t)||_.isNumber(t))&&(t={val:t}),!t||_.isEmpty(t)?_.isArray(t)?[]:"":TiStr.renderBy(e,t,{iteratee:i,regex:s,safe:n})),renderBy(t="",e={},{iteratee:i,regex:s=/(\${1,2})\{([^}]+)\}/g,safe:n=!1}={}){if(!t)return _.isArray(e)?[]:"";if(e=e||{},n){let t=_.isRegExp(n)?n:void 0;e=TiStr.safeDeep(e,t)}if(_.isRegExp(i)&&(s=i,i=void 0),i||(i=(({varName:t,vars:e,matched:i}={})=>{if(i.startsWith("$$"))return i.substring(1);let s=i,n=t.indexOf("?");n>0&&(s=_.trim(t.substring(n+1)),t=_.trim(t.substring(0,n)));let r=!1;t.startsWith("i18n:")&&(r=!0,t=t.substring(5).trim());let a=Ti.Util.fallback(Ti.Util.getOrPick(e,t),s);return r?Ti.I18n.get(a):a})),_.isArray(e)){let i=[];for(let s=0;s<e.length;s++){let n=e[s],r=TiStr.renderBy(t,n);i.push(r)}return i}let r,a=[],o=0;for(;r=s.exec(t);){let n=r.index;n>o&&a.push(t.substring(o,n));let l=i({vars:e,matched:r[0],prefix:r[1],varName:r[2]});a.push(l),o=s.lastIndex}return o<t.length&&a.push(t.substring(o)),a.join("")},safeDeep(t={},e=/['"]/g){return _.isString(t)?t.replace(e,""):_.isArray(t)?_.map(t,t=>this.safeDeep(t,e)):_.isPlainObject(t)?_.mapValues(t,t=>this.safeDeep(t,e)):t},joinWithoutNil(t="",...e){let i=_.flattenDeep(e);return _.filter(i,t=>!Ti.Util.isNil(t)).join(t)},join(t=[],e="",i=null){let s=_.flattenDeep(t);return _.isFunction(i)&&(s=_.map(s,i)),s.join(e)},joinAs(t=[],e="",i=null){let s=null;return i&&(s=(t=>_.isPlainObject(t)?_.get(t,i):i)),TiStr.join(t,e,s)},toJsValue(t="",{autoJson:e=!0,autoDate:i=!0,autoNil:s=!1,trimed:n=!0,context:r={}}={}){if(_.isArray(t)){let a=[],o={autoJson:e,autoDate:i,autoNil:s,trimed:n,context:r};for(let e of t){let t=TiStr.toJsValue(e,o);a.push(t)}return a}if(_.isPlainObject(t)){let a={},o={autoJson:e,autoDate:i,autoNil:s,trimed:n,context:r};return _.forEach(t,(t,e)=>{let i=TiStr.toJsValue(t,o);a[e]=i}),a}if(Ti.Util.isNil(t)||_.isBoolean(t)||_.isNumber(t))return t;let a=n?_.trim(t):t,o=!1;if(a.endsWith("?")&&(o=!0,a=a.substring(0,a.length-1).trim()),s){if("undefined"==a)return;if("null"==a)return null}if(/^-?[\d.]+$/.test(a))return 1*a;let l=_.get(r,a);if(!_.isUndefined(l)||o)return l;if(/^(true|false|yes|no|on|off)$/.test(a))return/^(true|yes|on)$/.test(a);let h=/^'([^']*)'$/.exec(a);if(h)return h[1];if(e){let e=Ti.Types.safeParseJson(t);if(!_.isUndefined(e))return e}if(i)try{return Ti.Types.toDate(t)}catch(t){}return a},joinArgs(s,args=[],iteratee=TiStr.toJsValue){if(_.isString(s)){if(/^\{.*\}$/.test(s))try{return[eval(`(${s})`)]}catch(t){}let list=s.split(",");for(let t of list){let e=_.trim(t);if(!e)continue;let i=iteratee(e);args.push(i)}return args}if(_.isArray(s))for(let t of s){let e=iteratee(t);args.push(e)}else _.isUndefined(s)||args.push(s);return args},toArray(t,{sep:e=/[:,;\t\n\/]+/g,ignoreNil:i=!0}={}){if(Ti.Util.isNil(t))return[];if(_.isArray(t))return t;if(_.isString(t)&&e){let s=_.map(t.split(e),t=>_.trim(t));return i?_.without(s,""):s}return[t]},toArrayBy:(t,e=",")=>TiStr.toArray(t,{sep:e,ignoreNil:!0}),toObject(t,{sep:e=/[:,;\t\n\/]+/g,ignoreNil:i=!0,keys:s=["value","text?value","icon"]}={}){if(_.isPlainObject(t)||_.isNull(t)||_.isUndefined(t))return t;let n=TiStr.toArray(t,{sep:e,ignoreNil:i});_.isString(s)&&(s=TiStr.toArray(s,{sep:/[:,;\s]+/g}));let r=[],a=[];_.forEach(s,t=>{let e=TiStr.toArray(t,{sep:"?"});if(e.length>1){let t=e[0];r.push(t),a.push({name:t,backup:e[1]})}else r.push(t)});let o={};_.forEach(r,(t,e)=>{let s=_.nth(n,e);_.isUndefined(s)&&i||(o[t]=s)});for(let t of a)_.isUndefined(o[t.name])&&(o[t.name]=o[t.backup]);return o},toObjList(t,{sepLine:e=/[,;\n]+/g,sepPair:i=/[:|\/\t]+/g,ignoreNil:s=!0,keys:n=["value","text?value","icon"]}={}){let r=TiStr.toArray(t,{sep:e,ignoreNil:s});return _.map(r,t=>TiStr.toObject(t,{sep:i,ignoreNil:s,keys:n}))},autoPrefixSearchStr(t){let e=_.toLower(_.trim(t));if(e)return e.startsWith("^")?e:"^.*"+e},sizeText(t=0,{fixed:e=2,M:i=1024,bytes:s=!1,units:n=["Bytes","KB","MB","GB","PB","TB"]}={}){let r=t,a=0;for(;a<n.length;a++){let t=r/i;if(t<1)break;r=t}let o,l=n[a];return o=r==parseInt(r)?r+l:r.toFixed(e)+l,s&&a>0?o+` (${t} bytes)`:o},toPercent(t,{fixed:e=2,auto:i=!0}={}){if(!_.isNumber(t))return"NaN";let s=100*t,n=e>=0?s.toFixed(e):s+"";if(i){let t=n.lastIndexOf("."),e=n.lastIndexOf("0");if(t>=0&&e>t){let i=n.length-1;for(;i>=t&&"0"==n[i];i--);i==e||i==t||i++,i<n.length&&(n=n.substring(0,i))}}return n+"%"},toCase(t,e){if(Ti.Util.isNil(t)||!e)return t;let i=TiStr.getCaseFunc(e);return _.isFunction(i)?i(t):t},getCaseFunc:t=>({upper:t=>t?t.toUpperCase():t,lower:t=>t?t.toLowerCase():t,camel:t=>_.camelCase(t),snake:t=>_.snakeCase(t),kebab:t=>_.kebabCase(t),start:t=>_.startCase(t)})[t],isValidCase:t=>_.isFunction(TiStr.getCaseFunc(t)),isPhoneNumber:(t="")=>/^(\+\d{2})? *(\d{11})$/.test(t)};return{S:TiStr}}(),{App:App}=function(){const{LoadTiAppInfo:t,LoadTiLinkedObj:e}=function(){function t(t){return/^@https?:\/\//.test(t)?t.substring(1):/^@!(js|css|html|mjs|text|json):\/\//.test(t)?t.substring(1):/^@\/{1,2}/.test(t)?t.substring(1):/^(@[A-Za-z0-9_-]+:?|\.\/)/.test(t)?t:/^(!(m?js|json|css|text):)/.test(t)?t:void 0}function e(i,{LT:s,dynamicPrefix:n,dynamicAlias:r}={}){if(_.isString(i)){if(!/^\.{3}/.test(i)){let a=t(i);if(a){let t=Ti.Config.cookUrl(a,{dynamicPrefix:n,dynamicAlias:r});if(!t)return;let{url:i,type:o}=t;s.isAlreadyInLoading(i)||(s.addItem(i),Ti.Load(i,{dynamicPrefix:n,dynamicAlias:r,cooked:!0,type:o}).then(t=>{let r=Ti.Util.getParentPath(i);e(t,{LT:s,dynamicPrefix:n,dynamicAlias:new Ti.Config.AliasMapping({"^./":r})}),s.loadedItem(i,t),s.tryFinished()}))}}}else if(_.isArray(i))for(let t=0;t<i.length;t++){e(i[t],{LT:s,dynamicPrefix:n,dynamicAlias:r})}else if(_.isPlainObject(i))for(let t in i){e(i[t],{LT:s,dynamicPrefix:n,dynamicAlias:r})}}function i(e,s,n={},{dynamicPrefix:r,dynamicAlias:a}){if(_.isString(e)){if(!/^\.{3}/.test(e)){let o=t(e);if(o){let t=Ti.Config.cookUrl(o,{dynamicPrefix:r,dynamicAlias:a});if(!t)return e;let{url:l,type:h}=t;if(n[l])return;let c=s[l].result,u=Ti.Util.getParentPath(l);return i(c,s,n=_.assign({},n,{[l]:!0}),{dynamicPrefix:r,dynamicAlias:new Ti.Config.AliasMapping({"^./":u})})}}}else{if(_.isArray(e)){let t=[];for(let o=0;o<e.length;o++){let l=i(e[o],s,n,{dynamicPrefix:r,dynamicAlias:a});_.isUndefined(l)||t.push(l)}return t}if(_.isPlainObject(e)){let t={};for(let o in e){let l=i(e[o],s,n,{dynamicPrefix:r,dynamicAlias:a});t[o]=l}return t}}return e}function s(t,{dynamicPrefix:s,dynamicAlias:r}={}){return new Promise((a,o)=>{let l=new n(e=>{let n=i(t,e,{},{dynamicPrefix:s,dynamicAlias:r});a(n)});e(t,{dynamicPrefix:s,dynamicAlias:r,LT:l})})}class n{constructor(t){this.itMap={},this.afterLoaded=t}isAlreadyInLoading(t){return!!this.itMap[t]}addItem(t){this.itMap[t]={done:!1,result:void 0}}loadedItem(t,e){let i=this.itMap[t];i.result=e,i.done=!0}tryFinished(){for(let t in this.itMap){if(!this.itMap[t].done)return}this.afterLoaded(this.itMap)}}return{LoadTiLinkedObj:s,LoadTiAppInfo:async function(t={},e=document){let i=await s(t,{"^./":"@MyApp:"});return Ti.IsInfo("TiApp")&&console.log("await LoadTiLinkedObj(conf)",i),i}}}(),{TiAppActionShortcuts:i}=function(){class t{constructor(){this.guards={},this.actions={}}addGuard(t,e,i){e&&_.isFunction(i)&&Ti.Util.pushValue(this.guards,e,{scope:t,func:i})}removeGuard(t,...e){this.guards=this.__remove_by(this.guards,t,e)}isWatched(t,e){let i=this.actions[e];if(_.isArray(i))for(let e of i)if(e.scope===t)return!0;return!1}watch(t,e=[],{$com:i,argContext:s={}}={}){let n=_.without(_.concat(e),null);_.forEach(n,e=>{if(_.isArray(e.items)&&e.items.length>0)this.watch(t,e.items,{$com:i,argContext:s});else if(e.action&&e.shortcut){if(this.isWatched(t,e.shortcut))return;let n=Ti.Shortcut.genActionInvoking(e.action,{$com:i,argContext:s,wait:e.wait});Ti.Util.pushValueBefore(this.actions,e.shortcut,{scope:t,func:n,prevent:Ti.Util.fallback(e.prevent,!0),stop:Ti.Util.fallback(e.stop,!0)})}})}unwatch(t,...e){this.actions=this.__remove_by(this.actions,t,e)}__remove_by(t,e,...i){let s=_.flattenDeep(i);if(!e&&_.isEmpty(s))return{};_.isEmpty(s)&&(s=_.keys(t));let n=Ti.Util.isNil(e),r={};return _.forEach(s,i=>{let s=[];_.forEach(t[i],t=>{n||t.scope===e||s.push(t)}),_.isEmpty(s)||(r[i]=s)}),r}fire(t,e,i={stop:!1,prevent:!1,quit:!1}){if(i.quit)return i;let s=Ti.Util.isNil(t),n=this.guards[e];if(_.isArray(n))for(let e of n)if((s||e.scope===t)&&!e.func())return i.quit=!0,i;let r=this.actions[e];if(!_.isArray(r))return i;for(let e of r)if((s||e.scope===t)&&(i.quit|=e.func(),i.stop|=e.stop,i.prevent|=e.prevent,i.quit))return i;return i}}return{TiAppActionShortcuts:t}}(),{TiVue:s}=function(){function t(t,e){let i=!1,s={};return _.forOwn(e,(e,n,r)=>{let a=/^\.{3}(.*)$/.exec(n);if(a){i=!0;let n=a[1];t&&_.assign(s,function(t,e){const i={};return _.forOwn(e,(e,s)=>{let n="map"+_.capitalize(s);t?_.assign(i,Vuex[n](t,e)):_.assign(i,Vuex[n](e))}),i}(n,e))}}),i?s:e}const e={StoreConfig(t={},i=null){let s=Ti.Util.merge({modules:{}},t.mixins);return!t.state&&s.state||(s.state=Ti.Util.genObj(t.state)),s.getters=_.assign(s.getters,Ti.Util.merge({},t.getters)),s.mutations=_.assign(s.mutations,Ti.Util.merge({},t.mutations)),s.actions=_.assign(s.actions,Ti.Util.merge({},t.actions)),Ti.I18n.put(t.i18n),i&&(s.namespaced=!0),_.forEach(t.modules,(t,i)=>{let n;n=i.startsWith(".")?e.StoreConfig(t):e.StoreConfig(t,i),s.modules[i]=n}),s.plugins=[].concat(t.plugins||[]),s},CreateStore:t=>new Vuex.Store({strict:Ti.IsForDev(),...t}),Options({global:i={},conf:s={},store:n}={}){_.isPlainObject(s.i18n)&&Ti.I18n.put(s.i18n);const r=_.pick(s,["data","props","watch"]),a=_.pick(s,["template","render","renderError"]),o=_.pick(s,["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","activated","deactivated","beforeDestroy","destroyed","errorCaptured"]),l=_.pick(s,["directives","filters","components"]);_.forOwn(l,function(t,s,n){const r=_.flattenDeep([t]),a=[];for(let t of r)t.globally?("components"==s&&(t=e.Options({conf:t,global:i})),Ti.Util.pushValue(i,s,t)):a.push(t);n[s]=a});const h=_.pick(s,["mixins","extends"]),c=_.pick(s,["name","delimiters","functional","model","inheritAttrs","comments","inject","provide"]);let u={..._.mapValues(r,t=>Ti.Util.merge({},t)),...a,..._.mapValues(o,Ti.Util.groupCall),directives:Ti.Util.merge({},l.directives),filters:Ti.Util.merge({},l.filters),components:function(){let t={};return _.map(l.components,s=>{let n=_.camelCase(s.name);t[n]=e.Options({conf:s,global:i})}),t}(),...h,...c};_.isFunction(u.data)||(u.data=Ti.Util.genObj(u.data||{}));const d=_.partial(t,n);return _.isArray(s.computed)?u.computed=Ti.Util.mergeWith(d,{},...s.computed):_.isObject(s.computed)&&(u.computed=s.computed),_.isArray(s.methods)?u.methods=Ti.Util.mergeWith(d,{},...s.methods):_.isObject(s.methods)&&(u.methods=s.methods),n&&(u.store=n),u},Setup(t={},i){const s={};return{global:s,options:e.Options({global:s,conf:t,store:i})}},CreateInstance(t,e){const i=Ti.Util.merge({},t.global.filters),s=Ti.Util.merge({},t.global.directives);_.forOwn(i,(t,e)=>{Vue.filter(e,t)}),_.forOwn(s,(t,e)=>{Vue.directive(e,t)});const n=(t,i)=>{if(_.forEach(t.components,n),delete t.components,Ti.I18n.put(t.i18n),_.isFunction(e)&&e(t),!t.name)throw console.warn(`com[${i}] without name`,t),"!!!";this.registerComponent(t.name,t)};return _.forEach(t.global.components,n),_.isFunction(e)&&e(t.options),new Vue(t.options)},registerComponent(t,e){let i=_.upperFirst(_.camelCase(t));Vue.component(i,e)}};return{TiVue:e}}(),{TiAppModal:n}=function(){class t{constructor(){this.className=void 0,this.icon=void 0,this.title=void 0,this.type="info",this.iconOk=void 0,this.textOk="i18n:ok",this.ok=(({result:t})=>t),this.iconCancel=void 0,this.textCancel="i18n:cancel",this.cancel=(()=>void 0),this.actions=null,this.transDelay=350,this.comType="ti-label",this.comConf={},this.components=[],this.closer="default",this.escape=!0,this.mask=!0,this.clickMaskToClose=!1,this.changeToClose=!1,this.position="center",this.width="6.4rem",this.height=void 0,this.maxWidth=void 0,this.maxHeight=void 0,this.minWidth=void 0,this.minHeight=void 0,this.spacing=void 0,this.overflow=void 0,this.adjustable=!1,this.result=void 0,this.model={prop:"value",event:"change"},this.modules={},this.events={},this.topActions=[],this.ready=async function(t){},this.preload=async function(t){},this.beforeClosed=async function(t){}}async open(t=_.identity){let e=[];this.actions?e=this.actions:(_.isFunction(this.ok)&&this.textOk&&e.push({icon:this.iconOk,text:this.textOk,handler:this.ok}),_.isFunction(this.cancel)&&this.textCancel&&e.push({icon:this.iconCancel,text:this.textCancel,handler:this.cancel}));let i="";this.model&&(this.model.event&&(i+=` @${this.model.event}="OnChange"`),this.model.prop&&(i+=` :${this.model.prop}="result"`));let s=_.cloneDeep(this.events),n=[];_.forEach(s,(t,e)=>{n.push(`@${e}="OnEvent('${e}', $event)"`)});let r={name:"app.modal",template:`<transition :name="TransName" @after-leave="OnAfterLeave">\n          <div class="ti-app-modal ${this.className||""}"\n            v-if="!hidden"\n              :class="TopClass"\n              :style="TopStyle"\n              @click.left="OnClickTop"\n              v-ti-activable>\n    \n              <div class="modal-con" \n                :class="ConClass"\n                :style="ConStyle"\n                @click.left.stop>\n    \n                <div class="modal-head"\n                  v-if="isShowHead">\n                    <div class="as-icon" v-if="icon"><ti-icon :value="icon"/></div>\n                    <div class="as-title">{{title|i18n}}</div>\n                    <div\n                      v-if="hasTopActionBar"\n                        class="as-bar">\n                          <ti-actionbar\n                            :items="topActions"\n                            align="right"\n                            :status="TopActionBarStatus"/>\n                    </div>\n                </div>\n    \n                <div class="modal-main">\n                  <component\n                    v-if="comType"\n                      class="ti-fill-parent"\n                      :class="MainClass"\n                      :is="comType"\n                      v-bind="TheComConf"\n                      :on-init="OnMainInit"\n                      ${i}\n                      ${n.join(" ")}\n                      @close="OnClose"\n                      @ok="OnOk"\n                      @actions:update="OnActionsUpdated"/>\n                </div>\n    \n                <div class="modal-actions"\n                  v-if="hasActions">\n                    <div class="as-action"\n                      v-for="a of actions"\n                        @click.left="OnClickActon(a)">\n                        <div class="as-icon" v-if="a.icon">\n                          <ti-icon :value="a.icon"/></div>\n                        <div class="as-text">{{a.text|i18n}}</div>\n                    </div>\n                </div>\n    \n                <div class="modal-closer"\n                  v-if="hasCloser"\n                    :class="CloserClass">\n                      <ti-icon value="zmdi-close" @click.native="OnClose"/>\n                </div>\n            </div>\n        </div></transition>`,components:this.components,data:{hidden:!0,icon:this.icon,title:this.title,type:this.type,ready:this.ready,beforeClosed:this.beforeClosed,actions:e,topActions:this.topActions,comType:null,comConf:this.comConf,closer:this.closer,escape:this.escape,mask:this.mask,position:this.position,clickMaskToClose:this.clickMaskToClose,changeToClose:this.changeToClose,width:this.width,height:this.height,maxWidth:this.maxWidth,maxHeight:this.maxHeight,minWidth:this.minWidth,minHeight:this.minHeight,spacing:this.spacing,overflow:this.overflow,adjustable:this.adjustable,result:_.cloneDeep(this.result)},store:{modules:_.defaults({viewport:"@mod:ti/viewport"},this.modules)},computed:{TopClass(){let t=Ti.Util.isNil(this.height);return this.getTopClass({"show-mask":this.isShowMask,"no-mask":!this.isShowMask,"has-height":!t,"nil-height":t},`at-${this.position}`)},TopStyle(){if("center"!=this.position)return{padding:Ti.Css.toSize(this.spacing)}},TransName(){return`app-modal-trans-at-${this.position}`},isShowHead(){return this.icon||this.title||this.hasTopActionBar},hasTopActionBar(){return!_.isEmpty(this.topActions)},isShowMask(){return!!this.mask},hasActions(){return!_.isEmpty(this.actions)},hasCloser(){return!!this.closer},isCloserDefault(){return!0===this.closer||"default"==this.closer},ConClass(){return Ti.Css.mergeClassName({"is-show-header":this.isShowHead,"is-hide-header":!this.isShowHead,"is-show-actions":this.hasActions,"is-hide-actions":!this.hasActions,"is-closer-default":this.isCloserDefault,"has-top-action-bar":this.hasTopActionBar},`is-${this.type}`)},ConStyle(){return Ti.Css.toStyle({width:this.width,height:this.height,maxWidth:this.maxWidth,maxHeight:this.maxHeight,minWidth:this.minWidth,minHeight:this.minHeight})},MainClass(){return Ti.Css.mergeClassName(`modal-type-is-${this.type}`)},Main(){return this.$store.state.main},State(){return this.$store.state},TopActionBarStatus(){return _.get(this.Main,"status")},CloserClass(){return Ti.Css.mergeClassName({"as-lamp-cord":!this.isCloserDefault,"as-default":this.isCloserDefault,[`at-${this.closer}`]:!this.isCloserDefault})},TheComConf(){return Ti.Util.explainObj(this,this.comConf)}},methods:{OnClickTop(){this.clickMaskToClose&&(this.hidden=!0)},OnClose(){this.close()},OnOk(t){_.isUndefined(t)&&(t=this.result),this.close(t)},OnChange(t){this.result=t,this.changeToClose&&this.close(this.result)},OnActionsUpdated(t=[]){this.topActions=t,Ti.App(this).reWatchShortcut(t)},OnEvent(t,e){console.log(t,e);_.get(s,t)(e)},async OnClickActon(t){if(t.handler){let e=Ti.App(this),i={close:!0},s=e.$vm(),n=await t.handler({$app:e,$body:s,$main:s.$main,result:_.cloneDeep(s.result),status:i});i.close?this.close(n):this.setResult(n)}},OnAfterLeave(){Ti.App(this).destroy(!0),t(this.returnValue)},OnMainInit(t){let e=Ti.App(this);this.$main=t,e.$vmMain(t),this.escape&&e.watchShortcut([{action:"root:close",shortcut:"ESCAPE"}]),this.setActived(),this.ready(e)},close(t){_.isUndefined(t)||(this.returnValue=t),this.hidden=!0},setResult(t){this.returnValue=t}},mounted:function(){let t=Ti.App(this);Ti.App.pushInstance(t),this.$nextTick(()=>{this.hidden=!1})},beforeDestroy:async function(){let t=Ti.App(this);_.isFunction(this.beforeClosed)&&await this.beforeClosed(t),Ti.App.pullInstance(t)}},a=Ti.App(r);await a.init();let o=Ti.Dom.createElement({$p:document.body,className:"the-stub"});await this.preload(a),a.mountTo(o),_.delay(()=>{a.$vm().comType=this.comType},this.transDelay||0)}}return{TiAppModal:t}}(),r=Symbol("ti-app"),a=Symbol("ti-info"),o=Symbol("ti-conf"),l=Symbol("ti-store"),h=Symbol("ti-vm"),c=Symbol("ti-vm-main"),u=Symbol("ti-vm-actived");class d{constructor(t={},e){this.appDecorator=e,this.$info(t),this.$conf(null),this.$store(null),this.$vm(null),this.$shortcuts=new i}name(){return this.$info().name}$info(t){return Ti.Util.geset(this,a,t)}$conf(t){return Ti.Util.geset(this,o,t)}$store(t){return Ti.Util.geset(this,l,t)}$vm(t){return Ti.Util.geset(this,h,t)}$vmMain(t){return Ti.Util.geset(this,c,t)}$state(){return this.$store().state}async init(){let e=this.$info(),i=await t(e);if(await this.appDecorator(i),this.$conf(i),Ti.IsInfo("TiApp")&&console.log("Ti.$conf",this.$conf()),i.i18n){let t=_.concat(i.i18n);for(let e of t)Ti.I18n.put(e)}i.importMethods&&_.assign(window,i.importMethods);let n;if(i.store){let t=s.StoreConfig(i.store);Ti.IsInfo("TiApp")&&console.log("TiVue.StoreConfig:",t),n=s.CreateStore(t),this.$store(n),n[r]=this,Ti.IsInfo("TiApp")&&console.log("Ti.$store",this.$store())}let a=s.Setup(i,n);Ti.IsInfo("TiApp")&&(console.log("TiVue.VueSetup(conf)"),console.log(" -- global:",a.global),console.log(" -- options:",a.options));let o=s.CreateInstance(a,t=>{Ti.Config.decorate(t)});return o[r]=this,this.$vm(o),this}mountTo(t){this.$el=Ti.Dom.find(t),this.$vm().$mount(this.$el),this.$el=this.$vm().$el,this.$el[r]=this}destroy(t=!1){this.$vm().$destroy(),this.$el[r]=null,t&&Ti.Dom.remove(this.$el)}setActivedVm(t=null){this[u]=t;let e=t.tiActivableComIdPath();this.$store().commit("viewport/setActivedIds",e)}setBlurredVm(t=null){if(this[u]==t){let e=t.tiParentActivableCom();this[u]=e;let i=e?e.tiActivableComIdPath():[];this.$store().commit("viewport/setActivedIds",i)}}getActivedVm(){return this[u]}reWatchShortcut(t=[]){this.unwatchShortcut(),this.watchShortcut(t)}watchShortcut(t=[]){this.$shortcuts.watch(this,t,{$com:()=>this.$vmMain(),argContext:this.$state()})}unwatchShortcut(...t){this.$shortcuts.unwatch(this,...t)}guardShortcut(t,e,i){this.$shortcuts.addGuard(t,e,i)}pulloutShortcut(t,e,i){this.$shortcuts.removeGuard(t,e,i)}fireShortcut(t,e){let i={stop:!1,prevent:!1,quit:!1},s=this.getActivedVm();if(s){let e=s.tiActivableComPath(!1);for(let s of e)if(_.isFunction(s.__ti_shortcut)){let e=s.__ti_shortcut(t)||{};if(i.stop|=e.stop,i.prevent|=e.prevent,i.quit|=e.quit,i.quit)break}}return this.$shortcuts.fire(this,t,i),i.prevent&&e&&_.isFunction(e.preventDefault)&&e.preventDefault(),i.stop&&e&&_.isFunction(e.stopPropagation)&&e.stopPropagation(),i}async exec(t,e){let i=t;if(_.isString(i)){let t=/^(commit|dispatch|root|main):(.+)$/.exec(i);if(!t)return;i={method:t[1],name:t[2]}}return await this[i.method](i.name,e)}commit(t,e){this.$store().commit(t,e)}async dispatch(t,e){Ti.IsInfo("TiApp")&&console.log("TiApp.dispatch",t,e);try{return await this.$store().dispatch(t,e)}catch(t){console.error(t),await Ti.Toast.Open(t,"error")}}root(t,e){Ti.IsInfo("TiApp")&&console.log("TiApp.self",t,e);let i=this.$vm()[t];if(_.isFunction(i))return i(e);if(_.isUndefined(i))throw Ti.Err.make("e-ti-app-self",{nm:t,payload:e});return i}main(t,e){Ti.IsInfo("TiApp")&&console.log("TiApp.main",t,e);let i=this.$vmMain()[t];if(_.isFunction(i))return i(e);if(_.isUndefined(i))throw Ti.Err.make("e-ti-app-main",{nm:t,payload:e});return i}global(t,...e){let i=_.get(window,t);if(_.isFunction(i))return i.apply(this,e);throw Ti.Err.make("e-ti-app-main",{nm:t,args:e})}get(t){return t?this.$vm()[t]:this.$vm()}async loadView(t,{setupMod:i=_.identity}={}){let n,r;if(t.modType){let r=await Ti.Load(t.modType),a=await e(r,{dynamicAlias:new Ti.Config.AliasMapping({"^./":t.modType+"/"})});a.state||(a.state={}),a=await i(a)||a,n=s.StoreConfig(a,!0)}let a={};t.comType&&(a=await Ti.Load(t.comType)),Ti.Util.pushValue(a,"components",t.components);let o=await e(a,{dynamicAlias:new Ti.Config.AliasMapping({"^./":t.comType+"/"})}),l=s.Setup(o);return t.comType&&(r=l.options.name||Ti.Util.getLinkName(t.comType),Ti.IsInfo("TiApp")&&(console.log("TiApp.loadView:",r),console.log(" -- global:",l.global),console.log(" -- options:",l.options)),Ti.Config.decorate(l.options),s.registerComponent(r,l.options)),_.map(l.global.components,t=>{Ti.Config.decorate(t),s.registerComponent(t.name,t)}),{...t,comName:r,mod:n}}}const m=function(t,e=_.identity){if(Ti.Util.isNil(t))return null;if(_.isString(t))return Ti.Load(t).then(t=>new d(t,e));if(_.isElement(t)){let e=t,i=e[r];for(;!i&&e.parentElement;)i=(e=e.parentElement)[r];return i}return t instanceof Vue?t.$root[r]:t instanceof Vuex.Store?t[r]:_.isPlainObject(t)?new d(t,e):void 0},p=[];return m.pushInstance=function(t){t&&p.push(t)},m.pullInstance=function(t){t&&_.pull(p,t)},m.topInstance=function(){return _.last(p)},m.hasTopInstance=function(){return p.length>0},m.eachInstance=function(t=_.identity){_.forEach(p,t)},m.allInstance=function(t=_.identity){return p},m.Open=function(t){return new Promise(e=>{let i=new n;_.assign(i,t),i.open(e)})},{App:m}}(),{Err:Err}={Err:{make(t="",e){let i=t;_.isString(t)&&(i={code:t,data:e});let s=i.code.replace(/[.]/g,"-"),n=Ti.I18n.get(s);e&&(_.isPlainObject(e)?n+=" : "+JSON.stringify(e):n+=" : "+e);let r=new Error(n.trim());return _.assign(r,i,{errMsg:n})}}},{Config:Config}=function(){const t={prefix:{},alias:{},suffix:{}};class e{constructor(t){this.list=[],this.reset(t)}reset(t={}){return this.list=[],_.forOwn(t,(t,e)=>{this.list.push({regex:new RegExp(e),newstr:t})}),this}get(t="",e){let i=t;for(let t of this.list)t.regex.test(i)&&(i=i.replace(t.regex,t.newstr));return i||(_.isUndefined(e)?t:e)}}const i=(new e).reset();class s{constructor(t){this.list=[],this.reset(t)}reset(t={}){return _.forOwn(t,(t,e)=>{this.list.push({regex:new RegExp(e),suffix:t})}),this}get(t="",e){let i=t;for(let t of this.list)if(t.regex.test(i)&&!i.endsWith(t.suffix)){i+=t.suffix;break}return i||(_.isUndefined(e)?t:e)}}const n=(new s).reset(),r={AliasMapping:e,version:()=>t.version,set({prefix:e,alias:s,suffix:r,lang:a}={}){e&&(t.prefix=e),s&&(t.alias=s,i.reset(t.alias)),r&&(t.suffix=r,n.reset(t.suffix)),a&&(t.lang=a)},update({prefix:e,alias:s,suffix:r,lang:a}={}){e&&_.assign(t.prefix,e),s&&(_.assign(t.alias,s),i.reset(t.alias)),r&&(_.assign(t.suffix,r),n.reset(t.suffix)),a&&(t.lang=a)},get:(e=null)=>e?_.get(t,e):t,decorate(t){let e=t.name||"Unkown";Ti.Util.pushValue(t,"mixins",{computed:{tiComType:()=>e}})},lang:()=>r.get("lang")||"zh-cn",cookUrl(t,{dynamicPrefix:e={},dynamicAlias:i}={}){let s,n=t,a=/^(!(m?js|json|css|text):)?(.+)$/.exec(t);a&&(s=a[2],n=a[3]);let o=r.url(n,{dynamicPrefix:e,dynamicAlias:i});if(o)return s||(s=(a=/\.(m?js|css|json)$/.exec(o))?a[1]:"text"),{type:s,url:o}},url(s="",{dynamicPrefix:r={},dynamicAlias:a}={}){if(/^((https?:)?\/\/)/.test(s))return s;let o=s;if(a){o=(a instanceof e?a:(new e).reset(a)).get(s,null)}o=i.get(o||s),/^.+\.(css|js|mjs|json|txt|text|html|xml)$/.test(o)||(o=n.get(o));let l=/^(@([^:]+):?)(.*)/.exec(o);if(!l)return o;let[h,c]=l.slice(2),u=r[h]||t.prefix[h];if(!u)return;return u+c}};return{Config:r}}(),{Dom:Dom}=function(){const t={createElement({tagName:e="div",attrs:i={},props:s={},data:n={},className:r="",style:a={},$p:o=null,$refer:l=null},h=document){const c=h.createElement(e);return r&&(c.className=Ti.Css.joinClassNames(r)),Ti.Dom.setStyle(c,a),t.setAttrs(c,i),t.setData(c,n),_.forEach(s,(t,e)=>{c[e]=t}),l&&!o&&(o=l.parentElement),o&&o.insertBefore(c,l),c},appendToHead(t,e=document.head){_.isElement(t)&&_.isElement(e)&&e.appendChild(t)},appendToBody(t,e=document.body){_.isElement(t)&&_.isElement(e)&&e.appendChild(t)},appendTo(t,e){_.isElement(t)&&_.isElement(e)&&e.appendChild(t)},prependTo(t,e){e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t)},wrap(t,e){t.insertAdjacentElement("afterend",e),e.appendChild(t)},unwrap(t){let e=t.parentNode,i=[];for(let e=0;e<t.childNodes.length;e++){let s=t.childNodes[e];i.push(s)}for(let s of i)e.insertBefore(s,t);Ti.Dom.remove(t)},replace:(e,i,s=!1)=>(e.insertAdjacentElement("afterend",i),s&&(i.innerHTML=e.innerHTML),t.remove(e),i),attrFilter(e){if(_.isString(e)){if(e.startsWith("^")&&e.endsWith("$")){let t=new RegExp(e);return e=>t.test(e)}return t=>e===t}if(_.isFunction(e))return e;if(_.isBoolean(e))return()=>e;if(_.isRegExp(e))return t=>e.test(t);if(_.isArray(e)){let i=[];for(let s of e)i.push(t.attrFilter(s));return t=>{for(let e of i)if(e(t))return!0;return!1}}throw"Unsupport attrFilter: "+e},attrs(t,e=!0){e=this.attrFilter(e);let i={};for(let s=0;s<t.attributes.length;s++){let{name:n,value:r}=t.attributes[s],a=e(n,r),o=r;_.isBoolean(a)?a=n:_.isPlainObject(a)&&(o=a.value,a=a.name),a&&("true"==o?o=!0:"false"==o&&(o=!1),i[a]=o)}return i},getClassList(t,{filter:e=(()=>!0),dftList:i=[]}={}){if(!t)return i;if(_.isArray(t))return 0==t.length?i:_.uniq(t);_.isElement(t)&&(t=t.className);let s=_.without(t.split(/\s+/),""),n=[];for(let t of s)e(t)&&n.push(t);return n=_.uniq(n),_.isEmpty(n)?i:n},getStyle(t,e=!0){e=this.attrFilter(e);let i={};for(var s=0;s<t.style.length;s++){let n=t.style[s],r=e(n,t.style[n]);if(r){_.isBoolean(r)&&(r=_.camelCase(n));let e=t.style[r];i[r]=e}}return i},getOwnStyle(t,e=!0){if(_.isElement(t))return Ti.Css.parseCssRule(t.getAttribute("style"),e)},parseCssRule:(t="",e=!0)=>(console.warn("!Deprecate call: Ti.Dom.parseCssRule -> Ti.Css.parseCssRule"),Ti.Css.parseCssRule(t,e)),renderCssRule:(t={})=>(console.warn("!Deprecate call: Ti.Dom.renderCssRule -> Ti.Css.renderCssRule"),Ti.Css.renderCssRule(t)),removeAttrs(t,e=!1){e=this.attrFilter(e);let i={};for(let s=0;s<t.attributes.length;s++){let{name:n,value:r}=t.attributes[s],a=e(n,r);a&&(_.isBoolean(a)&&(a=n),i[a]=r,t.removeAttribute(n))}return i},getData(t,e=!0){e=this.attrFilter(e);let i={};for(let s=0;s<t.attributes.length;s++){let{name:n,value:r}=t.attributes[s];if(n.startsWith("data-")){let t=e(n=_.camelCase(n.substring(5)),r);t&&(_.isBoolean(t)?i[n]=r:t.name?i[t.name]=t.value:i[t]=r)}}return i},setData(t,e={}){_.forEach(e,(e,i)=>{Ti.Util.isNil(e)?t.removeAttribute(`data-${_.kebabCase(i)}`):t.setAttribute(`data-${_.kebabCase(i)}`,e)})},copyAttributes(t,e,i=(()=>!0)){let s=t.attributes;for(let t=0;t<s.length;t++){let{name:n,value:r}=s[t];i(n,r)&&e.setAttribute(n,r)}},renameElement(t,e,i=(()=>!0)){if(!_.isString(e))return t;if(e=e.toUpperCase(),t.tagName==e)return t;let s=t.ownerDocument.createElement(e);return Ti.Dom.copyAttributes(t,s,i),Ti.Dom.replace(t,s,!0)},getHeadingLevel(t){if(!_.isElement(t))return 0;let e=/^H([1-6])$/.exec(t.tagName);return e?parseInt(e[1]):0},getMyHeadingLevel(t){let e=Ti.Dom.seek(t,t=>/^H([1-6])$/.exec(t.tagName),t=>t.previousElementSibling?t.previousElementSibling:t.parentElement?t.parentElement:void 0);return Ti.Dom.getHeadingLevel(e)},remove(e,i){if(_.isString(e)){let s=t.findAll(e,i);for(let e of s)t.remove(e)}else _.isElement(e)&&e.parentNode.removeChild(e)},findAll(t="*",e=document){if(!e)return[];return[...e.querySelectorAll(t)]},find:(t,e=document)=>e?_.isUndefined(t)?e:_.isNull(t)?null:_.isElement(t)?t:e.querySelector(t):null,elementFilter(e){if(_.isString(e)){if(e.startsWith("^")&&e.endsWith("$")){let t=new RegExp(e);return e=>t.test(e.tagName)}return i=>t.is(i,e)}if(_.isFunction(e))return e;if(_.isElement(e))return t=>e===t;if(_.isBoolean(e))return()=>e;if(_.isRegExp(e))return t=>e.test(t.tagName);if(_.isArray(e)){let i=[];for(let s of e)i.push(t.elementFilter(s));return t=>{for(let e of i)if(e(t))return!0;return!1}}throw"Unsupport elementFilter: "+e},seekUntil(e,i,{by:s,includeSelf:n=!1,includeStop:r=!0,reverse:a=!1}={}){if(!i||!_.isFunction(s))return[e];Ti.Util.isNil(i)&&(i=e.ownerDocument.documentElement),i=t.elementFilter(i);let o=[],l=e;for(n&&o.push(l),l=s(l);l;){if(i(l))return r&&o.push(l),o;o.push(l),l=s(l)}return a?o.reverse():o},seek(e,i,s){if(!_.isFunction(s))return e;i=t.elementFilter(i);let n=e;for(;n;){if(i(n))return n;n=s(n)}return null},seekByTagName(e,i,s){if(!i||!_.isFunction(s))return!1;let n=Ti.AutoMatch.parse(i);return t.seek(e,({tagName:t})=>n(t),s)},prev:(e,i)=>t.seek(e,i,t=>t.previousElementSibling),prevByTagName:(e,i)=>t.seekByTagName(e,i,t=>t.previousElementSibling),prevUtil:(e,i,s={})=>t.seekUtil(e,i,{...s,by:t=>t.previousElementSibling}),next:(e,i)=>t.seek(e,i,t=>t.nextElementSibling),nextByTagName:(e,i)=>t.seekByTagName(e,i,t=>t.nextElementSibling),nextUtil:(e,i,s={})=>t.seekUtil(e,i,{...s,by:t=>t.nextElementSibling}),closest:(e,i)=>t.seek(e,i,t=>t.parentElement),closestByTagName:(e,i)=>t.seekByTagName(e,i,t=>t.parentElement),parentsUntil:(e,i,s={})=>t.seekUntil(e,i,{...s,by:t=>t.parentElement}),eventCurrentTarget(e,i,s){let n=e.srcElement;if(!i)return n;for(;n;){if(n===s)return;if(t.is(n,i))return n;n=n.parentElement}},ownerWindow:t=>t.defaultView?t.defaultView:t.ownerDocument?t.ownerDocument.defaultView:t,isTouchDevice(){let t=window.navigator.userAgent||"";return/^.+(\((ipad|iphone);|linux;\s*android).+$/.test(t.toLowerCase())},autoRootFontSize({$win:t=window,phoneMaxWidth:e=540,tabletMaxWidth:i=768,designWidth:s=1e3,max:n=100,min:r=80,callback:a}={}){const o=t.document,l=o.documentElement,h=Ti.Rects.createBy(t);let c=h.width/s*n,u=Math.min(Math.max(c,r),n);if(_.isFunction(a)){a({$win:t,$doc:o,$root:l,mode:h.width>i?"desktop":h.width>e?"tablet":"phone",fontSize:u,width:h.width,height:h.height})}},watchDocument(t,e){document.addEventListener(t,e)},unwatchDocument(t,e){document.removeEventListener(t,e)},watchAutoRootFontSize(e={},i,s=window){_.isFunction(e)&&(s=i||window,i=e,e=void 0);let n=_.assign({},e,{$win:s,callback:i});s.addEventListener("resize",()=>{t.autoRootFontSize(n)}),_.delay(()=>{t.autoRootFontSize(n)},1)},formatStyle(t={},e){let i={},s=Ti.S.getCaseFunc(e),n=_.keys(t);for(let e of n){let n=t[e];s&&(e=s(e)),/^(opacity|z-index|zIndex|order)$/.test(e)?i[e]=1*n:_.isNumber(n)||/^\d+(\.\d+)?$/.test(n)?i[e]=`${n}px`:i[e]=n}return i},setStyleValue(t,e,i,s){(_.isUndefined(s)||s!=i)&&(i&&"none"!=i?_.isNumber(i)||/^\d+(\.\d+)?$/.test(i)?t.style[e]=`${i}px`:t.style[e]=i:t.style[e]="")},setStyle(t,e={}){if(!t)return;if(_.isEmpty(e))return void(t.style="");let i=Ti.Css.renderCssRule(e);t.style=i},updateStyle(t,e={}){t&&(_.isEmpty(e)?t.style="":_.forOwn(e,(e,i)=>{if(_.isNull(e)||_.isUndefined(e))return;let s=_.kebabCase(i);if(""===e)t.style.removeProperty(s);else{let i=_.isNumber(e)?e+"px":e;t.style.setProperty(s,i)}}))},setAttrs(t,e={},i){t&&_.isElement(t)&&_.forEach(e,(e,s)=>{let n=i?i+s:s,r=_.kebabCase(n);if("style"==r)if(Ti.Util.isNil(e))t.removeAttribute("style");else{let i=Ti.Css.renderCssRule(e);t.style=i}else{if(_.isUndefined(e))return;if(_.isNull(e))t.removeAttribute(r);else{let i=e;(_.isArray(e)||_.isPlainObject(e))&&(i=JSON.stringify(e)),t.setAttribute(r,i)}}})},setClass(t,...e){let i=_.flattenDeep(e).join(" ");t.className=i},addClass(t,...e){let i=_.flattenDeep(e),s={};_.forEach(t.classList,t=>{s[t]=!0});for(let e of i){let i=_.trim(e);s[i]||t.classList.add(i)}},is(t,e){if(t.matches)return t.matches(e);throw"Slot Element matched"},isBody:t=>t.ownerDocument.body===t,removeClass(t,...e){let i=_.flattenDeep(e);for(let e of i){let i=_.trim(e);t.classList.remove(i)}},hasClass(t,...e){if(!_.isElement(t))return!1;for(let i of e)if(!t.classList.contains(i))return!1;return!0},hasOneClass(t,...e){if(!_.isElement(t))return!1;for(let i of e)if(t.classList.contains(i))return!0;return!1},applyRect(e,i,s="tlwh",n={}){let r=e.ownerDocument.defaultView;_.defaults(n,{width:r.innerWidth,height:r.innerHeight});let a=i.toCss(n,s);t.updateStyle(e,a)},dockTo(e,i,{mode:s="H",axis:n={},posListX:r,posListY:a,space:o,coord:l="win",viewportBorder:h=4,position:c}={}){if(!_.isElement(e)||!_.isElement(i))return;c&&(e.style.position=c);let u={src:Ti.Rects.createBy(e),ta:Ti.Rects.createBy(i),win:Ti.Rects.createBy(e.ownerDocument.defaultView)};const d=(t,e,i)=>t<=e?i[0]:t>e&&t<=2*e?i[1]:i[2];if(_.defaults(n,{x:"auto",y:"auto"}),"auto"==n.x){let t=r||{H:["left","right"],V:["right","left"]}[s];n.x=d(u.ta.x,u.win.width/t.length,t)}if("auto"==n.y){let t=a||{H:["bottom","top"],V:["top","center","bottom"]}[s];n.y=d(u.ta.y,u.win.height/t.length,t)}let m=u.win.clone();"H"==s&&"win"==l&&("bottom"==n.y?m.top=u.ta.bottom:"top"==n.y&&(m.bottom=u.ta.top),m.updateBy("tlbr"));let p=u.src.dockTo(u.ta,s,{axis:n,space:o,viewport:m,viewportBorder:h,wrapCut:!0});if("target"==l)u.src.translate({x:-1*u.ta.left,y:-1*u.ta.top});else{"absolute"==window.getComputedStyle(e).position&&window.pageYOffset>0&&(u.src.top+=window.pageYOffset,u.src.update())}_.delay(()=>{t.applyRect(e,u.src,p)},0)},getRemBase(t=document){_.isElement(t)&&t.ownerDocument&&(t=t.ownerDocument);let e=t.documentElement.style.fontSize||"100px";return Ti.Css.toAbsPixel(e)},scrollBarSize:function(){if(!window.SCROLL_BAR_SIZE){var t=0;$("body").append("<div id='div_out' style='position:relative;width:100px;height:100px;overflow-y:scroll;overflow-x:scroll'></div>"),$("#div_out").append("<div id='div_in' style='position:absolute;width:100%;height:100%;'></div>");var e=$("#div_out"),i=$("#div_in");t=e.width()-i.width(),$("#div_out").remove(),$("#div_in").remove(),window.SCROLL_BAR_SIZE=t}return window.SCROLL_BAR_SIZE}};return{Dom:t}}(),{Rect:Rect,Rects:Rects}=function(){function t(t,e,s){let n={},r=i.explainToArray(e,!1);for(let e of r){let i=Ti.Util.fallback(t[e],s);_.isUndefined(i)||(n[e]=i)}return n}class e{constructor(){_.assign(this,{t:"top",l:"left",w:"width",h:"height",r:"right",b:"bottom",x:"x",y:"y"})}explainToArray(t,e=!0){let i=[],s=function(t,e=!0){if(!t)return[];if(_.isArray(t))return t;let i=t.toLowerCase().split("");return e?i.sort():i}(t,e);for(let t of s){let e=this[t];e&&i.push(e)}return i}getKey(t){return this[t]}}const i=new e;class s{constructor(t,e){this.__ti_rect__=!0,this.set(t,e)}set(t={top:0,left:0,width:0,height:0},e){const i=["bottom","height","left","right","top","width","x","y"];if(_.isUndefined(e)){let s=[];for(let e of i){let i=t[e];if(_.isNumber(i)){this[e]=i;let t=e.substring(0,1);s.push(t)}}e=s.join("")}else for(let e of i){let i=t[e];_.isNumber(i)&&(this[e]=i)}return"bhlrtwxy"==e?this:this.updateBy(e)}toString(e="tlwh"){let i=t(this,e,"NaN"),s=[];return _.forEach(i,t=>s.push(t)),s.join(",")}valueOf(){return this.toString()}update(t){return this.updateBy(t)}updateBy(t="tlwh"){return{"height/left/top/width":()=>{this.right=this.left+this.width,this.bottom=this.top+this.height,this.x=this.left+this.width/2,this.y=this.top+this.height/2},"height/right/top/width":()=>{this.left=this.right-this.width,this.bottom=this.top+this.height,this.x=this.left+this.width/2,this.y=this.top+this.height/2},"bottom/height/left/width":()=>{this.top=this.bottom-this.height,this.right=this.left+this.width,this.x=this.left+this.width/2,this.y=this.top+this.height/2},"bottom/height/right/width":()=>{this.top=this.bottom-this.height,this.left=this.right-this.width,this.x=this.left+this.width/2,this.y=this.top+this.height/2},"bottom/left/right/top":()=>{this.width=this.right-this.left,this.height=this.bottom-this.top,this.x=this.left+this.width/2,this.y=this.top+this.height/2},"height/width/x/y":()=>{let t=this.width/2,e=this.height/2;this.top=this.y-e,this.bottom=this.y+e,this.left=this.x-t,this.right=this.x+t},"height/left/width/y":()=>{let t=this.width/2,e=this.height/2;this.top=this.y-e,this.bottom=this.y+e,this.x=this.left+t,this.right=this.left+this.width},"height/right/width/y":()=>{let t=this.width/2,e=this.height/2;this.top=this.y-e,this.bottom=this.y+e,this.x=this.right-t,this.left=this.right-this.width},"height/top/width/x":()=>{let t=this.width/2,e=this.height/2;this.y=this.top+e,this.bottom=this.top+this.height,this.left=this.x-t,this.right=this.x+t},"bottom/height/width/x":()=>{let t=this.width/2,e=this.height/2;this.y=this.bottom-e,this.top=this.bottom-this.height,this.left=this.x-t,this.right=this.x+t}}[i.explainToArray(t).join("/")](),this}raw(e="tlwh",i){return t(this,e,i)}toCss(e={width:window.innerWidth,height:window.innerHeight},i="tlwh",s){var n={top:this.top,left:this.left,width:this.width,height:this.height,right:e.width-this.right,bottom:e.height-this.bottom};return Ti.IsDebug()&&console.log("CSS:",n),t(n,i,s)}relative(t,e={x:0,y:0}){return this.top=this.top-(t.top-e.y),this.left=this.left-(t.left-e.x),this.updateBy("tlwh")}zoom({x:t=1,y:e=t,centre:i=this}={}){return this.top=(this.top-i.y)*e+i.y,this.left=(this.left-i.x)*t+i.x,this.width=this.width*t,this.height=this.height*e,this.updateBy("tlwh")}zoomTo({width:t,height:e,mode:i="contain"}={}){if("contain"==i){if(new s({top:0,left:0,width:t,height:e}).contains(this))return this}let n,r,a=t,o=e,l=this.width/this.height,h=a/o;return l>h?"cover"==i?(r=o,n=o*l):(n=a,r=a/l):l<h?"cover"==i?(n=a,r=a/l):(r=o,n=o*l):(n=a,r=o,x=0,y=0),this.width=n,this.height=r,this.updateBy("tlwh")}centreTo({width:t,height:e,top:i=0,left:s=0}={},{xAxis:n=!0,yAxis:r=!0}={}){if(n&&t>0){let e=t-this.width;this.left=s+e/2}if(r&&e>0){let t=e-this.height;this.top=i+t/2}return this.updateBy("tlwh")}translate({x:t=0,y:e=0}={}){return this.y+=e,this.x+=t,this.updateBy("xywh")}moveTo(t={},e={},s="tl"){_.defaults(t,{x:0,y:0}),_.defaults(e,{x:0,y:0});return{"left/top":()=>{this.left=t.x-e.x,this.top=t.y-e.y,this.updateBy("tlwh")},"right/top":()=>{this.right=t.x+e.x,this.top=t.y-e.y,this.updateBy("trwh")},"bottom/left":()=>{this.left=t.x-e.x,this.bottom=t.y+e.y,this.updateBy("blwh")},"bottom/right":()=>{this.right=t.x+e.x,this.bottom=t.y+e.y,this.updateBy("brwh")}}[i.explainToArray(s).join("/")](),this}dockTo(t,e="H",{axis:i={},space:s={},viewport:r={},viewportBorder:a=4,wrapCut:o=!1}={}){_.isNumber(s)&&(s={x:s,y:s}),_.defaults(i,{x:"center",y:"bottom"}),_.defaults(s,{x:0,y:0});({"V:left/top":()=>{this.right=t.left-s.x,this.top=t.top+s.y,this.updateBy("rtwh")},"V:left/center":()=>{this.right=t.left-s.x,this.y=t.y+s.y,this.updateBy("rywh")},"V:left/bottom":()=>{this.right=t.left-s.x,this.bottom=t.bottom-s.y,this.updateBy("rbwh")},"V:right/top":()=>{this.left=t.right+s.x,this.top=t.top+s.y,this.updateBy("ltwh")},"V:right/center":()=>{this.left=t.right+s.x,this.y=t.y+s.y,this.updateBy("lywh")},"V:right/bottom":()=>{this.left=t.right+s.x,this.bottom=t.bottom-s.y,this.updateBy("lbwh")},"H:left/top":()=>{this.left=t.left+s.x,this.bottom=t.top-s.y,this.updateBy("lbwh")},"H:left/bottom":()=>{this.left=t.left+s.x,this.top=t.bottom+s.y,this.updateBy("ltwh")},"H:center/top":()=>{this.x=t.x+s.x,this.bottom=t.top-s.y,this.updateBy("xbwh")},"H:center/bottom":()=>{this.x=t.x+s.x,this.top=t.bottom+s.y,this.updateBy("xtwh")},"H:right/top":()=>{this.right=t.right-s.x,this.bottom=t.top-s.y,this.updateBy("rbwh")},"H:right/bottom":()=>{this.right=t.right-s.x,this.top=t.bottom+s.y,this.updateBy("rtwh")}})[e+":"+i.x+"/"+i.y]();let l="tl";if(o&&n.isRect(r)){let t=r.clone(a);t.wrap(this),t.contains(this)||(this.overlap(t),l="tlwh")}return l}dockIn(t,e={},i={}){_.defaults(e,{x:"center",y:"center"}),_.defaults(i,{x:0,y:0});return{"left/top":()=>{this.left=t.left+i.x,this.top=t.top+i.y,this.updateBy("ltwh")},"left/center":()=>{this.left=t.left+i.x,this.y=t.y+i.y,this.updateBy("lywh")},"left/bottom":()=>{this.left=t.left+i.x,this.bottom=t.bottom-i.y,this.updateBy("lbwh")},"right/top":()=>{this.right=t.right-i.x,this.top=t.top+i.y,this.updateBy("rtwh")},"right/center":()=>{this.right=t.right-i.x,this.y=t.y+i.y,this.updateBy("rywh")},"right/bottom":()=>{this.right=t.right-i.x,this.bottom=t.bottom-i.y,this.updateBy("brwh")},"center/center":()=>{this.x=t.x+i.x,this.x=t.y+i.y,this.updateBy("xywh")}}[e.x+"/"+e.y](),this}wrap(t){let e=["w","h"];return this.containsX(t)||(t.left>this.left&&t.right>this.right?(t.right=this.right,e.push("r")):(t.left=this.left,e.push("l"))),this.containsY(t)?3==e.length&&e.push("t"):t.top>this.top&&t.bottom>this.bottom?(t.bottom=this.bottom,e.push("b")):(t.top=this.top,e.push("t")),3==e.length&&e.push("l"),4==e.length?t.updateBy(e.join("")):t}wrapCut(t){return this.wrap(t),this.contains(t)||t.overlap(this),t}union(...t){for(let e of t)this.top=Math.min(this.top,e.top),this.left=Math.min(this.left,e.left),this.right=Math.max(this.right,e.right),this.bottom=Math.max(this.bottom,e.bottom);return this.updateBy("tlbr")}overlap(...t){for(let e of t)this.top=Math.max(this.top,e.top),this.left=Math.max(this.left,e.left),this.right=Math.min(this.right,e.right),this.bottom=Math.min(this.bottom,e.bottom);return this.updateBy("tlbr")}contains(t,e=0){return this.containsX(t,e)&&this.containsY(t,e)}containsX(t,e=0){return this.left+e<=t.left&&this.right-e>=t.right}containsY(t,e=0){return this.top+e<=t.top&&this.bottom-e>=t.bottom}hasPoint({x:t,y:e}={},i=0){return this.hasPointX(t,i)&&this.hasPointY(e,i)}hasPointX(t=0,e=0){return this.left+e<=t&&this.right-e>=t}hasPointY(t=0,e=0){return this.top+e<=t&&this.bottom-e>=t}isOverlap(t){let e=Math.max(this.top,t.top),i=Math.max(this.left,t.left),s=Math.min(this.right,t.right),n=Math.min(this.bottom,t.bottom);return s-i>0&&n-e>0}area(){return this.width*this.height}clone(t=0){return new s({left:this.left+t,right:this.right-t,top:this.top+t,bottom:this.bottom-t},"tlbr")}}const n={create:(t,e)=>new s(t,e),createBy(t){if(!t)return;if(!t.ownerDocument){let e=Ti.Dom.ownerWindow(t);return new s({top:0,left:0,width:e.document.documentElement.clientWidth,height:e.document.documentElement.clientHeight})}let e=t.getBoundingClientRect();return new s(e,"tlwh")},union(...t){if(0==t.length)return new s;let e=new s(t[0]);return e.union(...t.slice(1)),e},overlap(...t){if(0==t.length)return new s;let e=new s(t[0]);return e.overlap(...t.slice(1)),e},isRect:t=>t&&t.__ti_rect__&&t instanceof s};return{Rect:s,TiRects:n,Rects:n}}(),{Load:Load}=function(){async function t(e=[],{dynamicPrefix:i,dynamicAlias:s,cooked:r,type:a}={}){if(_.isFunction(e)){return t(e(),{dynamicPrefix:i})}if(_.isArray(e)){let n=[],r=[];return e.forEach((e,a)=>{n.push(t(e,{dynamicPrefix:i,dynamicAlias:s}).then(t=>r[a]=t))}),Promise.all(n).then(()=>r)}if(!_.isString(e))throw Ti.Err.make("e-ti-use-url_must_string",e);if(!r){let t=Ti.Config.cookUrl(e,{dynamicPrefix:i,dynamicAlias:s});a=t.type,e=t.url}let o=Ti.MatchCache(e);if(o)return o;try{return o=await n[a](e)}catch(t){throw Ti.IsWarn("TiLoad")&&console.warn(`TiLoad Fail: [${a}]`,`"${e}"`),t}}class e{constructor(t=(t=>t)){this.cached={},this.loading={},this.doLoad=t}async tryLoad(t,e){let i=this.cached[t];if(!_.isUndefined(i))return void e(i);let s=this.loading[t];if(_.isArray(s)&&s.length>0)return void s.push(e);this.loading[t]=[e];let n=await this.doLoad(t);this.cached[t]=n;let r=this.loading[t];this.loading[t]=null;for(let t of r)t(n)}}const i=new e(async t=>{try{return await import(t)}catch(e){throw Ti.IsWarn("TiLoad")&&console.warn("ti.load.mjs",t,e),e}}),s=new e(async t=>{try{return await Ti.Http.get(t)}catch(e){throw Ti.IsWarn("TiLoad")&&console.warn("ti.load.text",t,e),e}}),n={js:t=>new Promise((e,i)=>{let s=Ti.Dom.find(`script[src="${t}"]`);s?_.defer(e,s):((s=Ti.Dom.createElement({tagName:"script",props:{src:t}})).addEventListener("load",function(t){e(s)},{once:!0}),s.addEventListener("error",function(t){i(t)},{once:!0}),Ti.Dom.appendToHead(s))}),mjs:t=>new Promise((e,s)=>{i.tryLoad(t,t=>{e(t.default)})}),css:t=>new Promise((e,i)=>{let s=Ti.Dom.find(`link[href="${t}"]`);s?_.defer(e,s):((s=Ti.Dom.createElement({tagName:"link",props:{rel:"stylesheet",type:"text/css",href:t}})).addEventListener("load",function(t){e(s)},{once:!0}),s.addEventListener("error",function(t){i(t)},{once:!0}),Ti.Dom.appendToHead(s))}),async json(t){try{let e=await n.text(t);return _.isPlainObject(e)?e:JSON.parse(e)}catch(e){throw Ti.IsWarn("TiLoad")&&console.warn("ti.load.json!!",t,e),e}},text:t=>new Promise((e,i)=>{s.tryLoad(t,e)})};return{Load:t}}(),{Http:Http}=function(){const t={arraybuffer(t){throw"No implement yet!"},blob(t){throw"No implement yet!"},document(t){throw"No implement yet!"},xml(t){throw"No implement yet!"},ajax(e){let i=t.json(e);if(i.ok)return i.data;throw i},json(t){let e=t.responseText,i=_.trim(e)||null;try{return JSON.parse(i)}catch(t){return Ti.Types.safeParseJson(i,i)}},jsonOrText(t){let e=t.responseText;try{let t=_.trim(e)||null;return JSON.parse(t)}catch(t){}return e},text:t=>t.responseText},e={send(t,i={}){if(Ti.IsInfo("TiHttp")&&console.log("TiHttp.send",t,i),!t)return;let{method:s="GET",params:n={},body:r=null,file:a=null,headers:o={},cleanNil:l=!0,progress:h=_.identity,created:c=_.identity,beforeSend:u=_.identity,finished:d=_.identity,readyStateChanged:m=_.identity}=i;if(s=_.upperCase(s),l){let t={};Ti.Util.walk(n,{leaf:(e,i)=>{Ti.Util.isNil(e)||_.set(t,i,e)}}),n=t}let{urlToSend:p,sendData:f}=Ti.Invoke({GET:()=>{let i=e.encodeFormData(n);return{urlToSend:i?t+"?"+i:t}},POST:()=>(_.defaults(o,{"Content-type":"application/x-www-form-urlencoded; charset=utf-8"}),a?{urlToSend:[t,e.encodeFormData(n)].join("?"),sendData:a}:r?{urlToSend:[t,e.encodeFormData(n)].join("?"),sendData:r}:{urlToSend:t,sendData:e.encodeFormData(n)})}[s])||{urlToSend:t},g=new XMLHttpRequest;if(a){if(!g.upload)throw Ti.Err.make("e.ti.http.upload.NoSupported");g.upload.addEventListener("progress",h)}return c(g),new Promise((t,e)=>{g.onreadystatechange=(()=>{m(g,i),4==g.readyState&&(d(g),200==g.status?t(g):e(g))}),g.open(s,p),_.forOwn(o,(t,e)=>{g.setRequestHeader(e,t)}),u(g),g.send(f)})},sendAndProcess:(i,s={})=>e.send(i,s).then(e=>(function(e,{as:i="text"}={}){return Ti.InvokeBy(t,i,[e])})(e,s)),get:(t,i={})=>e.sendAndProcess(t,_.assign({},i,{method:"GET"})),post:(t,i={})=>e.sendAndProcess(t,_.assign({},i,{method:"POST"})),encodeFormData(t={}){let e=[];return _.forOwn(t,(t,i)=>{let s=Ti.Types.toStr(t);e.push(`${i}=${encodeURIComponent(s)}`)}),e.join("&")}};return{Http:e}}(),{I18n:I18n}=function(){function t(t){let i=_.get(e,t);if(i)return i;if(_.isString(t)){let i=t.replace(/\./g,"-");return e[i]}return t}const e={},i={put(t){if(_.isArray(t))for(let e of t)i.put(e);else if(_.isPlainObject(t)){if(_.isBoolean(t.ok))return void console.warn("invalid msgs",t);_.assign(e,t)}},get(e,s){if(e&&e.key&&_.isPlainObject(e))return i.getf(e.key,e.vars);if(e instanceof Error)return e.code?Ti.S.join([i.get(e.code),e.data]," : "):e.message;let n=t(e);return _.isUndefined(n)?_.isUndefined(s)?e:s:n},text(t,e){if(t&&t.text&&_.isPlainObject(t))return i.textf(t.text,t.vars);if(t instanceof Error)return i.get(t);let s=/^i18n:(.+)$/.exec(t);return s?i.get(s[1],e):Ti.Util.fallback(t,e)},getf(e,i={}){if(_.isString(e)){let s=t(e)||e;return Ti.S.renderBy(s,i)}return e},textf(t,e={}){let s=/^i18n:(.+)$/.exec(t);return s?i.getf(s[1],e):Ti.S.renderBy(t,e)},render:(t={},e)=>i.textf(e,t),explain(t){let e=_.trim(t),s=e.indexOf(":");if(s>0){let t=_.trim(e.substring(0,s)),n=_.trim(e.substring(s+1));return console.log({code:t,data:n}),i.getf(t,{val:n})}return i.get(e)},translate(t){let e=_.trim(t),s=e.indexOf(":");if(s>0){let t=_.trim(e.substring(0,s)),n=_.trim(e.substring(s+1));return i.get(t)+" : "+n}return i.get(e)}};return{I18n:i}}(),{Icons:Icons}=function(){const t={"7z":"fas-file-archive",apk:"zmdi-android",bin:"fas-file",css:"fab-css3",csv:"fas-file-csv",doc:"far-file-word",docx:"fas-file-word",dmg:"fab-apple",exe:"im-windows-o",gz:"fas-file-archive",hmaker_site:"zmdi-globe-alt",html:"fab-html5",js:"fab-node-js",json:"fas-quote-right",less:"fab-first-order-alt",md:"fab-markdown",mjs:"fab-node-js",mkv:"far-file-video",mp:"fas-file-signature",mp3:"far-file-audio",mp4:"far-file-video",msi:"fab-windows",pdf:"far-file-pdf",py:"fab-python",rar:"fas-file-archive",rss:"fas-rss-square",sass:"fab-first-order",tar:"far-file-archive",tgz:"fas-file-archive",comt:"im-flask",wnml:"fas-file-code",xls:"far-file-excel",xlsx:"fas-file-excel",xml:"far-file-code",youtube:"fab-youtube",zip:"fas-file-archive",category:"zmdi-folder",article:"zmdi-file-text"},e={audio:"far-file-audio",image:"far-file-image",text:"far-file-alt",video:"far-file-video","text/css":"fab-css3","text/html":"fab-html5","application/x-zip-compressed":"fas-file-archive","application/x-javascript":"fab-js-square","text/javascript":"fab-js-square"},i={add:"zmdi-plus",alert:"zmdi-notifications-none",backward:"zmdi-chevron-left",close:"zmdi-close",confirm:"zmdi-help",create:"zmdi-audio",del:"zmdi-delete",done:"fas-thumbs-up",download:"zmdi-download",edit:"zmdi-edit",error:"zmdi-alert-octagon",forward:"zmdi-chevron-right",help:"zmdi-help-outline",info:"zmdi-info-outline",loading:"fas-spinner fa-spin",moved:"zmdi-gamepad",processing:"zmdi-settings zmdi-hc-spin",ok:"zmdi-check-circle",prompt:"zmdi-keyboard",refresh:"zmdi-refresh",removed:"far-trash-alt",setting:"zmdi-settings",success:"zmdi-check-circle",track:"zmdi-notifications-none",warn:"zmdi-alert-triangle"},s={FILE:"far-file",DIR:"fas-folder"},n={...t,...e,...s,...i},r={put({types:n,mimes:r,races:a,names:o,dft:l}={}){_.assign(t,n),_.assign(e,r),_.assign(i,o),_.assign(s,a),_.assign("zmdi-cake",l)},evalIcon(r,a){if(!r)return a;if(_.isString(r))return n[r]||a;let{tp:o,type:l,mime:h,race:c,name:u,icon:d}=r;if(d)return d;let m=null;if(h){let t=/^([a-z0-9]+)\/(.+)$/.exec(h);t&&(m=t[1])}return t[l||o]||e[h]||e[m]||s[c]||i[u]||a},get:(t,e="zmdi-cake")=>r.evalIcon(t,e),getByName:(t,e=null)=>Ti.Util.fallback(i[t],e,"zmdi-cake"),evalIconObj(t,e){if(!t)return e;if(_.isString(t)){let e=/^(fa\w|zmdi|im)-([\d\w-]+)$/.exec(t);if(e){let[t,i,s]=e;return{type:"font",value:t,cate:i,name:s}}return{type:"image",value:t}}return t},parseFontIcon(t,e={}){if(!t)return e;let i={className:"material-icons",text:t},s=/^([a-z]+)-(.+)$/.exec(t);return s&&(/^fa[a-z]$/.test(s[1])?(i.className=s[1]+" fa-"+s[2],i.text=null):(i.className=s[1]+" "+t,i.text=null)),i},fontIconHtml(t,e=""){if(!t)return e;let i=r.parseFontIcon(t);return _.isEmpty(i)?e:`<i class="${i.className}">${i.text||""}</i>`}};return{Icons:r}}(),{Fuse:Fuse}=function(){class t{constructor({key:t,everythingOk:e,fail:i,once:s=!1}={}){_.assign(this,{key:t,everythingOk:e,fail:i,once:s})}async explode(){return!!await this.everythingOk()||(await this.fail(),!1)}}class e{constructor(){this.detonators=[]}async fire(){for(let t of this.detonators)if(!await t.explode())return!1;return _.remove(this.detonators,t=>t.once),!0}add(e={}){_.defaults(e,{key:"det-"+this.detonators.length}),e instanceof t?this.detonators.push(e):this.detonators.push(new t(e))}remove(...t){_.pullAllWith(this.detonators,t,(t,e)=>t.key==e)}clear(){this.detonators=[]}}class i{constructor(){this.fuses={}}get(t="main"){return this.fuses[t]}getOrCreate(t="main"){let i=this.get(t);return i||(i=new e,this.fuses[t]=i),i}async fire(t="main"){let e=this.get(t);return!e||await e.fire()}removeFuse(t){let e=this.get(t);return e&&delete this[t],e}clear(t="main"){let e=this.get(t);return e&&e.clear(),e}}return{Fuse:new i}}(),{Random:Random}=function(){const t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".split("");return{Random:{str(e=4,i=t){let s="";for(let n=0;n<e;n++){s+=i[_.random(0,t.length-1)]}return s},obj:(e=t)=>e[_.random(0,t.length-1)],list(t=[],e=t.length){let i=Math.min(e,t.length)-1;for(;i>0;i--){let e=_.random(0,i),s=t[i],n=t[e];t[i]=n,t[e]=s}return t}}}}(),{Storage:Storage}=function(){class t{constructor(t){this.storage=t}get(t,e,i=_.identity){let s=this.storage.getItem(t);return Ti.Util.isNil(s)?e:i(s)}getString(t,e=null){return this.get(t,e)}getObject(t,e={}){return this.get(t,e,t=>JSON.parse(t))}getInt(t,e=-1){return this.get(t,e,t=>parseInt(t))}getBoolean(t,e=!1){return this.get(t,e,t=>!!/^(true|yes|on|ok)$/.test(t))}getNumber(t,e=-1){return this.get(t,e,t=>1*t)}set(t,e){if(_.isNull(e)||_.isUndefined(e))this.remove(t);else{let i=e+"";this.storage.setItem(t,i)}}setObject(t,e={}){(_.isNull(e)||_.isUndefined(e))&&this.remove(t);let i=JSON.stringify(e);this.storage.setItem(t,i)}mergeObject(t,e={}){let i=this.getObject(t);_.merge(i,e),this.setObject(t,i)}remove(t){this.storage.removeItem(t)}clear(){this.storage.clear()}}return{Storage:{session:new t(window.sessionStorage),local:new t(window.localStorage)}}}(),{Shortcut:Shortcut}=function(){const t={genActionInvoking(t,{$com:e,argContext:i={},wait:s=0}={}){const n=t=>s>0?_.debounce(t,s,{leading:!0}):t,r=t=>_.isFunction(t)?t():t;if(_.isFunction(t))return n(t);let a,o,l;if(_.isString(t)){let e=/^((global|commit|dispatch|root|main|\$\w+):|=>)([^()]+)(\((.*)\))?$/.exec(t);if(!e)throw Ti.Err.make("e.action.invalid : "+t,{action:t});a=e[2]||e[1],o=e[3],l=e[5]}else _.isPlainObject(t)&&(a=t.mode,o=t.name,l=t.args);let h,c=Ti.S.joinArgs(l,[],t=>Ti.S.toJsValue(t,{context:i}));if("=>"==a){let i=_.get(window,o);if(!_.isFunction(i))throw Ti.Err.make("e.action.invoke.NotFunc : "+t,{action:t});h=(()=>{let t=r(e);i.apply(t,c)})}else h="$emit"==a||"$notify"==a?()=>{let i=r(e);if(!i)throw Ti.Err.make("e.action.emit.NoCom : "+t,{action:t});i[a](o,...c)}:"$parent"==a?()=>{let i=r(e),s=i[o];if(!_.isFunction(s))throw Ti.Err.make("e.action.call.NotFunc : "+t,{action:t});s.apply(i,c)}:()=>{let t=r(e),i=Ti.App(t),s=i[a],n=_.concat(o,c);s.apply(i,n)};if(!_.isFunction(h))throw Ti.Err.make("e.invalid.action : "+t,{action:t});return n(h)},getUniqueKey(t,{sep:e="+",mode:i="upper"}={}){let s=[];t.altKey&&s.push("ALT"),t.ctrlKey&&s.push("CTRL"),t.metaKey&&s.push("META"),t.shiftKey&&s.push("SHIFT");let n=Ti.S.toCase(t.key,i);return/^(ALT|CTRL|CONTROL|SHIFT|META)$/.test(n)||s.push(" "===n?"SPACE":n),s.join(e)},startListening(){this.isListening||(window.addEventListener("keydown",e=>{let i=t.getUniqueKey(e),s=Ti.App.topInstance();s&&s.fireShortcut(i,e)}),this.isListening=!0)}};return{Shortcut:t}}(),{TiWebsocket:TiWebsocket}={TiWebsocket:{listenRemote({watchTo:t=null,watched:e=_.identity,received:i=_.identity,closed:s=_.identity,error:n=_.identity}={}){let r=window.location.hostname,a=window.location.port,o={"http:":"ws","https:":"wss"}[window.location.protocol],l=[r];a>80&&l.push(a);var h=`${o}://${l.join(":")}/websocket`,c=new WebSocket(h);return _.isPlainObject(t)&&(c.onmessage=function(s){var n=JSON.parse(s.data);if("hi"==n.event){let e=JSON.stringify(t);this.send(e)}else"watched"==n.event?e(n):i(n)}),c.onclose=s,c.onerror=n,c}}},{Validate:Validate}=function(){const t={notNil:t=>!Ti.Util.isNil(t),notEmpty:t=>!_.isEmpty(t),notBlank:t=>!Ti.S.isBlank(t),isNil:t=>Ti.Util.isNil(t),isEmpty:t=>_.isEmpty(t),isBlank:t=>Ti.S.isBlank(t),isPlainObject:t=>_.isPlainObject(t),isBoolean:t=>_.isBoolean(t),isTrue:t=>!0===t,isFalse:t=>!1===t,isTruthy:t=>!!t,isFalsy:t=>!t,isNumber:t=>_.isNumber(t),isString:t=>_.isString(t),isDate:t=>_.isDate(t),inRange:(t,...e)=>_.inRange(t,...e),isMatch:(t,e)=>_.isMatch(t,e),isEqual:(t,e)=>_.isEqual(t,e),isOf:(t,...e)=>{for(let i of e)if(_.isEqual(i,t))return!0;return!1},matchRegex:(t,e)=>_.isRegExp(e)?e.test(t):new RegExp(e).test(t)},e={get(e,i=[],s){_.isFunction(e)&&(e=e());let n=_.get(t,e);if(!_.isFunction(n))throw`Invalid Validate: ${e}`;let r;return r=_.isEmpty(i)?n:_.partialRight(n,...i),s?t=>!r(t):r},evalBy(e,i={}){let s=!1;e.startsWith("!")&&(s=!0,e=_.trim(e.substring(1)));let n=Ti.Util.genInvoking(e,{context:i,funcSet:t,partial:"right"});if(!_.isFunction(n))throw`Invalid TiValidator: "${e}"`;return s?t=>!n(t):n},getBy(t){if(_.isBoolean(t))return()=>t;if(_.isFunction(t))return t;if(_.isString(t))return e.evalBy(t);if(_.isPlainObject(t)){let i=t.name,s=_.isUndefined(t.args)?[]:[].concat(t.args),n=!!t.not;return/^!/.test(i)&&(i=i.substring(1).trim(),n=!0),e.get(i,s,n)}if(_.isArray(t)&&t.length>0){let i=t[0],s=t.slice(1,t.length),n=!1;return/^!/.test(i)&&(i=i.substring(1).trim(),n=!0),e.get(i,s,n)}},checkBy(t,i){let s=e.getBy(t);return!!_.isFunction(s)&&!!s(i)},match(t={},i={},s=!1){if(!t||_.isEmpty(t))return s;if(_.isFunction(i))return!!i(t);if(_.isBoolean(i))return!!i;if(_.isArray(i)){for(let e of i)if(Ti.Validate.match(t,e,s))return!0;return!1}let n=_.keys(i);for(let s of n){let n=_.get(i,s),r=_.get(t,s);if(!e.checkBy(n,r))return!1}return!0},compile:(t,i)=>s=>e.match(s,t,i)};return{Validate:e}}(),{AutoMatch:AutoMatch}=function(){function t(s){if(Ti.Util.isNil(s))return new e;if(_.isBoolean(s))return function(t){let e=!!t;return function(t){return!!t===e}}(s);if(_.isNumber(s))return function(t){return function(e){return e==t}}(s);if(_.isArray(s)){let e=[];for(let i of s){let s=t(i);e.push(s)}return function(...t){return function(e){if(_.isEmpty(t))return!1;for(let i of t)if(i(e))return!0;return!1}}(...e)}if(_.isPlainObject(s))return s.$Nil?e(s.$Nil):s.$NotNil?function(t){if(!t)return t=>!Ti.Util.isNil(t);return e=>{let i=_.get(e,t);return!Ti.Util.isNil(i)}}(s.$NotNil):s.$Null?function(t){if(!t)return t=>_.isNull(t);return e=>{let i=_.get(e,t);return _.isNull(i)}}(s.$Null):s.$Undefined?function(t){if(!t)return t=>_.isUndefined(t);return e=>{let i=_.get(e,t);return _.isUndefined(i)}}(s.$Undefined):function(e){let s=[];return _.forEach(e,(e,n)=>{let r=n.startsWith("!"),a=t(e);r&&(n=n.substring(1).trim(),a=i(a)),s.push({key:n,m:a})}),function(t){if(!t||!_.isPlainObject(t))return!1;for(let e of s){let i=e.key,s=_.get(t,i);if(!(0,e.m)(s))return!1}return!0}}(s);if(_.isString(s))return function(t){if(Ti.Util.isNil(t))return e();if(""==t)return function(t){return _.isEmpty(t)};let s=t=>t;t.startsWith("!")&&(s=(t=>i(t)),t=t.substring(1).trim());if(Ti.S.isBlank(t)||"[BLANK]"==t)return s(function(t){return Ti.Util.isNil(t)||Ti.S.isBlank(t)});let n=/^([(\[])([^\]]+)([)\]])$/.exec(t);if(n)return s(function(t){let e=t;_.isString(t)&&(e=/^([(\[])([^\]]+)([)\]])$/.exec(t));if(!e)return function(){return!1};let i=_.trim(e[2]).split(/[,:;~]/g),s={val:_.trim(_.first(i)),open:"("==e[1]},n={val:i.length>1?_.trim(_.last(i)):NaN,open:")"==e[3]};_.isString(s.val)&&s.val?s.val*=1:s.val=NaN;_.isString(n.val)&&n.val?n.val*=1:n.val=NaN;return function(t){let e=1*t;if(isNaN(e))return!1;if(!isNaN(s.val)){if(s.open&&e<=s.val)return!1;if(e<s.val)return!1}if(!isNaN(n.val)){if(n.open&&e>=n.val)return!1;if(e>n.val)return!1}return!0}}(n));if(/^!?\^/.test(t))return s(function(t){let e=!1;t.startsWith("!")&&(e=!0,t=t.substring(1).trim());let i=new RegExp(t);return function(t){return Ti.Util.isNil(t)?e:i.test(t)?!e:e}}(t));if(/\*/.test(t))return s(function(t){let e=!1;t.startsWith("!")&&(e=!0,t=t.substring(1).trim());let i="^"+t.replaceAll("*",".*")+"$",s=new RegExp(i);return function(t){return Ti.Util.isNil(t)?e:s.test(t)?!e:e}}(t));return s(function(t){let e=!1;t.startsWith("~~")&&(e=!0,t=t.substring(2).toUpperCase());return function(i){return Ti.Util.isNil(i)?Ti.Util.isNil(t):e?t==i.toUpperCase():t==i}}(t))}(s);if(_.isRegExp(s))return function(t){return s.test(t)};throw Ti.Err.make("e.match.unsupport",s)}function e(t){return t?e=>{let i=_.get(e,t);return Ti.Util.isNil(i)}:t=>Ti.Util.isNil(t)}function i(t){return function(e){return!t(e)}}return{AutoMatch:{parse:e=>_.isFunction(e)?e:t(e),test:(e,i)=>_.isFunction(e)?e(i):t(e)(i)}}}(),{DateTime:DateTime}=function(){const t=["sun","mon","tue","wed","thu","fri","sat"],e=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],i={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6,sunday:0,monday:1,tuesday:2,wednesday:3,thursday:4,friday:5,saturday:6},s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=new RegExp("^((\\d{4})([/\\\\-])?(\\d{1,2})?([/\\\\-])?(\\d{1,2})?)?(([ T])?(\\d{1,2})(:)(\\d{1,2})((:)(\\d{1,2}))?((.)(\\d{1,3}))?)?(([+-])(\\d{1,2})(:\\d{1,2})?)?(Z(\\d*))?$"),r={parseTime:(t,e)=>Ti.Types.toTime(t,e),parse(t){if(_.isUndefined(t)||"today"===t||"now"===t)return new Date;if(!t||_.isArray(t)&&_.isEmpty(t))return null;if(_.isDate(t))return new Date(t);if(_.isNumber(t))return new Date(t);if(_.isString(t)){let e=t;if(/\d{13,}/.test(e))return new Date(1*e);let i=n.exec(t);if(i){let t=(t,e,i)=>{let s=t[e];return s?parseInt(s):i},e=new Date,s=t(i,2,e.getFullYear()),n=t(i,4,i[2]?1:e.getMonth()+1),r=t(i,6,i[2]?1:e.getDate()),a=t(i,9,0),o=t(i,11,0),l=t(i,14,0),h=t(i,17,0),c=[_.padStart(s,4,"0"),"-",_.padStart(n,2,"0"),"-",_.padStart(r,2,"0"),"T",_.padStart(a,2,"0"),":",_.padStart(o,2,"0"),":",_.padStart(l,2,"0"),".",_.padStart(h,3,"0")];i[18]&&c.push(i[18]);let u=c.join("");return new Date(u)}}throw"i18n:invalid-date"},format(i,n="yyyy-MM-dd HH:mm:ss"){if(_.isArray(i)){let t=[];for(let e of i)t.push(r.format(e,n));return t}if(_.isDate(i)||(i=r.parse(i)),!i)return null;let a,o=i.getFullYear(),l=i.getMonth()+1,h=i.getDate(),c=i.getHours(),u=i.getMinutes(),d=i.getSeconds(),m=i.getMilliseconds(),p=s[i.getMonth()],f=Ti.I18n.get(`cal.abbr.${p}`),g=Ti.I18n.get(p),y=i.getDay(),T=_.upperFirst(t[y]),v=_.upperFirst(e[y]),b=Ti.I18n.get(T),w=Ti.I18n.get(v),x={yyyy:o,M:l,d:h,H:c,m:u,s:d,S:m,yyy:o,yy:(""+o).substring(2,4),MM:_.padStart(l,2,"0"),dd:_.padStart(h,2,"0"),HH:_.padStart(c,2,"0"),mm:_.padStart(u,2,"0"),ss:_.padStart(d,2,"0"),SS:_.padStart(m,3,"0"),SSS:_.padStart(m,3,"0"),E:b,EE:b,EEE:b,EEEE:w,MMM:f,MMMM:g},S=/(y{2,4}|M{1,4}|dd?|HH?|mm?|ss?|S{1,3}|E{1,4}|'([^']+)')/g,C=[],k=0;for(;a=S.exec(n);){k<a.index&&C.push(n.substring(k,a.index));let t=Ti.Util.fallback(a[2],x[a[1]],a[1]);C.push(t),k=S.lastIndex}return k<n.length&&C.push(n.substring(k)),C.join("")},getWeekDayAbbr(e){let i=_.clamp(e,0,t.length-1);return t[i]},getWeekDayName(t){let i=_.clamp(t,0,e.length-1);return e[i]},getWeekDayValue(t,e=-1){let s=_.trim(_.lowerCase(t)),n=i[s];return _.isNumber(n)?n:e},getMonthAbbr(t){let e=_.clamp(t,0,11);return s[e]},setTime:(t,e=0,i=0,s=0,n=0)=>(_.inRange(e,0,24)&&t.setHours(e),_.inRange(i,0,60)&&t.setMinutes(i),_.inRange(s,0,60)&&t.setSeconds(s),_.inRange(n,0,1e3)&&t.setMilliseconds(n),t),setDayLastTime:t=>r.setTime(t,23,59,59,999),today(){let t=new Date;return r.setTime(t),t},todayInMs:()=>r.today().getTime(),moveYear:(t,e=0)=>(_.isDate(t)&&t.setFullYear(t.getFullYear+e),t),moveMonth:(t,e=0)=>(_.isDate(t)&&t.setMonth(t.getMonth()+e),t),moveDate:(t,e=0)=>(_.isDate(t)&&t.setDate(t.getDate()+e),t),createDate(t,e=0){if(_.isDate(t)){let i=new Date(t);return i.setDate(i.getDate()+e),i}},rangeStr({date:t,time:e="3h"}={},i="[${from},${to}]"){let s={from:`${t=t||"now"}-${e}`,to:t};return Ti.S.renderBy(i,s)},rangeFrom({from:t,to:e}={},i="[${from},${to}]"){let s=[];t&&(s[0]=r.parse(t).getTime()),e&&(s[1]=r.parse(e).getTime()),0==s.length&&(s[1]=Date.now()),s[0]||(s[0]=s[1]-864e5),s[1]||(s[1]=s[0]+864e5);let[n,a]=s;s[0]=Math.min(n,a),s[1]=Math.max(n,a);let o={from:s[0],to:s[1]};return Ti.S.renderBy(i,o)},toBoolStr(t,e=6e4,i="No",s="Yes"){let n=0;t&&(n=r.parse(t).getTime());return Date.now()-n>e?i:s},timeText(t,{justNow:e=10,i18n:i=Ti.I18n.get("time")}={}){let s=(t=r.parse(t)).getTime(),n=Date.now()-s,a=n>0?"past-":"future-";n=Math.abs(n);let o=Math.round(n/6e4);if(o<e)return i[`${a}in-min`];if(o<60)return Ti.S.renderBy(i[`${a}in-hour`],{min:o});let l=Math.round(n/36e5);if(l<24)return Ti.S.renderBy(i[`${a}in-day`],{min:o,hour:l});let h=Math.round(l/24);if(h<7)return Ti.S.renderBy(i[`${a}in-week`],{min:o,hour:l,day:h});return t.getFullYear()==(new Date).getFullYear()?r.format(t,i["in-year"]):r.format(t,i["any-time"])}};return{DateTime:r}}(),{Types:Types}=function(){class TiTime{constructor(t,e){this.hours=0,this.minutes=0,this.seconds=0,this.milliseconds=0,this.__cached={},this.update(t,e)}clone(){return new TiTime(this)}setHours(t=0){this.__cached={},this.hours=_.clamp(t,0,23)}setMinutes(t=0){this.__cached={},this.minutes=_.clamp(t,0,59)}setSeconds(t=0){this.__cached={},this.seconds=_.clamp(t,0,59)}setMilliseconds(t=1){this.__cached={},this.milliseconds=_.clamp(t,0,999)}setTimes({hours:t,minutes:e,seconds:i,milliseconds:s}={}){this.__cached={},this.hours=_.clamp(Ti.Util.fallback(t,this.hours),0,23),this.minutes=_.clamp(Ti.Util.fallback(e,this.minutes),0,59),this.seconds=_.clamp(Ti.Util.fallback(i,this.seconds),0,59),this.milliseconds=_.clamp(Ti.Util.fallback(s,this.milliseconds),0,999)}update(t,e="ms"){if(this.__cached={},_.isDate(t))this.hours=t.getHours(),this.minutes=t.getMinutes(),this.seconds=t.getSeconds(),this.milliseconds=t.getMilliseconds();else if(t instanceof TiTime)this.hours=t.hours,this.minutes=t.minutes,this.seconds=t.seconds,this.milliseconds=t.milliseconds;else if(_.isNumber(t)){let i={ms:t=>Math.round(t),s:t=>Math.round(1e3*t),min:t=>Math.round(1e3*t*60),hr:t=>Math.round(1e3*t*60*60)}[e](t);i=_.clamp(i,0,864e5);let s=parseInt(i/1e3);this.milliseconds=i-1e3*s,this.hours=parseInt(s/3600),s-=3600*this.hours,this.minutes=parseInt(s/60),this.seconds=s-60*this.minutes}else if(_.isString(t)){let e=/^PT((\d+)H)?((\d+)M)?((\d+)S)?$/.exec(t);if(e)return this.hours=e[2]?1*e[2]:0,this.minutes=e[4]?1*e[4]:0,this.seconds=e[6]?1*e[6]:0,this.milliseconds=0,this;(e=/^([0-9]{1,2}):?([0-9]{1,2})(:?([0-9]{1,2})([.,]([0-9]{1,3}))?)?$/.exec(t))&&(e[3]?e[5]?(this.hours=_.clamp(parseInt(e[1]),0,23),this.minutes=_.clamp(parseInt(e[2]),0,59),this.seconds=_.clamp(parseInt(e[4]),0,59),this.milliseconds=_.clamp(parseInt(e[6]),0,999)):(this.hours=_.clamp(parseInt(e[1]),0,23),this.minutes=_.clamp(parseInt(e[2]),0,59),this.seconds=_.clamp(parseInt(e[4]),0,59),this.milliseconds=0):(this.hours=_.clamp(parseInt(e[1]),0,23),this.minutes=_.clamp(parseInt(e[2]),0,59),this.seconds=0,this.milliseconds=0))}return this}get value(){if(!_.isNumber(this.__cached.value)){let t=3600*this.hours+60*this.minutes+this.seconds+Math.round(this.milliseconds/1e3);this.__cached.value=t}return this.__cached.value}get valueInMilliseconds(){if(!_.isNumber(this.__cached.valueInMilliseconds)){let t=36e5*this.hours+6e4*this.minutes+1e3*this.seconds+this.milliseconds;this.__cached.valueInMilliseconds=t}return this.__cached.valueInMilliseconds}toString(t="auto"){"auto"==t?t=this.milliseconds>0?"HH:mm:ss.SSS":this.seconds>0?"HH:mm:ss":"HH:mm":"min"==t&&(t=this.hours<=0?"mm:ss":"HH:mm:ss");let e,i="",s=/a|HH?|KK?|hh?|kk?|mm?|ss?|S(SS)?/g,n=0;for(;e=s.exec(t);){let r=e.index;r>n&&(i+=t.substring(n,r)),n=s.lastIndex;i+={a:()=>this.value>43200?"PM":"AM",H:()=>this.hours,k:()=>this.hours+1,K:()=>this.hours%12,h:()=>this.hours%12+1,m:()=>this.minutes,s:()=>this.seconds,S:()=>this.milliseconds,HH:()=>_.padStart(this.hours,2,"0"),kk:()=>_.padStart(this.hours+1,2,"0"),KK:()=>_.padStart(this.hours%12,2,"0"),hh:()=>_.padStart(this.hours%12+1,2,"0"),mm:()=>_.padStart(this.minutes,2,"0"),ss:()=>_.padStart(this.seconds,2,"0"),SSS:()=>_.padStart(this.milliseconds,3,"0")}[e[0]]()}return n<t.length&&(i+=t.substring(n)),i}}const QUICK_COLOR_TABLE={red:[255,0,0,1],green:[0,255,0,1],blue:[0,0,255,1],yellow:[255,255,0,1],black:[0,0,0,1],white:[255,255,255,1]};class TiColor{constructor(t){this.red=0,this.green=0,this.blue=0,this.alpha=1,this.__cached={},this.update(t)}clone(){return new TiColor([this.red,this.green,this.blue,this.alpha])}setRGBA({r:t,g:e,b:i,a:s}={}){this.__cached={},_.isNumber(t)&&(this.red=_.clamp(t,0,255)),_.isNumber(e)&&(this.green=_.clamp(e,0,255)),_.isNumber(i)&&(this.blue=_.clamp(i,0,255)),_.isNumber(s)&&(this.alpha=_.clamp(s,0,1))}update(t){if(this.__cached={},_.isString(t)){let e=QUICK_COLOR_TABLE[t.toLowerCase()];if(e)this.red=e[0],this.green=e[1],this.blue=e[2],this.alpha=e[3];else{let e,i=t.replace(/[ \t\r\n]+/g,"").toUpperCase();(e=/^#?([0-9A-F])([0-9A-F])([0-9A-F]);?$/.exec(i))?(this.red=parseInt(e[1]+e[1],16),this.green=parseInt(e[2]+e[2],16),this.blue=parseInt(e[3]+e[3],16)):(e=/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2});?$/.exec(i))?(this.red=parseInt(e[1],16),this.green=parseInt(e[2],16),this.blue=parseInt(e[3],16)):(e=/^RGB\((\d+),(\d+),(\d+)\)$/.exec(i))?(this.red=parseInt(e[1],10),this.green=parseInt(e[2],10),this.blue=parseInt(e[3],10)):(e=/^RGBA\((\d+),(\d+),(\d+),([\d.]+)\)$/.exec(i))?(this.red=parseInt(e[1],10),this.green=parseInt(e[2],10),this.blue=parseInt(e[3],10),this.alpha=1*e[4]):(e=/^0[xX]([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2});?$/.exec(i))&&(this.alpha=parseInt(e[1],16)/255,this.red=parseInt(e[2],16),this.green=parseInt(e[3],16),this.blue=parseInt(e[4],16))}}else if(_.isNumber(t)){let e=_.clamp(Math.round(t),0,255);this.red=e,this.green=e,this.blue=e,this.alpha=1}else _.isArray(t)&&t.length>=3?(this.red=_.clamp(Math.round(t[0]),0,255),this.green=_.clamp(Math.round(t[1]),0,255),this.blue=_.clamp(Math.round(t[2]),0,255),this.alpha=t.length>3?t[3]:1):t instanceof TiColor&&(this.red=t.red,this.green=t.green,this.blue=t.blue,this.alpha=t.alpha);return this}get hex(){if(!this.__cached.hex){let t=["#"];t.push(_.padStart(this.red.toString(16).toUpperCase(),2,"0")),t.push(_.padStart(this.green.toString(16).toUpperCase(),2,"0")),t.push(_.padStart(this.blue.toString(16).toUpperCase(),2,"0")),this.__cached.hex=t.join("")}return this.__cached.hex}get rgb(){if(!this.__cached.rgb){let t=[this.red,this.green,this.blue];this.__cached.rgb=`RGB(${t.join(",")})`}return this.__cached.rgb}get rgba(){if(!this.__cached.rgba){return`RGBA(${[this.red,this.green,this.blue,this.alpha].join(",")})`}return this.__cached.rgba}light(t=10){this.red=_.clamp(this.red+t,0,255),this.green=_.clamp(this.green+t,0,255),this.blue=_.clamp(this.blue+t,0,255)}dark(t=10){this.red=_.clamp(this.red-t,0,255),this.green=_.clamp(this.green-t,0,255),this.blue=_.clamp(this.blue-t,0,255)}between(t,e=.5,{}={}){e=_.clamp(e,0,1);let i=t.red-this.red,s=t.green-this.green,n=t.blue-this.blue,r=t.alpha-this.alpha,a=this.red+i*e,o=this.green+s*e,l=this.blue+n*e,h=this.alpha+r*e;return new TiColor([_.clamp(Math.round(a),0,255),_.clamp(Math.round(o),0,255),_.clamp(Math.round(l),0,255),_.clamp(h,0,1)])}adjustByHSL({h:t=0,s:e=0,l:i=0}={}){let s=this.toHSL();return s.h=_.clamp(s.h+t,0,1),s.s=_.clamp(s.s+e,0,1),s.l=_.clamp(s.l+i,0,1),this.fromHSL(s)}toHSL(){let t=this.red,e=this.green,i=this.blue;t/=255,e/=255,i/=255;let s,n,r=Math.max(t,e,i),a=Math.min(t,e,i),o=(r+a)/2;if(r===a)s=n=0;else{var l=r-a;switch(n=o>.5?l/(2-r-a):l/(r+a),r){case t:s=(e-i)/l+(e<i?6:0);break;case e:s=(i-t)/l+2;break;case i:s=(t-e)/l+4}s/=6}return{h:s,s:n,l:o}}fromHSL({h:t,s:e,l:i}={}){let s,n,r,a=function(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t};if(0===e)s=n=r=i;else{let o=i<.5?i*(1+e):i+e-i*e,l=2*i-o;s=a(l,o,t+1/3),n=a(l,o,t),r=a(l,o,t-1/3)}return this.red=Math.round(255*s),this.green=Math.round(255*n),this.blue=Math.round(255*r),this}toString(){return 1==this.alpha?this.hex:this.rgba}}const TiTypes={toStr(t,e,i){if(_.isFunction(e))return e(t)||i;if(Ti.Util.isNil(t))return Ti.Util.fallback(i,null);if(_.isNumber(t)){if(_.isArray(e))return Ti.Util.fallback(_.nth(e,t),t);if(_.isString(e))return Ti.S.renderVars(t,e);let i=""+t;return _.isPlainObject(e)?e[i]:i}if(_.isString(t))return _.isPlainObject(e)?Ti.Util.getOrPick(e,t):_.isString(e)?Ti.S.renderVars(t,e):t;if(_.isArray(t))return t.join(e||",");if(_.isBoolean(t))return(e||["false","true"])[1*t];if(_.isDate(t))return TiTypes.formatDateTime(t,e);if(t instanceof TiTime)return t.toString(e);if(t instanceof TiColor)return t.toString();if(_.isPlainObject(t)){if(!Ti.S.isBlank(e)){if(_.isString(e))return Ti.S.renderVars(t,e);_.isPlainObject(e)&&(t=Ti.Util.translate(t,e))}return JSON.stringify(t,null,e)}return""+t},toNumber(t){if(_.isBoolean(t))return t?1:0;if(_.isDate(t))return t.getTime();if(Ti.S.isBlank(t))return NaN;let e=1*t;return isNaN(e)?NaN:e},toInteger(t,{mode:e="int",dft:i=NaN,range:s=[],border:n=[!0,!0]}={}){if(_.isBoolean(t))return t?1:0;if(_.isDate(t))return t.getTime();let r={round:t=>Math.round(t),ceil:t=>Math.ceil(t),floor:t=>Math.floor(t),int:t=>parseInt(t)}[e](t);if(isNaN(r)&&(r=i),_.isArray(s)&&2==s.length){_.isArray(n)||(n=[n,n]);let[t,e]=n,[i,a]=s;if(isNaN(r))return Math.round((i+a)/2);if(!_.isNull(i)){if(t&&r<i)return i;if(!t&&r<=i)return i+1}if(!_.isNull(a)){if(e&&r>a)return a;if(!e&&r>=a)return a-1}}return r},toFloat(t,{precision:e=2,dft:i=NaN}={}){if(Ti.Util.isNil(t))return i;let s=1*t;if(isNaN(s))return i;if(e>=0){let t=Math.pow(10,e);return Math.round(s*t)/t}return s},toPercent:(t,{fixed:e=2,auto:i=!0}={})=>Ti.S.toPercent(t,{fixed:e,auto:i}),toBoolean:t=>0!=t&&(!_.isNull(t)&&!_.isUndefined(t)&&!/^(no|off|false)$/i.test(t)),toBoolStr:(t,e="No",i="Yes")=>t?i:e,toObject(t,e){let i=t;return _.isPlainObject(t)&&_.isPlainObject(e)?Ti.Util.translate(i,e):_.isArray(t)?Ti.S.toObject(t,e):_.isString(t)?((/^\{.*\}$/.test(t)||/^\[.*\]$/.test(t))&&(i=JSON.parse(t)),Ti.S.toObject(t,e)):i},toObjByPair(t={},{nameBy:e="name",valueBy:i="value",dft:s={}}={}){let n=t[e],r=t[i],a=_.assign({},s);if(_.isString(n))a[n]=r;else if(_.isArray(n))for(let t of n)a[t]=r[t];return a},toArray(t,{sep:e=/[ ,;\/、，；\r\n]+/}={}){if(Ti.Util.isNil(t))return t;if(_.isArray(t))return t;if(_.isString(t)){if(_.isRegExp(e)){let i=t.split(e);for(let t=0;t<i.length;t++)i[t]=_.trim(i[t]);return _.without(i,void 0,null,"")}return[t]}},toDate(t,e=null){if(_.isNull(t)||_.isUndefined(t))return e;if(_.isArray(t)){let e=[];return _.forEach(t,t=>{e.push(Ti.DateTime.parse(t))}),e}return Ti.DateTime.parse(t)},toDateSec(t,e=null){if(_.isNull(t)||_.isUndefined(t))return e;if(_.isArray(t)){let e=[];return _.forEach(t,t=>{_.isNumber(t)&&(t*=1e3),e.push(Ti.DateTime.parse(t))}),e}return _.isNumber(t)&&(t*=1e3),Ti.DateTime.parse(t)},toTime:(t,{dft:e,unit:i}={})=>_.isNull(t)||_.isUndefined(t)?e:new TiTime(t,i),toColor:(t,e=new TiColor)=>_.isNull(t)||_.isUndefined(t)?e:t instanceof TiColor?t:new TiColor(t),toAMS(t){let e=Ti.DateTime.parse(t);return _.isDate(e)?e.getTime():null},toSec(t){let e=TiTypes.toDateSec(t);return _.isDate(e)?Math.round(e.getTime()/1e3):null},toJson:(t,e="  ")=>JSON.stringify(t,null,e),toFilter(t={},e={}){let i={},{keyword:s,match:n,majorKey:r,majorValue:a}=t||{},o=e.keyword||{"=id":"^[\\d\\w]{26}(:.+)?$","=nm":"^[\\d\\w_.-]{3,}$",title:"^.+"};if(s){let t="title",e=_.keys(o);for(let i of e){let e=o[i];if(new RegExp(e).test(s)){t=i;break}}t.startsWith("=")?i[t.substring(1).trim()]=s:i[t]="^.*"+s}return _.isEmpty(n)||_.assign(i,n),r&&!Ti.Util.isNil(a)&&_.set(i,r,a),i},safeParseJson(str,dft){if(Ti.Util.isNil(str))return null;if(!_.isString(str))return str;try{return JSON.parse(str)}catch(E){let json=str.replace(/(function|=>)/g,"Function");try{return eval("("+json+")")}catch(t){}}return dft},formatTime(t,e="ms",i="auto"){if(_.isUndefined(t)||_.isNull(t))return"";if(_.isArray(t)){let e=[];for(let s of t)e.push(TiTypes.formatTime(s,i));return e}return t instanceof TiTime||(t=new TiTime(t,e)),t.toString(i)},formatDate:(t,e="yyyy-MM-dd")=>Ti.DateTime.format(t,e),formatDateTime:(t,e="yyyy-MM-dd HH:mm:ss")=>Ti.DateTime.format(t,e),toAjaxReturn(t,e){let i=t;if(_.isString(t))try{i=JSON.parse(t)}catch(t){return{ok:!1,errCode:"e.invalid.json_format",data:e}}return _.isBoolean(i.ok)?i:{ok:!0,data:i}},Time:TiTime,Color:TiColor,getFuncByType:(t="String",e="transformer")=>_.get({String:{transformer:"toStr",serializer:"toStr"},Number:{transformer:"toNumber",serializer:"toNumber"},Integer:{transformer:"toInteger",serializer:"toInteger"},Float:{transformer:"toFloat",serializer:"toFloat"},Boolean:{transformer:"toBoolean",serializer:"toBoolean"},Object:{transformer:"toObject",serializer:"toObject"},Array:{transformer:"toArray",serializer:"toArray"},DateTime:{transformer:"toDate",serializer:"formatDateTime"},AMS:{transformer:"toDate",serializer:"toAMS"},ASEC:{transformer:"toDateSec",serializer:"toSec"},Time:{transformer:"toTime",serializer:"formatTime"},Date:{transformer:"toDate",serializer:"formatDate"},Color:{transformer:"toColor",serializer:"toStr"}},`${t}.${e}`),getFuncBy(t={},e,i=TiTypes){let s=TiTypes.evalFunc(t[e],i);if(_.isFunction(s))return s;if(!s&&t.type&&(s=TiTypes.getFuncByType(t.type,e)),_.isString(s))return _.get(i,s);if(_.isPlainObject(s)&&s.name){let t=_.get(i,s.name);if(!_.isFunction(t))return;return _.isArray(s.args)&&s.args.length>0?_.partialRight(t,...s.args):_.isUndefined(s.args)||_.isNull(s.args)?t:_.partialRight(t,s.args)}},getFunc:(t={},e)=>TiTypes.getFuncBy(t,e),evalFunc(t,e=TiTypes){if(_.isFunction(t))return t;if(_.isString(t))return _.get(e,t);if(_.isPlainObject(t)&&t.name){let i=_.get(e,t.name);if(!_.isFunction(i))return;return _.isArray(t.args)&&t.args.length>0?_.partialRight(i,...t.args):_.isUndefined(t.args)||_.isNull(t.args)?i:_.partialRight(i,t.args)}},getJsType:(t,e="Object")=>_.isUndefined(t)?e:_.isNull(t)?"Object":_.isNaN(t)?"Number":_.isNumber(t)?parseInt(t)==t?"Integer":"Number":_.isBoolean(t)?"Boolean":_.isString(t)?"String":_.isArray(t)?"Array":"Object",parseTowStageID(t,e=":"){if(!_.isString(t))return{};let i=t.indexOf(e);return i<0?{homeId:null,myId:_.trim(t)}:{homeId:_.trim(t.substring(0,i)),myId:_.trim(t.substring(i+1))}}};return{TiTime:TiTime,TiColor:TiColor,Types:TiTypes}}(),{Util:Util}=function(){const t={...function(){const t={getLinkName(e){let i=e.lastIndexOf("/"),s=e.lastIndexOf(":"),n=Math.max(i,s),r=n>=0?e.substring(n+1):e;return t.getMajorName(r)},getFileName(t,e=""){if(!t)return e;for(;t.endsWith("/");)t=t.substring(0,t.length-1);let i=t.lastIndexOf("/");return i>=0?t.substring(i+1):t},getMajorName(t,e=""){if(!t)return e;for(;t.endsWith("/");)t=t.substring(0,t.length-1);for(var i=t.length,s=0,n=i,r=n-1;r>0;r--)if(n==i&&"."==t[r]&&(n=r),"/"==t[r]||"\\"==t[r]){s=r+1;break}return t.substring(s,n)},getSuffixName(t,e){if(!t)return"";var i=t.lastIndexOf("."),s=t.lastIndexOf("/");if(-1==i||i<s)return"";var n=t.substring(i+1);return e?n.toLowerCase():n},getSuffix(t,e){if(!t)return"";var i=t.lastIndexOf("."),s=t.lastIndexOf("/");if(-1==i||i<s)return"";var n=t.substring(i);return e?n.toLowerCase():n},splitPathToFullAncestorList(t){if(!t)return[];let e=[],i=0,s=0;for(;(s=t.indexOf("/",s))>1;)e.push(t.substring(0,s)),i=++s;return i<t.length&&e.push(t),e},appendPath(...t){let e=[];for(let i of t){if(_.isEmpty(i))continue;let t=/\/*$/.exec(i);t&&(i=i.substring(0,t.index)),e.length>0&&!/^\//.test(i)&&e.push("/"),e.push(i)}return e.join("")},getParentPath(t=""){if(!t)return t;for(;t.endsWith("/");)t=t.substring(0,t.length-1);let e=t.lastIndexOf("/");return e<0?"":t.substring(0,e+1)},getRelativePath(t="",e="",i="."){if(_.isEqual(t,e))return i;let s=t.endsWith("/"),n=e.endsWith("/"),r=_.without(t.split("/"),""),a=_.without(e.split("/"),""),o=Math.min(r.length,a.length),l=0;for(;l<o;l++){if(r[l]!=a[l])break}let h=[],c=r.length;s||c--;for(let t=l;t<c;t++)h.push("..");for(let t=l;t<a.length;t++)h.push(a[t]);return n&&h.push(""),h.join("/")},explainEventName(t){let e={},i=/^(([^>]+)>)?(.+)$/.exec(t);return i&&(e.block=_.trim(i[2]),e.event=_.trim(i[3])),e},parseHref(t=""){let e=/^((https?):)?((\/\/([^/:]+))(:(\d+))?)?([^?#]*)(\?([^#]*))?(#(.*))?$/.exec(t);if(e){let i={href:t,protocol:e[2],host:e[5],port:1*(e[7]||80),path:e[8],search:e[9],query:e[10],hash:e[11],anchor:e[12],toString(){let t=`${this.protocol}://${this.host}${this.path}`;if(!_.isEmpty(this.params)){let e=[];_.forEach(this.params,(t,i)=>{e.push(`${i}=${t}`)}),t+="?"+e.join("&")}return this.hash&&(t+=this.hash),t}};if(i.query){let t={},e=i.query.split("&");for(let i of e){let e=i.indexOf("=");if(e>0){let s=i.substring(0,e),n=i.substring(e+1);t[s]=decodeURIComponent(n)}else t[i]=!0}i.params=t}return i}return{path:t}}};return t}(),...function(){class t{constructor({url:t,params:e,anchor:i}={}){this.__S=null,this.set({url:t,params:e,anchor:i})}set({url:t="",params:e={},anchor:i}={}){return this.url=t,this.params=e,this.anchor=i,this.__S=null,this}valueOf(){return this.toString()}toString(){if(!this.__S){let t=[this.url],e=[];_.forEach(this.params,(t,i)=>{e.push(`${i}=${t}`)}),e.length>0&&t.push(e.join("&"));let i=t.join("?");this.anchor&&(/^#/.test(this.anchor)?i+=this.anchor:i+="#"+this.anchor),this.__S=i}return this.__S}}return{Link:({url:e,params:i,anchor:s}={})=>new t({url:e,params:i,anchor:s})}}(),merge:(e={},...i)=>t.mergeWith(void 0,e,...i),mergeWith(e=_.identity,i={},...s){const n=_.flattenDeep(s);for(let s of n){if(!s)continue;let n=e(s);_.isArray(n)?t.merge(i,...n):_.isFunction(n)?i[n.name]=n:_.isPlainObject(n)&&_.merge(i,n)}return i},deepMergeObj:(t={},...e)=>_.mergeWith(t,...e,(t,e)=>{if(_.isArray(t)||_.isArray(e))return e}),grouping(t=[],e,{titles:i=[],otherTitle:s={value:"Others",text:"Others"},asList:n=!1}={}){let r={},a=[];_.forEach(i,t=>{t.text&&!Ti.Util.isNil(t.value)&&(a[t.value]=t)});let o=[];return _.forEach(t,t=>{let i=_.get(t,e);if(i){let e=a[i]||{text:i,value:i},s=r[i];s||(s={...e,list:[]},r[i]=s),s.list.push(t)}else o.push(t)}),_.isEmpty(o)||(r[s.value]={...s,list:o}),n?_.values(r):r},insertToArray(t=[],e=-1,...i){if(!_.isArray(t)||_.isEmpty(i))return-1;if(_.isEmpty(t))return t.push(...i),0;let s=Ti.Num.scrollIndex(e,t.length+1);return t.length==s?t.push(...i):t.splice(s,0,...i),s},appendToObject(t={},e=null,i={}){let s={};return Ti.Util.isNil(e)?_.assign(s,t,i):_.forEach(t,(t,n)=>{s[n]=t,e==n&&_.assign(s,i)}),s},walk(t={},{root:e=_.identity,all:i=_.identity,leaf:s=_.identity,node:n=_.identity}={}){const r=(t,a=[])=>{let o=_.isArray(t),l=_.isPlainObject(t);if(i(t,a),o||l?_.isEmpty(a)?e(t,a):n(t,a):s(t,a),o)for(let e=0;e<t.length;e++){let i=t[e],s=a.concat(e);r(i,s)}else if(l){let e=_.keys(t);for(let i of e){let e=t[i],s=a.concat(i);r(e,s)}}};r(t)},inset(t=[],e=_.identity){let i=[];for(let s of t){let t=e(s);if(_.isArray(t)&&!_.isEmpty(t))for(let e of t)i.push(e);_.isUndefined(t)||i.push(t)}return i},explainObj(t={},e,{evalFunc:i=!1,iteratee:s=_.identity}={}){const n=e=>{if(Ti.Util.isNil(e))return e;let r=e;if(_.isString(r)){let e=/^:(:*(=|==|!=|=>>?|->)(.+))$/.exec(r);if(e)return s(e[1]);let i,n,a;if((e=/^(==>|=>>?|->)(.+)$/.exec(r))?(i=e[1],n=_.trim(e[2])):(e=/^(==?|!=)([^?]+)(\?(.*))?$/.exec(r))&&(i=e[1],n=_.trim(e[2]),a=e[4],/^=/.test(a)||"=="==i?a=Ti.S.toJsValue(a):a&&(a=_.trim(a))),i){let e={"==>":t=>{let e=_.get(window,t);if(_.isFunction(e))return e},"==":e=>{let i=_.get(t,e);return Ti.Util.isNil(i)?Ti.Util.fallbackNil(a,!1):!!i},"!=":e=>{let i=_.get(t,e);return Ti.Util.isNil(i)?Ti.Util.fallback(a,!0):!i},"=":(e,i)=>{if(".."==e)return t;let s=Ti.Util.getOrPick(t,e);return Ti.Util.isBlank(s)&&!_.isUndefined(i)?i:s},"=>>":e=>{return Ti.Util.genInvoking(e,{context:t,partial:"right"})()},"=>":e=>{return Ti.Util.genInvoking(e,{context:t,partial:"left"})()},"->":e=>{let i=/^(([\w\d_.]+)\?\?)?(.+)$/.exec(e),s=i[2],n=i[3];if(!s||!Ti.Util.isNil(_.get(t,s)))return Ti.S.renderBy(n,t)}}[i];if(_.isFunction(e))return e(n,a);throw"invalid dynamic value: "+r}return s(r)}if(_.isFunction(r)){if(i){let e=r(t);return s(e)}return r}if(_.isArray(r)){let t=[];for(let e of r){let i=n(e);t.push(s(i))}return t}if(r.__invoke&&r.name){let{name:e,args:i}=r;i=Ti.Util.explainObj(t,i);let s=Ti.Util.genInvoking({name:e,args:i},{context:t});if(_.isFunction(s))return s()}else if(r.__function&&r.name){let{name:e,args:i}=r;i=Ti.Util.explainObj(t,i);let s=Ti.Util.genInvoking({name:e,args:i},{context:t});if(_.isFunction(s))return s}else if(_.isPlainObject(r)){let t={};return _.forEach(r,(e,i)=>{let r=n(e),a=s(r);"..."==i?_.isPlainObject(a)?_.assign(t,a):t[i]=a:/^\.{3,}$/.test(i)?t[i.substring(1)]=a:t[i]=a}),t}return s(e)};return n(e)},explainObjs(e=[],i={},s){if(_.isArray(e)){let n=[];for(let r of e){let e=t.explainObj(r,i,s);n.push(e)}return n}return t.explainObj(e,i,s)},genObj:(t={})=>_.partial(_.cloneDeep,t),groupCall(...t){const e=_.flattenDeep(t).filter(t=>_.isFunction(t));if(0!=e.length)return 1==e.length?e[0]:function(...t){for(let i of e)i.apply(this,t)}},pushValue(t,e,i,s=!1){let n=_.get(t,e)||[];s?t[e]=_.concat(n,i||[]):_.set(t,e,_.concat(n,i||[]))},pushValueBefore(t,e,i,s=!1){let n=_.get(t,e)||[];s?t[e]=_.concat(i||[],n):_.set(t,e,_.concat(i||[],n))},pushUniqValue(t,e,i,s=!1){let n=_.get(t,e)||[];s?t[e]=_.uniq(_.concat(n,i||[])):_.set(t,e,_.uniq(_.concat(n,i||[])))},pushUniqValueBefore(t,e,i,s=!1){let n=_.get(t,e)||[];s?t[e]=_.uniq(_.concat(i||[],n)):_.set(t,e,_.uniq(_.concat(i||[],n)))},setTo(t={},e,i,s){_.isString(e)&&!_.isUndefined(i)?t[e]=_.isNull(i)?s:i:_.isPlainObject(e)&&(s=i,_.forOwn(e,(e,i)=>{_.isUndefined(e)||(t[i]=_.isNull(e)?s:e)}))},nth(t=[],e=0,i=null){let s=t.length;if(s<=0)return i;return t[Ti.Num.scrollIndex(e,s)]},anyKey(e,i,s="-"){if(t.isNil(e))return e;let n=[];return i&&n.push(i),_.isArray(e)||_.isPlainObject(e)?(_.forEach(e,t=>n.push(t)),n.join("-")):(n.push(e),n.join(s))},reverMapping(t={}){let e={};return _.forEach(t,(t,i)=>{e[t]=i}),e},translate(e={},i={},s=_.identity){if(_.isEmpty(i))return _.cloneDeep(e);if(_.isArray(e)){let n=[];for(let r=0;r<e.length;r++){let a=e[r],o=t.translate(a,i,s);n.push(o)}return n}if(_.isString(i)){let t=i.split(/[:;]/g),e={};for(let i of t){i=_.trim(i);let t=/^([^=]+)=(.+)$/.exec(i);t&&(e[t[1]]=t[2])}i=e}if(_.isString(e))return _.get(i,e);let n={};return _.forEach(i,(i,r)=>{let a;a=".."==i?e:t.getOrPick(e,i),a=s(a),_.set(n,r,a)}),n},pureCloneDeep(e){if(_.isArray(e)){let i=[];return _.forEach(e,(e,s)=>{_.isUndefined(e)||_.isFunction(e)||(i[s]=t.pureCloneDeep(e))}),i}if(_.isPlainObject(e)){let i={};return _.forEach(e,(e,s)=>{_.isUndefined(e)||_.isFunction(e)||(i[s]=t.pureCloneDeep(e))}),i}return _.cloneDeep(e)},setKey(t={},e,i){const s=function(t,e=[],i=0,n){if(i>=e.length)return t;if(_.isArray(t)){let r=[],a=parseInt(e[i]);for(let o=0;o<t.length;o++)if(o==a){let a=s(t[o],e,i+1,n);r.push(a)}else r.push(t[o]);return r}if(_.isPlainObject(t)){let r={},a=_.keys(t);if(e.length==i+1){let s=e[i];for(let e of a){let i=t[e];s==e?r[n]=i:r[e]=i}}else for(let o of a){let a=t[o],l=s(a,e,i+1,n);r[o]=l}return r}return t};return _.isString(e)&&(e=e.split(".")),s(t,e,0,i)},getValue(e,...i){if(_.isArray(e)){let s=[];for(let n of e){let e=t.getValue(n,i);s.push(e)}return s}for(let t of i){let i=_.get(e,t);if(!_.isUndefined(i)&&!_.isNull(i))return i}},getValueAs(e,i,...s){if(_.isArray(i)){let n=[];for(let r of i){let i=t.getValueAs(e,r,s);n.push(i)}return n}for(let t of s){let s=_.get(i,t);if(!_.isUndefined(s)&&!_.isNull(s))return Ti.S.renderBy(e,{val:s})}return e},getOrPick(t,e,i){if(_.isArray(e))return Ti.Util.fallback(_.pick(t,e),i);if(_.isFunction(e))return Ti.Util.fallback(e(t),i);if(_.isString(e)){let s=e.split("|");if(s.length>1)return Ti.Util.fallback(Ti.Util.getFallbackNil(t,s),i)}return Ti.Util.fallback(_.get(t,e),i)},getOrPickNoBlank(t,e,i){if(_.isArray(e))return Ti.Util.fallback(_.pick(t,e),i);if(_.isFunction(e))return Ti.Util.fallback(e(t),i);if(_.isString(e)){let s=e.split("|");if(s.length>1)return Ti.Util.fallback(Ti.Util.getFallbackBlank(t,s),i)}return Ti.Util.fallback(_.get(t,e),i)},truthyKeys(t={}){let e=[];return _.forEach(t,(t,i)=>{t&&e.push(i)}),e},joinTruthyKeys:(e={},i=",")=>t.truthyKeys(e).join(i),getFallback(t,...e){let i=_.flattenDeep(e);for(let e of i)if(e){let i=_.get(t,e);if(!_.isUndefined(i))return i}},getFallbackNil(e,...i){let s=_.flattenDeep(i);for(let i of s)if(i){let s=_.get(e,i);if(!t.isNil(s))return s}},getFallbackEmpty(t,...e){let i=_.flattenDeep(e);for(let e of i)if(e){let i=_.get(t,e);if(!_.isEmpty(i))return i}},getFallbackBlank(t,...e){let i=_.flattenDeep(e);for(let e of i)if(e){let i=_.get(t,e);if(!Ti.Util.isBlank(i))return i}},getFallbackNaN(t,...e){let i=_.flattenDeep(e);for(let e of i)if(e){let i=_.get(t,e);if(!isNaN(i))return i}},fallback(...t){for(let e of t)if(!_.isUndefined(e))return e},fallbackNil(...e){for(let i of e)if(!t.isNil(i))return i},trueGet:(t=!1,e,i)=>_.isBoolean(t)?t?e:i:t,fallbackEmpty(...t){for(let e of t)if(!_.isEmpty(e))return e},fallbackBlank(...t){for(let e of t)if(!Ti.S.isBlank(e))return e},fallbackNaN(...t){for(let e of t)if(!isNaN(e))return e},notEmpty:t=>!_.isEmpty(t),notNil:t=>!Ti.Util.isNil(t),notEmptyOf(t,e){let i=_.get(t,e);return!_.isEmpty(i)},notNilOf(t,e){let i=_.get(t,e);return!Ti.Util.isNil(i)},isNil:t=>_.isUndefined(t)||_.isNull(t),isBlank:t=>_.isUndefined(t)||_.isNull(t)||""===t||/^[ \t]*$/.test(t),geset:(t={},e,i)=>_.isPlainObject(e)?(_.assign(t,e),t):_.isArray(e)?_.pick(t,e):_.isUndefined(i)?_.isUndefined(e)?t:t[e]:(t[e]=i,t),async invoke(t={},e,i=[],s=this){let n=_.get(t,e);if(_.isFunction(n)){let t=_.concat(i);await n.apply(s,t)}},first:(t=[])=>_.isArray(t)?_.first(t):t,last:(t=[])=>_.isArray(t)?_.last(t):t,genGetter(e,{indexPrefix:i,dftKeys:s=[],context:n={},funcSet:r=window,dftValue:a,notNil:o=!1,partial:l="right"}={}){if(_.isFunction(e))return t=>e(t);if(e){if(i)return(t,s)=>Ti.Util.fallbackNil(Ti.Types.toStr(_.get(t,e)),`${i}${s}`);let s=/^'(.+)'$/.exec(e);if(s)return()=>s[1];if(s=/^=>(.+)$/.exec(e)){let e=s[1];return t.genInvoking(e,{context:n,funcSet:r,partial:l})}return t=>Ti.Util.getOrPick(t,e)}return _.isEmpty(s)?!_.isUndefined(a)||o?t=>a:void 0:t=>Ti.Util.getFallback(t,...s)},genGetterNotNil:(t,e)=>Ti.Util.genGetter(t,_.assign({},e,{notNil:!0})),genInvoking(t,{context:e={},dft:i=(()=>t),funcSet:s=window,partial:n="left"}={}){if(_.isFunction(t))return t;let r,a;if(t.name&&!_.isUndefined(t.args))r=t.name,a=_.concat(t.args);else{let e=/^([^()]+)(\((.+)\))?$/.exec(t);e&&(r=_.trim(e[1]),a=_.trim(e[3]))}let o=_.get(s,r);if(_.isFunction(o)){let t=Ti.S.joinArgs(a,[],t=>_.isString(t)||_.isArray(t)?Ti.S.toJsValue(t,{context:e}):t);return _.isEmpty(t)?o:"right"==n?function(e){let i=_.concat([e],t);return o.apply(this,i)}:"right?"==n?function(e){let i=_.isUndefined(e)?t:_.concat([e],t);return o.apply(this,i)}:"left"==n?function(e){let i=_.concat(t,[e]);return o.apply(this,i)}:()=>o(...t)}return i},genItemMatcher:(t,e=!1)=>_.isFunction(t)?(e,i)=>t(e,i):_.isString(t)?e?(e,i)=>_.indexOf(Ti.Util.getOrPick(e,t),i)>=0:(e,i)=>_.isEqual(Ti.Util.getOrPick(e,t),i):_.isArray(t)?(i,s)=>{for(let n of t){let t=Ti.Util.getOrPick(i,n);if(e){if(_.indexOf(t,s)>=0)return!0}else if(_.isEqual(t,s))return!0}return!1}:(t,e)=>!1,genItemValueGetter:(t,e)=>_.isFunction(t)?i=>t(i,e):_.isString(t)?i=>Ti.Util.getOrPick(i,t,e):function(){return e},genRowIdGetter:(t,e=["id","value"])=>_.isFunction(t)?(e,i)=>{let s=t(e,i);return Ti.Types.toStr(s)}:_.isString(t)?(e,i)=>Ti.Util.fallbackNil(Ti.Types.toStr(_.get(e,t)),`Row-${i}`):_.isEmpty(e)?void 0:t=>Ti.Util.getFallback(t,...e),genRowDataGetter:t=>_.isFunction(t)?e=>t(e):_.isString(t)?e=>_.get(e,t):_.isObject(t)?e=>Ti.Util.translate(e,t):t=>t};return{Util:t}}(),{Trees:Trees}=function(){const t={path:(t=[])=>Ti.Util.isNil(t)?[]:_.isArray(t)?t:_.map(_.without(t.split("/"),""),t=>/^\d+$/.test(t)?1*t:t),walkDeep(t,e=(()=>({})),{idBy:i="id",nameBy:s="name",childrenBy:n="children"}={}){let r={index:0,id:_.get(t,i),name:_.get(t,s),node:t,path:[],depth:0,parent:null,ancestors:[]};const a=t=>{let[r,o]=_.concat(e(t)||[null,!1]);if(o)return[r,o];let l=_.get(t.node,n);if(_.isArray(l)){let e={depth:t.depth+1,parent:t,ancestors:_.concat(t.ancestors,t)},n=0;for(let r of l){let o=_.get(r,i),l=_.get(r,s),h={index:n,id:o,name:l,node:r,path:_.concat(t.path,l||n),...e},[c,u]=a(h);if(n++,u)return[c,u]}}return[]};let[o]=a(r);return o},walkBreadth(t,e=(()=>({})),{idBy:i="id",nameBy:s="name",childrenBy:n="children"}={}){let r={index:0,id:_.get(t,i),name:_.get(t,s),node:t,path:[],depth:0,parent:null,ancestors:[]},[a,o]=_.concat(e(r)||[null,!1]);if(o)return[a,o];const l=t=>{let r=_.get(t.node,n);if(_.isArray(r)){let n=[],a={depth:t.depth+1,parent:t,ancestors:_.concat(t.ancestors,t)},o=0;for(let l of r){let r=_.get(l,i),h=_.get(l,s),c={index:o,id:r,name:h,node:l,path:_.concat(t.path,h||o),...a},[u,d]=_.concat(e(c)||[null,!1]);if(o++,d)return[u,d];n.push(c)}for(let t of n){let[e,i]=l(t);if(i)return[e,i]}}return[]};let[h]=l(r);return h},getById(e,i,s){if(!Ti.Util.isNil(i))return t.walkDeep(e,t=>{if(t.id==i)return[t,!0]},s)},getByPath(e,i=[],s){let n=t.path(i);return t.walkDeep(e,t=>{if(_.isEqual(n,t.path))return[t,!0]},s)},getNodeById(e,i,s){let n=t.getById(e,i,s);if(n)return n.node},getNodeByPath(e,i=[],s){let n=t.getByPath(e,i,s);if(n)return n.node},insertBefore(t,e,{nameBy:i="name"}={}){if(!t||_.isUndefined(e))return;let s,n;t.parent?(n=t.parent.node.children,s=t.index):(n=t.node.children,s=0);let r=Ti.Util.insertToArray(n,s,e),a=_.cloneDeep(t.path),o=_.get(e,i);a[a.length-1]=o;return{hierarchy:{index:r,node:e,path:a,depth:t.depth,parent:t.parent,ancestors:t.ancestors},children:n,item:e,index:r}},insertAfter(t,e,{nameBy:i="name"}={}){if(!t||_.isUndefined(e))return;let s,n;t.parent?(n=t.parent.node.children,s=t.index+1):(n=t.node.children,s=-1);let r=Ti.Util.insertToArray(n,s,e),a=_.cloneDeep(t.path),o=_.get(e,i);a[a.length-1]=o;return{hierarchy:{index:r,node:e,path:a,depth:t.depth,parent:t.parent,ancestors:t.ancestors},children:n,item:e,index:r}},prepend(t,e,{nameBy:i="name",autoChildren:s=!1}={}){if(!t||_.isUndefined(e))return;let n,r;_.isArray(t.node.children)?(r=t.node.children,n=0):s?(r=[],t.node.children=r,n=0):(r=t.parent.node.children,n=t.index+1);let a=Ti.Util.insertToArray(r,n,e),o=_.get(e,i);return{hierarchy:{index:a,node:e,path:_.concat(o,t.path),depth:t.depth+1,parent:t,ancestors:_.concat(t.ancestors,t)},children:r,item:e,index:a}},append(t,e,{nameBy:i="name",autoChildren:s=!1}={}){if(!t||_.isUndefined(e))return;let n,r;_.isArray(t.node.children)?(r=t.node.children,n=0):s?(r=[],t.node.children=r,n=0):(r=t.parent.node.children,n=t.index);let a=Ti.Util.insertToArray(r,n,e),o=_.get(e,i);return{hierarchy:{index:a,node:e,path:_.concat(t.path,o),depth:t.depth+1,parent:t,ancestors:_.concat(t.ancestors,t)},children:r,item:e,index:a}},replace(t,e,{nameBy:i="name"}={}){if(!t||!t.parent||_.isUndefined(e))return;let s=t.parent.node.children;s[t.index]=e;let n=_.cloneDeep(t.path),r=_.get(e,i);n[n.length-1]=r;return{hierarchy:{index:t.index,node:e,path:n,depth:t.depth,parent:t.parent,ancestors:t.ancestors},children:s,item:e,index:t.index}},remove(t){if(!t||!t.parent)return;let e=t.index;return _.remove(t.parent.node.children,(t,i)=>i==e).length>0},nextCandidate(t){if(!t||!t.parent)return;let e,i,s=t.parent.node.children;return s.length<=1?(e=t.parent.node,i=_.isEmpty(t.parent.path)?null:t.parent.path.slice(0,t.parent.path.length-1)):t.index+1<s.length?(e=s[t.index+1],i=t.parent.path):(e=s[t.index-1],i=t.parent.path),{node:e,path:i}}};return{Trees:t}}(),{Viewport:Viewport}=function(){class t{constructor(){this.reset()}reset(t=null){return this.scrolling=[],this.resizing=[],this}watch(t,{scroll:e,resize:i}={}){_.isFunction(e)&&this.scrolling.push({context:t,handler:e}),_.isFunction(i)&&this.resizing.push({context:t,handler:i})}unwatch(t){_.remove(this.scrolling,({context:e})=>e===t),_.remove(this.resizing,({context:e})=>e===t)}startListening(){let t=this;this.isListening||(window.addEventListener("resize",e=>{for(let i of t.resizing)i.handler.apply(i.context,[e])}),window.addEventListener("scroll",e=>{for(let i of t.scrolling)i.handler.apply(i.context,[e])}),this.isListening=!0)}}return{Viewport:new t}}(),{WWW:WWW}=function(){const t={explainNavigation(e=[],{base:i="/",depth:s=0,suffix:n=".html",iteratee:r=_.identity,idBy:a,indexPath:o=[],idPath:l=[]}={}){let h=[];for(let c=0;c<e.length;c++){let u=e[c],d=[].concat(o,c),m=Ti.Util.explainObj(u,a,{evalFunc:!0});Ti.Util.isNil(m)&&(m="it-"+d.join("-"));let p=[].concat(l,m),f={id:m,index:c,depth:s,idPath:p,indexPath:d,type:"page",..._.pick(u,"icon","title","type","value","href","target","params","rawData")};if("page"==u.type){if(!f.href&&u.value){let e=u.value;e.endsWith(n)||(e+=n);let s=Ti.Util.appendPath(i,e);f.value=e,f.href=t.joinHrefParams(s,u.params,u.anchor)}f.highlightBy=t.evalHighlightBy(u.highlightBy||f.value,u),!f.target&&u.newTab&&(f.target="_blank")}else"href"==f.type?(f.highlightBy=t.evalHighlightBy(u.highlightBy||f.value,u),f.href||(f.href=t.joinHrefParams(u.value,u.params,u.anchor)),!f.target&&u.newTab&&(f.target="_blank")):f.highlightBy=(()=>!1);_.isArray(u.items)&&(f.items=t.explainNavigation(u.items,{base:i,suffix:n,iteratee:r,depth:s+1,idBy:a,indexPath:d,idPath:p})),f=r(f),h.push(f)}return h},evalHighlightBy(t=!1,e={}){if(_.isFunction(t))return t;if(_.isString(t)){if(t.startsWith("^")||t.endsWith("$")){let e=new RegExp(t);return _.bind(function({path:t,value:e}){return this.test(e)||this.test(t)},e)}return({path:i,params:s,value:n})=>!Ti.Util.isNil(n)&&e.value==n||!!_.isEqual(i,t)&&!(!_.isEmpty(e.params)&&s&&!_.isEqual(e.params,s))}return Ti.Util.isNil(t)?({value:t})=>Ti.Util.isNil(t):_.isRegExp(t)?_.bind(function({path:t,value:e}){return this.test(e)||this.test(t)},t):_.isBoolean(t)?function(){return t}:function(){return!1}},joinHrefParams(t,e,i){if(!t)return null;let s;return _.isEmpty(e)||(s=[],_.forEach(e,(t,e)=>{if(!Ti.Util.isNil(t)){let i=encodeURIComponent(t);s.push(`${e}=${i}`)}}),s.length>0&&(t=t+"?"+s.join("&"))),i&&(i.startsWith("#")?t+=i:t+="#"+i),t},evalFee:({price:t=0,amount:e=1}={})=>t*e,getCurrencyPrefix:t=>({RMB:"￥",USD:"$",EUR:"€",GBP:"￡"})[_.upperCase(t)],feeText(e=0,i="RMB",{autoSuffix:s=!0}={}){let n=_.upperCase(i),r=t.getCurrencyPrefix(n),a=[];return r&&a.push(r),a.push(e),s&&r||a.push(n),a.join("")},evalObjPreviewSrc(t,{previewKey:e,previewObj:i,sha1Path:s=4,apiTmpl:n,cdnTmpl:r,dftSrc:a}={}){if(t){if(_.isString(t))return t;if(r){let e=".."!=i&&i?_.get(t,i):t;if(e&&e.sha1)return e=_.cloneDeep(e),e.sha1Path=s>0?e.sha1.substring(0,s)+"/"+e.sha1.substring(s):e.sha1,Ti.S.renderBy(r,e)}if(n){let i=".."!=e&&e?_.get(t,e):t;if(/^https?:\/\//.test(i))return i;if(i)return Ti.S.renderBy(n,t)}return a}},getSSRData(t,{root:e=document.documentElement,as:i="text",trimed:s=!0,autoRemove:n=!0,ssrFinger:r,dft:a}={}){let o=`.wn-ssr-data[data-ssr-key="${t}"]`,l=Ti.Dom.find(o,e);if(_.isElement(l)){if(!Ti.Util.isNil(r)){if(l.getAttribute("data-ssr-finger")!=r)return a}let t=l.textContent;return s&&(t=_.trim(t)),n&&Ti.Dom.remove(l),"json"==i?JSON.parse(t):t}return a},genQuery(t,{vkey:e="val",wrapArray:i=!1,errorAs:s,blankAs:n="[]"}={}){if(_.isFunction(t))return t;if(_.isArray(t))return i?()=>t:t;if(_.isString(t))throw"www:unsupport query: "+t},hydrateApi({base:t="/",siteApis:e={},apis:i={}}={}){let s={};const n=function(e,i,s={}){let n=_.cloneDeep(i);_.defaults(n,{name:e,method:"GET",headers:{},params:{},vars:{},as:"json",autoResetData:"GET"});if(n.path)return _.assign(n.vars,s.vars),_.assign(n.headers,s.headers),_.assign(n.params,s.params),"INVOKE"!=n.method&&(/^(https?:\/\/|\/)/.test(n.path)?n.url=n.path:n.url=Ti.Util.appendPath(t,n.path)),_.assign(n,_.pick(s,"body","preload","ssr","test","explainTest","transformer","dataKey","dataMerge","rawDataKey","rawDataMerge","autoResetData","after")),_.defaults(n,{bodyType:"form",dataKey:e}),n;console.warn(`!!!API[${e}] without defined in site!!!`,n)};return _.forEach(e,(t,e)=>{t.pages&&(t=n(e,t))&&(s[e]=t)}),_.forEach(i,(t,i)=>{let r=_.get(e,t.apiName||i),a=n(i,r,t);a&&(s[i]=a)}),s},async runApi(t={},e,{vars:i,params:s,headers:n,body:r,dispatch:a}={}){e=_.cloneDeep(e),_.assign(e.vars,i),_.assign(e.params,s),_.assign(e.headers,n),Ti.Util.isNil(r)||(e.body=r),_.defaults(i,e.vars);let o=e.url;if(!_.isEmpty(e.vars)){let i=Ti.Util.explainObj(t,e.vars);o=Ti.S.renderBy(o,i)}let l=_.pick(e,["method","as"]);if(l.headers=Ti.Util.explainObj(t,e.headers),l.params=Ti.Util.explainObj(t,e.params),"POST"==e.method&&e.body){let i=Ti.Util.explainObj(t,e.body);"json"==e.bodyType?l.body=JSON.stringify(i):"text"==e.bodyType?l.body=Ti.Types.toStr(i):l.body=Ti.Http.encodeFormData(i)}let h,c;if("INVOKE"==e.method)h=await a(e.path,l.params,{root:!0});else{if(e.ssr&&"GET"==e.method){let t=JSON.stringify(l.params||{}),i=_.pick(l,"as");i.dft=void 0,i.ssrFinger=Ti.Alg.sha1(t),h=Ti.WWW.getSSRData(`api-${e.name}`,i)}_.isUndefined(h)&&(h=await Ti.Http.sendAndProcess(o,l))}if(c=h,e.transformer){"BCHC.TagsToDict"==e.transformer&&console.log("transform",e.transformer);let i=_.cloneDeep(e.transformer),s=Ti.Util.fallback(i.partial,"right");if(i.explain){let e=_.pick(i,"name","args");i=Ti.Util.explainObjs(t,e)}let n=Ti.Util.genInvoking(i,{context:t,partial:s});_.isFunction(n)&&(c=await n(h))}return{reo:h,data:c}},async runApiAndPrcessReturn(t={},e,{vars:i,params:s,headers:n,body:r,ok:a,fail:o,dispatch:l,mergeData:h,updateData:c,doAction:u}={}){let d;try{d=await Ti.WWW.runApi(t,e,{vars:i,params:s,headers:n,body:r,dispatch:l})}catch(t){console.warn("Fail to invoke API",{api:e,err:t,vars:i,params:s,headers:n,body:r});let a=Ti.Util.explainObj({api:e,vars:i,params:s,headers:n,body:r,err:t,errText:t.responseText},o);return void await u(a)}let{reo:m,data:p}=d;if(e.dataKey){let t=Ti.Util.explainObj({reo:m,data:p,vars:i,params:s,headers:n},e.dataKey);if(t)if(e.dataMerge){let e={};_.set(e,t,p),h(e)}else c({key:t,value:p})}if(e.rawDataKey){let t=Ti.Util.explainObj({reo:m,data:p,vars:i,params:s,headers:n},e.rawDataKey);if(t)if(e.rawDataMerge){let e={};_.set(e,t,m),h(e)}else c({key:t,value:m})}let f=Ti.Util.explainObj({api:e,vars:i,params:s,headers:n,body:r,data:p,reo:m},a);await u(f)},groupPreloadApis(t){let e=[],i=[];return _.forEach(t,(t,s)=>{let n=t.preload;if(_.isBoolean(n)){if(!n)return;n=1}if(_.isNumber(n))if(n>=0){let t=_.nth(e,n);_.isArray(t)||(t=[],e[n]=t),t.push(s)}else i.push(s)}),{preloads:_.filter(e,t=>!!t),afterLoads:i}}};return{WWW:t}}(),{GPS:GPS}=function(){const t=3.141592653589793,e=6378245,i=.006693421622965943,s={WGS84_TO_GCJ02(n,r){if(s.outOfChina(n,r))return{lat:n,lng:r};let a=s.transformLat(r-105,n-35),o=s.transformLng(r-105,n-35),l=n/180*t,h=Math.sin(l);h=1-i*h*h;let c=Math.sqrt(h);return{lat:n+(a=180*a/(e*(1-i)/(h*c)*t)),lng:r+(o=180*o/(e/c*Math.cos(l)*t))}},WGS84_TO_BD09(t,e){let i=s.WGS84_TO_GCJ02(t,e);return s.GCJ02_TO_BD09(i.lat,i.lng)},GCJ02_TO_WGS84(t,e){let i=s.transform(t,e),n=2*e-i.lng;return{lat:2*t-i.lat,lng:n}},GCJ02_TO_BD09(e,i){let s=i,n=e,r=Math.sqrt(s*s+n*n)+2e-5*Math.sin(n*t),a=Math.atan2(n,s)+3e-6*Math.cos(s*t),o=r*Math.cos(a)+.0065;return{lat:r*Math.sin(a)+.006,lng:o}},BD09_TO_GCJ02(e,i){let s=i-.0065,n=e-.006,r=Math.sqrt(s*s+n*n)-2e-5*Math.sin(n*t),a=Math.atan2(n,s)-3e-6*Math.cos(s*t),o=r*Math.cos(a);return{lat:r*Math.sin(a),lng:o}},BD09_TO_WGS84(t,e){let i=s.BD09_TO_GCJ02(t,e);return s.GCJ02_TO_WGS84(i.lat,i.lng)},outOfChina:(t,e)=>e<72.004||e>137.8347||(t<.8293||t>55.8271),transform(n,r){if(s.outOfChina(n,r))return{lat:n,lng:r};let a=s.transformLat(r-105,n-35),o=s.transformLng(r-105,n-35),l=n/180*t,h=Math.sin(l);h=1-i*h*h;let c=Math.sqrt(h);return{lat:n+(a=180*a/(e*(1-i)/(h*c)*t)),lng:r+(o=180*o/(e/c*Math.cos(l)*t))}},transformLat(e,i){let s=2*e-100+3*i+.2*i*i+.1*e*i+.2*Math.sqrt(Math.abs(e));return s+=2*(20*Math.sin(6*e*t)+20*Math.sin(2*e*t))/3,s+=2*(20*Math.sin(i*t)+40*Math.sin(i/3*t))/3,s+=2*(160*Math.sin(i/12*t)+320*Math.sin(i*t/30))/3},transformLng(e,i){let s=300+e+2*i+.1*e*e+.1*e*i+.1*Math.sqrt(Math.abs(e));return s+=2*(20*Math.sin(6*e*t)+20*Math.sin(2*e*t))/3,s+=2*(20*Math.sin(e*t)+40*Math.sin(e/3*t))/3,s+=2*(150*Math.sin(e/12*t)+300*Math.sin(e/30*t))/3},getLngToWest(t,e){let i=t-e;return e<0&&t>0?360-i:i},getLatToSouth:(t,e)=>t-e,normlizedLat:t=>t,normlizedLng:t=>(t>360&&(t%=360),t>180?t-360:(t<-360&&(t%=360),t<-180?t+360:t)),getBounds(t=[]){let e=void 0,i=void 0,s=void 0,n=void 0;for(let r of t)e=_.isUndefined(e)?r.lng:Math.max(e,r.lng),i=_.isUndefined(i)?r.lng:Math.min(i,r.lng),s=_.isUndefined(s)?r.lat:Math.max(s,r.lat),n=_.isUndefined(n)?r.lat:Math.min(n,r.lat);return e-i>180?[{lat:n,lng:e},{lat:s,lng:i}]:[{lat:n,lng:i},{lat:s,lng:e}]},getCenter(t=[]){let[e,i]=s.getBounds(t);return{lat:(i.lat+e.lat)/2,lng:(i.lng+e.lng)/2}}};return{GPS:s}}(),{GIS:GIS}=function(){const t=3.141592653589793,e=6378245,i=.006693421622965943,s={isInBounds(t,e,i){let{N:s,S:n,E:r,W:a}=i;return!(t>s||t<n)&&!(e>r||e<a)},isLatLngObjInBounds:({lat:t,lng:e},i)=>s.isInBounds(t,e,i),isLatLngPairInBounds:([t,e],i)=>s.isInBounds(t,e,i),__build_bounds:({N:t,S:e,E:i,W:s}={})=>({N:t,S:e,E:i,W:s,NE:{lat:t,lng:i},NW:{lat:t,lng:s},SE:{lat:e,lng:i},SW:{lat:e,lng:s},lat:(t+e)/2,lng:(s+i)/2}),getLatlngPairBounds(t=[]){let e={N:-90,S:90,W:180,E:-180};return _.forEach(t,([t,i])=>{_.isNumber(i)&&_.isNumber(t)&&(e.N=Math.max(t,e.N),e.S=Math.min(t,e.S),e.E=Math.max(i,e.E),e.W=Math.min(i,e.W))}),s.__build_bounds(e)},getLnglatPairBounds(t=[]){let e={N:-90,S:90,W:180,E:-180};return _.forEach(t,([t,i])=>{_.isNumber(t)&&_.isNumber(i)&&(e.N=Math.max(i,e.N),e.S=Math.min(i,e.S),e.E=Math.max(t,e.E),e.W=Math.min(t,e.W))}),s.__build_bounds(e)},getLatlngObjBounds(t=[]){let e={N:-90,S:90,W:180,E:-180};return _.forEach(t,({lat:t,lng:i})=>{_.isNumber(i)&&_.isNumber(t)&&(e.N=Math.max(t,e.N),e.S=Math.min(t,e.S),e.E=Math.max(i,e.E),e.W=Math.min(i,e.W))}),s.__build_bounds(e)},latlngPairToObj:([t,e]=[])=>({lat:t,lng:e}),lnglatPairToObj:([t,e]=[])=>({lat:e,lng:t}),objToLatlngPair:({lat:t,lng:e}={})=>[t,e],objToLnglatPair:({lat:t,lng:e}={})=>[e,t],transLatlngPair(t,e="WGS84_TO_GCJ02"){let{lat:i,lng:n}=s[e](...t);return[i,n]},transLnglatPair(t,e="WGS84_TO_GCJ02"){let[i,n]=t,{lat:r,lng:a}=s[e](n,i);return[a,r]},transLatlngObj(t,e="WGS84_TO_GCJ02",i=!1){let{lat:n,lng:r}=t,a=s[e](n,r);return i?{...t,...a}:a},WGS84_TO_GCJ02(n,r){if(s.outOfChina(n,r))return{lat:n,lng:r};let a=s.transformLat(r-105,n-35),o=s.transformLng(r-105,n-35),l=n/180*t,h=Math.sin(l);h=1-i*h*h;let c=Math.sqrt(h);return{lat:n+(a=180*a/(e*(1-i)/(h*c)*t)),lng:r+(o=180*o/(e/c*Math.cos(l)*t))}},WGS84_TO_BD09(t,e){let i=s.WGS84_TO_GCJ02(t,e);return s.GCJ02_TO_BD09(i.lat,i.lng)},GCJ02_TO_WGS84(t,e){let i=s.transform(t,e),n=2*e-i.lng;return{lat:2*t-i.lat,lng:n}},GCJ02_TO_BD09(e,i){let s=i,n=e,r=Math.sqrt(s*s+n*n)+2e-5*Math.sin(n*t),a=Math.atan2(n,s)+3e-6*Math.cos(s*t),o=r*Math.cos(a)+.0065;return{lat:r*Math.sin(a)+.006,lng:o}},BD09_TO_GCJ02(e,i){let s=i-.0065,n=e-.006,r=Math.sqrt(s*s+n*n)-2e-5*Math.sin(n*t),a=Math.atan2(n,s)-3e-6*Math.cos(s*t),o=r*Math.cos(a);return{lat:r*Math.sin(a),lng:o}},BD09_TO_WGS84(t,e){let i=s.BD09_TO_GCJ02(t,e);return s.GCJ02_TO_WGS84(i.lat,i.lng)},outOfChina:(t,e)=>e<72.004||e>137.8347||(t<.8293||t>55.8271),transform(n,r){if(s.outOfChina(n,r))return{lat:n,lng:r};let a=s.transformLat(r-105,n-35),o=s.transformLng(r-105,n-35),l=n/180*t,h=Math.sin(l);h=1-i*h*h;let c=Math.sqrt(h);return{lat:n+(a=180*a/(e*(1-i)/(h*c)*t)),lng:r+(o=180*o/(e/c*Math.cos(l)*t))}},transformLat(e,i){let s=2*e-100+3*i+.2*i*i+.1*e*i+.2*Math.sqrt(Math.abs(e));return s+=2*(20*Math.sin(6*e*t)+20*Math.sin(2*e*t))/3,s+=2*(20*Math.sin(i*t)+40*Math.sin(i/3*t))/3,s+=2*(160*Math.sin(i/12*t)+320*Math.sin(i*t/30))/3},transformLng(e,i){let s=300+e+2*i+.1*e*e+.1*e*i+.1*Math.sqrt(Math.abs(e));return s+=2*(20*Math.sin(6*e*t)+20*Math.sin(2*e*t))/3,s+=2*(20*Math.sin(e*t)+40*Math.sin(e/3*t))/3,s+=2*(150*Math.sin(e/12*t)+300*Math.sin(e/30*t))/3}};return{GIS:s}}(),{Bank:Bank}={Bank:{getCurrencyChar:(t="RMB")=>({RMB:"¥",USD:"$",GBP:"£"})[t],isValidPayType:t=>({"wx.qrcode":!0,"zfb.qrcode":!0,paypal:!0})[t]||!1,getPayTypeText(t,e=!1){let i=null;if(_.isString(t)&&(i=`pay-by-${t.replace(".","-")}`),i)return e?Ti.I18n.get(i):i},getPayTypeChooseI18nText(t,{text:e="pay-step-choose-tip2",nil:i="pay-step-choose-nil"}={}){let s=Ti.Bank.getPayTypeText(t,!0);return s?Ti.I18n.getf(e,{val:s}):Ti.I18n.get(i)}}},{Num:Num}={Num:{fillSteps(t=0,e=1,{ary:i=[],step:s=1}={}){for(let n=0;n<e;n++)i[n]=t+n*s;return i},scrollIndex(t,e=0){if(e>0){let i=t%e;return i>=0?i:e+i}return-1},precise(t,e=2){if(e>=0){var i=Math.pow(10,e);return Math.round(t*i)/i}return t},ceilUnit(t,e=0){if(_.isNumber(t)&&e>0){return Math.ceil(t/e)*e}return t},floorUnit(t,e=0){if(_.isNumber(t)&&e>0){return Math.floor(t/e)*e}return t}}},{Css:Css}=function(){const t={scaleSize:(t=1,e,i)=>i&&e?{width:e,height:i}:i?{width:t*i,height:i}:e?{width:e,height:e/t}:void 0,toPixel(e,i=100,s=0){if(Ti.Util.isNil(e))return e;if(_.isNumber(e))return e>-1&&e<1?e*i:e;let n={base:i,dft:s,remBase:Ti.Dom.getRemBase()};return t.toAbsPixel(e,n)},toAbsPixel(t,{base:e=100,dft:i=0,remBase:s=100,emBase:n=14}={}){if(Ti.Util.isNil(t))return t;if(_.isNumber(t))return t;let r=/^(-?[\d.]+)(px|rem|em|%)?$/.exec(t);if(r){let t=1*r[1],i={px:t=>t,rem:t=>t*s,em:t=>t*n,"%":t=>t*e/100}[r[2]];return i?i(t):t}return i},toSize:(t,{autoPercent:e=!0,remBase:i=0}={})=>_.isNumber(t)||/^[0-9]+$/.test(t)?0==t?t:e&&t>=-1&&t<=1?100*t+"%":i>0?t/i+"rem":t+"px":t,toSizeRem100(e,i){let s=_.assign({},i,{remBase:100});return t.toSize(e,s)},toStyle:(e,i)=>_.mapValues(e,(e,s)=>{let n=_.kebabCase(s);return/^(opacity|z-index|order)$/.test(n)?e:t.toSize(e,i)}),toStyleRem100(e,i){let s=_.assign({},i,{remBase:100});return t.toStyle(e,s)},toBackgroundUrl(t,e=""){if(t)return e&&(t=Ti.Util.appendPath(e,t)),`url("${t}")`},toBackgroundUrlBy(t,e=""){if(t)return e&&(t=Ti.S.renderBy(e,t)),`url("${t}")`},toBackgroundUrlAsPreview(t,e,i,s){if(t&&!_.isEmpty(t))return t=Ti.WWW.evalObjPreviewSrc(t,{apiTmpl:e,cdnTmpl:i,dftSrc:s}),`url("${t}")`},toNumStyle:e=>t.toStyle(e,!1),mergeClassName:(...e)=>t.mergeClassNameBy({},...e),mergeClassNameBy(t={},...e){let i={};const s=e=>{if(!Ti.Util.isNil(e))if(_.isFunction(e)){let i=e(t);s(i)}else if(_.isString(e)){let t=_.without(_.split(e,/\s+/g),"");for(let e of t)i[e]=!0}else if(_.isArray(e))for(let t of e)s(t);else _.isPlainObject(e)&&_.forEach(e,(t,e)=>{if(t){let t=_.kebabCase(e);i[t]=!0}})};return s(e),i},joinClassNames(...e){let i=t.mergeClassName(...e),s=[];return _.forEach(i,(t,e)=>{t&&s.push(e)}),s.join(" ")},parseCssRule(t="",e=!0){if(t=_.trim(t),Ti.S.isBlank(t))return{};e=Ti.Dom.attrFilter(e);let i={},s=t.split(";");for(let t of s){if(Ti.S.isBlank(t))continue;let[s,n]=t.split(":"),r=e(s=_.trim(s),n=_.trim(n));r&&(_.isBoolean(r)&&(r=_.camelCase(s)),i[r]=n)}return i},renderCssRule(t={}){if(_.isEmpty(t))return"";if(_.isString(t))return t;let e=[];return _.forEach(t,(t,i)=>{if(_.isNull(t)||_.isUndefined(t)||Ti.S.isBlank(t))return;let s=_.kebabCase(i);/^(opacity|z-index|order)$/.test(s)?e.push(`${s}:${t}`):_.isNumber(t)?e.push(`${s}:${t}px`):e.push(`${s}:${t}`)}),e.join(";")},renderCssStyleSheet(e=[]){e=_.concat(e);let i=[];for(let s of e){let{selectors:e,rules:n}=s;e=_.concat(e),_.isEmpty(e)||_.isEmpty(n)||(i.push(e.join(",")+"{"),i.push(t.renderCssRule(n)),i.push("}"))}return i.join("\n")}};return{Css:t}}(),{Mapping:Mapping}=function(){class t{constructor(t,e){this.data=e,_.isString(t)?this.path=_.without(t.split("/"),""):_.isArray(t)&&(this.path=t)}match(t){let e=_.isArray(t)?t:_.without(t.split("/"),"");for(let t=0;t<e.length;t++){let i=e[t],s=this.path[t];if("*"!=s&&i!=s)return!1}return!0}}class e{constructor(t,e){this.data=e,this.regex=new RegExp(t)}match(t){return this.regex.test(t)}}class i{constructor(t={}){this.parse(t)}parse(i={}){this.maps={},this.regexs=[],this.paths=[],_.forEach(i,(i,s)=>{let n=_.map(s.split(","),t=>_.trim(t));for(let s of n)s.startsWith("^")?this.regexs.push(new e(s,i)):s.indexOf("/")>=0?this.paths.push(new t(s,i)):this.maps[s]=i})}get(t,e){if(!Ti.Util.isNil(t)){let e=this.maps[t];if(!_.isUndefined(e))return e;for(let e of this.paths){let i=_.without(t.split("/"),"");if(e.match(i))return e.data}for(let e of this.regexs)if(e.match(t))return e.data}return e}}return{Mapping:i}}(),{Dict:Dict,DictFactory:DictFactory}=function(){const t=["item","data","query","children","getValue","getText","getIcon","isMatched","itemCache","dataCache","hooks","shadowed"];class e{constructor(){this.__item_loading={},this.hooks=[],this.shadowed=!1,this.item=_.idendity,this.data=(()=>[]),this.dataChildrenKey=null,this.query=(t=>[]),this.children=(t=>[]),this.getValue=(t=>Ti.Util.getFallback(t,"value","id")),this.getText=(t=>Ti.Util.getFallback(t,"title","text","name","nm")),this.getIcon=(t=>_.get(t,"icon")),this.isMatched=((t,e)=>{let i=this.getValue(t);if(_.isEqual(e,i))return!0;let s=this.getText(t);return!!(s&&s.indexOf(e)>=0)}),this.itemCache={},this.dataCache=null}setShadowed(t=!1){this.shadowed=t}isShadowed(){return this.shadowed}addHooks(...t){let e=_.flattenDeep(t);_.forEach(e,t=>{_.isFunction(t)&&this.hooks.push(t)})}clearHooks(){this.hooks=[]}doHooks(t=!1){for(let e of this.hooks)e({loading:t})}invoke(t,...e){let i=this[t];if(_.isFunction(i))return i.apply(this,[...e,this])}async invokeAsync(t,...e){let i=this[t];if(_.isFunction(i)){return await i.apply(this,[...e,this])}}setFunc(t){_.forEach(t,(t,e)=>{_.isFunction(t)&&(this[e]=t)})}duplicate({hooks:i=!1,cache:s=!0,dataCache:n=!0,itemCache:r=!0}={}){let a=new e;return _.forEach(t,t=>{a[t]=this[t]}),i||(a.hooks=[]),s||(a.itemCache={},a.dataCache=null),n||(a.dataCache=null),r||(a.itemCache={}),a}isItemCached(t){return!Ti.Util.isNil(this.itemCache[t])}addItemToCache(t,e){t=Ti.Util.fallback(t,null);let i=e;if(Ti.Util.isNil(i)&&(i=this.getValue(t)),_.isUndefined(t)||Ti.Util.isNil(i)||(this.itemCache[i]=t),this.dataChildrenKey){let e=t[this.dataChildrenKey];if(_.isArray(e)&&e.length>0)for(let t of e)this.addItemToCache(t)}}clearCache(){this.itemCache={},this.dataCache=null}findItem(t,e=[]){for(let i of e){let e=this.getValue(i);if(_.isEqual(t,e))return i}}async getItem(t){if(Ti.Util.isNil(t))return null;let e=this.itemCache[t];if(_.isUndefined(e)){let i=this.__item_loading[t];if(i)return await new Promise(t=>{i.push(t)});i=[],this.__item_loading[t]=i,this.doHooks(!0),e=await this.invokeAsync("item",t),this.doHooks(!1),e&&_.isPlainObject(e)&&this.addItemToCache(e,t);for(let t of i)t(e||null);delete this.__item_loading[t]}return _.isArray(e)&&console.warn("!!!! Dict.getItem=>[] !!! 靠，又出现了 val=",t),this.isShadowed()?_.cloneDeep(e):e}async getData(t=!1){let e=this.dataCache;return(t||_.isEmpty(e))&&(this.doHooks(!0),e=await this.invokeAsync("data"),this.doHooks(!1),_.forEach(e,(t,i)=>{_.isPlainObject(t)||(t={text:t,value:t},e[i]=t),this.addItemToCache(t)}),this.dataCache=e),this.isShadowed()?_.cloneDeep(e)||[]:e||[]}async queryData(t){let e,i=_.trim(t);return i?(this.doHooks(!0),e=await this.invokeAsync("query",i),this.doHooks(!1),_.forEach(e,t=>{this.addItemToCache(t)}),this.isShadowed()?_.cloneDeep(e)||[]:e||[]):e=await this.getData()}async getChildren(t){if(!t)return await this.getData();this.doHooks(!0);let e=await this.invokeAsync("children",t);return this.doHooks(!1),_.forEach(e,t=>{this.addItemToCache(t)}),this.isShadowed()?_.cloneDeep(e)||[]:e||[]}getBy(t=".text",e,i){return t&&".text"!=t?".icon"==t?this.getIcon(e):".value"==t?this.getValue(e):Ti.Util.fallback(Ti.Util.getOrPick(e,t),i,this.getValue(e)):this.getText(e)}async checkItem(t){let e=await this.getItem(t);if(!e)throw Ti.Err.make("e.dict.no-item",{dictName:dictName,val:t});return e}async getItemText(t){let e=await this.getItem(t);if(e)return this.getText(e)}async getItemIcon(t){let e=await this.getItem(t);if(e)return this.getIcon(e)}async getItemAs(t,e){let i=await this.getItem(e);if(i)return this.getBy(t,i,e)}}const i={},s={definations:{},instances:{}},n={__debug_static:()=>i,__debug_dynamic:()=>s,DictReferName(t){if(_.isString(t)){let e=/^(@Dict:|#)(.+)$/.exec(t);if(e)return _.trim(e[2])}},GetOrCreate(t={},{hooks:s,name:r}={}){let a;if(t.data instanceof e)a=t.data;else{let e=r||n.DictReferName(t.data);e&&(a=i[e])}return a?(s&&(a=a.duplicate({hooks:!1})).addHooks(s),a):n.CreateDict(t,{hooks:s,name:r})},CreateDict({data:t,query:s,item:n,children:r,dataChildrenKey:a,getValue:o,getText:l,getIcon:h,isMatched:c,shadowed:u}={},{hooks:d,name:m}={}){if(_.isString(t)||_.isArray(t)){let e=Ti.S.toObjList(t);t=(()=>e)}else t||(t=(()=>[]));n||(n=(async(t,e)=>(await e.getData(),e.itemCache[t]))),s||(s=(async(t,e)=>{let i=await e.getData(),s=[];for(let n of i)e.isMatched(n,t)&&s.push(n);return s})),r||(r=(()=>[]));let p=new e;return p.dataChildrenKey=a,p.setFunc({data:t,query:s,item:n,children:r,getValue:o,getText:l,getIcon:h,isMatched:c}),m&&(i[m]=p),u&&p.setShadowed(u),d&&p.addHooks(d),p},GetDict(t,e){let s=i[t];return s&&e&&(s=s.duplicate({hooks:!1})).addHooks(e),s},CheckDict(t,e){let s=n.GetDict(t,e);if(s)return s;let{name:r,args:a}=n.explainDictName(t);if(s=n.GetDict(r,e)){if(!_.isEmpty(a)){let e=s.duplicate({hooks:!0,dataCache:!1});return e.setFunc({data:function(){return this.getChildren(...a)}}),i[t]=e,e}return s}throw`e.dict.noexists : ${t}`},explainDictName(t){let e={},i=/^([^:()]+)(\(([^)]*)\))?(:(.+))?$/.exec(t);return i&&(e.name=i[1],e.args=Ti.S.joinArgs(i[3]),e.vkey=i[5],1==e.args.length&&/^=/.test(e.args[0])&&(e.dynamic=!0,e.dictKey=_.trim(e.args[0].substring(1)))),e},CreateDynamicDict(t,e){e&&_.isFunction(t)?s.definations[e]=t:console.error("Can not CreateDynamicDict",{factory:t,name:e})},GetDynamicDict({name:t,key:e,vars:i}={},n){let r=`${t}.${e}`,a=_.get(s.instances,r);if(!a){let e=s.definations[t];if(!e)return null;if(!(a=e(i)))return null;_.set(s.instances,r,a)}return a&&n&&(a=a.duplicate({hooks:!1})).addHooks(n),a},CheckDynamicDict({name:t,key:e,vars:i}={},s){let r=n.GetDynamicDict({name:t,key:e,vars:i},s);if(r)return r;throw`e.dict.dynamic.WithoutDefined : ${JSON.stringify({name:t,key:e,vars:i})}`},async getBy(t,e){if(Ti.Util.isNil(e))return e;let{name:i,vKey:s}=n.explainDictName(t),r=n.CheckDict(i);return await r.getItemAs(s,e)},async getAll(t){try{let e=n.CheckDict(t);return await e.getData()}catch(e){console.error(`e.dict.getAll : ${t}`,e)}},async getText(t,e){try{let i=n.CheckDict(t);return await i.getItemText(e)}catch(e){console.error(`e.dict.getText : ${t}`,e)}},async getIcon(t,e){try{let i=n.CheckDict(t);return await i.getItemIcon(e)}catch(e){console.error(`e.dict.getIcon : ${t}`,e)}}};return{Dict:e,DictFactory:n}}(),{VueEventBubble:VueEventBubble}=function(){const t=function(t,e,i=!1){t.$parent&&!i&&(_.isFunction(t.__before_bubble)&&(e=t.__before_bubble(e)||e),t.$parent.$notify(e.name,...e.args))},e=function(e,...i){let s,n={name:e,args:i},r=!1;if(_.isFunction(this.__on_events)&&(s=this.__on_events(e,...i)),_.isFunction(s)||(s=_.get(this.$listeners,e)),_.isFunction(s)||(s=this.$tiEventTryFallback(e,this.$listeners)),_.isFunction(s)){let e=s(...n.args);r=!0,_.isBoolean(e)?r=e:e&&_.isBoolean(e.stop)&&(r=e.stop,n.name=e.name||n.name),t(this,n,r)}else t(this,n)};return{VueEventBubble:{install(t,{overrideEmit:i=!1}={}){_.assign(t.prototype,{$notify:e,$tiEventTryFallback(t,e={}){let i=_.split(t,"::");for(;i.length>1;){let[,...t]=i,s=t.join("::"),n=_.get(e,s);if(n)return n;i=t}}}),i&&t.mixin({created:function(){this.$emit=e}})}}}}(),{VueTiCom:VueTiCom}=function(){const t={inheritAttrs:!1,computed:{...Vuex.mapGetters("viewport",["viewportMode","viewportActivedComIds","isViewportModeDesktop","isViewportModeTablet","isViewportModePhone","isViewportModeDesktopOrTablet","isViewportModePhoneOrTablet"]),tiComId(){return`${this._uid}:${this.tiComType}`},isActived(){return _.indexOf(this.viewportActivedComIds,this.tiComId)>=0},isSelfActived(){return _.last(this.viewportActivedComIds)==this.tiComId},getTopClass(){return(...t)=>Ti.Css.mergeClassNameBy(this,{"is-self-actived":this.isSelfActived,"is-actived":this.isActived},t,this.className)}},props:{className:void 0,onInit:void 0,onReady:void 0},created:async function(){_.isFunction(this.onInit)&&this.onInit(this)},mounted:function(){_.isFunction(this.onReady)&&this.onReady(this)},beforeDestroyed:function(){Ti.App(this).setBlurredVm(this)}},e={tiActivableComIdPath(t=!0){let e=this.tiActivableComPath(t);return _.map(e,t=>t.tiComId)},tiActivableComPath(t=!0){let e=[this],i=this.$parent;for(;i;)i.__ti_activable__&&e.push(i),i=i.$parent;return t&&e.reverse(),e},tiParentActivableCom(){let t=this.$parent;for(;t&&!t.__ti_activable__;)t=t.$parent;return t},tiParentCom(t){let e=_.kebabCase(t),i=this.$parent;for(;i&&i.tiComType!=e;)i=i.$parent;return i},setActived(){this.isSelfActived||Ti.App(this).setActivedVm(this)}};return{VueTiCom:{install(i){i.mixin(t),_.assign(i.prototype,e),i.filter("i18n",function(t,e={}){return/^i18n:(.+)/.test(t)?Ti.I18n.textf(t,e):Ti.I18n.getf(t,e)}),i.filter("percent",function(t,e=2,i=!0){return Ti.S.toPercent(1*t,{fixed:e,auto:i})}),i.filter("float",function(t,e=2,i=0){return Ti.Types.toFloat(t,{precision:e,dft:i})}),i.filter("datetime",function(t,e="yyyy-MM-dd"){return Ti.DateTime.format(t,e)}),i.directive("dropFiles",{bind:function(t,e){let i=null,s=null,n=e.modifiers.mask;_.isArray(e.value)?(i=e.value.length>0?e.value[0]:null,s=e.value.length>1?e.value[1]:null):_.isFunction(e.value)&&(i=e.value),i&&(n&&(s=Ti.I18n.text(s||"i18n:drop-file-here-to-upload")),t.__drag_enter_count=0,t.addEventListener("dragenter",function(e){t.__drag_enter_count++,1==t.__drag_enter_count&&(t.setAttribute("ti-is-drag",""),n&&(t.$ti_drag_mask=Ti.Dom.createElement({className:"ti-drag-mask",$p:t}),t.$ti_drag_mask.innerHTML=`<span>${s}</span>`))}),t.addEventListener("dragover",function(t){t.preventDefault(),t.stopPropagation()}),t.addEventListener("dragleave",function(e){t.__drag_enter_count--,t.__drag_enter_count<=0&&(t.removeAttribute("ti-is-drag"),t.$ti_drag_mask&&(Ti.Dom.remove(t.$ti_drag_mask),delete t.$ti_drag_mask))}),t.addEventListener("drop",function(e){e.preventDefault(),e.stopPropagation(),t.__drag_enter_count=0,t.removeAttribute("ti-is-drag"),t.$ti_drag_mask&&(Ti.Dom.remove(t.$ti_drag_mask),delete t.$ti_drag_mask),_.isFunction(i)&&i(e.dataTransfer.files)}))}}),i.directive("dropOff",{bind:function(t,e){t.addEventListener("dragover",function(t){t.preventDefault(),t.stopPropagation()}),t.addEventListener("drop",function(t){t.preventDefault(),t.stopPropagation()})}}),i.directive("dragOff",{bind:function(t,e){t.addEventListener("dragstart",function(t){t.preventDefault(),t.stopPropagation()})}}),i.directive("tiActivable",{bind:function(t,{value:e},{context:i}){let s=i;s.__ti_activable__=!0,t.addEventListener("click",function(t){t.__ti_activable_used__||(t.__ti_activable_used__=!0,s.setActived())})}}),i.directive("tiDraggable",{bind:function(t,{value:e},{context:i}){Ti.Be.Draggable(t,e)}})}}}}(),{Album:Album}=function(){const t=["flex-none","item-margin-md","item-padding-no","pic-fit-cover","hover-to-zoom","at-bottom","title-wrap-ellipsis"];class e{constructor(e,i){Ti.Dom.addClass(e,"ti-widget-album"),this.$el=e,this.setup=_.assign({live:!1,attrPrefix:"wn-obj-",dftWallClass:t,itemToPhoto:{name:"=name",link:"=link",thumb:"=thumb",src:"=src",brief:"=brief"}},i);let s=this.getData();this.setup.live&&s.fullpreview&&Ti.Dom.setAttrs(this.$el,{widget:"album-fullpreview",titleKey:`${this.setup.attrPrefix}title`},"ti-live-")}setData(t={}){let{attrPrefix:e}=this.setup,i=this.formatData(t);Ti.Dom.setStyle(this.$el,i.style),Ti.Dom.setAttrs(this.$el,_.omit(i,"style"),e),Ti.Dom.setAttrs(this.$el,{tiAlbumFallsWidth:null,tiAlbumFallsCount:null})}formatData(t={}){let{dftWallClass:e}=this.setup,{id:i,name:s,link:n,layout:r,fullpreview:a,autoopen:o,style:l,wallStyle:h,tileStyle:c,imageStyle:u,titleStyle:d,briefStyle:m,wallClass:p}=t;return p=Ti.Dom.getClassList(p,{dftList:e}),l=Ti.Dom.formatStyle(l),h=Ti.Dom.formatStyle(h),c=Ti.Dom.formatStyle(c),u=Ti.Dom.formatStyle(u),d=Ti.Dom.formatStyle(d),m=Ti.Dom.formatStyle(m),{id:i,name:s,link:n,layout:r,fullpreview:a,autoopen:o,wallClass:p.join(" "),style:Ti.Css.renderCssRule(l),wallStyle:Ti.Css.renderCssRule(h),tileStyle:Ti.Css.renderCssRule(c),imageStyle:Ti.Css.renderCssRule(u),titleStyle:Ti.Css.renderCssRule(d),briefStyle:Ti.Css.renderCssRule(m)}}getData(){let{attrPrefix:t}=this.setup,e=t.length,i=Ti.Dom.attrs(this.$el,i=>"style"==i?i:i.startsWith(t)?_.camelCase(i.substring(e)):void 0),{style:s,wallClass:n,wallStyle:r,tileStyle:a,imageStyle:o,titleStyle:l,briefStyle:h}=i;return i.wallClass=Ti.Dom.getClassList(n).join(" "),i.style=Ti.Css.parseCssRule(s),i.wallStyle=Ti.Css.parseCssRule(r),i.tileStyle=Ti.Css.parseCssRule(a),i.imageStyle=Ti.Css.parseCssRule(o),i.titleStyle=Ti.Css.parseCssRule(l),i.briefStyle=Ti.Css.parseCssRule(h),i.type=this.$el.getAttribute("ti-album-type"),i}covertToPhotos(t=[]){let{itemToPhoto:e}=this.setup;return _.map(t,t=>{let i=Ti.Util.explainObj(t,e,{evalFunc:!0});return i.item=t,i})}renderItems(t=[]){let e=this.covertToPhotos(t);this.renderPhotos(e)}renderPhotos(t=[]){let{attrPrefix:e}=this.setup,i=this.getData(),s=Ti.Dom.createElement({tagName:"div",className:["photo-wall",i.wallClass,`layout-${i.layout||"wall"}`],style:i.wallStyle});"falls"==i.layout?this.renderPhotosAsFalls(t,{$wall:s,album:i,attrPrefix:e}):this.renderPhotosAsWall(t,{$wall:s,album:i,attrPrefix:e}),this.$el.innerHTML="",Ti.Dom.appendTo(s,this.$el)}renderPhotosAsWall(t=[],{$wall:e,album:i,attrPrefix:s}){for(let n=0;n<t.length;n++)this.createPhotoTileElement(e,t[n],i,s)}renderPhotosAsFalls(t=[],{$wall:e,album:i,attrPrefix:s}){let{count:n,width:r}=this.evalColumns(e,i);Ti.Dom.setAttrs(this.$el,{count:n,width:r},"ti-album-falls-");let a=[];for(let t=0;t<n;t++){let t=Ti.Dom.createElement({$p:e,tagName:"div",className:"falls-group",style:{width:r}});a.push(t)}let{tileStyle:o,imageStyle:l,titleStyle:h,briefStyle:c}=i,u={tileStyle:o=_.omit(o,"width","maxWidth","minWidth"),imageStyle:l,titleStyle:h,briefStyle:c};for(let e=0;e<t.length;e++){let i=a[e%n];this.createPhotoTileElement(i,t[e],u,s)}}createPhotoTileElement(t,e,{tileStyle:i,imageStyle:s,titleStyle:n,briefStyle:r},a){let{thumb:o,src:l,link:h,name:c,brief:u,item:d}=e,m=Ti.Dom.createElement({$p:t,tagName:"a",className:"wall-tile",style:i,attrs:{href:h||null,title:c||null,target:"_blank"}}),p=Ti.Dom.createElement({$p:m,tagName:"img",style:s,attrs:{src:o||l,srcLarge:l}});if(c&&!Ti.S.isBlank(c)){Ti.Dom.createElement({$p:m,tagName:"div",className:"tile-title",style:n}).innerText=c.replace(/\r?\n/g," ")}if(u&&!Ti.S.isBlank(u)){Ti.Dom.createElement({$p:m,tagName:"div",className:"tile-brief",style:r}).innerText=u}Ti.Dom.setAttrs(p,d,a)}evalColumns(t,e){let{count:i,width:s}=Ti.Dom.attrs(this.$el,(t,e)=>"ti-album-falls-width"==t?"width":"ti-album-falls-count"==t?{name:"count",value:1*e}:void 0);if(i>0)return{count:i,width:s};this.$el.innerHTML="",Ti.Dom.appendTo(t,this.$el),this.showLoading(t);let n=Ti.Dom.find(".album-loading-stub",t),r=n.clientWidth,a=n.ownerDocument.documentElement.style.fontSize||"100px",o={remBase:Ti.Css.toAbsPixel(a),base:r},l=_.get(e,"tileStyle.width")||"25%",h=Ti.Css.toAbsPixel(l,o);if(h>0)return Ti.Dom.remove(n),{count:Math.floor(r/h),width:l};throw"Fail to eval falls columns count: itW: "+l}getPhotos(){let t=`${this.setup.attrPrefix}layout`;return"falls"==this.$el.getAttribute(t)?this.getFallsPhotos():this.getWallPhotos()}getFallsPhotos(){let t=[],e=Ti.Dom.find(":scope > .photo-wall",this.$el),i=Ti.Dom.findAll(".falls-group",e);if(!_.isEmpty(i)){let e=[],s=0;for(let t of i){let i=Ti.Dom.findAll(".wall-tile",t),n=[];for(let t=0;t<i.length;t++){let e=this.getPhotoDataFromTile(i[t]);n.push(e),s++}e.push(n)}for(;s>0;)for(let i=0;i<e.length;i++){let n=e[i];if(n.length>0){let e=n.shift();t.push(e),s--}}}return t}getWallPhotos(){let t=[],e=Ti.Dom.find(":scope > .photo-wall",this.$el),i=Ti.Dom.findAll(".wall-tile",e);for(let e=0;e<i.length;e++){let s=this.getPhotoDataFromTile(i[e]);t.push(s)}return t}getPhotoDataFromTile(t){let e=this.setup.attrPrefix,i=e.length,s=Ti.Dom.find("img",t),n=Ti.Dom.attrs(s,(t,s)=>{if(t.startsWith(e)){let e=_.camelCase(t.substring(i)),n=s;if(/^\{.*\}$/.test(s))try{n=JSON.parse(s)}catch(t){}return{name:e,value:n}}});return{name:t.getAttribute("title")||null,link:t.getAttribute("href")||null,thumb:s.getAttribute("src")||null,src:s.getAttribute("src-large")||null,item:n}}convertToItems(t=[]){return _.map(t,t=>t.item)}getItems(){let t=this.getPhotos();return this.convertToItems(t)}showLoading(t){(t=t||this.$el).innerHTML=['<div class="album-loading-stub">','<i class="fas fa-spinner fa-spin"></i>',"</div>"].join("")}}return{Album:{getEditFormConfig(t){let e=_.kebabCase(t);return{className:"no-status",spacing:"tiny",fields:[{title:`i18n:hmk-${e}-info`,fields:[{title:`i18n:hmk-${e}-id`,name:"id",comConf:{className:"is-nowrap",fullField:!1}},{title:`i18n:hmk-${e}-name`,name:"name"},{title:"i18n:hmk-w-edit-album-fullpreview",name:"fullpreview",type:"Boolean",comType:"TiToggle"},{title:"i18n:hmk-w-edit-album-autoopen",name:"autoopen",type:"Boolean",comType:"TiToggle"}]},{title:"i18n:hmk-aspect",fields:[{title:"i18n:layout",name:"layout",defaultAs:"wall",comType:"TiSwitcher",comConf:{options:[{value:"wall",text:"i18n:hmk-layout-wall"},{value:"falls",text:"i18n:hmk-layout-falls"}]}},{title:"i18n:style",name:"wallClass",emptyAs:null,comType:"HmPropClassPicker",comConf:{valueType:"String",dialogHeight:600,form:{fields:[{title:"i18n:hmk-class-flex",name:"flexMode",comType:"TiSwitcher",comConf:{options:[{value:"flex-none",text:"i18n:hmk-class-flex-none"},{value:"flex-both",text:"i18n:hmk-class-flex-both"},{value:"flex-grow",text:"i18n:hmk-class-flex-grow"},{value:"flex-shrink",text:"i18n:hmk-class-flex-shrink"}]}},{title:"i18n:hmk-class-item-padding",name:"itemPadding",comType:"TiSwitcher",comConf:{options:[{value:"item-padding-no",text:"i18n:hmk-class-sz-no"},{value:"item-padding-xs",text:"i18n:hmk-class-sz-xs"},{value:"item-padding-sm",text:"i18n:hmk-class-sz-sm"},{value:"item-padding-md",text:"i18n:hmk-class-sz-md"},{value:"item-padding-lg",text:"i18n:hmk-class-sz-lg"},{value:"item-padding-xl",text:"i18n:hmk-class-sz-xl"}]}},{title:"i18n:hmk-class-item-margin",name:"itemMargin",comType:"TiSwitcher",comConf:{options:[{value:"item-margin-no",text:"i18n:hmk-class-sz-no"},{value:"item-margin-xs",text:"i18n:hmk-class-sz-xs"},{value:"item-margin-sm",text:"i18n:hmk-class-sz-sm"},{value:"item-margin-md",text:"i18n:hmk-class-sz-md"},{value:"item-margin-lg",text:"i18n:hmk-class-sz-lg"},{value:"item-margin-xl",text:"i18n:hmk-class-sz-xl"}]}},{title:"i18n:hmk-class-text-at",name:"textAt",comType:"TiSwitcher",comConf:{options:[{value:"at-top",text:"i18n:hmk-class-at-top"},{value:"at-center",text:"i18n:hmk-class-at-center"},{value:"at-bottom",text:"i18n:hmk-class-at-bottom"}]}},{title:"i18n:hmk-class-title-wrap",name:"titleWrap",defaultAs:"title-warp",comType:"TiSwitcher",comConf:{options:[{value:"title-wrap-auto",text:"i18n:hmk-class-text-wrap-auto"},{value:"title-wrap-clip",text:"i18n:hmk-class-text-wrap-clip"},{value:"title-wrap-ellipsis",text:"i18n:hmk-class-text-wrap-ellipsis"}]}},{title:"i18n:hmk-class-object-fit",name:"picFit",comType:"TiSwitcher",comConf:{options:[{value:"pic-fit-fill",text:"i18n:hmk-class-object-fit-fill"},{value:"pic-fit-cover",text:"i18n:hmk-class-object-fit-cover"},{value:"pic-fit-contain",text:"i18n:hmk-class-object-fit-contain"},{value:"pic-fit-none",text:"i18n:hmk-class-object-fit-none"}]}},{title:"i18n:hmk-class-hover",name:"textHover",comType:"TiSwitcher",comConf:{options:[{value:"hover-to-up",text:"i18n:hmk-class-hover-to-up"},{value:"hover-to-scale",text:"i18n:hmk-class-hover-to-scale"},{value:"hover-to-zoom",text:"i18n:hmk-class-hover-to-zoom"}]}}]}}}]},{title:"i18n:hmk-style-adv",fields:[{title:"i18n:hmk-style-outside",name:"style",type:"Object",emptyAs:null,comType:"HmPropCssRules",comConf:{rules:"#BLOCK"}},{title:"i18n:hmk-style-inside",name:"wallStyle",type:"Object",emptyAs:null,comType:"HmPropCssRules",comConf:{rules:"#BLOCK"}},{title:"i18n:hmk-style-tile",name:"tileStyle",type:"Object",emptyAs:null,comType:"HmPropCssRules",comConf:{rules:"#BLOCK"}},{title:"i18n:hmk-style-image",name:"imageStyle",type:"Object",emptyAs:null,comType:"HmPropCssRules",comConf:{rules:"#IMG"}},{title:"i18n:hmk-style-title",name:"titleStyle",type:"Object",emptyAs:null,comType:"HmPropCssRules",comConf:{rules:"#TEXT-BLOCK"}},{title:"i18n:hmk-style-brief",name:"briefStyle",type:"Object",emptyAs:null,comType:"HmPropCssRules",comConf:{rules:"#TEXT-BLOCK"}}]}]}},registryTinyMceMenuItem(t,{prefix:e,settings:i,GetCurrentAlbumElement:s}){const n=(...t)=>_.camelCase(t.join("-"));let r=_.kebabCase(["wn",e].join("-")),a=n("Wn",e,"Prop"),o=n("Wn",e,"Reload"),l=n("Wn",e,"AutoFitWidth"),h=n("Wn",e,"Margin"),c=n("Wn",e,"ClrSize"),u=n("Set",e,"Style"),d=n("Reload",e),m=n("Show",e,"Prop"),p=_.kebabCase(e);return t.ui.registry.addMenuItem(c,{text:Ti.I18n.text(`i18n:hmk-${p}-clrsz`),onAction(){t.execCommand(u,t,{width:"",height:"",maxWidth:"",maxHeight:"",minWidth:"",minHeight:""})}}),t.ui.registry.addMenuItem(l,{text:Ti.I18n.text(`i18n:hmk-${p}-autofit`),onAction(){t.execCommand(u,t,{width:"100%",maxWidth:"",minWidth:""})}}),t.ui.registry.addMenuItem(h,{text:Ti.I18n.text(`i18n:hmk-${p}-margin`),getSubmenuItems:function(){const e=function(e,i){let n=s(t),r=!0;if(n){r=i==(n.style.marginLeft||n.style.marginRight)}return e.setActive(r),function(){}};return[{type:"togglemenuitem",text:Ti.I18n.text("i18n:hmk-margin-sm"),onAction(){t.execCommand(u,t,{margin:"1em"})},onSetup:function(t){return e(t,"1em")}},{type:"togglemenuitem",text:Ti.I18n.text("i18n:hmk-margin-md"),onAction(){t.execCommand(u,t,{margin:"2em"})},onSetup:function(t){return e(t,"2em")}},{type:"togglemenuitem",text:Ti.I18n.text("i18n:hmk-margin-lg"),onAction(){t.execCommand(u,t,{margin:"3em"})},onSetup:function(t){return e(t,"3em")}},{type:"menuitem",icon:"align-center",text:Ti.I18n.text("i18n:hmk-margin-center"),onAction(){t.execCommand(u,t,{margin:"0 auto"})}},{type:"menuitem",icon:"square-6",text:Ti.I18n.text("i18n:hmk-margin-no"),onAction(){t.execCommand(u,t,{margin:""})}}]}}),t.ui.registry.addMenuItem(o,{icon:"sync-alt-solid",text:Ti.I18n.text(`i18n:hmk-${p}-refresh`),onAction(){t.execCommand(d,t,i)}}),t.ui.registry.addMenuItem(a,{text:Ti.I18n.text(`i18n:hmk-${p}-prop`),onAction(){t.execCommand(m,t,i)}}),t.ui.registry.addContextMenu(r,{update:function(e){let i=s(t);return _.isElement(i)?[[c,l].join(" "),[h,o].join(" "),a].join(" | "):[]}}),{NM_MENU:r,NM_PROP:a,NM_RELOAD:o,NM_AUTO_FIT_WIDTH:l,NM_MARGIN:h,NM_CLR_SZ:c,CMD_SET_STYLE:u,CMD_RELOAD:d,CMD_PROP:m}},getOrCreate:(t,i={})=>(t.__ti_photo_wall||(t.__ti_photo_wall=new e(t,i)),t.__ti_photo_wall)}}}(),{PhotoGallery:PhotoGallery}=function(){class t{constructor(t,e){this.currentIndex=0,this.$doc=t.ownerDocument,this.$el=t,this.setup=_.assign({className:"ti-widget-photo-gallery",topStyle:{},viewportStyle:{},scrollerStyle:{},tileStyle:{},imgStyle:{},indicatorStyle:{},indicatorUlStyle:{},indicatorItStyle:{},indicatorItImgStyle:{},thumbKey:"src",largeKey:"src-large",titleKey:"title",zoomStep:-.1},e),this.$top=null,this.zoomScale=1,this.translateX=0,this.translateY=0}getData(){let{thumbKey:t,largeKey:e,titleKey:i,getData:s}=this.setup;if(_.isFunction(s))return s(this);let n=[],r=Ti.Dom.findAll("img[src]",this.$el);for(let s=0;s<r.length;s++){let a,o=r[s],l=o.getAttribute(t),h=o.getAttribute(e),c=o.getAttribute(i),u=Ti.Dom.closest(o,"a[href]");u&&("#"!=(a=u.getAttribute("href"))&&"void(0)"!=a||(a=void 0)),n.push({index:s,srcThumb:l,srcLarge:h,link:a,title:c,src:h||l})}return n}findPhotoIndex(t,e=this.data){let i=t;if(_.isElement(i)&&(i=i.getAttribute("src")),_.isArray(e))for(let t=0;t<e.length;t++){let s=e[t];if(s.srcLarge==i||s.srcThumb==i)return t}return-1}scrollToPrev(){this.currentIndex>0&&this.scrollTo(this.currentIndex-1)}scrollToNext(){this.currentIndex<this.data.length-1&&this.scrollTo(this.currentIndex+1)}scrollTo(t=this.currentIndex){let{imgStyle:e}=this.setup;this.resizePhotos(this.$scroller),this.zoomScale=1,this.translateX=0,this.translateY=0,this.applyImageTransform();let i=this.$viewport.clientWidth,s=t||0;this.currentIndex=s;let n=i*this.currentIndex*-1;this.$scroller.style.left=`${n}px`;let r=this.getImageTile(s);if(r&&"yes"==r.getAttribute("img-nil")){let t=r.getAttribute("src-thumb"),i=Ti.Dom.find("span",r);i&&Ti.Dom.updateStyle(i,{backgroundImage:`url(${t})`});let s=r.getAttribute("src-large");if(Ti.Dom.createElement({$p:r,tagName:"img",style:e,attrs:{src:s}}).addEventListener("load",()=>{r.removeAttribute("img-nil"),r.setAttribute("img-loaded","yes")},{once:!0}),_.isElement(this.$opener)){let t=_.trim(r.getAttribute("href"))||null;Ti.Dom.setAttrs(this.$opener,{href:t})}}this.$currentImg=Ti.Dom.find("img",r);let a=Ti.Dom.find("a.is-current",this.$indicatorUl);a&&Ti.Dom.removeClass(a,"is-current"),(a=Ti.Dom.find(`a[gallery-index="${s}"]`,this.$indicatorUl))&&Ti.Dom.addClass(a,"is-current"),0==this.currentIndex?Ti.Dom.addClass(this.$top,"no-prev"):Ti.Dom.removeClass(this.$top,"no-prev"),this.currentIndex>=this.data.length-1?Ti.Dom.addClass(this.$scroller,"no-next"):Ti.Dom.removeClass(this.$scroller,"no-next")}scrollIndicatorToPage(t=-1){let e=Ti.Css.toPixel(this.$indicatorUl.style.left||0),i=this.$indicatorCon.clientWidth;this.scrollIndicatorTo(e+i*t)}scrollIndicatorTo(t=0){let e=this.$indicatorCon.clientWidth-this.$indicatorCon.scrollWidth,i=_.clamp(t,e,0);this.$indicatorUl.style.left=`${i}px`}getImageTile(t=this.currentIndex){return Ti.Dom.find(`.as-tile[gallery-index="${t}"]`,this.$scroller)}applyImageTransform(){let t={transform:1!=this.zoomScale?`scale(${this.zoomScale})`:"",left:this.translateX?`${this.translateX}px`:"",top:this.translateY?`${this.translateY}px`:""};Ti.Dom.updateStyle(this.$currentImg,t);let e=Ti.Dom.closest(this.$currentImg,".as-tile");e&&(this.zoomScale>1?e.setAttribute("img-zoom","in"):this.zoomScale<1?e.setAttribute("img-zoom","out"):e.removeAttribute("img-zoom"))}changeZoomScale(t){t>0?this.zoomScale+=this.zoomScale*this.setup.zoomStep:t<0&&(this.zoomScale-=this.zoomScale*this.setup.zoomStep,this.zoomScale=Math.max(0,this.zoomScale)),this.applyImageTransform()}resizePhotos(t=this.$scroller){let e=`${this.$viewport.clientWidth}px`,i=`${this.$viewport.clientHeight}px`,s=Ti.Dom.findAll(".as-tile",t);for(let t of s)t.style.width=e,t.style.height=i;let n=this.$indicatorCon;n.scrollWidth>n.clientWidth?this.$indicator.setAttribute("item-overflow","yes"):this.$indicator.removeAttribute("item-overflow"),this.renderClipIndicatorPhotos()}renderClipIndicatorPhotos(){let{indicatorItImgStyle:t}=this.setup,e=Ti.Rects.createBy(this.$indicatorCon),i=Ti.Dom.findAll("a[img-nil]",this.$indicatorUl);for(let s=0;s<i.length;s++){let n=i[s],r=Ti.Rects.createBy(n);if(e.isOverlap(r)){let e=n.getAttribute("src-thumb");n.innerHTML="",n.removeAttribute("img-nil"),Ti.Dom.createElement({$p:n,tagName:"img",style:t,attrs:{src:e}})}}}renderPhotos(t=this.data){let{tileStyle:e,indicatorItStyle:i}=this.setup,s=Ti.Dom.createElement({tagName:"div"}),n=Ti.Dom.createElement({tagName:"ul"});if(_.isArray(t)){let r=0;for(let a of t){let t=r++,o=Ti.Dom.createElement({$p:s,tagName:"div",className:"as-tile",style:e,attrs:{galleryIndex:t,href:a.link,target:"_blank",srcThumb:a.srcThumb,srcLarge:a.srcLarge,imgNil:"yes"}});Ti.Dom.createElement({$p:o,tagName:"span",className:"nil-img"}).innerHTML='<i class="fas fa-spinner fa-spin"></i>',a.title&&(Ti.Dom.createElement({$p:o,tagName:"header"}).innerText=a.title.replace(/\r?\n/g," "));let l=Ti.Dom.createElement({$p:n,tagName:"a",style:i,attrs:{href:`javascript:void(${t})`,galleryIndex:t,srcThumb:a.srcThumb,imgNil:"yes"}});Ti.Dom.createElement({$p:l,tagName:"span",className:"nil-img"})}}this.currentIndex=0,this.$scroller.innerHTML=s.innerHTML,this.$indicatorUl.innerHTML=n.innerHTML,this.resizePhotos()}redraw(){if(this.$top)return;let{className:t,topStyle:e,viewportStyle:i,scrollerStyle:s,indicatorStyle:n,indicatorUlStyle:r,showOpener:a}=this.setup;this.$top=Ti.Dom.createElement({tagName:"div",className:t||"ti-widget-photo-gallery",style:e}),Ti.Dom.addClass(this.$top,"no-ready"),this.$con=Ti.Dom.createElement({$p:this.$top,tagName:"div",className:"photo-gallery-con"}),this.$viewport=Ti.Dom.createElement({$p:this.$con,tagName:"div",className:"as-viewport",style:i}),this.$scroller=Ti.Dom.createElement({$p:this.$viewport,tagName:"div",className:"as-scroller",style:s}),a&&(this.$opener=Ti.Dom.createElement({$p:this.$viewport,tagName:"a",className:"as-opener",attrs:{target:"_blank"}}),this.$opener.innerHTML='<i class="zmdi zmdi-open-in-new"></i>'),this.$toolbar=Ti.Dom.createElement({$p:this.$viewport,tagName:"div",className:"as-toolbar"}),this.$zoomIn=Ti.Dom.createElement({$p:this.$toolbar,tagName:"a",className:"as-zoom-in",attrs:{href:"javascript:void(0)"}}),this.$zoomIn.innerHTML='<i class="fas fa-search-plus"></i>',this.$zoomOut=Ti.Dom.createElement({$p:this.$toolbar,tagName:"a",className:"as-zoom-out",attrs:{href:"javascript:void(0)"}}),this.$zoomOut.innerHTML='<i class="fas fa-search-minus"></i>',this.$indicator=Ti.Dom.createElement({$p:this.$con,tagName:"div",className:"as-indicator",style:n}),this.$indicatorCon=Ti.Dom.createElement({$p:this.$indicator,tagName:"div",className:"as-indi-con"}),this.$indicatorUl=Ti.Dom.createElement({$p:this.$indicatorCon,tagName:"ul",style:_.assign({left:0},r)}),this.$indiBtnToPrev=Ti.Dom.createElement({$p:this.$indicator,tagName:"div",className:"as-indi-btn to-prev"}),this.$indiBtnToPrev.innerHTML='<span><i class="fas fa-chevron-left"></i></span>',this.$indiBtnToNext=Ti.Dom.createElement({$p:this.$indicator,tagName:"div",className:"as-indi-btn to-next"}),this.$indiBtnToNext.innerHTML='<span><i class="fas fa-chevron-right"></i></span>',this.$switcher=Ti.Dom.createElement({$p:this.$con,tagName:"div",className:"as-switcher"}),this.$btnPrev=Ti.Dom.createElement({$p:this.$switcher,tagName:"div",className:"as-switcher-btn is-prev"}),this.$btnPrev.innerHTML='<span><i class="zmdi zmdi-chevron-left"></i></span>',this.$btnNext=Ti.Dom.createElement({$p:this.$switcher,tagName:"div",className:"as-switcher-btn is-next"}),this.$btnNext.innerHTML='<span><i class="zmdi zmdi-chevron-right"></i></span>',this.$closer=Ti.Dom.createElement({$p:this.$con,tagName:"div",className:"as-closer"}),this.$closer.innerHTML='<a href="javascript:void(0)"><i class="zmdi zmdi-close"></i></a>',Ti.Dom.appendTo(this.$top,this.$doc.body),this.data=this.getData(),this.renderPhotos(),this.$closer.addEventListener("click",()=>this.close()),Ti.Dom.find("span",this.$btnPrev).addEventListener("click",()=>{this.scrollToPrev()}),Ti.Dom.find("span",this.$btnNext).addEventListener("click",()=>{this.scrollToNext()}),this.$indicator.addEventListener("click",({srcElement:t})=>{let e=Ti.Dom.closest(t,"[gallery-index]");if(e){let t=1*e.getAttribute("gallery-index");return void(t>=0&&this.scrollTo(t))}let i=Ti.Dom.closest(t,".as-indi-btn");if(i){let t=Ti.Dom.hasClass(i,"to-prev")?1:-1;this.scrollIndicatorToPage(t)}});let o=this;this.OnResize=function(){Ti.Dom.addClass(o.$top,"is-resizing"),o.resizePhotos(),o.scrollTo(),_.delay(()=>{Ti.Dom.removeClass(o.$top,"is-resizing")},100)},this.OnWheel=function(t){t.preventDefault(),t.stopPropagation(),this.changeZoomScale(t.deltaY)},Ti.Dom.removeClass(this.$top,"no-ready"),Ti.Dom.addClass(this.$top,"is-ready")}watchEvents(){this.$doc.defaultView.addEventListener("resize",this.OnResize,!0),this.$top.onwheel=(t=>{this.OnWheel(t)}),this.$top.ondblclick=(t=>{Ti.Dom.closest(t.srcElement,".as-toolbar")||(this.zoomScale=1,this.translateX=0,this.translateY=0,this.applyImageTransform())}),this.$zoomIn.onclick=(t=>{t.stopPropagation(),this.changeZoomScale(-1)}),this.$zoomOut.onclick=(t=>{t.stopPropagation(),this.changeZoomScale(1)}),this.$indicatorUl.addEventListener("transitionend",_.debounce(()=>{this.renderClipIndicatorPhotos()},500)),"desktop"==this.$doc.documentElement.getAttribute("as")&&Ti.Be.Draggable(this.$top,{prepare:t=>{t.$event.preventDefault(),t._x=this.translateX,t._y=this.translateY},actived:()=>{Ti.Dom.addClass(this.$scroller,"is-moving")},dragging:({_x:t,_y:e,offsetX:i,offsetY:s})=>{this.translateX=t+i,this.translateY=e+s,this.applyImageTransform()},done:()=>{Ti.Dom.removeClass(this.$scroller,"is-moving")}})}unwatchEvents(){this.$doc.defaultView.removeEventListener("resize",this.OnResize,!0)}close(){_.isFunction(this.setup.onBeforeClose)&&this.setup.onBeforeClose(),this.$top&&(this.$top.addEventListener("transitionend",()=>{Ti.Dom.remove(this.$top),this.$top=null,_.isFunction(this.setup.onClosed)&&this.setup.onClosed()},{once:!0}),Ti.Dom.removeClass(this.$top,"is-ready"),Ti.Dom.addClass(this.$top,"no-ready"),this.unwatchEvents())}}return{PhotoGallery:{bind(e,i={}){if(!e.__ti_photo_gallery){let s=new t(e,i);e.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),s.redraw(),s.watchEvents();let e=t.srcElement;s.currentIndex=Math.max(0,s.findPhotoIndex(e)),s.scrollTo()},!0),e.__ti_photo_gallery=s}return e.__ti_photo_gallery}}}}(),{WalnutAppMain:WalnutAppMain}=function(){return{WalnutAppMain:async function({rs:t="/gu/rs/",appName:e="wn.manager",preloads:i=[],debug:s=!1,logging:n={root:"warn"},shortcute:r=!0,theme:a,lang:o="zh-cn",viewport:l={phoneMaxWidth:540,tabletMaxWidth:768,designWidth:1e3,max:100,min:80}}={}){Ti.AddResourcePrefix(t),Vue.use(Ti.Vue.EventBubble),Vue.use(Ti.Vue.TiCom),Ti.SetForDev(s),Ti.SetLogLevel(n.root),_.forEach(n.names,(t,e)=>{Ti.SetLogLevel(t,e)}),r&&Ti.Shortcut.startListening(),l&&Ti.Viewport.startListening(),Ti.SetAppName(e),Ti.Config.set({prefix:{app:"/a/load/",MyApp:`/a/load/${e}/`,theme:`${t}ti/theme/`,lib:`${t}ti/lib/`,deps:`${t}ti/deps/`,dist:`${t}ti/dist/`,mod:`${t}ti/mod/`,com:`${t}ti/com/`,i18n:`${t}ti/i18n/`},alias:{"^./":"@MyApp:","^@MyApp:?$":"@MyApp:_app.json","^@i18n:(.+)$":`@i18n:${o}/$1`,"/i18n/":`/i18n/${o}/`,"^(@[A-Za-z]+):i18n/(.+)$":`$1:i18n/${o}/$2`},suffix:{"^@theme:":".css","^@app:":"/_app.json","(^@mod:|[/:]mod/)":"/_mod.json","(^@com:|[/:]com/)":"/_com.json","(^@i18n:|[/:]i18n/)":".i18n.json"},lang:o});let h=await Wn.Sys.exec("ti config -cqn",{appName:e,as:"json"});if(_.isEmpty(h)||Ti.Config.update(h),!_.isEmpty(i)){let t=[];_.forEach(i,e=>{t.push(Ti.Load(e))}),await Promise.all(t)}if(h.icons&&Ti.Icons.put(h.icons),h.i18n&&Ti.I18n.put(await Ti.Load(h.i18n)),h.css){let t=[].concat(h.css);for(let e of t){let t=Ti.S.renderBy(e,{theme:a});await Ti.Load(t)}}let c=await Ti.Load("@MyApp");if(_.assign(c.data,h.gui),_.isEmpty(h.components)||Ti.Util.pushUniqValue(c,"components",h.components),_.isEmpty(h.deps)||Ti.Util.pushUniqValue(c,"deps",h.deps),!_.isEmpty(h.preloads)){let t=[];_.forEach(h.preloads,e=>{t.push(Ti.Load(e))}),await Promise.all(t)}if(!_.isEmpty(h.rsPrefixes)){let t=_.concat(h.rsPrefixes);Ti.AddResourcePrefix(...t)}for(let t of _.keys(h.global)){let e=h.global[t],i=await Ti.Load(e);window[t]=i}Ti.I18n.put(await Ti.Load(["@i18n:_ti","@i18n:_wn","@i18n:_net","@i18n:web","@i18n:hmaker","@i18n:ti-datetime"])),Wn.Dict.setup(h.dictionary);let u=Ti.App(c,async t=>{_.merge(t.data,h.data)});await u.init(),Ti.Dom.watchAutoRootFontSize(l,({$root:t,mode:e,fontSize:i})=>{t.style.fontSize=i+"px",t.setAttribute("as",e),Ti.App.eachInstance(t=>{t.commit("viewport/setMode",e)})}),u.commit("session/set",_app.session),Wn.Session.setup(_app.session),u.mountTo("#app"),Ti.App.pushInstance(u);let d="~";return _app.obj&&(d="id:"+_app.obj.id),await u.dispatch("viewport/reload"),await u.dispatch("current/reload",d),u.get("obj")}}}(),{WebAppMain:WebAppMain}=function(){return{WebAppMain:async function({rs:t="/gu/rs/",siteRs:e="/",vars:i={},lang:s="zh-cn",appJson:n,siteId:r,domain:a,preloads:o=[],debug:l=!1,logging:h={root:"warn"},shortcute:c=!0,viewport:u={phoneMaxWidth:640,tabletMaxWidth:900,designWidth:1200,max:100,min:70}}={}){const d=Ti.Util.parseHref(window.location.href);t=_.get(i,"rs")||t,e=_.get(i,"siteRs")||e;let m=_.get(i,"confHome")||`/gu/mnt/project/${a}/_ti/`;if(s=_.get(i,"lang")||s,n.langInPath){let{match:t,group:e}=n.langInPath||{};if(t&&e){let i=new RegExp(t).exec(d.path);i&&(s=_.kebabCase(i[e]))}}if(Ti.AddResourcePrefix(t,e),Vue.use(Ti.Vue.EventBubble),Vue.use(Ti.Vue.TiCom),Ti.SetForDev(l),Ti.SetLogLevel(h.root),_.forEach(h.names,(t,e)=>Ti.SetLogLevel(e,t)),c&&Ti.Shortcut.startListening(),u&&Ti.Viewport.startListening(),Ti.Config.set({prefix:{Site:`${e}`,Conf:`${m}`,theme:`${t}ti/theme/`,lib:`${t}ti/lib/`,deps:`${t}ti/deps/`,dist:`${t}ti/dist/`,mod:`${t}ti/mod/`,com:`${t}ti/com/`,i18n:`${t}ti/i18n/`},alias:{"^./":"@Site:","^@Site:?$":"@Site:_app.json","^@i18n:(.+)$":`@i18n:${s}/$1`,"[:/]i18n/":`$&${s}/`},suffix:{"^@theme:":".css","^@app:":"/_app.json","(^@mod:|[/:]mod/)":"/_mod.json","(^@com:|[/:]com/)":"/_com.json","(^@i18n:|[/:]i18n/)":".i18n.json"},lang:s}),!_.isEmpty(o))for(let t of o)await Ti.Load(t);if(n.css){let t=_.concat(n.css),e={theme:n.theme||"light"};for(let i of t)if(i){let t=Ti.S.renderBy(i,e);await Ti.Load(t)}n.css=void 0}_.isArray(i.deps)&&Ti.Util.pushUniqValue(n,"deps",i.deps),Ti.I18n.put(await Ti.Load(["@i18n:_ti","@i18n:_net","@i18n:_wn","@i18n:web","@i18n:ti-datetime"]));let p=await Ti.App(n,e=>(_.assign(e.store.state,i,{loading:!1,siteId:r,domain:a,rs:t,lang:s}),e));return await p.init(),Ti.App.pushInstance(p),window.TiWebApp=p,Ti.SetAppName(p.name()),Ti.Dom.watchAutoRootFontSize(u,({$root:t,mode:e,fontSize:i})=>{t.style.fontSize=i+"px",t.setAttribute("as",e),Ti.App.eachInstance(t=>{t.commit("viewport/setMode",e)})}),p.mountTo("#app"),await p.dispatch("reload",{loc:d,lang:s}),p}}}(),Facebook=function(){function t(t=[],e=500){let i,s,n;for(let r of t){let t="height";r.width<r.height&&(t="width"),i?r[t]<i[t]&&(i=r):(i=r,n=r),e>0&&n[t]>e&&r[t]<=e&&(n=r),s?r[t]>s[t]&&(s=r):s=r}return e<0?s:0==e?i:n}function e(t,e="v10.0"){return`https://graph.facebook.com/${e}/${t}`}const i={setObjListPreview(t,e){_.forEach(t,t=>{i.setObjPreview(t,t.images,e)})},setObjPreview:(e,i,s)=>((function(e,i=[],{preview:s={type:"font",value:"fas-images"},thumbMinSize:n=500}={}){let r=t(i,n),a=t(i,-1);e.width=_.get(a,"width"),e.height=_.get(a,"height"),e.src=_.get(a,"source"),e.thumb_src=_.get(r,"source"),e.thumb_src?e.preview={type:"image",value:e.thumb_src}:e.preview=s})(e,i,s),e),async getAlbumPhotoList({albumId:t,access_token:i,after:s,fields:n="id,link,name,images,width,height"}={}){if(!t)return;let r=e(`${t}/photos`);return await Ti.Http.get(r,{params:{access_token:i,fields:n,after:s},as:"json"})},async getPhoto({photoId:t,access_token:i,fields:s="id,link,name,images,width,height"}={}){if(!t)return;let n=e(`${t}`);return await Ti.Http.get(n,{params:{access_token:i,fields:s},as:"json"})},async getAlbumList({userId:t,access_token:i,after:s,fields:n="id,name,place,created_time,description,link,count,cover_photo"}={}){let r=e(`${t}/albums`);return await Ti.Http.get(r,{params:{access_token:i,fields:n,after:s},as:"json"})}};return i}(),LOAD_CACHE={};let RS_PREFIXs=[];const ENV={version:"1.6-20210706.174218",dev:!1,appName:null,session:{},log:{ROOT:0}},LOG_LEVELS={error:0,warn:1,info:2,debug:3,trace:4},G_FUNCS={},Ti={Alg:Alg,Be:Be,S:S,Util:Util,App:App,Err:Err,Config:Config,Dom:Dom,Css:Css,Load:Load,Http:Http,Icons:Icons,I18n:I18n,Shortcut:Shortcut,Fuse:Fuse,Random:Random,Storage:Storage,Types:Types,Viewport:Viewport,WWW:WWW,GPS:GPS,GIS:GIS,Validate:Validate,DateTime:DateTime,Num:Num,Trees:Trees,Bank:Bank,Mapping:Mapping,Dict:Dict,DictFactory:DictFactory,Rects:Rects,Rect:Rect,AutoMatch:AutoMatch,Websocket:TiWebsocket,Widget:{Album:Album,PhotoGallery:PhotoGallery},Api:{Facebook:Facebook},Preload:Preload,MatchCache:MatchCache,AddResourcePrefix:AddResourcePrefix,RS_PREFIXs:RS_PREFIXs,LOAD_CACHE:LOAD_CACHE,WalnutAppMain:WalnutAppMain,WebAppMain:WebAppMain,Vue:{EventBubble:VueEventBubble,TiCom:VueTiCom},Alert:Alert,Confirm:Confirm,Prompt:Prompt,Toast:Toast,Captcha:Captcha,Env:(t,e)=>_.isUndefined(t)?ENV:Ti.Util.geset(ENV,t,e),Version:()=>Ti.Env("version"),SetForDev(t=!0){Ti.Env({dev:t})},IsForDev:()=>Ti.Env("dev"),SetAppName(t){Ti.Env({appName:t})},GetAppName:()=>Ti.Env("appName"),SetLogLevel(t=0,e="ROOT"){_.isString(t)&&(t=LOG_LEVELS[t]||0),ENV.log[e]=t},IsError:t=>_IS_LOG(t,LOG_LEVELS.error),IsWarn:t=>_IS_LOG(t,LOG_LEVELS.warn),IsInfo:t=>_IS_LOG(t,LOG_LEVELS.info),IsDebug:t=>_IS_LOG(t,LOG_LEVELS.debug),IsTrace:t=>_IS_LOG(t,LOG_LEVELS.trace),Invoke(t,e=[],i){if(_.isFunction(t))return i=i||this,t.apply(i,e)},InvokeBy(t={},e,i=[],s){if(t)return Ti.Invoke(t[e],i,s||t)},async DoInvoke(t,e=[],i){if(_.isFunction(t))return i=i||this,await t.apply(i,e)},async DoInvokeBy(t={},e,i=[],s){if(t)return await Ti.DoInvoke(t[e],i,s||t)},AddGlobalFuncs(t){_.assign(G_FUNCS,t)},GlobalFuncs:()=>_.assign({},Ti.Types,G_FUNCS)};export default Ti;window&&(window.Ti=Ti);