function Preload(t,e){LOAD_CACHE[t]=e}function AddResourcePrefix(...t){for(let e of t)e&&(e.endsWith("/")?RS_PREFIXs.push(e):RS_PREFIXs.push(e+"/"))}function MatchCache(t){if(t){for(let e of RS_PREFIXs)if(e&&t.startsWith(e)){t=t.substring(e.length);break}return LOAD_CACHE[t]}}function _IS_LOG(t="ROOT",e){let i=ENV.log[t];return _.isUndefined(i)&&(i=ENV.log.ROOT),i>=e}const{Alert:Alert}=function(){return{Alert:async function(t="",{title:e,icon:i,type:n="track",textOk:s="i18n:ok",position:r="center",width:a=480,height:o,vars:l={}}={}){let h=Ti.I18n.textf(t,l),c=i||Ti.Icons.get(n,"zmdi-info"),u=e||Ti.I18n.get(n);return await Ti.App.Open({className:"is-alert in-top-z-index",type:n,width:a,height:o,position:r,title:u,closer:!1,actions:[{text:s,handler:()=>!0}],comType:"modal-inner-body",comConf:{icon:c,text:h},components:{name:"modal-inner-body",globally:!1,props:{icon:void 0,text:void 0},template:'<div class="ti-msg-body as-alert">\n          <div class="as-icon"><ti-icon :value="icon"/></div>\n          <div class="as-text">{{text}}</div>\n        </div>'}})}}}(),{Confirm:Confirm}=function(){return{Confirm:async function(t="",{title:e,icon:i,closer:n=!1,type:s="info",position:r="center",textYes:a="i18n:yes",textNo:o="i18n:no",width:l=480,height:h}={}){let c=Ti.I18n.text(t),u=i||"zmdi-help",d=e||"i18n:confirm";return await Ti.App.Open({type:s,width:l,height:h,position:r,title:d,closer:n,actions:[{text:a,handler:()=>!0},{text:o,handler:()=>!1}],comType:"modal-inner-body",comConf:{icon:u,text:c},components:{name:"modal-inner-body",globally:!1,props:{icon:void 0,text:void 0},template:'<div class="ti-msg-body as-confirm">\n          <div class="as-icon"><ti-icon :value="icon"/></div>\n          <div class="as-text">{{text}}</div>\n        </div>'}})}}}(),{Prompt:Prompt}=function(){return{Prompt:async function(t="",{title:e="i18n:prompt",icon:i,type:n="info",position:s="center",iconOk:r,iconCancel:a,textOk:o="i18n:ok",textCancel:l="i18n:cancel",width:h=480,height:c,trimed:u=!0,placeholder:d="",valueCase:p=null,value:f=""}={}){let m=Ti.I18n.text(t),g=i||"zmdi-keyboard";return await Ti.App.Open({type:n,width:h,height:c,position:s,title:e,closer:!1,result:f,textOk:o,textCancel:l,iconOk:r,iconCancel:a,comType:"modal-inner-body",components:[{name:"modal-inner-body",globally:!1,data:{icon:g,text:m,placeholder:d||f,trimed:u,valueCase:p},props:{value:null},template:'<div class="ti-msg-body as-prompt"\n          v-ti-activable>\n          <div class="as-icon"><ti-icon :value="icon"/></div>\n          <div class="as-text">\n            <div class="as-tip" v-if="text">{{text}}</div>\n            <ti-input\n              :value="value"\n              :trimed="trimed"\n              :placeholder="placeholder"\n              :value-case="valueCase"\n              :focused="true"\n              :auto-select="true"\n              @inputing="onInputing"/>\n          </div>\n        </div>',methods:{onInputing(t){this.$emit("change",t)},__ti_shortcut(t){"ENTER"==t&&Ti.App(this).$vm().close(this.value)}}},"@com:ti/input"]})}}}(),{Captcha:Captcha}=function(){return{Captcha:async function(t="",{title:e="i18n:captcha-tip",type:i="info",position:n="center",iconOk:s,iconCancel:r,textOk:a="i18n:ok",textCancel:o="i18n:cancel",width:l=420,height:h,imgWidth:c,imgHeight:u=50,textChange:d="i18n:captcha-chagne",placeholder:p="i18n:captcha"}={}){return await Ti.App.Open({type:i,width:l,height:h,position:n,title:e,closer:!1,result:"",textOk:a,textCancel:o,iconOk:s,iconCancel:r,comType:"modal-inner-body",components:[{name:"modal-inner-body",globally:!1,data:{src:t,timestamp:Date.now(),imgWidth:c,imgHeight:u,textChange:d,placeholder:p||value},props:{value:null},template:'<div class="web-simple-form">\n          <header style="padding-bottom:0;">\n            <img ref="pic"\n              v-if="src"\n                :style="CaptchaStyle"\n                :src="CaptchaSrc"\n                @load="OnImgLoaded"/>\n          </header>\n          <section>\n            <div class="as-input">\n              <input ref="input"\n                spellcheck="false"\n                :placeholder="placeholder|i18n"\n                :value="value"\n                @input="$emit(\'change\', $refs.input.value)">\n              <span @click="timestamp = Date.now()">\n                <a>{{textChange|i18n}}</a>\n              </span>\n            </div>\n          </section>\n        </div>',computed:{CaptchaStyle(){return Ti.Css.toStyle({width:this.imgWidth,height:this.imgHeight})},CaptchaSrc(){return this.src&&this.timestamp>0?-1==this.src.lastIndexOf("?")?this.src+"?_t="+this.timestamp:this.src+"&_t="+this.timestamp:this.src}},methods:{OnImgLoaded(){Ti.Be.BlinkIt(this.$refs.pic)},__ti_shortcut(t){"ENTER"==t&&Ti.App(this).$vm().close(this.value)}}}]})}}}(),{Toast:Toast}=function(){const{TiRuntimeStack:t}=function(){class t{constructor({setItemViewportMode:t=_.identity}={}){this.viewportMode="desktop",this.stack=[],this.setItemViewportMode=t}push(t){t&&(this.setItemViewportMode(t,this.viewportMode),this.stack.push(t))}remove(t){let e,i=[];for(let n of this.stack)n===t?e=n:i.push(n);return this.stack=i,e}setViewportMode(t){this.viewportMode=t;for(let e of this.stack)this.setItemViewportMode(e,t)}pop(){return this.stack.pop()}}return{TiRuntimeStack:t}}(),e=new t,i=Symbol("toa-options"),n=Symbol("toa-app-instance");class s{constructor(t={}){this[i]=t}async open(){let{position:t="center",icon:s=!0,content:r="i18n:empty",vars:a={},type:o="info",spacing:l=0,duration:h=3e3,closer:c=!0}=this[i],u=Ti.Dom.createElement({$p:document.body,className:"the-stub"});!0===s&&(s=Ti.Icons.get(o));let d={template:'<div class="ti-toast"\n        :class="topClass"\n        :style="topStyle"\n        @click="onClose">\n        <transition :name="transName"\n          @after-leave="onAfterLeave">\n          <div v-if="!hidden"\n            class="toast-con"\n            @click.stop>\n            <div v-if="icon"\n              class="toast-icon">\n              <ti-icon :value="icon"/>\n            </div>\n            <div class="toast-body">{{content|i18n(vars)}}</div>\n            <div v-if="closer && \'center\'!=position"\n              class="toast-closer">\n              <a @click="onClose">{{\'close\'|i18n}}</a>\n            </div>\n          </div>\n        </transition>\n      </div>',data:{position:t,icon:s,content:r,type:o,closer:c,vars:a,hidden:!0},store:{modules:{viewport:"@mod:ti/viewport"}},computed:{topClass(){return Ti.Css.mergeClassName({"as-bar":"center"!=this.position,"as-block":"center"==this.position},[`at-${this.position}`,`is-${this.type}`])},topStyle(){if("center"!=this.position)return{padding:Ti.Css.toSize(l)}},transName(){return`toast-trans-at-${this.position}`}},methods:{onClose(){this.closer&&(this.hidden=!0)},onAfterLeave(){Ti.App(this).$toast.close()},doOpen(){this.hidden=!1},doClose(){this.hidden=!0}}},p=await Ti.App(d);return this[n]=p,await p.init(),p.mountTo(u),p.$toast=this,p.root("doOpen"),e.push(this),h>0&&_.delay(()=>{p.root("doClose")},h),this}$app(){return this[n]}close(){e.remove(this),this.$app().destroy(!0)}}return{Toast:{Open(t,e="info",i="top"){_.isString(t)&&(t=_.isPlainObject(e)?_.assign({position:i,type:"info",content:t,vars:e},e):{type:e||"info",position:i||"top",content:t});let n=new s(t);return n.open(),n},Close(){let t=e.pop();t&&t.close()}}}}(),{Be:Be}=function(){const t={Open:(t,{target:e="_blank",method:i="GET",params:n={},delay:s=100}={})=>new Promise(r=>{let a=Ti.Dom.createElement({$p:document.body,tagName:"form",attrs:{target:e,method:i,action:t},props:{style:"display:none;"}});_.forEach(n,(t,e)=>{Ti.Dom.createElement({$p:a,tagName:"input",props:{name:e,value:t,type:"hidden"}})}),_.delay(function(){a.submit(),r({url:t,target:e,method:i,params:n})},s)}),OpenLink:(e,{target:i="_blank",method:n="GET",delay:s=100}={})=>t.Open(e.url,{target:i,method:n,delay:s,params:e.params}),ScrollWindowTo({x:t=0,y:e=0}={}){window.scrollTo(t,e)},BlinkIt:function(t,e){if(0!=(t=$(t)).length){"function"==typeof(e=e||{})?e={after:e}:"number"==typeof e&&(e={speed:e});var i=t.offset(),n=t[0].ownerDocument,s=$(n),r={width:t.outerWidth(),height:t.outerHeight(),"border-color":"#FF0",background:"#FFA",opacity:.8,position:"fixed",top:i.top-s.scrollTop(),left:i.left-s.scrollLeft(),"z-index":9999999},a=$(e.html||'<div class="z_blink_light">&nbsp;</div>');a.css(r).appendTo(n.body),a.animate({opacity:.1},e.speed||500,function(){$(this).remove(),"function"==typeof e.after&&e.after.apply(t)})}},EditIt(t,e={}){var i=$(t);if(0==i.length||i.hasClass("is-be-editing"))return;i.addClass("is-be-editing"),_.defaults(e,{text:null,width:0,height:0,extendWidth:!0,takePlace:!0,selectOnFocus:!0,copyStyle:["letter-spacing","margin","border","font-size","font-family","line-height","text-align"],ok:function(t,e){this.innerText=t},context:i[0]});const n={jEle:i,$el:i[0],options:e,oldValue:Ti.Util.fallback(e.text,i.text()),onCancel(){this.jMask.remove(),this.jDiv.remove(),this.jEle.css({visibility:""}).removeClass("is-be-editing")},onOk(){let t=_.trim(this.jInput.val());t!=this.oldValue&&e.ok.apply(e.context,[t,e.oldValue,e]),this.onCancel()}};let s=Ti.Rects.createBy(n.$el),r=e.width||s.width,a=e.height||s.height;const o=$('<div class="ti-be-editing as-con"><input></div>'),l=o.find("input"),h=$('<div class="ti-be-editing as-mask"></div>');if(_.assign(n,{jDiv:o,jInput:l,jMask:h,$div:o[0],$input:l[0],$mask:h[0],primaryWidth:r,primaryHeight:a}),h.css({position:"fixed",zIndex:999999,top:0,left:0,right:0,bottom:0}),o.css({position:"fixed",zIndex:1e6,top:s.top,left:s.left,width:r,height:a}),l.css({width:"100%",height:"100%",outline:"none",resize:"none",overflow:"hidden",padding:"0 .06rem",background:"rgba(255,255,50,0.8)",color:"#000",lineHeight:a}).attr({spellcheck:!1}).val(n.oldValue),!_.isEmpty(e.copyStyle)){const t=window.getComputedStyle(n.$el);let i=_.pick(t,e.copyStyle);l.css(i)}return n.jMask.appendTo(document.body),n.jDiv.appendTo(document.body),n.jEle.css({visibility:"hidden"}),e.selectOnFocus?n.$input.select():n.$input.focus(),l.one("blur",()=>{n.onOk()}),l.on("keydown",t=>{let e=t.which;27==e?n.onCancel():13==e&&n.onOk()}),n}};return{Be:t}}(),{Alg:Alg}={Alg:{sha1:t=>(_.isString(t)||(t=JSON.stringify(t)),CryptoJS.SHA1(t).toString()),gcd(t,e){return t=Math.round(t),(e=Math.round(e))?this.gcd(e,t%e):t},gcds(){var t=Array.from(arguments),e=_.flatten(t);if(0==e.length)return NaN;if(1==e.length)return e[0];for(var i=this.gcd(e[0],e[1]),n=2;n<e.length;n++)i=this.gcd(i,e[n]);return i},lcm(t,e){return t=Math.round(t),e=Math.round(e),t*e/this.gcd(t,e)},lcms(){var t=Array.from(arguments),e=_.flatten(t);if(0==e.length)return NaN;if(1==e.length)return e[0];for(var i=this.lcm(e[0],e[1]),n=2;n<e.length;n++)i=this.lcm(i,e[n]);return i}}},{S:S}=function(){const TiStr={sBlank:(t,e)=>TiStr.isBlank(t)?e:t,isBlank:t=>!!_.isString(t)&&(!t||/^\s*$/.test(t)),renderVars:(t={},e="",{iteratee:i,regex:n,safe:s}={})=>((_.isString(t)||_.isNumber(t))&&(t={val:t}),!t||_.isEmpty(t)?_.isArray(t)?[]:"":TiStr.renderBy(e,t,{iteratee:i,regex:n,safe:s})),renderBy(t="",e={},{iteratee:i,regex:n=/(\${1,2})\{([^}]+)\}/g,safe:s=!1}={}){if(!t)return _.isArray(e)?[]:"";if(e=e||{},s){let t=_.isRegExp(s)?s:void 0;e=TiStr.safeDeep(e,t)}if(_.isRegExp(i)&&(n=i,i=void 0),i||(i=(({varName:t,vars:e,matched:i}={})=>{if(i.startsWith("$$"))return i.substring(1);let n=i,s=t.indexOf("?");s>0&&(n=_.trim(t.substring(s+1)),t=_.trim(t.substring(0,s)));let r=!1;t.startsWith("i18n:")&&(r=!0,t=t.substring(5).trim());let a=Ti.Util.fallback(Ti.Util.getOrPick(e,t),n);return r?Ti.I18n.get(a):a})),_.isArray(e)){let i=[];for(let n=0;n<e.length;n++){let s=e[n],r=TiStr.renderBy(t,s);i.push(r)}return i}let r,a=[],o=0;for(;r=n.exec(t);){let s=r.index;s>o&&a.push(t.substring(o,s));let l=i({vars:e,matched:r[0],prefix:r[1],varName:r[2]});a.push(l),o=n.lastIndex}return o<t.length&&a.push(t.substring(o)),a.join("")},safeDeep(t={},e=/['"]/g){return _.isString(t)?t.replace(e,""):_.isArray(t)?_.map(t,t=>this.safeDeep(t,e)):_.isPlainObject(t)?_.mapValues(t,t=>this.safeDeep(t,e)):t},joinWithoutNil(t="",...e){let i=_.flattenDeep(e);return _.filter(i,t=>!Ti.Util.isNil(t)).join(t)},join(t=[],e="",i=null){let n=_.flattenDeep(t);return _.isFunction(i)&&(n=_.map(n,i)),n.join(e)},joinAs(t=[],e="",i=null){let n=null;return i&&(n=(t=>_.isPlainObject(t)?_.get(t,i):i)),TiStr.join(t,e,n)},toJsValue(t="",{autoJson:e=!0,autoDate:i=!0,autoNil:n=!1,trimed:s=!0,context:r={}}={}){if(_.isArray(t)){let a=[],o={autoJson:e,autoDate:i,autoNil:n,trimed:s,context:r};for(let e of t){let t=TiStr.toJsValue(e,o);a.push(t)}return a}if(_.isPlainObject(t)){let a={},o={autoJson:e,autoDate:i,autoNil:n,trimed:s,context:r};return _.forEach(t,(t,e)=>{let i=TiStr.toJsValue(t,o);a[e]=i}),a}if(Ti.Util.isNil(t)||_.isBoolean(t)||_.isNumber(t))return t;let a=s?_.trim(t):t;if(n){if("undefined"==a)return;if("null"==a)return null}if(/^-?[\d.]+$/.test(a))return 1*a;let o=_.get(r,a);if(!_.isUndefined(o))return o;if(/^(true|false|yes|no|on|off)$/.test(a))return/^(true|yes|on)$/.test(a);let l=/^'([^']*)'$/.exec(a);if(l)return l[1];if(e){let e=Ti.Types.safeParseJson(t);if(!_.isUndefined(e))return e}if(i)try{return Ti.Types.toDate(t)}catch(t){}return a},joinArgs(s,args=[],iteratee=TiStr.toJsValue){if(_.isString(s)){if(/^\{.*\}$/.test(s))try{return[eval(`(${s})`)]}catch(t){}let list=s.split(",");for(let t of list){let e=_.trim(t);if(!e)continue;let i=iteratee(e);args.push(i)}return args}if(_.isArray(s))for(let t of s){let e=iteratee(t);args.push(e)}else _.isUndefined(s)||args.push(s);return args},toArray(t,{sep:e=/[:,;\t\n\/]+/g,ignoreNil:i=!0}={}){if(Ti.Util.isNil(t))return[];if(_.isArray(t))return t;if(_.isString(t)&&e){let n=_.map(t.split(e),t=>_.trim(t));return i?_.without(n,""):n}return[t]},toArrayBy:(t,e=",")=>TiStr.toArray(t,{sep:e,ignoreNil:!0}),toObject(t,{sep:e=/[:,;\t\n\/]+/g,ignoreNil:i=!0,keys:n=["value","text?value","icon"]}={}){if(_.isPlainObject(t)||_.isNull(t)||_.isUndefined(t))return t;let s=TiStr.toArray(t,{sep:e,ignoreNil:i}),r=[],a=[];_.forEach(n,t=>{let e=TiStr.toArray(t,{sep:"?"});if(e.length>1){let t=e[0];r.push(t),a.push({name:t,backup:e[1]})}else r.push(t)});let o={};_.forEach(r,(t,e)=>{let n=_.nth(s,e);_.isUndefined(n)&&i||(o[t]=n)});for(let t of a)_.isUndefined(o[t.name])&&(o[t.name]=o[t.backup]);return o},toObjList(t,{sepLine:e=/[,;\n]+/g,sepPair:i=/[:|\/\t]+/g,ignoreNil:n=!0,keys:s=["value","text?value","icon"]}={}){let r=TiStr.toArray(t,{sep:e,ignoreNil:n});return _.map(r,t=>TiStr.toObject(t,{sep:i,ignoreNil:n,keys:s}))},sizeText(t=0,{fixed:e=2,M:i=1024,bytes:n=!1,units:s=["Bytes","KB","MB","GB","PB","TB"]}={}){let r=t,a=0;for(;a<s.length;a++){let t=r/i;if(t<1)break;r=t}let o,l=s[a];return o=r==parseInt(r)?r+l:r.toFixed(e)+l,n?o+` (${t} bytes)`:o},toPercent(t,{fixed:e=2,auto:i=!0}={}){if(!_.isNumber(t))return"NaN";let n=100*t,s=e>=0?n.toFixed(e):n+"";if(i){let t=s.lastIndexOf("."),e=s.lastIndexOf("0");if(t>=0&&e>t){let i=s.length-1;for(;i>=t&&"0"==s[i];i--);i==e||i==t||i++,i<s.length&&(s=s.substring(0,i))}}return s+"%"},toCase(t,e){if(Ti.Util.isNil(t))return t;let i=TiStr.getCaseFunc(e);return _.isFunction(i)?i(t):t},getCaseFunc:t=>({upper:t=>t?t.toUpperCase():t,lower:t=>t?t.toLowerCase():t,camel:t=>_.camelCase(t),snake:t=>_.snakeCase(t),kebab:t=>_.kebabCase(t),start:t=>_.startCase(t)})[t],isValidCase:t=>_.isFunction(TiStr.getCaseFunc(t)),isPhoneNumber:(t="")=>/^(\+\d{2})? *(\d{11})$/.test(t)};return{S:TiStr}}(),{App:App}=function(){const{LoadTiAppInfo:t,LoadTiLinkedObj:e}=function(){function t(t){return/^@https?:\/\//.test(t)?t.substring(1):/^@!(js|css|html|mjs|text|json):\/\//.test(t)?t.substring(1):/^@\/{1,2}/.test(t)?t.substring(1):/^(@[A-Za-z0-9_-]+:?|\.\/)/.test(t)?t:/^(!(m?js|json|css|text):)/.test(t)?t:void 0}function e(i,{LT:n,dynamicPrefix:s,dynamicAlias:r}={}){if(_.isString(i)){if(!/^\.{3}/.test(i)){let a=t(i);if(a){let{url:t,type:i}=Ti.Config.cookUrl(a,{dynamicPrefix:s,dynamicAlias:r});n.isAlreadyInLoading(t)||(n.addItem(t),Ti.Load(t,{dynamicPrefix:s,dynamicAlias:r,cooked:!0,type:i}).then(i=>{let r=Ti.Util.getParentPath(t);e(i,{LT:n,dynamicPrefix:s,dynamicAlias:new Ti.Config.AliasMapping({"^./":r})}),n.loadedItem(t,i),n.tryFinished()}))}}}else if(_.isArray(i))for(let t=0;t<i.length;t++){e(i[t],{LT:n,dynamicPrefix:s,dynamicAlias:r})}else if(_.isPlainObject(i))for(let t in i){e(i[t],{LT:n,dynamicPrefix:s,dynamicAlias:r})}}function i(e,n,s={},{dynamicPrefix:r,dynamicAlias:a}){if(_.isString(e)){if(!/^\.{3}/.test(e)){let o=t(e);if(o){let{url:t,type:e}=Ti.Config.cookUrl(o,{dynamicPrefix:r,dynamicAlias:a});if(s[t])return;let l=n[t].result,h=Ti.Util.getParentPath(t);return i(l,n,s=_.assign({},s,{[t]:!0}),{dynamicPrefix:r,dynamicAlias:new Ti.Config.AliasMapping({"^./":h})})}}}else{if(_.isArray(e)){let t=[];for(let o=0;o<e.length;o++){let l=i(e[o],n,s,{dynamicPrefix:r,dynamicAlias:a});_.isUndefined(l)||t.push(l)}return t}if(_.isPlainObject(e)){let t={};for(let o in e){let l=i(e[o],n,s,{dynamicPrefix:r,dynamicAlias:a});t[o]=l}return t}}return e}function n(t,{dynamicPrefix:n,dynamicAlias:r}={}){return new Promise((a,o)=>{let l=new s(e=>{let s=i(t,e,{},{dynamicPrefix:n,dynamicAlias:r});a(s)});e(t,{dynamicPrefix:n,dynamicAlias:r,LT:l})})}class s{constructor(t){this.itMap={},this.afterLoaded=t}isAlreadyInLoading(t){return!!this.itMap[t]}addItem(t){this.itMap[t]={done:!1,result:void 0}}loadedItem(t,e){let i=this.itMap[t];i.result=e,i.done=!0}tryFinished(){for(let t in this.itMap){if(!this.itMap[t].done)return}this.afterLoaded(this.itMap)}}return{LoadTiLinkedObj:n,LoadTiAppInfo:async function(t={},e=document){let i=await n(t,{"^./":"@MyApp:"});return Ti.IsInfo("TiApp")&&console.log("await LoadTiLinkedObj(conf)",i),i}}}(),{TiAppActionShortcuts:i}=function(){class t{constructor(){this.guards={},this.actions={}}addGuard(t,e,i){e&&_.isFunction(i)&&Ti.Util.pushValue(this.guards,e,{scope:t,func:i})}removeGuard(t,...e){this.guards=this.__remove_by(this.guards,t,e)}isWatched(t,e){let i=this.actions[e];if(_.isArray(i))for(let e of i)if(e.scope===t)return!0;return!1}watch(t,e=[],{$com:i,argContext:n={}}={}){let s=_.without(_.concat(e),null);_.forEach(s,e=>{if(_.isArray(e.items)&&e.items.length>0)this.watch(t,e.items,{$com:i,argContext:n});else if(e.action&&e.shortcut){if(this.isWatched(t,e.shortcut))return;let s=Ti.Shortcut.genActionInvoking(e.action,{$com:i,argContext:n,wait:e.wait});Ti.Util.pushValueBefore(this.actions,e.shortcut,{scope:t,func:s,prevent:Ti.Util.fallback(e.prevent,!0),stop:Ti.Util.fallback(e.stop,!0)})}})}unwatch(t,...e){this.actions=this.__remove_by(this.actions,t,e)}__remove_by(t,e,...i){let n=_.flattenDeep(i);if(!e&&_.isEmpty(n))return{};_.isEmpty(n)&&(n=_.keys(t));let s=Ti.Util.isNil(e),r={};return _.forEach(n,i=>{let n=[];_.forEach(t[i],t=>{s||t.scope===e||n.push(t)}),_.isEmpty(n)||(r[i]=n)}),r}fire(t,e,i={stop:!1,prevent:!1,quit:!1}){if(i.quit)return i;let n=Ti.Util.isNil(t),s=this.guards[e];if(_.isArray(s))for(let e of s)if((n||e.scope===t)&&!e.func())return i.quit=!0,i;let r=this.actions[e];if(!_.isArray(r))return i;for(let e of r)if((n||e.scope===t)&&(i.quit|=e.func(),i.stop|=e.stop,i.prevent|=e.prevent,i.quit))return i;return i}}return{TiAppActionShortcuts:t}}(),{TiVue:n}=function(){function t(t,e){let i=!1,n={};return _.forOwn(e,(e,s,r)=>{let a=/^\.{3}(.*)$/.exec(s);if(a){i=!0;let s=a[1];t&&_.assign(n,function(t,e){const i={};return _.forOwn(e,(e,n)=>{let s="map"+_.capitalize(n);t?_.assign(i,Vuex[s](t,e)):_.assign(i,Vuex[s](e))}),i}(s,e))}}),i?n:e}const e={StoreConfig(t={},i=null){let n=Ti.Util.merge({modules:{}},t.mixins);return!t.state&&n.state||(n.state=Ti.Util.genObj(t.state)),n.getters=_.assign(n.getters,Ti.Util.merge({},t.getters)),n.mutations=_.assign(n.mutations,Ti.Util.merge({},t.mutations)),n.actions=_.assign(n.actions,Ti.Util.merge({},t.actions)),Ti.I18n.put(t.i18n),i&&(n.namespaced=!0),_.forEach(t.modules,(t,i)=>{let s;s=i.startsWith(".")?e.StoreConfig(t):e.StoreConfig(t,i),n.modules[i]=s}),n.plugins=[].concat(t.plugins||[]),n},CreateStore:t=>new Vuex.Store({strict:Ti.IsForDev(),...t}),Options({global:i={},conf:n={},store:s}={}){_.isPlainObject(n.i18n)&&Ti.I18n.put(n.i18n);const r=_.pick(n,["data","props","watch"]),a=_.pick(n,["template","render","renderError"]),o=_.pick(n,["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","activated","deactivated","beforeDestroy","destroyed","errorCaptured"]),l=_.pick(n,["directives","filters","components"]);_.forOwn(l,function(t,n,s){const r=_.flattenDeep([t]),a=[];for(let t of r)t.globally?("components"==n&&(t=e.Options({conf:t,global:i})),Ti.Util.pushValue(i,n,t)):a.push(t);s[n]=a});const h=_.pick(n,["mixins","extends"]),c=_.pick(n,["name","delimiters","functional","model","inheritAttrs","comments","inject","provide"]);let u={..._.mapValues(r,t=>Ti.Util.merge({},t)),...a,..._.mapValues(o,Ti.Util.groupCall),directives:Ti.Util.merge({},l.directives),filters:Ti.Util.merge({},l.filters),components:function(){let t={};return _.map(l.components,n=>{t[n.name]=e.Options({conf:n,global:i})}),t}(),...h,...c};_.isFunction(u.data)||(u.data=Ti.Util.genObj(u.data||{}));const d=_.partial(t,s);return _.isArray(n.computed)?u.computed=Ti.Util.mergeWith(d,{},...n.computed):_.isObject(n.computed)&&(u.computed=n.computed),_.isArray(n.methods)?u.methods=Ti.Util.mergeWith(d,{},...n.methods):_.isObject(n.methods)&&(u.methods=n.methods),s&&(u.store=s),u},Setup(t={},i){const n={};return{global:n,options:e.Options({global:n,conf:t,store:i})}},CreateInstance(t,e){const i=Ti.Util.merge({},t.global.filters),n=Ti.Util.merge({},t.global.directives);_.forOwn(i,(t,e)=>{Vue.filter(e,t)}),_.forOwn(n,(t,e)=>{Vue.directive(e,t)});const s=(t,i)=>{if(_.forEach(t.components,s),delete t.components,Ti.I18n.put(t.i18n),_.isFunction(e)&&e(t),!t.name)throw console.warn(`com[${i}] without name`,t),"!!!";this.registerComponent(t.name,t)};return _.forEach(t.global.components,s),_.isFunction(e)&&e(t.options),new Vue(t.options)},registerComponent(t,e){let i=_.upperFirst(_.camelCase(t));Vue.component(i,e)}};return{TiVue:e}}(),{TiAppModal:s}=function(){class t{constructor(){this.className=void 0,this.icon=void 0,this.title=void 0,this.type="info",this.iconOk=void 0,this.textOk="i18n:ok",this.ok=(({result:t})=>t),this.iconCancel=void 0,this.textCancel="i18n:cancel",this.cancel=(()=>void 0),this.actions=null,this.transDelay=350,this.comType="ti-label",this.comConf={},this.components=[],this.closer="default",this.escape=!0,this.mask=!0,this.clickMaskToClose=!1,this.changeToClose=!1,this.position="center",this.width="6.4rem",this.height=void 0,this.spacing=void 0,this.overflow=void 0,this.adjustable=!1,this.result=void 0,this.model={prop:"value",event:"change"},this.modules={},this.events={},this.topActions=[],this.ready=async function(t){},this.preload=async function(t){},this.beforeClosed=async function(t){}}async open(t=_.identity){let e=[];this.actions?e=this.actions:(_.isFunction(this.ok)&&this.textOk&&e.push({icon:this.iconOk,text:this.textOk,handler:this.ok}),_.isFunction(this.cancel)&&this.textCancel&&e.push({icon:this.iconCancel,text:this.textCancel,handler:this.cancel}));let i="";this.model&&(this.model.event&&(i+=` @${this.model.event}="OnChange"`),this.model.prop&&(i+=` :${this.model.prop}="result"`));let n=_.cloneDeep(this.events),s=[];_.forEach(n,(t,e)=>{s.push(`@${e}="OnEvent('${e}', $event)"`)});let r={name:"app.modal",template:`<transition :name="TransName" @after-leave="OnAfterLeave">\n          <div class="ti-app-modal ${this.className||""}"\n            v-if="!hidden"\n              :class="TopClass"\n              :style="TopStyle"\n              @click.left="OnClickTop"\n              v-ti-activable>\n    \n              <div class="modal-con" \n                :class="ConClass"\n                :style="ConStyle"\n                @click.left.stop>\n    \n                <div class="modal-head"\n                  v-if="isShowHead">\n                    <div class="as-icon" v-if="icon"><ti-icon :value="icon"/></div>\n                    <div class="as-title">{{title|i18n}}</div>\n                    <div\n                      v-if="hasTopActionBar"\n                        class="as-bar">\n                          <ti-actionbar\n                            :items="topActions"\n                            align="right"\n                            :status="TopActionBarStatus"/>\n                    </div>\n                </div>\n    \n                <div class="modal-main">\n                  <component\n                    v-if="comType"\n                      class="ti-fill-parent"\n                      :class="MainClass"\n                      :is="comType"\n                      v-bind="TheComConf"\n                      :on-init="OnMainInit"\n                      ${i}\n                      ${s.join(" ")}\n                      @close="OnClose"\n                      @ok="OnOk"\n                      @actions:update="OnActionsUpdated"/>\n                </div>\n    \n                <div class="modal-actions"\n                  v-if="hasActions">\n                    <div class="as-action"\n                      v-for="a of actions"\n                        @click.left="OnClickActon(a)">\n                        <div class="as-icon" v-if="a.icon">\n                          <ti-icon :value="a.icon"/></div>\n                        <div class="as-text">{{a.text|i18n}}</div>\n                    </div>\n                </div>\n    \n                <div class="modal-closer"\n                  v-if="hasCloser"\n                    :class="CloserClass">\n                      <ti-icon value="zmdi-close" @click.native="OnClose"/>\n                </div>\n            </div>\n        </div></transition>`,components:this.components,data:{hidden:!0,icon:this.icon,title:this.title,type:this.type,ready:this.ready,beforeClosed:this.beforeClosed,actions:e,topActions:this.topActions,comType:null,comConf:this.comConf,closer:this.closer,escape:this.escape,mask:this.mask,position:this.position,clickMaskToClose:this.clickMaskToClose,changeToClose:this.changeToClose,width:this.width,height:this.height,spacing:this.spacing,overflow:this.overflow,adjustable:this.adjustable,result:_.cloneDeep(this.result)},store:{modules:_.defaults({viewport:"@mod:ti/viewport"},this.modules)},computed:{TopClass(){let t=Ti.Util.isNil(this.height);return this.getTopClass({"show-mask":this.isShowMask,"no-mask":!this.isShowMask,"has-height":!t,"nil-height":t},`at-${this.position}`)},TopStyle(){if("center"!=this.position)return{padding:Ti.Css.toSize(this.spacing)}},TransName(){return`app-modal-trans-at-${this.position}`},isShowHead(){return this.icon||this.title||this.hasTopActionBar},hasTopActionBar(){return!_.isEmpty(this.topActions)},isShowMask(){return!!this.mask},hasActions(){return!_.isEmpty(this.actions)},hasCloser(){return!!this.closer},isCloserDefault(){return!0===this.closer||"default"==this.closer},ConClass(){return Ti.Css.mergeClassName({"is-show-header":this.isShowHead,"is-hide-header":!this.isShowHead,"is-show-actions":this.hasActions,"is-hide-actions":!this.hasActions,"is-closer-default":this.isCloserDefault,"has-top-action-bar":this.hasTopActionBar},`is-${this.type}`)},ConStyle(){return Ti.Css.toStyle({width:this.width,height:this.height})},MainClass(){return Ti.Css.mergeClassName(`modal-type-is-${this.type}`)},Main(){return this.$store.state.main},TopActionBarStatus(){return _.get(this.Main,"status")},CloserClass(){return Ti.Css.mergeClassName({"as-lamp-cord":!this.isCloserDefault,"as-default":this.isCloserDefault,[`at-${this.closer}`]:!this.isCloserDefault})},TheComConf(){return Ti.Util.explainObj(this,this.comConf)}},methods:{OnClickTop(){this.clickMaskToClose&&(this.hidden=!0)},OnClose(){this.close()},OnOk(t){_.isUndefined(t)&&(t=this.result),this.close(t)},OnChange(t){this.result=t,this.changeToClose&&this.close(this.result)},OnActionsUpdated(t=[]){this.topActions=t,Ti.App(this).reWatchShortcut(t)},OnEvent(t,e){_.get(n,t)(e)},async OnClickActon(t){if(t.handler){let e=Ti.App(this),i={close:!0},n=e.$vm(),s=await t.handler({$app:e,$body:n,$main:n.$main,result:_.cloneDeep(n.result),status:i});i.close?this.close(s):this.setResult(s)}},OnAfterLeave(){Ti.App(this).destroy(!0),t(this.returnValue)},OnMainInit(t){let e=Ti.App(this);this.$main=t,e.$vmMain(t),this.escape&&e.watchShortcut([{action:"root:close",shortcut:"ESCAPE"}]),this.setActived(),this.ready(e)},close(t){_.isUndefined(t)||(this.returnValue=t),this.hidden=!0},setResult(t){this.returnValue=t}},mounted:function(){let t=Ti.App(this);Ti.App.pushInstance(t),this.$nextTick(()=>{this.hidden=!1})},beforeDestroy:async function(){let t=Ti.App(this);_.isFunction(this.beforeClosed)&&await this.beforeClosed(t),Ti.App.pullInstance(t)}},a=Ti.App(r);await a.init();let o=Ti.Dom.createElement({$p:document.body,className:"the-stub"});await this.preload(a),a.mountTo(o),_.delay(()=>{a.$vm().comType=this.comType},this.transDelay||0)}}return{TiAppModal:t}}(),r=Symbol("ti-app"),a=Symbol("ti-info"),o=Symbol("ti-conf"),l=Symbol("ti-store"),h=Symbol("ti-vm"),c=Symbol("ti-vm-main"),u=Symbol("ti-vm-actived");class d{constructor(t={},e){this.appDecorator=e,this.$info(t),this.$conf(null),this.$store(null),this.$vm(null),this.$shortcuts=new i}name(){return this.$info().name}$info(t){return Ti.Util.geset(this,a,t)}$conf(t){return Ti.Util.geset(this,o,t)}$store(t){return Ti.Util.geset(this,l,t)}$vm(t){return Ti.Util.geset(this,h,t)}$vmMain(t){return Ti.Util.geset(this,c,t)}$state(){return this.$store().state}async init(){let e=this.$info(),i=await t(e);await this.appDecorator(i),this.$conf(i),Ti.IsInfo("TiApp")&&console.log("Ti.$conf",this.$conf());let s;if(i.store){let t=n.StoreConfig(i.store);Ti.IsInfo("TiApp")&&console.log("TiVue.StoreConfig:",t),s=n.CreateStore(t),this.$store(s),s[r]=this,Ti.IsInfo("TiApp")&&console.log("Ti.$store",this.$store())}let a=n.Setup(i,s);Ti.IsInfo("TiApp")&&(console.log("TiVue.VueSetup(conf)"),console.log(" -- global:",a.global),console.log(" -- options:",a.options));let o=n.CreateInstance(a,t=>{Ti.Config.decorate(t)});return o[r]=this,this.$vm(o),this}mountTo(t){this.$el=Ti.Dom.find(t),this.$vm().$mount(this.$el),this.$el=this.$vm().$el,this.$el[r]=this}destroy(t=!1){this.$vm().$destroy(),this.$el[r]=null,t&&Ti.Dom.remove(this.$el)}setActivedVm(t=null){this[u]=t;let e=t.tiActivableComIdPath();this.$store().commit("viewport/setActivedIds",e)}setBlurredVm(t=null){if(this[u]==t){let e=t.tiParentActivableCom();this[u]=e;let i=e?e.tiActivableComIdPath():[];this.$store().commit("viewport/setActivedIds",i)}}getActivedVm(){return this[u]}reWatchShortcut(t=[]){this.unwatchShortcut(),this.watchShortcut(t)}watchShortcut(t=[]){this.$shortcuts.watch(this,t,{$com:()=>this.$vmMain(),argContext:this.$state()})}unwatchShortcut(...t){this.$shortcuts.unwatch(this,...t)}guardShortcut(t,e,i){this.$shortcuts.addGuard(t,e,i)}pulloutShortcut(t,e,i){this.$shortcuts.removeGuard(t,e,i)}fireShortcut(t,e){let i={stop:!1,prevent:!1,quit:!1},n=this.getActivedVm();if(n){let e=n.tiActivableComPath(!1);for(let n of e)if(_.isFunction(n.__ti_shortcut)){let e=n.__ti_shortcut(t)||{};if(i.stop|=e.stop,i.prevent|=e.prevent,i.quit|=e.quit,i.quit)break}}return this.$shortcuts.fire(this,t,i),i.prevent&&e.preventDefault(),i.stop&&e.stopPropagation(),i}async exec(t,e){let i=t;if(_.isString(i)){let t=/^(commit|dispatch|root|main):(.+)$/.exec(i);if(!t)return;i={method:t[1],name:t[2]}}return await this[i.method](i.name,e)}commit(t,e){this.$store().commit(t,e)}async dispatch(t,e){return Ti.IsInfo("TiApp")&&console.log("TiApp.dispatch",t,e),await this.$store().dispatch(t,e)}root(t,e){Ti.IsInfo("TiApp")&&console.log("TiApp.self",t,e);let i=this.$vm()[t];if(_.isFunction(i))return i(e);if(_.isUndefined(i))throw Ti.Err.make("e-ti-app-self",{nm:t,payload:e});return i}main(t,e){Ti.IsInfo("TiApp")&&console.log("TiApp.main",t,e);let i=this.$vmMain()[t];if(_.isFunction(i))return i(e);if(_.isUndefined(i))throw Ti.Err.make("e-ti-app-main",{nm:t,payload:e});return i}global(t,...e){let i=_.get(window,t);if(_.isFunction(i))return i.apply(this,e);throw Ti.Err.make("e-ti-app-main",{nm:t,args:e})}get(t){return t?this.$vm()[t]:this.$vm()}async loadView(t){let i;if(t.modType){let s=await Ti.Load(t.modType),r=await e(s,{dynamicAlias:new Ti.Config.AliasMapping({"^./":t.modType+"/"})});r.state||(r.state={}),i=n.StoreConfig(r,!0)}let s=await Ti.Load(t.comType);Ti.Util.pushValue(s,"components",t.components);let r=await e(s,{dynamicAlias:new Ti.Config.AliasMapping({"^./":t.comType+"/"})}),a=n.Setup(r),o=a.options.name||Ti.Util.getLinkName(t.comType);return Ti.IsInfo("TiApp")&&(console.log("TiApp.loadView:",o),console.log(" -- global:",a.global),console.log(" -- options:",a.options)),Ti.Config.decorate(a.options),n.registerComponent(o,a.options),_.map(a.global.components,t=>{Ti.Config.decorate(t),n.registerComponent(t.name,t)}),{...t,comName:o,mod:i}}}const p=function(t,e=_.identity){if(Ti.Util.isNil(t))return null;if(_.isString(t))return Ti.Load(t).then(t=>new d(t,e));if(_.isElement(t)){let e=t,i=e[r];for(;!i&&e.parentElement;)i=(e=e.parentElement)[r];return i}return t instanceof Vue?t.$root[r]:t instanceof Vuex.Store?t[r]:_.isPlainObject(t)?new d(t,e):void 0},f=[];return p.pushInstance=function(t){t&&f.push(t)},p.pullInstance=function(t){t&&_.pull(f,t)},p.topInstance=function(){return _.last(f)},p.hasTopInstance=function(){return f.length>0},p.eachInstance=function(t=_.identity){_.forEach(f,t)},p.allInstance=function(t=_.identity){return f},p.Open=function(t){return new Promise(e=>{let i=new s;_.assign(i,t),i.open(e)})},{App:p}}(),{Err:Err}={Err:{make(t="",e){let i=t;_.isString(t)&&(i={code:t,data:e});let n=i.code.replace(/[.]/g,"-"),s=Ti.I18n.get(n);e&&(_.isPlainObject(e)?s+=" : "+JSON.stringify(e):s+=" : "+e);let r=new Error(s.trim());return _.assign(r,i,{errMsg:s})}}},{Config:Config}=function(){const t={prefix:{},alias:{},suffix:{}};class e{constructor(t){this.list=[],this.reset(t)}reset(t={}){return this.list=[],_.forOwn(t,(t,e)=>{this.list.push({regex:new RegExp(e),newstr:t})}),this}get(t="",e){let i=t;for(let t of this.list)t.regex.test(i)&&(i=i.replace(t.regex,t.newstr));return i||(_.isUndefined(e)?t:e)}}const i=(new e).reset();class n{constructor(t){this.list=[],this.reset(t)}reset(t={}){return _.forOwn(t,(t,e)=>{this.list.push({regex:new RegExp(e),suffix:t})}),this}get(t="",e){let i=t;for(let t of this.list)if(t.regex.test(i)&&!i.endsWith(t.suffix)){i+=t.suffix;break}return i||(_.isUndefined(e)?t:e)}}const s=(new n).reset(),r={AliasMapping:e,version:()=>t.version,set({prefix:e,alias:n,suffix:r,lang:a}={}){e&&(t.prefix=e),n&&(t.alias=n,i.reset(t.alias)),r&&(t.suffix=r,s.reset(t.suffix)),a&&(t.lang=a)},update({prefix:e,alias:n,suffix:r,lang:a}={}){e&&_.assign(t.prefix,e),n&&(_.assign(t.alias,n),i.reset(t.alias)),r&&(_.assign(t.suffix,r),s.reset(t.suffix)),a&&(t.lang=a)},get:(e=null)=>e?_.get(t,e):t,decorate(t){let e=t.name||"Unkown";Ti.Util.pushValue(t,"mixins",{computed:{tiComType:()=>e}})},lang:()=>r.get("lang")||"zh-cn",cookUrl(t,{dynamicPrefix:e={},dynamicAlias:i}={}){let n,s=t,a=/^(!(m?js|json|css|text):)?(.+)$/.exec(t);a&&(n=a[2],s=a[3]);let o=r.url(s,{dynamicPrefix:e,dynamicAlias:i});return n||(n=(a=/\.(m?js|css|json)$/.exec(o))?a[1]:"text"),{type:n,url:o}},url(n="",{dynamicPrefix:r={},dynamicAlias:a}={}){if(/^((https?:)?\/\/)/.test(n))return n;let o=n;if(a){o=(a instanceof e?a:(new e).reset(a)).get(n,null)}o=i.get(o||n),/^.+\.(css|js|mjs|json|txt|text|html|xml)$/.test(o)||(o=s.get(o));let l=/^(@([^:]+):?)(.*)/.exec(o);if(!l)return o;let[h,c]=l.slice(2),u=r[h]||t.prefix[h];if(!u)throw Ti.Err.make("e-ti-config-prefix_without_defined",h);return u+c}};return{Config:r}}(),{Dom:Dom}=function(){const t={createElement({tagName:t="div",attrs:e={},props:i={},className:n="",$p:s=null},r=document){const a=r.createElement(t);return n&&(a.className=Ti.Css.joinClassNames(n)),_.forOwn(e,(t,e)=>{a.setAttribute(e,t)}),_.forOwn(i,(t,e)=>{a[e]=t}),s&&s.appendChild(a),a},appendToHead(t,e=document.head){_.isElement(t)&&_.isElement(e)&&e.appendChild(t)},appendToBody(t,e=document.body){_.isElement(t)&&_.isElement($body)&&$body.appendChild(t)},appendTo(t,e){_.isElement(t)&&_.isElement(e)&&e.appendChild(t)},prependTo(t,e){e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t)},findAll(t="*",e=document){if(!e)return[];return[...e.querySelectorAll(t)]},find:(t="*",e=document)=>e?_.isElement(t)?t:e.querySelector(t):[],remove(e,i){if(_.isString(e)){let n=t.findAll(e,i);for(let e of n)t.remove(e)}else _.isElement(e)&&e.parentNode.removeChild(e)},ownerWindow:t=>t.defaultView?t.defaultView:t.ownerDocument?t.ownerDocument.defaultView:t,autoRootFontSize({$win:t=window,phoneMaxWidth:e=540,tabletMaxWidth:i=768,designWidth:n=1e3,max:s=100,min:r=80,callback:a}={}){const o=window.document,l=document.documentElement;let h=t.innerWidth/n*s,c=Math.min(Math.max(h,r),s);if(_.isFunction(a)){a({$win:t,$doc:o,$root:l,mode:t.innerWidth>i?"desktop":t.innerWidth>e?"tablet":"phone",fontSize:c,width:t.innerWidth,height:t.innerHeight})}},watchDocument(t,e){document.addEventListener(t,e)},unwatchDocument(t,e){document.removeEventListener(t,e)},watchAutoRootFontSize(e={},i,n=window){_.isFunction(e)&&(n=i||window,i=e,e=void 0);let s=_.assign({},e,{$win:n,callback:i});n.addEventListener("resize",()=>{t.autoRootFontSize(s)}),_.delay(()=>{t.autoRootFontSize(s)},1)},setStyle(t,e={}){_.forOwn(e,(e,i)=>{if(_.isNull(e)||_.isUndefined(e))return;let n=_.kebabCase(i);if(""===e)t.style.removeProperty(n);else{let i=_.isNumber(e)?e+"px":e;t.style.setProperty(n,i)}})},setClass(t,...e){let i=_.flattenDeep(e).join(" ");t.className=i},addClass(t,...e){let i=_.flattenDeep(e);for(let e of i){let i=_.trim(e);t.classList.add(i)}},removeClass(t,...e){let i=_.flattenDeep(e);for(let e of i){let i=_.trim(e);t.classList.remove(i)}},hasClass(t,...e){if(!_.isElement(t))return!1;for(let i of e)if(!t.classList.contains(i))return!1;return!0},hasOneClass(t,...e){if(!_.isElement(t))return!1;for(let i of e)if(t.classList.contains(i))return!0;return!1},applyRect(e,i,n="tlwh",s={}){let r=e.ownerDocument.defaultView;_.defaults(s,{width:r.innerWidth,height:r.innerHeight});let a=i.toCss(s,n);t.setStyle(e,a)},dockTo(e,i,{mode:n="H",axis:s={},posListX:r,posListY:a,space:o,viewportBorder:l=4,position:h}={}){h&&(e.style.position=h);let c={src:Ti.Rects.createBy(e),ta:Ti.Rects.createBy(i),win:Ti.Rects.createBy(e.ownerDocument.defaultView)};const u=(t,e,i)=>t<=e?i[0]:t>e&&t<=2*e?i[1]:i[2];if(_.defaults(s,{x:"auto",y:"auto"}),"auto"==s.x){let t=r||{H:["left","right"],V:["right","left"]}[n];s.x=u(c.ta.x,c.win.width/t.length,t)}if("auto"==s.y){let t=a||{H:["bottom","top"],V:["top","center","bottom"]}[n];s.y=u(c.ta.y,c.win.height/t.length,t)}let d=c.win.clone();"H"==n&&("bottom"==s.y?d.top=c.ta.bottom:"top"==s.y&&(d.bottom=c.ta.top),d.updateBy("tlbr"));let p=c.src.dockTo(c.ta,n,{axis:s,space:o,viewport:d,viewportBorder:l,wrapCut:!0});_.delay(()=>{t.applyRect(e,c.src,p)},0)},htmlChipITT({icon:t,text:e,tip:i,more:n}={},{tagName:s="div",className:r="",iconTag:a="div",iconClass:o="",textTag:l="div",textClass:h="",textAsHtml:c=!1,moreTag:u="div",moreClass:d="",wrapperTag:p="",wrapperClass:f="",attrs:m={}}={}){let g="";if(t||e){let p=Ti.Icons.fontIconHtml(t),f=(t,e)=>t&&e?`${t}="${e}"`:"",y=t=>f("class",t),T=[];if(_.forOwn(m,(t,e)=>{T.push(f(e,t))}),T=T.join(" "),g+=`<${s} ${y(r)} ${f("ti-tip",i)} ${T}>`,p&&(g+=`<${a} ${y(o)}">${p}</${a}>`),e){let t=c?e:Ti.I18n.text(e);g+=`<${l} ${y(h)}>${t}</${l}>`}if(n){let t=Ti.I18n.text(n);g+=`<${u} ${y(d)}>${t}</${u}>`}g+=`</${s}>`}return p?`<${p} ${klass(f)}>${g}</${p}>`:g},scrollBarSize:function(){if(!window.SCROLL_BAR_SIZE){var t=0;$("body").append("<div id='div_out' style='position:relative;width:100px;height:100px;overflow-y:scroll;overflow-x:scroll'></div>"),$("#div_out").append("<div id='div_in' style='position:absolute;width:100%;height:100%;'></div>");var e=$("#div_out"),i=$("#div_in");t=e.width()-i.width(),$("#div_out").remove(),$("#div_in").remove(),window.SCROLL_BAR_SIZE=t}return window.SCROLL_BAR_SIZE}};return{Dom:t}}(),{Rect:Rect,Rects:Rects}=function(){function t(t,e,n){let s={},r=i.explainToArray(e,!1);for(let e of r){let i=Ti.Util.fallback(t[e],n);_.isUndefined(i)||(s[e]=i)}return s}class e{constructor(){_.assign(this,{t:"top",l:"left",w:"width",h:"height",r:"right",b:"bottom",x:"x",y:"y"})}explainToArray(t,e=!0){let i=[],n=function(t,e=!0){if(!t)return[];if(_.isArray(t))return t;let i=t.toLowerCase().split("");return e?i.sort():i}(t,e);for(let t of n){let e=this[t];e&&i.push(e)}return i}getKey(t){return this[t]}}const i=new e;class n{constructor(t,e){this.__ti_rect__=!0,this.set(t,e)}set(t={top:0,left:0,width:0,height:0},e){const i=["bottom","height","left","right","top","width","x","y"];if(_.isUndefined(e)){let n=[];for(let e of i){let i=t[e];if(_.isNumber(i)){this[e]=i;let t=e.substring(0,1);n.push(t)}}e=n.join("")}else for(let e of i){let i=t[e];_.isNumber(i)&&(this[e]=i)}return"bhlrtwxy"==e?this:this.updateBy(e)}toString(e="tlwh"){let i=t(this,e,"NaN"),n=[];return _.forEach(i,t=>n.push(t)),n.join(",")}valueOf(){return this.toString()}updateBy(t="tlwh"){return{"height/left/top/width":()=>{this.right=this.left+this.width,this.bottom=this.top+this.height,this.x=this.left+this.width/2,this.y=this.top+this.height/2},"height/right/top/width":()=>{this.left=this.right-this.width,this.bottom=this.top+this.height,this.x=this.left+this.width/2,this.y=this.top+this.height/2},"bottom/height/left/width":()=>{this.top=this.bottom-this.height,this.right=this.left+this.width,this.x=this.left+this.width/2,this.y=this.top+this.height/2},"bottom/height/right/width":()=>{this.top=this.bottom-this.height,this.left=this.right-this.width,this.x=this.left+this.width/2,this.y=this.top+this.height/2},"bottom/left/right/top":()=>{this.width=this.right-this.left,this.height=this.bottom-this.top,this.x=this.left+this.width/2,this.y=this.top+this.height/2},"height/width/x/y":()=>{let t=this.width/2,e=this.height/2;this.top=this.y-e,this.bottom=this.y+e,this.left=this.x-t,this.right=this.x+t},"height/left/width/y":()=>{let t=this.width/2,e=this.height/2;this.top=this.y-e,this.bottom=this.y+e,this.x=this.left+t,this.right=this.left+this.width},"height/right/width/y":()=>{let t=this.width/2,e=this.height/2;this.top=this.y-e,this.bottom=this.y+e,this.x=this.right-t,this.left=this.right-this.width},"height/top/width/x":()=>{let t=this.width/2,e=this.height/2;this.y=this.top+e,this.bottom=this.top+this.height,this.left=this.x-t,this.right=this.x+t},"bottom/height/width/x":()=>{let t=this.width/2,e=this.height/2;this.y=this.bottom-e,this.top=this.bottom-this.height,this.left=this.x-t,this.right=this.x+t}}[i.explainToArray(t).join("/")](),this}raw(e="tlwh",i){return t(this,e,i)}toCss(e={width:window.innerWidth,height:window.innerHeight},i="tlwh",n){var s={top:this.top,left:this.left,width:this.width,height:this.height,right:e.width-this.right,bottom:e.height-this.bottom};return Ti.IsDebug()&&console.log("CSS:",s),t(s,i,n)}relative(t,e={x:0,y:0}){return this.top=this.top-(t.top-e.y),this.left=this.left-(t.left-e.x),this.updateBy("tlwh")}zoom({x:t=1,y:e=t,centre:i=this}={}){return this.top=(this.top-i.y)*e+i.y,this.left=(this.left-i.x)*t+i.x,this.width=this.width*t,this.height=this.height*e,this.updateBy("tlwh")}zoomTo({width:t,height:e,mode:i="contain"}={}){if("contain"==i){if(new n({top:0,left:0,width:t,height:e}).contains(this))return this}let s,r,a=t,o=e,l=this.width/this.height,h=a/o;return l>h?"cover"==i?(r=o,s=o*l):(s=a,r=a/l):l<h?"cover"==i?(s=a,r=a/l):(r=o,s=o*l):(s=a,r=o,x=0,y=0),this.width=s,this.height=r,this.updateBy("tlwh")}centreTo({width:t,height:e,top:i=0,left:n=0}={},{xAxis:s=!0,yAxis:r=!0}={}){if(s&&t>0){let e=t-this.width;this.left=n+e/2}if(r&&e>0){let t=e-this.height;this.top=i+t/2}return this.updateBy("tlwh")}translate({x:t=0,y:e=0}={}){return this.y-=e,this.x-=t,this.updateBy("xywh")}moveTo(t={},e={},n="tl"){_.defaults(t,{x:0,y:0}),_.defaults(e,{x:0,y:0});return{"left/top":()=>{this.left=t.x-e.x,this.top=t.y-e.y,this.updateBy("tlwh")},"right/top":()=>{this.right=t.x+e.x,this.top=t.y-e.y,this.updateBy("trwh")},"bottom/left":()=>{this.left=t.x-e.x,this.bottom=t.y+e.y,this.updateBy("blwh")},"bottom/right":()=>{this.right=t.x+e.x,this.bottom=t.y+e.y,this.updateBy("brwh")}}[i.explainToArray(n).join("/")](),this}dockTo(t,e="H",{axis:i={},space:n={},viewport:r={},viewportBorder:a=4,wrapCut:o=!1}={}){_.isNumber(n)&&(n={x:n,y:n}),_.defaults(i,{x:"center",y:"bottom"}),_.defaults(n,{x:0,y:0});({"V:left/top":()=>{this.right=t.left-n.x,this.top=t.top+n.y,this.updateBy("rtwh")},"V:left/center":()=>{this.right=t.left-n.x,this.y=t.y+n.y,this.updateBy("rywh")},"V:left/bottom":()=>{this.right=t.left-n.x,this.bottom=t.bottom-n.y,this.updateBy("rbwh")},"V:right/top":()=>{this.left=t.right+n.x,this.top=t.top+n.y,this.updateBy("ltwh")},"V:right/center":()=>{this.left=t.right+n.x,this.y=t.y+n.y,this.updateBy("lywh")},"V:right/bottom":()=>{this.left=t.right+n.x,this.bottom=t.bottom-n.y,this.updateBy("lbwh")},"H:left/top":()=>{this.left=t.left+n.x,this.bottom=t.top-n.y,this.updateBy("lbwh")},"H:left/bottom":()=>{this.left=t.left+n.x,this.top=t.bottom+n.y,this.updateBy("ltwh")},"H:center/top":()=>{this.x=t.x+n.x,this.bottom=t.top-n.y,this.updateBy("xbwh")},"H:center/bottom":()=>{this.x=t.x+n.x,this.top=t.bottom+n.y,this.updateBy("xtwh")},"H:right/top":()=>{this.right=t.right-n.x,this.bottom=t.top-n.y,this.updateBy("rbwh")},"H:right/bottom":()=>{this.right=t.right-n.x,this.top=t.bottom+n.y,this.updateBy("rtwh")}})[e+":"+i.x+"/"+i.y]();let l="tl";if(o&&s.isRect(r)){let t=r.clone(a);t.wrap(this),t.contains(this)||(this.overlap(t),l="tlwh")}return l}dockIn(t,e={},i={}){_.defaults(e,{x:"center",y:"center"}),_.defaults(i,{x:0,y:0});return{"left/top":()=>{this.left=t.left+i.x,this.top=t.top+i.y,this.updateBy("ltwh")},"left/center":()=>{this.left=t.left+i.x,this.y=t.y+i.y,this.updateBy("lywh")},"left/bottom":()=>{this.left=t.left+i.x,this.bottom=t.bottom-i.y,this.updateBy("lbwh")},"right/top":()=>{this.right=t.right-i.x,this.top=t.top+i.y,this.updateBy("rtwh")},"right/center":()=>{this.right=t.right-i.x,this.y=t.y+i.y,this.updateBy("rywh")},"right/bottom":()=>{this.right=t.right-i.x,this.bottom=t.bottom-i.y,this.updateBy("brwh")},"center/center":()=>{this.x=t.x+i.x,this.x=t.y+i.y,this.updateBy("xywh")}}[e.x+"/"+e.y](),this}wrap(t){let e=["w","h"];return this.containsX(t)||(t.left>this.left&&t.right>this.right?(t.right=this.right,e.push("r")):(t.left=this.left,e.push("l"))),this.containsY(t)?3==e.length&&e.push("t"):t.top>this.top&&t.bottom>this.bottom?(t.bottom=this.bottom,e.push("b")):(t.top=this.top,e.push("t")),3==e.length&&e.push("l"),4==e.length?t.updateBy(e.join("")):t}wrapCut(t){return this.wrap(t),this.contains(t)||t.overlap(this),t}union(...t){for(let e of t)this.top=Math.min(this.top,e.top),this.left=Math.min(this.left,e.left),this.right=Math.max(this.right,e.right),this.bottom=Math.max(this.bottom,e.bottom);return this.updateBy("tlbr")}overlap(...t){for(let e of t)this.top=Math.max(this.top,e.top),this.left=Math.max(this.left,e.left),this.right=Math.min(this.right,e.right),this.bottom=Math.min(this.bottom,e.bottom);return this.updateBy("tlbr")}contains(t,e=0){return this.containsX(t,e)&&this.containsY(t,e)}containsX(t,e=0){return this.left+e<=t.left&&this.right-e>=t.right}containsY(t,e=0){return this.top+e<=t.top&&this.bottom-e>=t.bottom}isOverlap(t){return this.overlap(t).area()>0}area(){return this.width*this.height}clone(t=0){return new n({left:this.left+t,right:this.right-t,top:this.top+t,bottom:this.bottom-t},"tlbr")}}const s={create:(t,e)=>new n(t,e),createBy(t){if(!t.ownerDocument){let e=Ti.Dom.ownerWindow(t);return new n({top:0,left:0,width:e.innerWidth,height:e.innerHeight})}let e=t.getBoundingClientRect();return new n(e,"tlwh")},union(...t){if(0==t.length)return new n;let e=new n(t[0]);return e.union(...t.slice(1)),e},overlap(...t){if(0==t.length)return new n;let e=new n(t[0]);return e.overlap(...t.slice(1)),e},isRect:t=>t&&t.__ti_rect__&&t instanceof n};return{Rect:n,TiRects:s,Rects:s}}(),{Load:Load}=function(){async function t(e=[],{dynamicPrefix:i,dynamicAlias:n,cooked:r,type:a}={}){if(_.isFunction(e)){return t(e(),{dynamicPrefix:i})}if(_.isArray(e)){let s=[],r=[];return e.forEach((e,a)=>{s.push(t(e,{dynamicPrefix:i,dynamicAlias:n}).then(t=>r[a]=t))}),Promise.all(s).then(()=>r)}if(!_.isString(e))throw Ti.Err.make("e-ti-use-url_must_string",e);if(!r){let t=Ti.Config.cookUrl(e,{dynamicPrefix:i,dynamicAlias:n});a=t.type,e=t.url}let o=Ti.MatchCache(e);if(o)return o;try{return o=await s[a](e)}catch(t){throw Ti.IsWarn("TiLoad")&&console.warn(`TiLoad Fail: [${a}]`,`"${e}"`),t}}class e{constructor(t=(t=>t)){this.cached={},this.loading={},this.doLoad=t}async tryLoad(t,e){let i=this.cached[t];if(!_.isUndefined(i))return void e(i);let n=this.loading[t];if(_.isArray(n)&&n.length>0)return void n.push(e);this.loading[t]=[e];let s=await this.doLoad(t);this.cached[t]=s;let r=this.loading[t];this.loading[t]=null;for(let t of r)t(s)}}const i=new e(async t=>{try{return await import(t)}catch(e){throw Ti.IsWarn("TiLoad")&&console.warn("ti.load.mjs",t,e),e}}),n=new e(async t=>{try{return await Ti.Http.get(t)}catch(e){throw Ti.IsWarn("TiLoad")&&console.warn("ti.load.text",t,e),e}}),s={js:t=>new Promise((e,i)=>{let n=Ti.Dom.find(`script[src="${t}"]`);n?_.defer(e,n):((n=Ti.Dom.createElement({tagName:"script",props:{src:t}})).addEventListener("load",function(t){e(n)},{once:!0}),n.addEventListener("error",function(t){i(t)},{once:!0}),Ti.Dom.appendToHead(n))}),mjs:t=>new Promise((e,n)=>{i.tryLoad(t,t=>{e(t.default)})}),css:t=>new Promise((e,i)=>{let n=Ti.Dom.find(`link[href="${t}"]`);n?_.defer(e,n):((n=Ti.Dom.createElement({tagName:"link",props:{rel:"stylesheet",type:"text/css",href:t}})).addEventListener("load",function(t){e(n)},{once:!0}),n.addEventListener("error",function(t){i(t)},{once:!0}),Ti.Dom.appendToHead(n))}),async json(t){try{let e=await s.text(t);return _.isPlainObject(e)?e:JSON.parse(e)}catch(e){throw Ti.IsWarn("TiLoad")&&console.warn("ti.load.json!!",t,e),e}},text:t=>new Promise((e,i)=>{n.tryLoad(t,e)})};return{Load:t}}(),{Http:Http}=function(){const t={arraybuffer(t){throw"No implement yet!"},blob(t){throw"No implement yet!"},document(t){throw"No implement yet!"},xml(t){throw"No implement yet!"},ajax(e){let i=t.json(e);if(i.ok)return i.data;throw i},json(t){let e=t.responseText,i=_.trim(e)||null;try{return JSON.parse(i)}catch(t){return Ti.Types.safeParseJson(i,i)}},jsonOrText(t){let e=t.responseText;try{let t=_.trim(e)||null;return JSON.parse(t)}catch(t){}return e},text:t=>t.responseText},e={send(t,i={}){if(Ti.IsInfo("TiHttp")&&console.log("TiHttp.send",t,i),!t)return;let{method:n="GET",params:s={},body:r=null,file:a=null,headers:o={},cleanNil:l=!0,progress:h=_.identity,created:c=_.identity,beforeSend:u=_.identity,finished:d=_.identity,readyStateChanged:p=_.identity}=i;if(n=_.upperCase(n),l){let t={};Ti.Util.walk(s,{leaf:(e,i)=>{Ti.Util.isNil(e)||_.set(t,i,e)}}),s=t}let{urlToSend:f,sendData:m}=Ti.Invoke({GET:()=>{let i=e.encodeFormData(s);return{urlToSend:i?t+"?"+i:t}},POST:()=>(_.defaults(o,{"Content-type":"application/x-www-form-urlencoded; charset=utf-8"}),a?{urlToSend:[t,e.encodeFormData(s)].join("?"),sendData:a}:r?{urlToSend:[t,e.encodeFormData(s)].join("?"),sendData:r}:{urlToSend:t,sendData:e.encodeFormData(s)})}[n])||{urlToSend:t},g=new XMLHttpRequest;if(a){if(!g.upload)throw Ti.Err.make("e.ti.http.upload.NoSupported");g.upload.addEventListener("progress",h)}return c(g),new Promise((t,e)=>{g.onreadystatechange=(()=>{p(g,i),4==g.readyState&&(d(g),200==g.status?t(g):e(g))}),g.open(n,f),_.forOwn(o,(t,e)=>{g.setRequestHeader(e,t)}),u(g),g.send(m)})},sendAndProcess:(i,n={})=>e.send(i,n).then(e=>(function(e,{as:i="text"}={}){return Ti.InvokeBy(t,i,[e])})(e,n)),get:(t,i={})=>e.sendAndProcess(t,_.assign({},i,{method:"GET"})),post:(t,i={})=>e.sendAndProcess(t,_.assign({},i,{method:"POST"})),encodeFormData(t={}){let e=[];return _.forOwn(t,(t,i)=>{let n=Ti.Types.toStr(t);e.push(`${i}=${encodeURIComponent(n)}`)}),e.join("&")}};return{Http:e}}(),{I18n:I18n}=function(){function t(t){let i=_.get(e,t);if(i)return i;if(_.isString(t)){let i=t.replace(/\./g,"-");return e[i]}return t}const e={},i={put(t){if(_.isArray(t))for(let e of t)i.put(e);else if(_.isPlainObject(t)){if(_.isBoolean(t.ok))return void console.warn("invalid msgs",t);_.assign(e,t)}},get(e,n){if(e&&e.key&&_.isPlainObject(e))return i.getf(e.key,e.vars);if(e instanceof Error)return e.code?Ti.S.join([i.get(e.code),e.data]," : "):e.message;let s=t(e);return _.isUndefined(s)?_.isUndefined(n)?e:n:s},text(t,e){if(t&&t.text&&_.isPlainObject(t))return i.textf(t.text,t.vars);if(t instanceof Error)return i.get(t);let n=/^i18n:(.+)$/.exec(t);return n?i.get(n[1],e):Ti.Util.fallback(t,e)},getf(e,i={}){if(_.isString(e)){let n=t(e)||e;return Ti.S.renderBy(n,i)}return e},textf(t,e={}){let n=/^i18n:(.+)$/.exec(t);return n?i.getf(n[1],e):Ti.S.renderBy(t,e)},render:(t={},e)=>i.textf(e,t),explain(t){let e=_.trim(t),n=e.indexOf(":");if(n>0){let t=_.trim(e.substring(0,n)),s=_.trim(e.substring(n+1));return i.getf(t,{val:s})}return i.get(e)},translate(t){let e=_.trim(t),n=e.indexOf(":");if(n>0){let t=_.trim(e.substring(0,n)),s=_.trim(e.substring(n+1));return i.get(t)+" : "+s}return i.get(e)}};return{I18n:i}}(),{Icons:Icons}=function(){const t={"7z":"fas-file-archive",apk:"zmdi-android",bin:"fas-file",css:"fab-css3",csv:"fas-file-csv",doc:"far-file-word",docx:"fas-file-word",dmg:"fab-apple",exe:"im-windows-o",gz:"fas-file-archive",hmaker_site:"zmdi-globe-alt",html:"fab-html5",js:"fab-node-js",json:"fas-quote-right",less:"fab-first-order-alt",md:"fab-markdown",mjs:"fab-node-js",mkv:"far-file-video",mp:"fas-file-signature",mp3:"far-file-audio",mp4:"far-file-video",msi:"fab-windows",pdf:"far-file-pdf",py:"fab-python",rar:"fas-file-archive",rss:"fas-rss-square",sass:"fab-first-order",tar:"far-file-archive",tgz:"fas-file-archive",comt:"im-flask",wnml:"fas-file-code",xls:"far-file-excel",xlsx:"fas-file-excel",xml:"far-file-code",zip:"fas-file-archive"},e={audio:"far-file-audio",image:"far-file-image",text:"far-file-alt",video:"far-file-video","text/css":"fab-css3","text/html":"fab-html5","application/x-zip-compressed":"fas-file-archive","application/x-javascript":"fab-js-square","text/javascript":"fab-js-square"},i={add:"zmdi-plus",alert:"zmdi-notifications-none",backward:"zmdi-chevron-left",close:"zmdi-close",confirm:"zmdi-help",create:"zmdi-audio",del:"zmdi-delete",done:"fas-thumbs-up",download:"zmdi-download",edit:"zmdi-edit",error:"zmdi-alert-octagon",forward:"zmdi-chevron-right",help:"zmdi-help-outline",info:"zmdi-info-outline",loading:"fas-spinner fa-spin",processing:"zmdi-settings zmdi-hc-spin",ok:"zmdi-check-circle",prompt:"zmdi-keyboard",refresh:"zmdi-refresh",removed:"far-trash-alt",setting:"zmdi-settings",success:"zmdi-check-circle",track:"zmdi-notifications-none",warn:"zmdi-alert-triangle"},n={FILE:"far-file",DIR:"fas-folder"},s={...t,...e,...n,...i},r="zmdi-cake",a={put({types:s,mimes:a,races:o,names:l,dft:h}={}){_.assign(t,s),_.assign(e,a),_.assign(i,l),_.assign(n,o),_.assign(r,h)},get(a,o=r){if(!a)return o||r;if(_.isString(a))return s[a]||o||r;let{tp:l,type:h,mime:c,race:u,name:d}=a,p=null;if(c){let t=/^([a-z0-9]+)\/(.+)$/.exec(c);t&&(p=t[1])}return t[h||l]||e[c]||e[p]||n[u]||i[d]||o||r},getByName:(t,e=null)=>Ti.Util.fallback(i[t],e,r),evalIconObj(t,e){if(!t)return e;if(_.isString(t)){let e=/^(fa\w|zmdi|im)-([\d\w-]+)$/.exec(t);if(e){let[t,i,n]=e;return{type:"font",value:t,cate:i,name:n}}return{type:"image",value:t}}return t},parseFontIcon(t,e={}){if(!t)return e;let i={className:"material-icons",text:t},n=/^([a-z]+)-(.+)$/.exec(t);return n&&(/^fa[a-z]$/.test(n[1])?(i.className=n[1]+" fa-"+n[2],i.text=null):(i.className=n[1]+" "+t,i.text=null)),i},fontIconHtml(t,e=""){if(!t)return e;let i=a.parseFontIcon(t);return _.isEmpty(i)?e:`<i class="${i.className}">${i.text||""}</i>`}};return{Icons:a}}(),{Fuse:Fuse}=function(){class t{constructor({key:t,everythingOk:e,fail:i,once:n=!1}={}){_.assign(this,{key:t,everythingOk:e,fail:i,once:n})}async explode(){return!!await this.everythingOk()||(await this.fail(),!1)}}class e{constructor(){this.detonators=[]}async fire(){for(let t of this.detonators)if(!await t.explode())return!1;return _.remove(this.detonators,t=>t.once),!0}add(e={}){_.defaults(e,{key:"det-"+this.detonators.length}),e instanceof t?this.detonators.push(e):this.detonators.push(new t(e))}remove(...t){_.pullAllWith(this.detonators,t,(t,e)=>t.key==e)}clear(){this.detonators=[]}}class i{constructor(){this.fuses={}}get(t="main"){return this.fuses[t]}getOrCreate(t="main"){let i=this.get(t);return i||(i=new e,this.fuses[t]=i),i}async fire(t="main"){let e=this.get(t);return!e||await e.fire()}removeFuse(t){let e=this.get(t);return e&&delete this[t],e}clear(t="main"){let e=this.get(t);return e&&e.clear(),e}}return{Fuse:new i}}(),{Random:Random}=function(){const t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".split("");return{Random:{str(e=4,i=t){let n="";for(let s=0;s<e;s++){n+=i[_.random(0,t.length-1)]}return n},obj:(e=t)=>e[_.random(0,t.length-1)],list(t=[],e=t.length){let i=Math.min(e,t.length)-1;for(;i>0;i--){let e=_.random(0,i),n=t[i],s=t[e];t[i]=s,t[e]=n}return t}}}}(),{Storage:Storage}=function(){class t{constructor(t){this.storage=t}get(t,e,i=_.identity){let n=this.storage.getItem(t);return Ti.Util.isNil(n)?e:i(n)}getString(t,e=null){return this.get(t,e)}getObject(t,e={}){return this.get(t,e,t=>JSON.parse(t))}getInt(t,e=-1){return this.get(t,e,t=>parseInt(t))}getBoolean(t,e=!1){return this.get(t,e,t=>!!/^(true|yes|on|ok)$/.test(t))}getNumber(t,e=-1){return this.get(t,e,t=>1*t)}set(t,e){if(_.isNull(e)||_.isUndefined(e))this.remove(t);else{let i=e+"";this.storage.setItem(t,i)}}setObject(t,e={}){(_.isNull(e)||_.isUndefined(e))&&this.remove(t);let i=JSON.stringify(e);this.storage.setItem(t,i)}mergeObject(t,e={}){let i=this.getObject(t);_.merge(i,e),this.setObject(t,i)}remove(t){this.storage.removeItem(t)}clear(){this.storage.clear()}}return{Storage:{session:new t(window.sessionStorage),local:new t(window.localStorage)}}}(),{Shortcut:Shortcut}=function(){const t={genActionInvoking(t,{$com:e,argContext:i={},wait:n=0}={}){const s=t=>n>0?_.debounce(t,n,{leading:!0}):t,r=t=>_.isFunction(t)?t():t;if(_.isFunction(t))return s(t);let a,o,l;if(_.isString(t)){let e=/^((global|commit|dispatch|root|main|\$\w+):|=>)([^()]+)(\((.*)\))?$/.exec(t);if(!e)throw Ti.Err.make("e.action.invalid : "+t,{action:t});a=e[2]||e[1],o=e[3],l=e[5]}else _.isPlainObject(t)&&(a=t.mode,o=t.name,l=t.args);let h,c=Ti.S.joinArgs(l,[],t=>Ti.S.toJsValue(t,{context:i}));if("=>"==a){let i=_.get(window,o);if(!_.isFunction(i))throw Ti.Err.make("e.action.invoke.NotFunc : "+t,{action:t});h=(()=>{let t=r(e);i.apply(t,c)})}else h="$emit"==a||"$notify"==a?()=>{let i=r(e);if(!i)throw Ti.Err.make("e.action.emit.NoCom : "+t,{action:t});i[a](o,...c)}:"$parent"==a?()=>{let i=r(e),n=i[o];if(!_.isFunction(n))throw Ti.Err.make("e.action.call.NotFunc : "+t,{action:t});n.apply(i,c)}:()=>{let t=r(e),i=Ti.App(t),n=i[a],s=_.concat(o,c);n.apply(i,s)};if(!_.isFunction(h))throw Ti.Err.make("e.invalid.action : "+t,{action:t});return s(h)},getUniqueKey(t,{sep:e="+",mode:i="upper"}={}){let n=[];t.altKey&&n.push("ALT"),t.ctrlKey&&n.push("CTRL"),t.metaKey&&n.push("META"),t.shiftKey&&n.push("SHIFT");let s=Ti.S.toCase(t.key,i);return/^(ALT|CTRL|CONTROL|SHIFT|META)$/.test(s)||n.push(" "===s?"SPACE":s),n.join(e)},startListening(){this.isListening||(window.addEventListener("keydown",e=>{let i=t.getUniqueKey(e),n=Ti.App.topInstance();n&&n.fireShortcut(i,e)}),this.isListening=!0)}};return{Shortcut:t}}(),{TiWebsocket:TiWebsocket}={TiWebsocket:{listenRemote({watchTo:t=null,watched:e=_.identity,received:i=_.identity,closed:n=_.identity,error:s=_.identity}={}){let r=window.location.hostname,a=window.location.port,o={"http:":"ws","https:":"wss"}[window.location.protocol],l=[r];a>80&&l.push(a);var h=`${o}://${l.join(":")}/websocket`,c=new WebSocket(h);return _.isPlainObject(t)&&(c.onmessage=function(n){var s=JSON.parse(n.data);if("hi"==s.event){let e=JSON.stringify(t);this.send(e)}else"watched"==s.event?e(s):i(s)}),c.onclose=n,c.onerror=s,c}}},{Validate:Validate}=function(){const t={notNil:t=>!Ti.Util.isNil(t),notEmpty:t=>!_.isEmpty(t),notBlank:t=>!Ti.S.isBlank(t),isNil:t=>Ti.Util.isNil(t),isEmpty:t=>_.isEmpty(t),isBlank:t=>Ti.S.isBlank(t),isPlainObject:t=>_.isPlainObject(t),isBoolean:t=>_.isBoolean(t),isTrue:t=>!0===t,isFalse:t=>!1===t,isTruthy:t=>!!t,isFalsy:t=>!t,isNumber:t=>_.isNumber(t),isString:t=>_.isString(t),isDate:t=>_.isDate(t),inRange:(t,...e)=>_.inRange(t,...e),isMatch:(t,e)=>_.isMatch(t,e),isEqual:(t,e)=>_.isEqual(t,e),isOf:(t,...e)=>{for(let i of e)if(_.isEqual(i,t))return!0;return!1},matchRegex:(t,e)=>_.isRegExp(e)?e.test(t):new RegExp(e).test(t)},e={get(e,i=[],n){_.isFunction(e)&&(e=e());let s=_.get(t,e);if(!_.isFunction(s))throw`Invalid Validate: ${e}`;let r;return r=_.isEmpty(i)?s:_.partialRight(s,...i),n?t=>!r(t):r},evalBy(e,i={}){let n=!1;e.startsWith("!")&&(n=!0,e=_.trim(e.substring(1)));let s=Ti.Util.genInvoking(e,{context:i,funcSet:t,partial:"right"});if(!_.isFunction(s))throw`Invalid TiValidator: "${e}"`;return n?t=>!s(t):s},getBy(t){if(_.isBoolean(t))return()=>t;if(_.isFunction(t))return t;if(_.isString(t))return e.evalBy(t);if(_.isPlainObject(t)){let i=t.name,n=_.isUndefined(t.args)?[]:[].concat(t.args),s=!!t.not;return/^!/.test(i)&&(i=i.substring(1).trim(),s=!0),e.get(i,n,s)}if(_.isArray(t)&&t.length>0){let i=t[0],n=t.slice(1,t.length),s=!1;return/^!/.test(i)&&(i=i.substring(1).trim(),s=!0),e.get(i,n,s)}},checkBy(t,i){let n=e.getBy(t);return!!_.isFunction(n)&&!!n(i)},match(t={},i={},n=!1){if(!t||_.isEmpty(t))return n;if(_.isFunction(i))return!!i(t);if(_.isBoolean(i))return!!i;if(_.isArray(i)){for(let e of i)if(Ti.Validate.match(t,e,n))return!0;return!1}let s=_.keys(i);for(let n of s){let s=_.get(i,n),r=_.get(t,n);if(!e.checkBy(s,r))return!1}return!0},compile:(t,i)=>n=>e.match(n,t,i)};return{Validate:e}}(),{AutoMatch:AutoMatch}=function(){function t(n){if(Ti.Util.isNil(n))return new e;if(_.isBoolean(n))return function(t){let e=!!t;return function(t){return!!t===e}}(n);if(_.isNumber(n))return function(t){return function(e){return e==t}}(n);if(_.isArray(n)){let e=[];for(let i of n){let n=t(i);e.push(n)}return function(...t){return function(e){if(_.isEmpty(t))return!1;for(let i of t)if(i(e))return!0;return!1}}(...e)}if(_.isPlainObject(n))return function(e){let n=[];return _.forEach(e,(e,s)=>{let r=s.startsWith("!"),a=t(e);r&&(s=s.substring(1).trim(),a=i(a)),n.push({key:s,m:a})}),function(t){if(!t||!_.isPlainObject(t))return!1;for(let e of n){let i=e.key,n=_.get(t,i);if(!(0,e.m)(n))return!1}return!0}}(n);if(_.isString(n))return function(t){if(Ti.Util.isNil(t))return e();if(""==t)return function(t){return _.isEmpty(t)};let n=t=>t;t.startsWith("!")&&(n=(t=>i(t)),t=t.substring(1).trim());if(Ti.S.isBlank(t)||"[BLANK]"==t)return n(function(t){return Ti.Util.isNil(t)||Ti.S.isBlank(t)});let s=/^([(\[])([^\]]+)([)\]])$/.exec(t);if(s)return n(function(t){let e=t;_.isString(t)&&(e=/^([(\[])([^\]]+)([)\]])$/.exec(t));if(!e)return function(){return!1};let i=JSON.parse("["+e[2]+"]"),n={val:_.first(i),open:"("==e[1]},s={val:_.last(i),open:")"==e[3]};return function(t){let e=1*t;return!isNaN(e)&&(!(n.open&&e<=n.val)&&(!(e<n.val)&&(!(s.open&&e>=s.val)&&!(e>s.val))))}}(s));if(/^!?\^/.test(t))return n(function(t){let e=!1;t.startsWith("!")&&(e=!0,t=t.substring(1).trim());let i=new RegExp(t);return function(t){return Ti.Util.isNil(t)?e:i.test(t)?!e:e}}(t));if(/\*/.test(t))return n(function(t){let e=!1;t.startsWith("!")&&(e=!0,t=t.substring(1).trim());let i="^"+t.replaceAll("*",".*")+"$",n=new RegExp(i);return function(t){return Ti.Util.isNil(t)?e:n.test(t)?!e:e}}(t));return n(function(t){let e=!1;t.startsWith("~~")&&(e=!0,t=t.substring(2).toUpperCase());return function(i){return Ti.Util.isNil(i)?Ti.Util.isNil(t):e?t==i.toUpperCase():t==i}}(t))}(n);throw Ti.Err.make("e.match.unsupport",n)}function e(){return function(t){return Ti.Util.isNil(t)}}function i(t){return function(e){return!t(e)}}return{AutoMatch:{parse:e=>t(e),test:(e,i)=>t(e)(i)}}}(),{Types:Types}=function(){class TiTime{constructor(t,e){this.hours=0,this.minutes=0,this.seconds=0,this.milliseconds=0,this.__cached={},this.update(t,e)}clone(){return new TiTime(this)}setHours(t=0){this.__cached={},this.hours=_.clamp(t,0,23)}setMinutes(t=0){this.__cached={},this.minutes=_.clamp(t,0,59)}setSeconds(t=0){this.__cached={},this.seconds=_.clamp(t,0,59)}setMilliseconds(t=1){this.__cached={},this.milliseconds=_.clamp(t,0,999)}setTimes({hours:t,minutes:e,seconds:i,milliseconds:n}={}){this.__cached={},this.hours=_.clamp(Ti.Util.fallback(t,this.hours),0,23),this.minutes=_.clamp(Ti.Util.fallback(e,this.minutes),0,59),this.seconds=_.clamp(Ti.Util.fallback(i,this.seconds),0,59),this.milliseconds=_.clamp(Ti.Util.fallback(n,this.milliseconds),0,999)}update(t,e="ms"){if(this.__cached={},_.isDate(t))this.hours=t.getHours(),this.minutes=t.getMinutes(),this.seconds=t.getSeconds(),this.milliseconds=t.getMilliseconds();else if(t instanceof TiTime)this.hours=t.hours,this.minutes=t.minutes,this.seconds=t.seconds,this.milliseconds=t.milliseconds;else if(_.isNumber(t)){let i={ms:t=>Math.round(t),s:t=>Math.round(1e3*t),min:t=>Math.round(1e3*t*60),hr:t=>Math.round(1e3*t*60*60)}[e](t);i=_.clamp(i,0,864e5);let n=parseInt(i/1e3);this.milliseconds=i-1e3*n,this.hours=parseInt(n/3600),n-=3600*this.hours,this.minutes=parseInt(n/60),this.seconds=n-60*this.minutes}else if(_.isString(t)){let e=/^([0-9]{1,2}):?([0-9]{1,2})(:?([0-9]{1,2})([.,]([0-9]{1,3}))?)?$/.exec(t);e&&(e[3]?e[5]?(this.hours=_.clamp(parseInt(e[1]),0,23),this.minutes=_.clamp(parseInt(e[2]),0,59),this.seconds=_.clamp(parseInt(e[4]),0,59),this.milliseconds=_.clamp(parseInt(e[6]),0,999)):(this.hours=_.clamp(parseInt(e[1]),0,23),this.minutes=_.clamp(parseInt(e[2]),0,59),this.seconds=_.clamp(parseInt(e[4]),0,59),this.milliseconds=0):(this.hours=_.clamp(parseInt(e[1]),0,23),this.minutes=_.clamp(parseInt(e[2]),0,59),this.seconds=0,this.milliseconds=0))}return this}get value(){if(!_.isNumber(this.__cached.value)){let t=3600*this.hours+60*this.minutes+this.seconds+Math.round(this.milliseconds/1e3);this.__cached.value=t}return this.__cached.value}get valueInMilliseconds(){if(!_.isNumber(this.__cached.valueInMilliseconds)){let t=36e5*this.hours+6e4*this.minutes+1e3*this.seconds+this.milliseconds;this.__cached.valueInMilliseconds=t}return this.__cached.valueInMilliseconds}toString(t="auto"){"auto"==t?t=this.milliseconds>0?"HH:mm:ss.SSS":this.seconds>0?"HH:mm:ss":"HH:mm":"min"==t&&(t=this.hours<=0?"mm:ss":"HH:mm:ss");let e,i="",n=/a|HH?|KK?|hh?|kk?|mm?|ss?|S(SS)?/g,s=0;for(;e=n.exec(t);){let r=e.index;r>s&&(i+=t.substring(s,r)),s=n.lastIndex;i+={a:()=>this.value>43200?"PM":"AM",H:()=>this.hours,k:()=>this.hours+1,K:()=>this.hours%12,h:()=>this.hours%12+1,m:()=>this.minutes,s:()=>this.seconds,S:()=>this.milliseconds,HH:()=>_.padStart(this.hours,2,"0"),kk:()=>_.padStart(this.hours+1,2,"0"),KK:()=>_.padStart(this.hours%12,2,"0"),hh:()=>_.padStart(this.hours%12+1,2,"0"),mm:()=>_.padStart(this.minutes,2,"0"),ss:()=>_.padStart(this.seconds,2,"0"),SSS:()=>_.padStart(this.milliseconds,3,"0")}[e[0]]()}return s<t.length&&(i+=t.substring(s)),i}}const QUICK_COLOR_TABLE={red:[255,0,0,1],green:[0,255,0,1],blue:[0,0,255,1],yellow:[255,255,0,1],black:[0,0,0,1],white:[255,255,255,1]};class TiColor{constructor(t){this.red=0,this.green=0,this.blue=0,this.alpha=1,this.__cached={},this.update(t)}clone(){return new TiColor([this.red,this.green,this.blue,this.alpha])}setRGBA({r:t,g:e,b:i,a:n}={}){this.__cached={},_.isNumber(t)&&(this.red=_.clamp(t,0,255)),_.isNumber(e)&&(this.green=_.clamp(e,0,255)),_.isNumber(i)&&(this.blue=_.clamp(i,0,255)),_.isNumber(n)&&(this.alpha=_.clamp(n,0,1))}update(t){if(this.__cached={},_.isString(t)){let e=QUICK_COLOR_TABLE[t.toLowerCase()];if(e)this.red=e[0],this.green=e[1],this.blue=e[2],this.alpha=e[3];else{let e,i=t.replace(/[ \t\r\n]+/g,"").toUpperCase();(e=/^#?([0-9A-F])([0-9A-F])([0-9A-F]);?$/.exec(i))?(this.red=parseInt(e[1]+e[1],16),this.green=parseInt(e[2]+e[2],16),this.blue=parseInt(e[3]+e[3],16)):(e=/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2});?$/.exec(i))?(this.red=parseInt(e[1],16),this.green=parseInt(e[2],16),this.blue=parseInt(e[3],16)):(e=/^RGB\((\d+),(\d+),(\d+)\)$/.exec(i))?(this.red=parseInt(e[1],10),this.green=parseInt(e[2],10),this.blue=parseInt(e[3],10)):(e=/^RGBA\((\d+),(\d+),(\d+),([\d.]+)\)$/.exec(i))?(this.red=parseInt(e[1],10),this.green=parseInt(e[2],10),this.blue=parseInt(e[3],10),this.alpha=1*e[4]):(e=/^0[xX]([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2});?$/.exec(i))&&(this.alpha=parseInt(e[1],16)/255,this.red=parseInt(e[2],16),this.green=parseInt(e[3],16),this.blue=parseInt(e[4],16))}}else if(_.isNumber(t)){let e=_.clamp(Math.round(t),0,255);this.red=e,this.green=e,this.blue=e,this.alpha=1}else _.isArray(t)&&t.length>=3?(this.red=_.clamp(Math.round(t[0]),0,255),this.green=_.clamp(Math.round(t[1]),0,255),this.blue=_.clamp(Math.round(t[2]),0,255),this.alpha=t.length>3?t[3]:1):t instanceof TiColor&&(this.red=t.red,this.green=t.green,this.blue=t.blue,this.alpha=t.alpha);return this}get hex(){if(!this.__cached.hex){let t=["#"];t.push(_.padStart(this.red.toString(16).toUpperCase(),2,"0")),t.push(_.padStart(this.green.toString(16).toUpperCase(),2,"0")),t.push(_.padStart(this.blue.toString(16).toUpperCase(),2,"0")),this.__cached.hex=t.join("")}return this.__cached.hex}get rgb(){if(!this.__cached.rgb){let t=[this.red,this.green,this.blue];this.__cached.rgb=`RGB(${t.join(",")})`}return this.__cached.rgb}get rgba(){if(!this.__cached.rgba){return`RGBA(${[this.red,this.green,this.blue,this.alpha].join(",")})`}return this.__cached.rgba}light(t=10){this.red=_.clamp(this.red+t,0,255),this.green=_.clamp(this.green+t,0,255),this.blue=_.clamp(this.blue+t,0,255)}dark(t=10){this.red=_.clamp(this.red-t,0,255),this.green=_.clamp(this.green-t,0,255),this.blue=_.clamp(this.blue-t,0,255)}between(t,e=.5,{}={}){e=_.clamp(e,0,1);let i=t.red-this.red,n=t.green-this.green,s=t.blue-this.blue,r=t.alpha-this.alpha,a=this.red+i*e,o=this.green+n*e,l=this.blue+s*e,h=this.alpha+r*e;return new TiColor([_.clamp(Math.round(a),0,255),_.clamp(Math.round(o),0,255),_.clamp(Math.round(l),0,255),_.clamp(h,0,1)])}adjustByHSL({h:t=0,s:e=0,l:i=0}={}){let n=this.toHSL();return n.h=_.clamp(n.h+t,0,1),n.s=_.clamp(n.s+e,0,1),n.l=_.clamp(n.l+i,0,1),this.fromHSL(n)}toHSL(){let t=this.red,e=this.green,i=this.blue;t/=255,e/=255,i/=255;let n,s,r=Math.max(t,e,i),a=Math.min(t,e,i),o=(r+a)/2;if(r===a)n=s=0;else{var l=r-a;switch(s=o>.5?l/(2-r-a):l/(r+a),r){case t:n=(e-i)/l+(e<i?6:0);break;case e:n=(i-t)/l+2;break;case i:n=(t-e)/l+4}n/=6}return{h:n,s:s,l:o}}fromHSL({h:t,s:e,l:i}={}){let n,s,r,a=function(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t};if(0===e)n=s=r=i;else{let o=i<.5?i*(1+e):i+e-i*e,l=2*i-o;n=a(l,o,t+1/3),s=a(l,o,t),r=a(l,o,t-1/3)}return this.red=Math.round(255*n),this.green=Math.round(255*s),this.blue=Math.round(255*r),this}toString(){return 1==this.alpha?this.hex:this.rgba}}const TiTypes={toStr(t,e,i){if(_.isFunction(e))return e(t)||i;if(Ti.Util.isNil(t))return Ti.Util.fallback(i,null);if(_.isNumber(t)){if(_.isArray(e))return Ti.Util.fallback(_.nth(e,t),t);if(_.isString(e))return Ti.S.renderVars(t,e);let i=""+t;return _.isPlainObject(e)?e[i]:i}if(_.isString(t))return _.isPlainObject(e)?Ti.Util.getOrPick(e,t):_.isString(e)?Ti.S.renderVars(t,e):t;if(_.isArray(t))return t.join(e||",");if(_.isBoolean(t))return(e||["false","true"])[1*t];if(_.isDate(t))return TiTypes.formatDateTime(t,e);if(t instanceof TiTime)return t.toString(e);if(t instanceof TiColor)return t.toString();if(_.isPlainObject(t)){if(!Ti.S.isBlank(e)){if(_.isString(e))return Ti.S.renderVars(t,e);_.isPlainObject(e)&&(t=Ti.Util.translate(t,e))}return JSON.stringify(t,null,e)}return""+t},toNumber(t){if(_.isBoolean(t))return t?1:0;if(_.isDate(t))return t.getTime();let e=1*t;return isNaN(e)?NaN:e},toInteger(t,{mode:e="int",dft:i=NaN,range:n=[],border:s=[!0,!0]}={}){if(_.isBoolean(t))return t?1:0;if(_.isDate(t))return t.getTime();let r={round:t=>Math.round(t),ceil:t=>Math.ceil(t),floor:t=>Math.floor(t),int:t=>parseInt(t)}[e](t);if(isNaN(r)&&(r=i),_.isArray(n)&&2==n.length){_.isArray(s)||(s=[s,s]);let[t,e]=s,[i,a]=n;if(isNaN(r))return Math.round((i+a)/2);if(!_.isNull(i)){if(t&&r<i)return i;if(!t&&r<=i)return i+1}if(!_.isNull(a)){if(e&&r>a)return a;if(!e&&r>=a)return a-1}}return r},toFloat(t,{precision:e=2,dft:i=NaN}={}){let n=1*t;if(isNaN(n))return i;if(e>=0){let t=Math.pow(10,e);return Math.round(n*t)/t}return n},toPercent:(t,{fixed:e=2,auto:i=!0}={})=>Ti.S.toPercent(t,{fixed:e,auto:i}),toBoolean:t=>0!=t&&(!_.isNull(t)&&!_.isUndefined(t)&&!/^(no|off|false)$/i.test(t)),toBoolStr:(t,e="No",i="Yes")=>t?i:e,toObject(t,e){let i=t;return _.isPlainObject(t)&&_.isPlainObject(e)?Ti.Util.translate(i,e):_.isArray(t)?Ti.S.toObject(t,e):_.isString(t)?((/^\{.*\}$/.test(t)||/^\[.*\]$/.test(t))&&(i=JSON.parse(t)),Ti.S.toObject(t,e)):i},toObjByPair(t={},{nameBy:e="name",valueBy:i="value",dft:n={}}={}){let s=t[e],r=t[i],a=_.assign({},n);if(_.isString(s))a[s]=r;else if(_.isArray(s))for(let t of s)a[t]=r[t];return a},toArray(t,{sep:e=/[ ,;\/\r\n]+/}={}){if(Ti.Util.isNil(t))return t;if(_.isArray(t))return t;if(_.isString(t)){if(_.isRegExp(e)){let i=t.split(e);for(let t=0;t<i.length;t++)i[t]=_.trim(i[t]);return _.without(i,void 0,null,"")}return[t]}},toDate(t,e=null){if(_.isNull(t)||_.isUndefined(t))return e;if(_.isArray(t)){let e=[];return _.forEach(t,t=>{e.push(Ti.DateTime.parse(t))}),e}return Ti.DateTime.parse(t)},toDateSec(t,e=null){if(_.isNull(t)||_.isUndefined(t))return e;if(_.isArray(t)){let e=[];return _.forEach(t,t=>{_.isNumber(t)&&(t*=1e3),e.push(Ti.DateTime.parse(t))}),e}return _.isNumber(t)&&(t*=1e3),Ti.DateTime.parse(t)},toTime:(t,{dft:e,unit:i}={})=>_.isNull(t)||_.isUndefined(t)?e:new TiTime(t,i),toColor:(t,e=new TiColor)=>_.isNull(t)||_.isUndefined(t)?e:t instanceof TiColor?t:new TiColor(t),toAMS(t){let e=Ti.DateTime.parse(t);return _.isDate(e)?e.getTime():null},toSec(t){let e=TiTypes.toDateSec(t);return _.isDate(e)?Math.round(e.getTime()/1e3):null},toJson:(t,e="  ")=>JSON.stringify(t,null,e),safeParseJson(str,dft){if(Ti.Util.isNil(str))return null;if(!_.isString(str))return str;try{return JSON.parse(str)}catch(E){let json=str.replace(/(function|=>)/g,"Function");try{return eval("("+json+")")}catch(t){}}return dft},formatTime(t,e="ms",i="auto"){if(_.isUndefined(t)||_.isNull(t))return"";if(_.isArray(t)){let e=[];for(let n of t)e.push(TiTypes.formatTime(n,i));return e}return t instanceof TiTime||(t=new TiTime(t,e)),t.toString(i)},formatDate:(t,e="yyyy-MM-dd")=>Ti.DateTime.format(t,e),formatDateTime:(t,e="yyyy-MM-dd HH:mm:ss")=>Ti.DateTime.format(t,e),toAjaxReturn(t,e){let i=t;if(_.isString(t))try{i=JSON.parse(t)}catch(t){return{ok:!1,errCode:"e.invalid.json_format",data:e}}return _.isBoolean(i.ok)?i:{ok:!0,data:i}},Time:TiTime,Color:TiColor,getFuncByType:(t="String",e="transformer")=>_.get({String:{transformer:"toStr",serializer:"toStr"},Number:{transformer:"toNumber",serializer:"toNumber"},Integer:{transformer:"toInteger",serializer:"toInteger"},Float:{transformer:"toFloat",serializer:"toFloat"},Boolean:{transformer:"toBoolean",serializer:"toBoolean"},Object:{transformer:"toObject",serializer:"toObject"},Array:{transformer:"toArray",serializer:"toArray"},DateTime:{transformer:"toDate",serializer:"formatDateTime"},AMS:{transformer:"toDate",serializer:"toAMS"},ASEC:{transformer:"toDateSec",serializer:"toSec"},Time:{transformer:"toTime",serializer:"formatTime"},Date:{transformer:"toDate",serializer:"formatDate"},Color:{transformer:"toColor",serializer:"toStr"}},`${t}.${e}`),getFuncBy(t={},e,i=TiTypes){let n=TiTypes.evalFunc(t[e],i);if(_.isFunction(n))return n;if(!n&&t.type&&(n=TiTypes.getFuncByType(t.type,e)),_.isString(n))return _.get(i,n);if(_.isPlainObject(n)&&n.name){let t=_.get(i,n.name);if(!_.isFunction(t))return;return _.isArray(n.args)&&n.args.length>0?_.partialRight(t,...n.args):_.isUndefined(n.args)||_.isNull(n.args)?t:_.partialRight(t,n.args)}},getFunc:(t={},e)=>TiTypes.getFuncBy(t,e),evalFunc(t,e=TiTypes){if(_.isFunction(t))return t;if(_.isString(t))return _.get(e,t);if(_.isPlainObject(t)&&t.name){let i=_.get(e,t.name);if(!_.isFunction(i))return;return _.isArray(t.args)&&t.args.length>0?_.partialRight(i,...t.args):_.isUndefined(t.args)||_.isNull(t.args)?i:_.partialRight(i,t.args)}},getJsType:(t,e="Object")=>_.isUndefined(t)?e:_.isNull(t)?"Object":_.isNaN(t)?"Number":_.isNumber(t)?parseInt(t)==t?"Integer":"Number":_.isBoolean(t)?"Boolean":_.isString(t)?"String":_.isArray(t)?"Array":"Object",parseTowStageID(t,e=":"){if(!_.isString(t))return{};let i=t.indexOf(e);return i<0?{homeId:null,myId:_.trim(t)}:{homeId:_.trim(t.substring(0,i)),myId:_.trim(t.substring(i+1))}}};return{TiTime:TiTime,TiColor:TiColor,Types:TiTypes}}(),{Util:Util}=function(){const t={...function(){const t={getLinkName(e){let i=e.lastIndexOf("/"),n=e.lastIndexOf(":"),s=Math.max(i,n),r=s>=0?e.substring(s+1):e;return t.getMajorName(r)},getFileName(t,e=""){if(!t)return e;let i=t.lastIndexOf("/");return i>=0?t.substring(i+1):t},getMajorName(t,e=""){if(!t)return e;for(var i=t.length,n=0,s=i,r=s-1;r>0;r--)if(s==i&&"."==t[r]&&(s=r),"/"==t[r]||"\\"==t[r]){n=r+1;break}return t.substring(n,s)},getSuffixName(t,e){if(!t)return"";var i=t.lastIndexOf("."),n=t.lastIndexOf("/");if(-1==i||i<n)return"";var s=t.substring(i+1);return e?s.toLowerCase():s},getSuffix(t,e){if(!t)return"";var i=t.lastIndexOf("."),n=t.lastIndexOf("/");if(-1==i||i<n)return"";var s=t.substring(i);return e?s.toLowerCase():s},appendPath(...t){let e=[];for(let i of t){if(_.isEmpty(i))continue;let t=/\/*$/.exec(i);t&&(i=i.substring(0,t.index)),e.length>0&&!/^\//.test(i)&&e.push("/"),e.push(i)}return e.join("")},getParentPath(t=""){if(!t||t.endsWith("/"))return t;let e=t.lastIndexOf("/");return e<0?"":t.substring(0,e+1)},getRelativePath(t="",e="",i="."){if(_.isEqual(t,e))return i;let n=t.endsWith("/"),s=e.endsWith("/"),r=_.without(t.split("/"),""),a=_.without(e.split("/"),""),o=Math.min(r.length,a.length),l=0;for(;l<o;l++){if(r[l]!=a[l])break}let h=[],c=r.length;n||c--;for(let t=l;t<c;t++)h.push("..");for(let t=l;t<a.length;t++)h.push(a[t]);return s&&h.push(""),h.join("/")},explainEventName(t){let e={},i=/^(([^>]+)>)?(.+)$/.exec(t);return i&&(e.block=_.trim(i[2]),e.event=_.trim(i[3])),e},parseHref(t=""){let e=/^((https?):)?((\/\/([^/:]+))(:(\d+))?)?([^?]*)(\?([^#]*))?(#(.*))?$/.exec(t);if(e){let i={href:t,protocol:e[2],host:e[5],port:1*(e[7]||80),path:e[8],search:e[9],query:e[10],hash:e[11],anchor:e[12],toString(){let t=`${this.protocol}://${this.host}${this.path}`;if(!_.isEmpty(this.params)){let e=[];_.forEach(this.params,(t,i)=>{e.push(`${i}=${t}`)}),t+="?"+e.join("&")}return this.hash&&(t+=this.hash),t}};if(i.query){let t={},e=i.query.split("&");for(let i of e){let e=i.indexOf("=");if(e>0){let n=i.substring(0,e),s=i.substring(e+1);t[n]=decodeURIComponent(s)}else t[i]=!0}i.params=t}return i}return{path:t}}};return t}(),...function(){class t{constructor({url:t,params:e,anchor:i}={}){this.url=t,this.params=e,this.anchor=i,this.__S=null,this.set({url:t,params:e})}set({url:t="",params:e={},anchor:i}={}){return this.url=t,this.params=e,this.anchor=i,this.__S=null,this}valueOf(){return this.toString()}toString(){if(!this.__S){let t=[this.url],e=[];_.forEach(this.params,(t,i)=>{e.push(`${i}=${t}`)}),e.length>0&&t.push(e.join("&"));let i=t.join("?");this.anchor&&(/^#/.test(this.anchor)?i+=this.anchor:i+="#"+this.anchor),this.__S=i}return this.__S}}return{Link:({url:e,params:i,anchor:n}={})=>new t({url:e,params:i,anchor:n})}}(),merge:(e={},...i)=>t.mergeWith(void 0,e,...i),mergeWith(e=_.identity,i={},...n){const s=_.flattenDeep(n);for(let n of s){if(!n)continue;let s=e(n);_.isArray(s)?t.merge(i,...s):_.isFunction(s)?i[s.name]=s:_.isPlainObject(s)&&_.merge(i,s)}return i},deepMergeObj:(t={},...e)=>_.mergeWith(t,...e,(t,e)=>{if(_.isArray(t)||_.isArray(e))return e}),grouping(t=[],e,{titles:i=[],otherTitle:n={value:"Others",text:"Others"},asList:s=!1}={}){let r={},a=[];_.forEach(i,t=>{t.text&&!Ti.Util.isNil(t.value)&&(a[t.value]=t)});let o=[];return _.forEach(t,t=>{let i=_.get(t,e);if(i){let e=a[i]||{text:i,value:i},n=r[i];n||(n={...e,list:[]},r[i]=n),n.list.push(t)}else o.push(t)}),_.isEmpty(o)||(r[n.value]={...n,list:o}),s?_.values(r):r},insertToArray(t=[],e=-1,...i){if(!_.isArray(t)||_.isEmpty(i))return-1;if(_.isEmpty(t))return t.push(...i),0;let n=Ti.Num.scrollIndex(e,t.length+1);return t.length==n?t.push(...i):t.splice(n,0,...i),n},appendToObject(t={},e=null,i={}){let n={};return Ti.Util.isNil(e)?_.assign(n,t,i):_.forEach(t,(t,s)=>{n[s]=t,e==s&&_.assign(n,i)}),n},walk(t={},{root:e=_.identity,all:i=_.identity,leaf:n=_.identity,node:s=_.identity}={}){const r=(t,a=[])=>{let o=_.isArray(t),l=_.isPlainObject(t);if(i(t,a),o||l?_.isEmpty(a)?e(t,a):s(t,a):n(t,a),o)for(let e=0;e<t.length;e++){let i=t[e],n=a.concat(e);r(i,n)}else if(l){let e=_.keys(t);for(let i of e){let e=t[i],n=a.concat(i);r(e,n)}}};r(t)},inset(t=[],e=_.identity){let i=[];for(let n of t){let t=e(n);if(_.isArray(t)&&!_.isEmpty(t))for(let e of t)i.push(e);_.isUndefined(t)||i.push(t)}return i},explainObj(t={},e,{evalFunc:i=!1,iteratee:n=_.identity}={}){const s=e=>{let r=e;if(_.isString(r)){let e=/^:(:*(=|==|!=|=>>?|->)(.+))$/.exec(r);if(e)return n(e[1]);let i,s,a;if((e=/^(==|!=|=>>?|->)(.+)$/.exec(r))?(i=e[1],s=_.trim(e[2])):(e=/^(=)([^?]+)(\?(.*))?$/.exec(r))&&(i=e[1],s=_.trim(e[2]),a=e[4]),i){Ti.Util.isNil(a)||(a=_.trim(a));let e={"==":e=>!!_.get(t,e),"!=":e=>!_.get(t,e),"=":(e,i)=>{if(".."==e)return t;let n=Ti.Util.getOrPick(t,e);return Ti.Util.isNil(n)&&!_.isUndefined(i)?i:n},"=>>":e=>{return Ti.Util.genInvoking(e,{context:t,partial:"right"})()},"=>":e=>{return Ti.Util.genInvoking(e,{context:t,partial:"left"})()},"->":e=>{let i=/^(([\w\d_.]+)\?\?)?(.+)$/.exec(e),n=i[2],s=i[3];if(!n||!Ti.Util.isNil(_.get(t,n)))return Ti.S.renderBy(s,t)}}[i];if(_.isFunction(e))return e(s,a);throw"invalid dynamic value: "+r}return n(r)}if(_.isFunction(r)){if(i){let e=r(t);return n(e)}return r}if(_.isArray(r)){let t=[];for(let e of r){let i=s(e);t.push(n(i))}return t}if(_.isPlainObject(r)){let t={};return _.forEach(r,(e,i)=>{let r=s(e),a=n(r);"..."==i?_.assign(t,a):/^\.{3,}$/.test(i)?t[i.substring(1)]=a:t[i]=a}),t}return n(e)};return s(e)},explainObjs(e=[],i={},n){if(_.isArray(e)){let s=[];for(let r of e){let e=t.explainObj(r,i,n);s.push(e)}return s}return t.explainObj(e,i,n)},genObj:(t={})=>_.partial(_.cloneDeep,t),groupCall(...t){const e=_.flattenDeep(t).filter(t=>_.isFunction(t));if(0!=e.length)return 1==e.length?e[0]:function(...t){for(let i of e)i.apply(this,t)}},pushValue(t,e,i,n=!1){let s=_.get(t,e)||[];n?t[e]=_.concat(s,i||[]):_.set(t,e,_.concat(s,i||[]))},pushValueBefore(t,e,i,n=!1){let s=_.get(t,e)||[];n?t[e]=_.concat(i||[],s):_.set(t,e,_.concat(i||[],s))},pushUniqValue(t,e,i,n=!1){let s=_.get(t,e)||[];n?t[e]=_.uniq(_.concat(s,i||[])):_.set(t,e,_.uniq(_.concat(s,i||[])))},pushUniqValueBefore(t,e,i,n=!1){let s=_.get(t,e)||[];n?t[e]=_.uniq(_.concat(i||[],s)):_.set(t,e,_.uniq(_.concat(i||[],s)))},setTo(t={},e,i,n){_.isString(e)&&!_.isUndefined(i)?t[e]=_.isNull(i)?n:i:_.isPlainObject(e)&&(n=i,_.forOwn(e,(e,i)=>{_.isUndefined(e)||(t[i]=_.isNull(e)?n:e)}))},nth(t=[],e=0,i=null){let n=t.length;if(n<=0)return i;return t[Ti.Num.scrollIndex(e,n)]},anyKey(e,i,n="-"){if(t.isNil(e))return e;let s=[];return i&&s.push(i),_.isArray(e)||_.isPlainObject(e)?(_.forEach(e,t=>s.push(t)),s.join("-")):(s.push(e),s.join(n))},translate(e={},i={},n=_.identity){if(_.isEmpty(e)||_.isEmpty(i))return _.cloneDeep(e);if(_.isArray(e)){let s=[];for(let r=0;r<e.length;r++){let a=e[r],o=t.translate(a,i,n);s.push(o)}return s}if(_.isString(i)){let t=i.split(/[:;]/g),e={};for(let i of t){i=_.trim(i);let t=/^([^=]+)=(.+)$/.exec(i);t&&(e[t[1]]=t[2])}i=e}if(_.isString(e))return _.get(i,e);let s={};return _.forEach(i,(i,r)=>{let a;a=".."==i?e:t.getOrPick(e,i),a=n(a),_.set(s,r,a)}),s},pureCloneDeep(e){if(_.isArray(e)){let i=[];return _.forEach(e,(e,n)=>{_.isUndefined(e)||_.isFunction(e)||(i[n]=t.pureCloneDeep(e))}),i}if(_.isPlainObject(e)){let i={};return _.forEach(e,(e,n)=>{_.isUndefined(e)||_.isFunction(e)||(i[n]=t.pureCloneDeep(e))}),i}return _.cloneDeep(e)},setKey(t={},e,i){const n=function(t,e=[],i=0,s){if(i>=e.length)return t;if(_.isArray(t)){let r=[],a=parseInt(e[i]);for(let o=0;o<t.length;o++)if(o==a){let a=n(t[o],e,i+1,s);r.push(a)}else r.push(t[o]);return r}if(_.isPlainObject(t)){let r={},a=_.keys(t);if(e.length==i+1){let n=e[i];for(let e of a){let i=t[e];n==e?r[s]=i:r[e]=i}}else for(let o of a){let a=t[o],l=n(a,e,i+1,s);r[o]=l}return r}return t};return _.isString(e)&&(e=e.split(".")),n(t,e,0,i)},getOrPick(t,e,i){if(_.isArray(e))return Ti.Util.fallback(_.pick(t,e),i);if(_.isFunction(e))return Ti.Util.fallback(e(t),i);if(_.isString(e)){let n=e.split("|");if(n.length>1)return Ti.Util.fallback(Ti.Util.getFallbackNil(t,n),i)}return Ti.Util.fallback(_.get(t,e),i)},getOrPickNoBlank(t,e,i){if(_.isArray(e))return Ti.Util.fallback(_.pick(t,e),i);if(_.isFunction(e))return Ti.Util.fallback(e(t),i);if(_.isString(e)){let n=e.split("|");if(n.length>1)return Ti.Util.fallback(Ti.Util.getFallbackBlank(t,n),i)}return Ti.Util.fallback(_.get(t,e),i)},truthyKeys(t={}){let e=[];return _.forEach(t,(t,i)=>{t&&e.push(i)}),e},getFallback(t,...e){let i=_.flattenDeep(e);for(let e of i)if(e){let i=_.get(t,e);if(!_.isUndefined(i))return i}},getFallbackNil(e,...i){let n=_.flattenDeep(i);for(let i of n)if(i){let n=_.get(e,i);if(!t.isNil(n))return n}},getFallbackEmpty(t,...e){let i=_.flattenDeep(e);for(let e of i)if(e){let i=_.get(t,e);if(!_.isEmpty(i))return i}},getFallbackBlank(t,...e){let i=_.flattenDeep(e);for(let e of i)if(e){let i=_.get(t,e);if(!Ti.Util.isBlank(i))return i}},getFallbackNaN(t,...e){let i=_.flattenDeep(e);for(let e of i)if(e){let i=_.get(t,e);if(!isNaN(i))return i}},fallback(...t){for(let e of t)if(!_.isUndefined(e))return e},fallbackNil(...e){for(let i of e)if(!t.isNil(i))return i},fallbackEmpty(...t){for(let e of t)if(!_.isEmpty(e))return e},fallbackBlank(...t){for(let e of t)if(!Ti.S.isBlank(e))return e},fallbackNaN(...t){for(let e of t)if(!isNaN(e))return e},isNil:t=>_.isUndefined(t)||_.isNull(t),isBlank:t=>_.isUndefined(t)||_.isNull(t)||""===t||/^[ \t]*$/.test(t),geset:(t={},e,i)=>_.isPlainObject(e)?(_.assign(t,e),t):_.isArray(e)?_.pick(t,e):_.isUndefined(i)?_.isUndefined(e)?t:t[e]:(t[e]=i,t),async invoke(t={},e,i=[],n=this){let s=_.get(t,e);if(_.isFunction(s)){let t=_.concat(i);await s.apply(n,t)}},first:(t=[])=>_.isArray(t)?_.first(t):t,last:(t=[])=>_.isArray(t)?_.last(t):t,genGetter(e,{indexPrefix:i,dftKeys:n=[],context:s={},funcSet:r=window,partial:a="right"}={}){if(_.isFunction(e))return t=>e(t);if(e){if(i)return(t,n)=>Ti.Util.fallbackNil(Ti.Types.toStr(_.get(t,e)),`${i}${n}`);let n=/^'(.+)'$/.exec(e);if(n)return()=>n[1];if(n=/^=>(.+)$/.exec(e)){let e=n[1];return t.genInvoking(e,{context:s,funcSet:r,partial:a})}return t=>Ti.Util.getOrPick(t,e)}return _.isEmpty(n)?void 0:t=>Ti.Util.getFallback(t,...n)},genInvoking(t,{context:e={},funcSet:i=window,partial:n="left"}={}){if(_.isFunction(t))return t;let s,r;if(t.name&&!_.isUndefined(t.args))s=t.name,r=_.concat(t.args);else{let e=/^([^()]+)(\((.+)\))?$/.exec(t);e&&(s=_.trim(e[1]),r=_.trim(e[3]))}let a=_.get(i,s);if(_.isFunction(a)){let t=Ti.S.joinArgs(r,[],t=>Ti.S.toJsValue(t,{context:e}));return _.isEmpty(t)?a:"right"==n?function(e){let i=_.isUndefined(e)?t:_.concat([e],t);return a.apply(this,i)}:"left"==n?function(e){let i=_.concat(t,[e]);return a.apply(this,i)}:()=>a(...t)}return()=>t},genItemMatcher:(t,e=!1)=>_.isFunction(t)?(e,i)=>t(e,i):_.isString(t)?e?(e,i)=>_.indexOf(Ti.Util.getOrPick(e,t),i)>=0:(e,i)=>_.isEqual(Ti.Util.getOrPick(e,t),i):_.isArray(t)?(i,n)=>{for(let s of t){let t=Ti.Util.getOrPick(i,s);if(e){if(_.indexOf(t,n)>=0)return!0}else if(_.isEqual(t,n))return!0}return!1}:(t,e)=>!1,genItemValueGetter:(t,e)=>_.isFunction(t)?i=>t(i,e):_.isString(t)?i=>Ti.Util.getOrPick(i,t,e):function(){return e},genRowIdGetter:(t,e=["id","value"])=>_.isFunction(t)?(e,i)=>Ti.Types.toStr(t(e,i)):_.isString(t)?(e,i)=>Ti.Util.fallbackNil(Ti.Types.toStr(_.get(e,t)),`Row-${i}`):_.isEmpty(e)?void 0:t=>Ti.Util.getFallback(t,...e),genRowDataGetter:t=>_.isFunction(t)?e=>t(e):_.isString(t)?e=>_.get(e,t):_.isObject(t)?e=>Ti.Util.translate(e,t):t=>t};return{Util:t}}(),{Trees:Trees}=function(){const t={path:(t=[])=>Ti.Util.isNil(t)?[]:_.isArray(t)?t:_.map(_.without(t.split("/"),""),t=>/^\d+$/.test(t)?1*t:t),walkDeep(t,e=(()=>({}))){let i={index:0,node:t,path:[],depth:0,parent:null,ancestors:[]};const n=t=>{let[i,s]=_.concat(e(t)||[null,!1]);if(s)return[i,s];if(_.isArray(t.node.children)){let e={depth:t.depth+1,parent:t,ancestors:_.concat(t.ancestors,t)},r=0;for(let a of t.node.children)if([i,s]=n({index:r,node:a,path:_.concat(t.path,a.name),...e}),r++,s)return[i,s]}return[]};let[s]=n(i);return s},walkBreadth(t,e=(()=>({}))){let i={index:0,node:t,path:[],depth:0,parent:null,ancestors:[]},[n,s]=_.concat(e(i)||[null,!1]);if(s)return[n,s];const r=t=>{if(_.isArray(t.node.children)){let i=[],n={depth:t.depth+1,parent:t,ancestors:_.concat(t.ancestors,t)},s=0;for(let r of t.node.children){let a={index:s,node:r,path:_.concat(t.path,r.name||s),...n},[o,l]=_.concat(e(a)||[null,!1]);if(s++,l)return[o,l];i.push(a)}for(let t of i){let[e,i]=r(t);if(i)return[e,i]}}return[]};let[a]=r(i);return a},getById(e,i){if(!Ti.Util.isNil(i))return t.walkDeep(e,t=>{if(t.node.id==i)return[t,!0]})},getByPath(e,i=[]){let n=t.path(i);return t.walkDeep(e,t=>{if(_.isEqual(n,t.path))return[t,!0]})},getNodeById(e,i){let n=t.getById(e,i);if(n)return n.node},getNodeByPath(e,i=[]){let n=t.getByPath(e,i);if(n)return n.node},insertBefore(t,e){if(!t||_.isUndefined(e))return;let i,n;t.parent?(n=t.parent.node.children,i=t.index):(n=t.node.children,i=0);return{hierarchy:t,children:n,item:e,index:Ti.Util.insertToArray(n,i,e)}},insertAfter(t,e){if(!t||_.isUndefined(e))return;let i,n;t.parent?(n=t.parent.node.children,i=t.index+1):(n=t.node.children,i=-1);return{hierarchy:t,children:n,item:e,index:Ti.Util.insertToArray(n,i,e)}},prepend(t,e){if(!t||_.isUndefined(e))return;let i,n;_.isArray(t.node.children)?(n=t.node.children,i=0):(n=t.parent.node.children,i=t.index+1);return{hierarchy:t,children:n,item:e,index:Ti.Util.insertToArray(n,i,e)}},append(t,e){if(!t||_.isUndefined(e))return;let i,n;_.isArray(t.node.children)?(n=t.node.children,i=0):(n=t.parent.node.children,i=t.index);return{hierarchy:t,children:n,item:e,index:Ti.Util.insertToArray(n,i,e)}},remove(t){if(!t||!t.parent)return;let e=t.index;return _.remove(t.parent.node.children,(t,i)=>i==e).length>0},nextCandidate(t){if(!t||!t.parent)return;let e,i,n=t.parent.node.children;return n.length<=1?(e=t.parent.node,i=_.isEmpty(t.parent.path)?null:t.parent.path.slice(0,t.parent.path.length-1)):t.index+1<n.length?(e=n[t.index+1],i=t.parent.path):(e=n[t.index-1],i=t.parent.path),{node:e,path:i}}};return{Trees:t}}(),{Viewport:Viewport}=function(){class t{constructor(){this.reset()}reset(t=null){return this.scrolling=[],this.resizing=[],this}watch(t,{scroll:e,resize:i}={}){_.isFunction(e)&&this.scrolling.push({context:t,handler:e}),_.isFunction(i)&&this.resizing.push({context:t,handler:i})}unwatch(t){_.remove(this.scrolling,({context:e})=>e===t),_.remove(this.resizing,({context:e})=>e===t)}startListening(){let t=this;this.isListening||(window.addEventListener("resize",e=>{for(let i of t.resizing)i.handler.apply(i.context,[e])}),window.addEventListener("scroll",e=>{for(let i of t.scrolling)i.handler.apply(i.context,[e])}),this.isListening=!0)}}return{Viewport:new t}}(),{WWW:WWW}=function(){const t={explainNavigation(e=[],i="/",n=".html"){let s=[];for(let r of e){let e={type:"page",..._.pick(r,"icon","title","type","value","href","target","params")};if("page"==r.type){if(!e.href&&r.value){let s=r.value;s.endsWith(n)||(s+=n);let a=Ti.Util.appendPath(i,s);e.value=s,e.href=t.joinHrefParams(a,r.params,r.anchor)}e.highlightBy=t.evalHighlightBy(r.highlightBy||e.value,r),!e.target&&r.newTab&&(e.target="_blank")}else"href"==e.type?(e.highlightBy=(()=>!1),e.href||(e.href=t.joinHrefParams(r.value,r.params,r.anchor)),!e.target&&r.newTab&&(e.target="_blank")):e.highlightBy=(()=>!1);_.isArray(r.items)&&(e.items=t.explainNavigation(r.items,i,n)),s.push(e)}return s},evalHighlightBy(t=!1,e={}){if(_.isFunction(t))return t;if(_.isString(t)){if(t.startsWith("^")||t.endsWith("$")){let e=new RegExp(t);return _.bind(function(t){return this.test(t)},e)}return(i,n)=>!!_.isEqual(i,t)&&!(!_.isEmpty(e.params)&&n&&!_.isEqual(e.params,n))}return _.isRegExp(t)?_.bind(function(t){return this.test(t)},t):_.isBoolean(t)?function(){return t}:function(){return!1}},joinHrefParams(t,e,i){if(!t)return null;let n;return _.isEmpty(e)||(n=[],_.forEach(e,(t,e)=>{if(!Ti.Util.isNil(t)){let i=encodeURIComponent(t);n.push(`${e}=${i}`)}}),n.length>0&&(t=t+"?"+n.join("&"))),i&&(i.startsWith("#")?t+=i:t+="#"+i),t},evalFee:({price:t=0,amount:e=1}={})=>t*e,getCurrencyPrefix:t=>({RMB:"",USD:"$",EUR:"",GBP:""})[_.upperCase(t)],feeText(e=0,i="RMB",{autoSuffix:n=!0}={}){let s=_.upperCase(i),r=t.getCurrencyPrefix(s),a=[];return r&&a.push(r),a.push(e),n&&r||a.push(s),a.join("")},evalObjPreviewSrc(t,{previewKey:e,previewObj:i,sha1Path:n=4,apiTmpl:s,cdnTmpl:r,dftSrc:a}={}){if(_.isString(t))return t;if(r){let e=".."==i?t:_.get(t,i);if(e&&e.sha1)return e=_.cloneDeep(e),e.sha1Path=n>0?e.sha1.substring(0,n)+"/"+e.sha1.substring(n):e.sha1,Ti.S.renderBy(r,e)}if(s){if(_.get(t,e))return Ti.S.renderBy(s,t)}return a},getSSRData(t,{root:e=document.documentElement,as:i="text",trimed:n=!0,autoRemove:s=!0,ssrFinger:r,dft:a}={}){let o=`.wn-ssr-data[data-ssr-key="${t}"]`,l=Ti.Dom.find(o,e);if(_.isElement(l)){if(!Ti.Util.isNil(r)){if(l.getAttribute("data-ssr-finger")!=r)return a}let t=l.textContent;return n&&(t=_.trim(t)),s&&Ti.Dom.remove(l),"json"==i?JSON.parse(t):t}return a}};return{WWW:t}}(),{GPS:GPS}=function(){const t=3.141592653589793,e=6378245,i=.006693421622965943,n={WGS84_TO_GCJ02(s,r){if(n.outOfChina(s,r))return{lat:s,lng:r};let a=n.transformLat(r-105,s-35),o=n.transformLng(r-105,s-35),l=s/180*t,h=Math.sin(l);h=1-i*h*h;let c=Math.sqrt(h);return{lat:s+(a=180*a/(e*(1-i)/(h*c)*t)),lng:r+(o=180*o/(e/c*Math.cos(l)*t))}},WGS84_TO_BD09(t,e){let i=n.WGS84_TO_GCJ02(t,e);return n.GCJ02_TO_BD09(i.lat,i.lng)},GCJ02_TO_WGS84(t,e){let i=n.transform(t,e),s=2*e-i.lng;return{lat:2*t-i.lat,lng:s}},GCJ02_TO_BD09(e,i){let n=i,s=e,r=Math.sqrt(n*n+s*s)+2e-5*Math.sin(s*t),a=Math.atan2(s,n)+3e-6*Math.cos(n*t),o=r*Math.cos(a)+.0065;return{lat:r*Math.sin(a)+.006,lng:o}},BD09_TO_GCJ02(e,i){let n=i-.0065,s=e-.006,r=Math.sqrt(n*n+s*s)-2e-5*Math.sin(s*t),a=Math.atan2(s,n)-3e-6*Math.cos(n*t),o=r*Math.cos(a);return{lat:r*Math.sin(a),lng:o}},BD09_TO_WGS84(t,e){let i=n.BD09_TO_GCJ02(t,e);return n.GCJ02_TO_WGS84(i.lat,i.lng)},outOfChina:(t,e)=>e<72.004||e>137.8347||(t<.8293||t>55.8271),transform(s,r){if(n.outOfChina(s,r))return{lat:s,lng:r};let a=n.transformLat(r-105,s-35),o=n.transformLng(r-105,s-35),l=s/180*t,h=Math.sin(l);h=1-i*h*h;let c=Math.sqrt(h);return{lat:s+(a=180*a/(e*(1-i)/(h*c)*t)),lng:r+(o=180*o/(e/c*Math.cos(l)*t))}},transformLat(e,i){let n=2*e-100+3*i+.2*i*i+.1*e*i+.2*Math.sqrt(Math.abs(e));return n+=2*(20*Math.sin(6*e*t)+20*Math.sin(2*e*t))/3,n+=2*(20*Math.sin(i*t)+40*Math.sin(i/3*t))/3,n+=2*(160*Math.sin(i/12*t)+320*Math.sin(i*t/30))/3},transformLng(e,i){let n=300+e+2*i+.1*e*e+.1*e*i+.1*Math.sqrt(Math.abs(e));return n+=2*(20*Math.sin(6*e*t)+20*Math.sin(2*e*t))/3,n+=2*(20*Math.sin(e*t)+40*Math.sin(e/3*t))/3,n+=2*(150*Math.sin(e/12*t)+300*Math.sin(e/30*t))/3},getLngToWest(t,e){let i=t-e;return e<0&&t>0?360-i:i},getLatToSouth:(t,e)=>t-e,normlizedLat:t=>t,normlizedLng:t=>(t>360&&(t%=360),t>180?t-360:(t<-360&&(t%=360),t<-180?t+360:t)),getBounds(t=[]){let e=void 0,i=void 0,n=void 0,s=void 0;for(let r of t)e=_.isUndefined(e)?r.lng:Math.max(e,r.lng),i=_.isUndefined(i)?r.lng:Math.min(i,r.lng),n=_.isUndefined(n)?r.lat:Math.max(n,r.lat),s=_.isUndefined(s)?r.lat:Math.min(s,r.lat);return e-i>180?[{lat:s,lng:e},{lat:n,lng:i}]:[{lat:s,lng:i},{lat:n,lng:e}]},getCenter(t=[]){let[e,i]=n.getBounds(t);return{lat:(i.lat+e.lat)/2,lng:(i.lng+e.lng)/2}}};return{GPS:n}}(),{GIS:GIS}=function(){const t=3.141592653589793,e=6378245,i=.006693421622965943,n={__build_bounds:({N:t,S:e,E:i,W:n}={})=>({N:t,S:e,E:i,W:n,NE:{lat:t,lng:i},NW:{lat:t,lng:n},SE:{lat:e,lng:i},SW:{lat:e,lng:n},lat:(t+e)/2,lng:(n+i)/2}),getLatlngPairBounds(t=[]){let e={N:-90,S:90,W:180,E:-180};return _.forEach(t,([t,i])=>{e.N=Math.max(t,e.N),e.S=Math.min(t,e.S),e.E=Math.max(i,e.E),e.W=Math.min(i,e.W)}),n.__build_bounds(e)},getLnglatPairBounds(t=[]){let e={N:-90,S:90,W:180,E:-180};return _.forEach(t,([t,i])=>{e.N=Math.max(i,e.N),e.S=Math.min(i,e.S),e.E=Math.max(t,e.E),e.W=Math.min(t,e.W)}),n.__build_bounds(e)},getLatlngObjBounds(t=[]){let e={N:-90,S:90,W:180,E:-180};return _.forEach(t,({lat:t,lng:i})=>{e.N=Math.max(t,e.N),e.S=Math.min(t,e.S),e.E=Math.max(i,e.E),e.W=Math.min(i,e.W)}),n.__build_bounds(e)},latlngPairToObj:([t,e]=[])=>({lat:t,lng:e}),lnglatPairToObj:([t,e]=[])=>({lat:e,lng:t}),objToLatlngPair:({lat:t,lng:e}={})=>[t,e],objToLnglatPair:({lat:t,lng:e}={})=>[e,t],transLatlngPair(t,e="WGS84_TO_GCJ02"){let{lat:i,lng:s}=n[e](...t);return[i,s]},transLnglatPair(t,e="WGS84_TO_GCJ02"){let[i,s]=t,{lat:r,lng:a}=n[e](s,i);return[a,r]},transLatlngObj(t,e="WGS84_TO_GCJ02",i=!1){let{lat:s,lng:r}=t,a=n[e](s,r);return i?{...t,...a}:a},WGS84_TO_GCJ02(s,r){if(n.outOfChina(s,r))return{lat:s,lng:r};let a=n.transformLat(r-105,s-35),o=n.transformLng(r-105,s-35),l=s/180*t,h=Math.sin(l);h=1-i*h*h;let c=Math.sqrt(h);return{lat:s+(a=180*a/(e*(1-i)/(h*c)*t)),lng:r+(o=180*o/(e/c*Math.cos(l)*t))}},WGS84_TO_BD09(t,e){let i=n.WGS84_TO_GCJ02(t,e);return n.GCJ02_TO_BD09(i.lat,i.lng)},GCJ02_TO_WGS84(t,e){let i=n.transform(t,e),s=2*e-i.lng;return{lat:2*t-i.lat,lng:s}},GCJ02_TO_BD09(e,i){let n=i,s=e,r=Math.sqrt(n*n+s*s)+2e-5*Math.sin(s*t),a=Math.atan2(s,n)+3e-6*Math.cos(n*t),o=r*Math.cos(a)+.0065;return{lat:r*Math.sin(a)+.006,lng:o}},BD09_TO_GCJ02(e,i){let n=i-.0065,s=e-.006,r=Math.sqrt(n*n+s*s)-2e-5*Math.sin(s*t),a=Math.atan2(s,n)-3e-6*Math.cos(n*t),o=r*Math.cos(a);return{lat:r*Math.sin(a),lng:o}},BD09_TO_WGS84(t,e){let i=n.BD09_TO_GCJ02(t,e);return n.GCJ02_TO_WGS84(i.lat,i.lng)},outOfChina:(t,e)=>e<72.004||e>137.8347||(t<.8293||t>55.8271),transform(s,r){if(n.outOfChina(s,r))return{lat:s,lng:r};let a=n.transformLat(r-105,s-35),o=n.transformLng(r-105,s-35),l=s/180*t,h=Math.sin(l);h=1-i*h*h;let c=Math.sqrt(h);return{lat:s+(a=180*a/(e*(1-i)/(h*c)*t)),lng:r+(o=180*o/(e/c*Math.cos(l)*t))}},transformLat(e,i){let n=2*e-100+3*i+.2*i*i+.1*e*i+.2*Math.sqrt(Math.abs(e));return n+=2*(20*Math.sin(6*e*t)+20*Math.sin(2*e*t))/3,n+=2*(20*Math.sin(i*t)+40*Math.sin(i/3*t))/3,n+=2*(160*Math.sin(i/12*t)+320*Math.sin(i*t/30))/3},transformLng(e,i){let n=300+e+2*i+.1*e*e+.1*e*i+.1*Math.sqrt(Math.abs(e));return n+=2*(20*Math.sin(6*e*t)+20*Math.sin(2*e*t))/3,n+=2*(20*Math.sin(e*t)+40*Math.sin(e/3*t))/3,n+=2*(150*Math.sin(e/12*t)+300*Math.sin(e/30*t))/3}};return{GIS:n}}(),{Bank:Bank}={Bank:{getCurrencyChar:(t="RMB")=>({RMB:"",USD:"$",GBP:""})[t],isValidPayType:t=>({"wx.qrcode":!0,"zfb.qrcode":!0,paypal:!0})[t]||!1,getPayTypeText(t,e=!1){let i=null;if(_.isString(t)&&(i=`pay-by-${t.replace(".","-")}`),i)return e?Ti.I18n.get(i):i},getPayTypeChooseI18nText(t,{text:e="pay-step-choose-tip2",nil:i="pay-step-choose-nil"}={}){let n=Ti.Bank.getPayTypeText(t,!0);return n?Ti.I18n.getf(e,{val:n}):Ti.I18n.get(i)}}},{DateTime:DateTime}=function(){const t=["sun","mon","tue","wed","thu","fri","sat"],e=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],i={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6,sunday:0,monday:1,tuesday:2,wednesday:3,thursday:4,friday:5,saturday:6},n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],s=new RegExp("^((\\d{4})([/\\\\-])?(\\d{1,2})?([/\\\\-])?(\\d{1,2})?)?(([ T])?(\\d{1,2})(:)(\\d{1,2})((:)(\\d{1,2}))?((.)(\\d{1,3}))?)?(([+-])(\\d{1,2})(:\\d{1,2})?)?(Z(\\d*))?$"),r={parse(t){if(_.isUndefined(t)||"today"===t||"now"===t)return new Date;if(!t||_.isArray(t)&&_.isEmpty(t))return null;if(_.isDate(t))return new Date(t);if(_.isNumber(t))return new Date(t);if(_.isString(t)){let e=t;if(/\d{13,}/.test(e))return new Date(1*e);let i=s.exec(t);if(i){let t=(t,e,i)=>{let n=t[e];return n?parseInt(n):i},e=new Date,n=t(i,2,e.getFullYear()),s=t(i,4,i[2]?1:e.getMonth()+1),r=t(i,6,i[2]?1:e.getDate()),a=t(i,9,0),o=t(i,11,0),l=t(i,14,0),h=t(i,17,0),c=[_.padStart(n,4,"0"),"-",_.padStart(s,2,"0"),"-",_.padStart(r,2,"0"),"T",_.padStart(a,2,"0"),":",_.padStart(o,2,"0"),":",_.padStart(l,2,"0"),".",_.padStart(h,3,"0")];i[18]&&c.push(i[18]);let u=c.join("");return new Date(u)}}throw"i18n:invalid-date"},format(i,s="yyyy-MM-dd HH:mm:ss"){if(_.isArray(i)){let t=[];for(let e of i)t.push(r.format(e,s));return t}if(_.isDate(i)||(i=r.parse(i)),!i)return null;let a,o=i.getFullYear(),l=i.getMonth()+1,h=i.getDate(),c=i.getHours(),u=i.getMinutes(),d=i.getSeconds(),p=i.getMilliseconds(),f=n[i.getMonth()],m=Ti.I18n.get(`cal.abbr.${f}`),g=Ti.I18n.get(f),y=i.getDay(),T=_.upperFirst(t[y]),b=_.upperFirst(e[y]),v=Ti.I18n.get(T),w=Ti.I18n.get(b),x={yyyy:o,M:l,d:h,H:c,m:u,s:d,S:p,yyy:o,yy:(""+o).substring(2,4),MM:_.padStart(l,2,"0"),dd:_.padStart(h,2,"0"),HH:_.padStart(c,2,"0"),mm:_.padStart(u,2,"0"),ss:_.padStart(d,2,"0"),SS:_.padStart(p,3,"0"),SSS:_.padStart(p,3,"0"),E:v,EE:v,EEE:v,EEEE:w,MMM:m,MMMM:g},S=/(y{2,4}|M{1,4}|dd?|HH?|mm?|ss?|S{1,3}|E{1,4}|'([^']+)')/g,k=[],C=0;for(;a=S.exec(s);){C<a.index&&k.push(s.substring(C,a.index));let t=Ti.Util.fallback(a[2],x[a[1]],a[1]);k.push(t),C=S.lastIndex}return C<s.length&&k.push(s.substring(C)),k.join("")},getWeekDayAbbr(e){let i=_.clamp(e,0,t.length-1);return t[i]},getWeekDayName(t){let i=_.clamp(t,0,e.length-1);return e[i]},getWeekDayValue(t,e=-1){let n=_.trim(_.lowerCase(t)),s=i[n];return _.isNumber(s)?s:e},getMonthAbbr(t){let e=_.clamp(t,0,11);return n[e]},setTime:(t,e=0,i=0,n=0,s=0)=>(_.inRange(e,0,24)&&t.setHours(e),_.inRange(i,0,60)&&t.setMinutes(i),_.inRange(n,0,60)&&t.setSeconds(n),_.inRange(s,0,1e3)&&t.setMilliseconds(s),t),setDayLastTime:t=>r.setTime(t,23,59,59,999),moveYear:(t,e=0)=>(_.isDate(t)&&t.setFullYear(t.getFullYear+e),t),moveMonth:(t,e=0)=>(_.isDate(t)&&t.setMonth(t.getMonth()+e),t),moveDate:(t,e=0)=>(_.isDate(t)&&t.setDate(t.getDate()+e),t),createDate(t,e=0){if(_.isDate(t)){let i=new Date(t);return i.setDate(i.getDate()+e),i}},rangeStr({date:t,time:e="3h"}={},i="[${from},${to}]"){let n={from:`${t=t||"now"}-${e}`,to:t};return Ti.S.renderBy(i,n)},timeText(t,{justNow:e=10,i18n:i=Ti.I18n.get("time")}={}){let n=(t=r.parse(t)).getTime(),s=Date.now()-n,a=s>0?"past-":"future-";s=Math.abs(s);let o=Math.round(s/6e4);if(o<e)return i[`${a}in-min`];if(o<60)return Ti.S.renderBy(i[`${a}in-hour`],{min:o});let l=Math.round(s/36e5);if(l<24)return Ti.S.renderBy(i[`${a}in-day`],{min:o,hour:l});let h=Math.round(l/24);if(h<7)return Ti.S.renderBy(i[`${a}in-week`],{min:o,hour:l,day:h});return t.getFullYear()==(new Date).getFullYear()?r.format(t,i["in-year"]):r.format(t,i["any-time"])}};return{DateTime:r}}(),{Num:Num}={Num:{fillSteps(t=0,e=1,{ary:i=[],step:n=1}={}){for(let s=0;s<e;s++)i[s]=t+s*n;return i},scrollIndex(t,e=0){if(e>0){let i=t%e;return i>=0?i:e+i}return-1},precise(t,e=2){if(e>=0){var i=Math.pow(10,e);return Math.round(t*i)/i}return t},ceilUnit(t,e=0){if(_.isNumber(t)&&e>0){return Math.ceil(t/e)*e}return t},floorUnit(t,e=0){if(_.isNumber(t)&&e>0){return Math.floor(t/e)*e}return t}}},{Css:Css}=function(){const t={toPixel(t,e=100,i=0){if(_.isNumber(t))return t>-1&&t<1?t*e:t;let n=/^([\d.]+)(px)?(%)?$/.exec(t);return n?n[3]?n[1]*e/100:1*n[1]:i},toSize:(t,{autoPercent:e=!0,remBase:i=0}={})=>_.isNumber(t)||/^[0-9]+$/.test(t)?0==t?t:e&&t>-1&&t<1?100*t+"%":i>0?t/i+"rem":t+"px":t,toSizeRem100(e,i){let n=_.assign({},i,{remBase:100});return t.toSize(e,n)},toStyle:(e,i)=>_.mapValues(e,(e,n)=>{let s=_.kebabCase(n);return/^(opacity|z-index|order)$/.test(s)?e:t.toSize(e,i)}),toStyleRem100(e,i){let n=_.assign({},i,{remBase:100});return t.toStyle(e,n)},toBackgroundUrl(t,e=""){if(t)return e&&(t=Ti.Util.appendPath(e,t)),`url("${t}")`},toNumStyle:e=>t.toStyle(e,!1),mergeClassName(...t){let e={};const i=t=>{if(!Ti.Util.isNil(t))if(_.isFunction(t)){let e=t();i(e)}else if(_.isString(t)){let i=_.without(_.split(t,/ +/g),"");for(let t of i)e[t]=!0}else if(_.isArray(t))for(let e of t)i(e);else _.isPlainObject(t)&&_.forEach(t,(t,i)=>{t&&(e[i]=!0)})};return i(t),e},joinClassNames(...e){let i=t.mergeClassName(...e),n=[];return _.forEach(i,(t,e)=>{t&&n.push(e)}),n.join(" ")}};return{Css:t}}(),{Mapping:Mapping}=function(){class t{constructor(t,e){this.data=e,_.isString(t)?this.path=_.without(t.split("/"),""):_.isArray(t)&&(this.path=t)}match(t){let e=_.isArray(t)?t:_.without(t.split("/"),"");for(let t=0;t<e.length;t++){let i=e[t],n=this.path[t];if("*"!=n&&i!=n)return!1}return!0}}class e{constructor(t,e){this.data=e,this.regex=new RegExp(t)}match(t){return this.regex.test(t)}}class i{constructor(t={}){this.parse(t)}parse(i={}){this.maps={},this.regexs=[],this.paths=[],_.forEach(i,(i,n)=>{let s=_.map(n.split(","),t=>_.trim(t));for(let n of s)n.startsWith("^")?this.regexs.push(new e(n,i)):n.indexOf("/")>=0?this.paths.push(new t(n,i)):this.maps[n]=i})}get(t,e){if(!Ti.Util.isNil(t)){let e=this.maps[t];if(!_.isUndefined(e))return e;for(let e of this.paths){let i=_.without(t.split("/"),"");if(e.match(i))return e.data}for(let e of this.regexs)if(e.match(t))return e.data}return e}}return{Mapping:i}}(),{Dict:Dict,DictFactory:DictFactory}=function(){const t={item:Symbol("item"),data:Symbol("data"),query:Symbol("query"),children:Symbol("children"),getValue:Symbol("getValue"),getText:Symbol("getText"),getIcon:Symbol("getIcon"),isMatched:Symbol("isMatched"),itemCache:Symbol("itemCache"),dataCache:Symbol("dataCache"),hooks:Symbol("hooks"),shadowed:Symbol("shadowed")},e={};class i{constructor(){this[t.hooks]=[],this[t.shadowed]=!1,this[t.item]=_.idendity,this[t.data]=(()=>[]),this[t.query]=(t=>[]),this[t.children]=(t=>[]),this[t.getValue]=(t=>Ti.Util.getFallback(t,"value","id")),this[t.getText]=(t=>Ti.Util.getFallback(t,"title","text","name","nm")),this[t.getIcon]=(t=>_.get(t,"icon")),this[t.isMatched]=((t,e,i)=>{let n=i.getValue(t);if(_.isEqual(e,n))return!0;let s=i.getText(t);return!!(s&&s.indexOf(e)>=0)}),this[t.itemCache]={},this[t.dataCache]=null}setShadowed(e=!1){this[t.shadowed]=e}isShadowed(){return this[t.shadowed]}addHooks(...e){let i=_.flattenDeep(e);_.forEach(i,e=>{_.isFunction(e)&&this[t.hooks].push(e)})}clearHooks(){this[t.hooks]=[]}doHooks(e=!1){for(let i of this[t.hooks])i({loading:e})}invoke(e,...i){let n=this[t[e]];if(_.isFunction(n))return n.apply(this,[...i,this])}async invokeAsync(e,...i){let n=this[t[e]];if(_.isFunction(n)){return await n.apply(this,[...i,this])}}setFunc(e){_.forEach(e,(e,i)=>{_.isFunction(e)&&(this[t[i]]=e)})}duplicate({hooks:e=!1,cache:n=!0,dataCache:s=!0,itemCache:r=!0}={}){let a=new i;return _.forEach(t,t=>{a[t]=this[t]}),e||(a[t.hooks]=[]),n||(a[t.itemCache]={},a[t.dataCache]=null),s||(a[t.dataCache]=null),r||(a[t.itemCache]={}),a}isItemCached(e){return!Ti.Util.isNil(this[t.itemCache][e])}addItemToCache(e,i){e=Ti.Util.fallback(e,null);let n=i;Ti.Util.isNil(n)&&(n=this.getValue(e)),_.isUndefined(e)||Ti.Util.isNil(n)||(this[t.itemCache][n]=e)}clearCache(){this[t.itemCache]={},this[t.dataCache]=null}findItem(t,e=[]){for(let i of e){let e=this.getValue(i);if(_.isEqual(t,e))return i}}async getItem(i){if(Ti.Util.isNil(i))return null;let n=this[t.itemCache][i];if(_.isUndefined(n)){let t=e[i];if(t)return await new Promise(e=>{t.push(e)});t=[],e[i]=t,this.doHooks(!0),n=await this.invokeAsync("item",i),this.doHooks(!1),n&&_.isPlainObject(n)&&this.addItemToCache(n,i);for(let e of t)e(n||null);delete e[i]}return _.isArray(n)&&console.warn("!!!! Dict.getItem=>[] !!!  val=",i),this.isShadowed()?_.cloneDeep(n):n}async getData(e=!1){let i=this[t.dataCache];return(e||_.isEmpty(i))&&(this.doHooks(!0),i=await this.invokeAsync("data"),this.doHooks(!1),_.forEach(i,(t,e)=>{_.isPlainObject(t)||(t={text:t,value:t},i[e]=t),this.addItemToCache(t)}),this[t.dataCache]=i),this.isShadowed()?_.cloneDeep(i)||[]:i||[]}async queryData(t){let e,i=_.trim(t);return i?(this.doHooks(!0),e=await this.invokeAsync("query",i),this.doHooks(!1),_.forEach(e,t=>{this.addItemToCache(t)}),this.isShadowed()?_.cloneDeep(e)||[]:e||[]):e=await this.getData()}async getChildren(t){if(!t)return await this.getData();this.doHooks(!0);let e=await this.invokeAsync("children",t);return this.doHooks(!1),_.forEach(e,t=>{this.addItemToCache(t)}),this.isShadowed()?_.cloneDeep(e)||[]:e||[]}getValue(t){return this.invoke("getValue",t)}getText(t){return this.invoke("getText",t)}getIcon(t){return this.invoke("getIcon",t)}isMatched(t,e){return this.invoke("isMatched",t,e)}getBy(t=".text",e,i){return t&&".text"!=t?".icon"==t?this.getIcon(e):".value"==t?this.getValue(e):Ti.Util.fallback(Ti.Util.getOrPick(e,t),i,this.getValue(e)):this.getText(e)}async checkItem(t){let e=await this.getItem(t);if(!e)throw Ti.Err.make("e.dict.no-item",{dictName:dictName,val:t});return e}async getItemText(t){let e=await this.getItem(t);if(e)return this.getText(e)}async getItemIcon(t){let e=await this.getItem(t);if(e)return this.getIcon(e)}async getItemAs(t,e){let i=await this.getItem(e);if(i)return this.getBy(t,i,e)}}const n={},s={DictReferName(t){if(_.isString(t)){let e=/^(@Dict:|#)(.+)$/.exec(t);if(e)return _.trim(e[2])}},GetOrCreate(t={},{hooks:e,name:r}={}){let a;if(t.data instanceof i)a=t.data;else{let e=r||s.DictReferName(t.data);e&&(a=n[e])}return a?(e&&(a=a.duplicate({hooks:!1})).addHooks(e),a):s.CreateDict(t,{hooks:e,name:r})},CreateDict({data:t,query:e,item:s,children:r,getValue:a,getText:o,getIcon:l,isMatched:h,shadowed:c}={},{hooks:u,name:d}={}){if(_.isString(t)||_.isArray(t)){let e=Ti.S.toObjList(t);t=(()=>e)}else t||(t=(()=>[]));s||(s=(async(t,e)=>{let i=await e.getData();for(let n of i){let i=e.getValue(n);if(i==t||_.isEqual(i,t))return n}})),e||(e=(async(t,e)=>{let i=await e.getData(),n=[];for(let s of i)e.isMatched(s,t)&&n.push(s);return n})),r||(r=(()=>[]));let p=new i;return p.setFunc({data:t,query:e,item:s,children:r,getValue:a,getText:o,getIcon:l,isMatched:h}),d&&(n[d]=p),c&&p.setShadowed(c),u&&p.addHooks(u),p},GetDict(t,e){let i=n[t];return i&&e&&(i=i.duplicate({hooks:!1})).addHooks(e),i},CheckDict(t,e){let i=s.GetDict(t,e);if(i)return i;let{name:r,args:a}=s.explainDictName(t);if(i=s.GetDict(r,e)){if(!_.isEmpty(a)){let e=i.duplicate({hooks:!0,dataCache:!1});return e.setFunc({data:function(){return this.getChildren(...a)}}),n[t]=e,e}return i}throw`e.dict.noexists : ${t}`},explainDictName(t){let e={},i=/^([^:()]+)(\(([^)]*)\))?(:(.+))?$/.exec(t);return i&&(e.name=i[1],e.args=Ti.S.joinArgs(i[3]),e.vkey=i[5]),e},async getBy(t,e){if(Ti.Util.isNil(e))return e;let{name:i,vKey:n}=s.explainDictName(t),r=s.CheckDict(i);return await r.getItemAs(n,e)},async getAll(t){try{let e=s.CheckDict(t);return await e.getData()}catch(e){console.error(`e.dict.getAll : ${t}`,e)}},async getText(t,e){try{let i=s.CheckDict(t);return await i.getItemText(e)}catch(e){console.error(`e.dict.getText : ${t}`,e)}},async getIcon(t,e){try{let i=s.CheckDict(t);return await i.getItemIcon(e)}catch(e){console.error(`e.dict.getIcon : ${t}`,e)}}};return{Dict:i,DictFactory:s}}(),{VueEventBubble:VueEventBubble}=function(){const t=function(t,e,i=!1){t.$parent&&!i&&(_.isFunction(t.__before_bubble)&&(e=t.__before_bubble(e)||e),t.$parent.$notify(e.name,...e.args))},e=function(e,...i){let n,s={name:e,args:i},r=!1;if(_.isFunction(this.__on_events)&&(n=this.__on_events(e,...i)),_.isFunction(n)||(n=_.get(this.$listeners,e)),_.isFunction(n)||(n=this.$tiEventTryFallback(e,this.$listeners)),_.isFunction(n)){let e=n(...s.args);r=!0,_.isBoolean(e)?r=e:e&&_.isBoolean(e.stop)&&(r=e.stop),t(this,s,r)}else t(this,s)};return{VueEventBubble:{install(t,{overrideEmit:i=!1}={}){_.assign(t.prototype,{$notify:e,$tiEventTryFallback(t,e={}){let i=_.split(t,"::");for(;i.length>1;){let[,...t]=i,n=t.join("::"),s=_.get(e,n);if(s)return s;i=t}}}),i&&t.mixin({created:function(){this.$emit=e}})}}}}(),{VueTiCom:VueTiCom}=function(){const t={inheritAttrs:!1,computed:{...Vuex.mapGetters("viewport",["viewportMode","viewportActivedComIds","isViewportModeDesktop","isViewportModeTablet","isViewportModePhone","isViewportModeDesktopOrTablet","isViewportModePhoneOrTablet"]),tiComId(){return`${this._uid}:${this.tiComType}`},isActived(){return _.indexOf(this.viewportActivedComIds,this.tiComId)>=0},isSelfActived(){return _.last(this.viewportActivedComIds)==this.tiComId},getTopClass(){return(...t)=>Ti.Css.mergeClassName({"is-self-actived":this.isSelfActived,"is-actived":this.isActived},t,this.className)}},props:{className:void 0,onInit:void 0,onReady:void 0},created:async function(){_.isFunction(this.onInit)&&this.onInit(this)},mounted:function(){_.isFunction(this.onReady)&&this.onReady(this)},beforeDestroyed:function(){Ti.App(this).setBlurredVm(this)}},e={tiActivableComIdPath(t=!0){let e=this.tiActivableComPath(t);return _.map(e,t=>t.tiComId)},tiActivableComPath(t=!0){let e=[this],i=this.$parent;for(;i;)i.__ti_activable__&&e.push(i),i=i.$parent;return t&&e.reverse(),e},tiParentActivableCom(){let t=this.$parent;for(;t&&!t.__ti_activable__;)t=t.$parent;return t},setActived(){this.isSelfActived||Ti.App(this).setActivedVm(this)}};return{VueTiCom:{install(i){i.mixin(t),_.assign(i.prototype,e),i.filter("i18n",function(t,e={}){return/^i18n:(.+)/.test(t)?Ti.I18n.textf(t,e):Ti.I18n.getf(t,e)}),i.filter("percent",function(t,e=2,i=!0){return Ti.S.toPercent(1*t,{fixed:e,auto:i})}),i.filter("float",function(t,e=2,i=0){return Ti.Types.toFloat(t,{precision:e,dft:i})}),i.filter("datetime",function(t,e="yyyy-MM-dd"){return Ti.DateTime.format(t,e)}),i.directive("dropFiles",{bind:function(t,e){let i=null,n=null,s=e.modifiers.mask;_.isArray(e.value)?(i=e.value.length>0?e.value[0]:null,n=e.value.length>1?e.value[1]:null):_.isFunction(e.value)&&(i=e.value),s&&(n=Ti.I18n.text(n||"i18n:drop-file-here-to-upload")),t.__drag_enter_count=0,t.addEventListener("dragenter",function(e){t.__drag_enter_count++,1==t.__drag_enter_count&&(t.setAttribute("ti-is-drag",""),s&&(t.$ti_drag_mask=Ti.Dom.createElement({className:"ti-drag-mask",$p:t}),t.$ti_drag_mask.innerHTML=`<span>${n}</span>`))}),t.addEventListener("dragover",function(t){t.preventDefault(),t.stopPropagation()}),t.addEventListener("dragleave",function(e){t.__drag_enter_count--,t.__drag_enter_count<=0&&(t.removeAttribute("ti-is-drag"),t.$ti_drag_mask&&(Ti.Dom.remove(t.$ti_drag_mask),delete t.$ti_drag_mask))}),t.addEventListener("drop",function(e){e.preventDefault(),e.stopPropagation(),t.__drag_enter_count=0,t.removeAttribute("ti-is-drag"),t.$ti_drag_mask&&(Ti.Dom.remove(t.$ti_drag_mask),delete t.$ti_drag_mask),_.isFunction(i)&&i(e.dataTransfer.files)})}}),i.directive("dropOff",{bind:function(t,e){t.addEventListener("dragover",function(t){t.preventDefault(),t.stopPropagation()}),t.addEventListener("drop",function(t){t.preventDefault(),t.stopPropagation()})}}),i.directive("dragOff",{bind:function(t,e){t.addEventListener("dragstart",function(t){t.preventDefault(),t.stopPropagation()})}}),i.directive("tiActivable",{bind:function(t,{value:e},{context:i}){let n=i;n.__ti_activable__=!0,t.addEventListener("click",function(t){t.__ti_activable_used__||(t.__ti_activable_used__=!0,n.setActived())})}})}}}}(),{WalnutAppMain:WalnutAppMain}=function(){return{WalnutAppMain:async function({rs:t="/gu/rs/",appName:e="wn.manager",preloads:i=[],debug:n=!1,logging:s={root:"warn"},shortcute:r=!0,theme:a,lang:o="zh-cn",viewport:l={phoneMaxWidth:540,tabletMaxWidth:768,designWidth:1e3,max:100,min:80}}={}){if(Ti.AddResourcePrefix(t),Vue.use(Ti.Vue.EventBubble),Vue.use(Ti.Vue.TiCom),Ti.SetForDev(n),Ti.SetLogLevel(s.root),_.forEach(s.names,(t,e)=>{Ti.SetLogLevel(t,e)}),r&&Ti.Shortcut.startListening(),l&&Ti.Viewport.startListening(),Ti.SetAppName(e),Ti.Config.set({prefix:{app:"/a/load/",MyApp:`/a/load/${e}/`,theme:`${t}ti/theme/`,lib:`${t}ti/lib/`,deps:`${t}ti/deps/`,dist:`${t}ti/dist/`,mod:`${t}ti/mod/`,com:`${t}ti/com/`,i18n:`${t}ti/i18n/`},alias:{"^./":"@MyApp:","^@MyApp:?$":"@MyApp:_app.json","^@i18n:(.+)$":`@i18n:${o}/$1`,"/i18n/":`/i18n/${o}/`,"^(@[A-Za-z]+):i18n/(.+)$":`$1:i18n/${o}/$2`},suffix:{"^@theme:":".css","^@app:":"/_app.json","(^@mod:|[/:]mod/)":"/_mod.json","(^@com:|[/:]com/)":"/_com.json","(^@i18n:|[/:]i18n/)":".i18n.json"},lang:o}),!_.isEmpty(i)){let t=[];_.forEach(i,e=>{t.push(Ti.Load(e))}),await Promise.all(t)}Ti.I18n.put(await Ti.Load(["@i18n:_ti","@i18n:_wn","@i18n:_net","@i18n:web","@i18n:ti-datetime"]));let h=await Wn.Sys.exec("ti config -cqn",{appName:e,as:"json"});if(_.isEmpty(h)||Ti.Config.update(h),h.i18n&&Ti.I18n.put(await Ti.Load(h.i18n)),h.css){let t=[].concat(h.css);for(let e of t){let t=_.template(e)({theme:a});await Ti.Load(t)}}let c=await Ti.Load("@MyApp");if(_.assign(c.data,h.gui),_.isEmpty(h.components)||Ti.Util.pushUniqValue(c,"components",h.components),_.isEmpty(h.deps)||Ti.Util.pushUniqValue(c,"deps",h.deps),!_.isEmpty(h.preloads)){let t=[];_.forEach(h.preloads,e=>{t.push(Ti.Load(e))}),await Promise.all(t)}if(!_.isEmpty(h.rsPrefixes)){let t=_.concat(h.rsPrefixes);Ti.AddResourcePrefix(...t)}for(let t of _.keys(h.global)){let e=h.global[t],i=await Ti.Load(e);window[t]=i}Wn.Dict.setup(h.dictionary);let u=Ti.App(c,async t=>{if(t.varLoadPath){let e=await Wn.Io.loadContent(t.varLoadPath,{as:"json"});_.set(t,"data.vars",e)}});await u.init(),Ti.Dom.watchAutoRootFontSize(l,({$root:t,mode:e,fontSize:i})=>{t.style.fontSize=i+"px",t.setAttribute("as",e),Ti.App.eachInstance(t=>{t.commit("viewport/setMode",e)})}),u.commit("session/set",_app.session),Wn.Session.setup(_app.session),u.mountTo("#app"),Ti.App.pushInstance(u);let d="~";return _app.obj&&(d="id:"+_app.obj.id),await u.dispatch("current/reload",d),u.get("obj")}}}(),{WebAppMain:WebAppMain}=function(){return{WebAppMain:async function({rs:t="/gu/rs/",siteRs:e="/",vars:i={},lang:n="zh-cn",appJson:s,siteId:r,domain:a,preloads:o=[],debug:l=!1,logging:h={root:"warn"},shortcute:c=!0,viewport:u={phoneMaxWidth:640,tabletMaxWidth:900,designWidth:1200,max:100,min:70}}={}){if(t=_.get(i,"rs")||t,e=_.get(i,"siteRs")||e,n=_.get(i,"lang")||n,Ti.AddResourcePrefix(t,e),Vue.use(Ti.Vue.EventBubble),Vue.use(Ti.Vue.TiCom),Ti.SetForDev(l),Ti.SetLogLevel(h.root),_.forEach(h.names,(t,e)=>Ti.SetLogLevel(e,t)),c&&Ti.Shortcut.startListening(),u&&Ti.Viewport.startListening(),Ti.Config.set({prefix:{Site:`${e}`,theme:`${t}ti/theme/`,lib:`${t}ti/lib/`,deps:`${t}ti/deps/`,dist:`${t}ti/dist/`,mod:`${t}ti/mod/`,com:`${t}ti/com/`,i18n:`${t}ti/i18n/`},alias:{"^./":"@Site:","^@Site:?$":"@Site:_app.json","^@i18n:(.+)$":`@i18n:${n}/$1`,"[:/]i18n/":`$&${n}/`},suffix:{"^@theme:":".css","^@app:":"/_app.json","(^@mod:|[/:]mod/)":"/_mod.json","(^@com:|[/:]com/)":"/_com.json","(^@i18n:|[/:]i18n/)":".i18n.json"},lang:n}),!_.isEmpty(o)){let t=[];_.forEach(o,e=>{t.push(Ti.Load(e))}),await Promise.all(t)}if(Ti.I18n.put(await Ti.Load(["@i18n:_ti","@i18n:_net","@i18n:_wn","@i18n:web","@i18n:ti-datetime"])),s.css){let t=_.concat(s.css);for(let e of t)e&&await Ti.Load(e)}_.isArray(i.deps)&&Ti.Util.pushUniqValue(s,"deps",i.deps);let d=await Ti.App(s,e=>(_.assign(e.store.state,i,{loading:!1,siteId:r,domain:a,rs:t}),e));return await d.init(),Ti.App.pushInstance(d),Ti.SetAppName(d.name()),Ti.Dom.watchAutoRootFontSize(u,({$root:t,mode:e,fontSize:i})=>{t.style.fontSize=i+"px",t.setAttribute("as",e),Ti.App.eachInstance(t=>{t.commit("viewport/setMode",e)})}),d.mountTo("#app"),await d.dispatch("reload"),d}}}(),LOAD_CACHE={};let RS_PREFIXs=[];const ENV={version:"2.5-20201210.162732",dev:!1,appName:null,session:{},log:{ROOT:0}},LOG_LEVELS={error:0,warn:1,info:2,debug:3,trace:4},G_FUNCS={};export const Ti={Alg:Alg,Be:Be,S:S,Util:Util,App:App,Err:Err,Config:Config,Dom:Dom,Css:Css,Load:Load,Http:Http,Icons:Icons,I18n:I18n,Shortcut:Shortcut,Fuse:Fuse,Random:Random,Storage:Storage,Types:Types,Viewport:Viewport,WWW:WWW,GPS:GPS,GIS:GIS,Validate:Validate,DateTime:DateTime,Num:Num,Trees:Trees,Bank:Bank,Mapping:Mapping,Dict:Dict,DictFactory:DictFactory,Rects:Rects,Rect:Rect,AutoMatch:AutoMatch,Websocket:TiWebsocket,Preload:Preload,MatchCache:MatchCache,AddResourcePrefix:AddResourcePrefix,RS_PREFIXs:RS_PREFIXs,LOAD_CACHE:LOAD_CACHE,WalnutAppMain:WalnutAppMain,WebAppMain:WebAppMain,Vue:{EventBubble:VueEventBubble,TiCom:VueTiCom},Alert:Alert,Confirm:Confirm,Prompt:Prompt,Toast:Toast,Captcha:Captcha,Env:(t,e)=>_.isUndefined(t)?ENV:Ti.Util.geset(ENV,t,e),Version:()=>Ti.Env("version"),SetForDev(t=!0){Ti.Env({dev:t})},IsForDev:()=>Ti.Env("dev"),SetAppName(t){Ti.Env({appName:t})},GetAppName:()=>Ti.Env("appName"),SetLogLevel(t=0,e="ROOT"){_.isString(t)&&(t=LOG_LEVELS[t]||0),ENV.log[e]=t},IsError:t=>_IS_LOG(t,LOG_LEVELS.error),IsWarn:t=>_IS_LOG(t,LOG_LEVELS.warn),IsInfo:t=>_IS_LOG(t,LOG_LEVELS.info),IsDebug:t=>_IS_LOG(t,LOG_LEVELS.debug),IsTrace:t=>_IS_LOG(t,LOG_LEVELS.trace),Invoke(t,e=[],i){if(_.isFunction(t))return i=i||this,t.apply(i,e)},InvokeBy(t={},e,i=[],n){if(t)return Ti.Invoke(t[e],i,n||t)},async DoInvoke(t,e=[],i){if(_.isFunction(t))return i=i||this,await t.apply(i,e)},async DoInvokeBy(t={},e,i=[],n){if(t)return await Ti.DoInvoke(t[e],i,n||t)},AddGlobalFuncs(t){_.assign(G_FUNCS,t)},GlobalFuncs:()=>_.assign({},Ti.Types,G_FUNCS)};export default Ti;window&&(window.Ti=Ti);