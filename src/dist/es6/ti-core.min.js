function Preload(t,e){LOAD_CACHE[t]=e}function AddResourcePrefix(...t){let e=_.flattenDeep(t);for(let t of e)!Ti.Util.isNil(t)&&_.indexOf(RS_PREFIXs,t)<0&&(t&&!t.endsWith("/")?RS_PREFIXs.push(t+"/"):RS_PREFIXs.push(t))}function MatchCache(t){if(t){for(let e of RS_PREFIXs)if(!Ti.Util.isNil(e)&&t.startsWith(e)){t=t.substring(e.length);break}return LOAD_CACHE[t]}}function _IS_LOG(t="ROOT",e){let i=ENV.log[t];return _.isUndefined(i)&&(i=ENV.log.ROOT),i>=e}const{Alert:Alert}=function(){return{Alert:async function(t="",{title:e,icon:i,type:n="track",textOk:s="i18n:ok",position:r="center",width:a=480,height:o,vars:l={}}={}){let h=Ti.I18n.textf(t,l),c=i||Ti.Icons.get(n,"zmdi-info"),u=e||Ti.I18n.get(n);return await Ti.App.Open({className:"is-alert in-top-z-index",type:n,width:a,height:o,position:r,title:u,closer:!1,actions:[{text:s,handler:()=>!0}],comType:"modal-inner-body",comConf:{icon:c,text:h},components:{name:"modal-inner-body",globally:!1,props:{icon:void 0,text:void 0},template:'<div class="ti-msg-body as-alert">\n          <div class="as-icon"><ti-icon :value="icon"/></div>\n          <div class="as-text">{{text}}</div>\n        </div>',methods:{__ti_shortcut(t){"ENTER"==t&&this.$notify("ok")}}}})}}}(),{Confirm:Confirm}=function(){return{Confirm:async function(t="",{title:e,icon:i,vars:n,closer:s=!1,type:r="info",position:a="center",textYes:o="i18n:yes",textNo:l="i18n:no",width:h=480,height:c}={}){let u=_.isEmpty(n)?Ti.I18n.text(t):Ti.I18n.textf(t,n),d=i||"zmdi-help",p=e||"i18n:confirm";return await Ti.App.Open({type:r,width:h,height:c,position:a,title:p,closer:s,actions:[{text:o,handler:()=>!0},{text:l,handler:()=>!1}],comType:"modal-inner-body",comConf:{icon:d,text:u},components:{name:"modal-inner-body",globally:!1,props:{icon:void 0,text:void 0},template:'<div class="ti-msg-body as-confirm">\n          <div class="as-icon"><ti-icon :value="icon"/></div>\n          <div class="as-text">{{text}}</div>\n        </div>',methods:{__ti_shortcut(t){"ENTER"==t&&this.$notify("ok",!0)}}}})}}}(),{Prompt:Prompt}=function(){return{Prompt:async function(t="",{title:e="i18n:prompt",icon:i,type:n="info",position:s="center",iconOk:r,iconCancel:a,textOk:o="i18n:ok",textCancel:l="i18n:cancel",width:h=480,height:c,trimed:u=!0,placeholder:d="",valueCase:p=null,value:m="",comType:f="TiInput",comConf:g={focused:!0,autoSelect:!0},comModel:y={}}={}){let T=Ti.I18n.text(t),x=i||"zmdi-keyboard";return y=y||{},/^TiInput(Currency)?/.test(f)?_.defaults(y,{event:"inputing",prop:"value"}):_.defaults(y,{event:"change",prop:"value"}),await Ti.App.Open({type:n,width:h,height:c,position:s,title:e,closer:!1,result:m,textOk:o,textCancel:l,iconOk:r,iconCancel:a,comType:"modal-inner-body",components:[{name:"modal-inner-body",globally:!1,data:{icon:x,text:T,comType:f,comConf:_.assign({placeholder:d||m,trimed:u,valueCase:p},g)},props:{value:null},template:`<div class="ti-msg-body as-prompt"\n          v-ti-activable>\n          <div class="as-icon"><ti-icon :value="icon"/></div>\n          <div class="as-text">\n            <div class="as-tip" v-if="text">{{text}}</div>\n            <component \n              :is="comType"\n              v-bind="comConf"\n              :${y.prop}="value"\n              @${y.event}="OnComChange"/>\n          </div>\n        </div>`,methods:{OnComChange(t){this.$emit("change",t)},__ti_shortcut(t){"ENTER"==t&&Ti.App(this).$vm().close(this.value)}}},"@com:ti/input"]})}}}(),{Captcha:Captcha}=function(){return{Captcha:async function(t="",{title:e="i18n:captcha-tip",type:i="info",position:n="center",iconOk:s,iconCancel:r,textOk:a="i18n:ok",textCancel:o="i18n:cancel",width:l=420,height:h,imgWidth:c,imgHeight:u=50,textChange:d="i18n:captcha-chagne",placeholder:p="i18n:captcha"}={}){return await Ti.App.Open({type:i,width:l,height:h,position:n,title:e,closer:!1,result:"",textOk:a,textCancel:o,iconOk:s,iconCancel:r,comType:"modal-inner-body",components:[{name:"modal-inner-body",globally:!1,data:{src:t,timestamp:Date.now(),imgWidth:c,imgHeight:u,textChange:d,placeholder:p||value},props:{value:null},template:'<div class="web-simple-form">\n          <header style="padding-bottom:0;">\n            <img ref="pic"\n              v-if="src"\n                :style="CaptchaStyle"\n                :src="CaptchaSrc"\n                @load="OnImgLoaded"/>\n          </header>\n          <section>\n            <div class="as-input">\n              <input ref="input"\n                spellcheck="false"\n                :placeholder="placeholder|i18n"\n                :value="value"\n                @input="$emit(\'change\', $refs.input.value)">\n              <span @click="timestamp = Date.now()">\n                <a>{{textChange|i18n}}</a>\n              </span>\n            </div>\n          </section>\n        </div>',computed:{CaptchaStyle(){return Ti.Css.toStyle({width:this.imgWidth,height:this.imgHeight})},CaptchaSrc(){return this.src&&this.timestamp>0?-1==this.src.lastIndexOf("?")?this.src+"?_t="+this.timestamp:this.src+"&_t="+this.timestamp:this.src}},methods:{OnImgLoaded(){Ti.Be.BlinkIt(this.$refs.pic)},__ti_shortcut(t){"ENTER"==t&&Ti.App(this).$vm().close(this.value)}}}]})}}}(),{Toast:Toast}=function(){const{TiRuntimeStack:t}=function(){class t{constructor({setItemViewportMode:t=_.identity}={}){this.viewportMode="desktop",this.stack=[],this.setItemViewportMode=t}push(t){t&&(this.setItemViewportMode(t,this.viewportMode),this.stack.push(t))}remove(t){let e,i=[];for(let n of this.stack)n===t?e=n:i.push(n);return this.stack=i,e}setViewportMode(t){this.viewportMode=t;for(let e of this.stack)this.setItemViewportMode(e,t)}pop(){return this.stack.pop()}}return{TiRuntimeStack:t}}(),e=new t,i=Symbol("toa-options"),n=Symbol("toa-app-instance");class s{constructor(t={}){this[i]=t}async open(){let{position:t="center",icon:s=!0,content:r="i18n:empty",vars:a={},type:o="info",spacing:l=0,duration:h=3e3,closer:c=!0}=this[i],u=Ti.Dom.createElement({$p:document.body,className:"the-stub"});!0===s&&(s=Ti.Icons.get(o));let d={template:'<div class="ti-toast"\n        :class="topClass"\n        :style="topStyle"\n        @click="onClose">\n        <transition :name="transName"\n          @after-leave="onAfterLeave">\n          <div v-if="!hidden"\n            class="toast-con"\n            @click.stop>\n            <div v-if="icon"\n              class="toast-icon">\n              <ti-icon :value="icon"/>\n            </div>\n            <div class="toast-body">{{content|i18n(vars)}}</div>\n            <div v-if="closer && \'center\'!=position"\n              class="toast-closer">\n              <a @click="onClose">{{\'close\'|i18n}}</a>\n            </div>\n          </div>\n        </transition>\n      </div>',data:{position:t,icon:s,content:r,type:o,closer:c,vars:a,hidden:!0},store:{modules:{viewport:"@mod:ti/viewport"}},computed:{topClass(){return Ti.Css.mergeClassName({"as-bar":"center"!=this.position,"as-block":"center"==this.position},[`at-${this.position}`,`is-${this.type}`])},topStyle(){if("center"!=this.position)return{padding:Ti.Css.toSize(l)}},transName(){return`toast-trans-at-${this.position}`}},methods:{onClose(){this.closer&&(this.hidden=!0)},onAfterLeave(){Ti.App(this).$toast.close()},doOpen(){this.hidden=!1},doClose(){this.hidden=!0}}},p=await Ti.App(d);return this[n]=p,await p.init(),p.mountTo(u),p.$toast=this,p.root("doOpen"),e.push(this),h>0&&_.delay(()=>{p.root("doClose")},h),this}$app(){return this[n]}close(){e.remove(this),this.$app().destroy(!0)}}return{Toast:{Open(t,e="info",i="top"){t instanceof Error&&(t=t.errMsg||t+""),_.isString(t)&&(t=_.isPlainObject(e)?_.assign({position:i,type:"info",content:t,vars:e},e):{type:e||"info",position:i||"top",content:t}),/^i18n:/.test(t.content)||(t.content=Ti.I18n.translate(t.content));let n=new s(t);return n.open(),n},Close(){let t=e.pop();t&&t.close()}}}}(),{Toptip:Toptip}=function(){class t{constructor({$el:t,content:e,type:i}={}){this.$el=t,this.content=e,this.type=i}async open(){let t={template:'<WebTextArticle\n      :value="content"\n      :type="type"\n      theme="tipbox"\n      />',data:_.pick(this,"content","type"),store:{modules:{viewport:"@mod:ti/viewport"}},computed:{},methods:{},components:["@com:web/text/article"]},e=await Ti.App(t);return this.app=e,await e.init(),e.mountTo(this.$el),this}}const e={tipBox:null,$target:null,$wrapper:null,targetRect:null,tipRect:null,closeCheckerIsSet:!1,checkDelay:200,async createTip(e,i={}){if(this.$target===e)return;this.$target=e;let n=this.getTipData(e),{type:s="paper",size:r="auto",content:a,contentType:o="text",mode:l="H",vars:h={}}=_.assign(n,i),c=/^\[(([HV]):?)?(([^!]+)!)?(html|text|md)?(:?([^\]]+))?\]\s*(.+)/.exec(a);c&&(l=c[2]||l,s=c[4]||s,o=c[5]||o,r=c[7]||_.trim(r),a=_.trim(c[8]));let{$wrapper:u,$foot:d,$stub:p,$arrow:m}=this.getTipWarpper(!0);Ti.Dom.setAttrs(u,{"tip-size":r,"tip-type":s,"tip-ready":"no"});let f=this.getTipMeasureStyle(r);if(Ti.Dom.setStyle(u,f),/^i18n:/.test(a)&&(a=Ti.I18n.translate(a.substring(5).trim())),/^@tip:/.test(a)){let t=Ti.S.renderBy(a,{lang:_.snakeCase(Ti.Env("LANG")||"zh-cn")});o={txt:"text",html:"html",md:"text"}[Ti.Util.getSuffixName(a)]||"text",a=await Ti.Load(t)}_.isEmpty(h)||(a=Ti.Tmpl.exec(a,h));let g=new t({$el:p,content:a,type:o});await g.open();let y=Ti.Dom.dockTo(u,e,{mode:l,space:{H:{x:0,y:12},V:{x:12,y:0}}[l]||0,posListX:{H:["center"],V:["right","left"]}[l],posListY:{H:["bottom","top"],V:["center"]}[l]});Ti.Dom.setAttrs(u,{"tip-at":y.axis["H"==l?"y":"x"]});let T=Ti.Rects.createBy(m),x={H:({left:t},{x:e})=>({"margin-left":`${Math.round(e-t-T.width/2)}px`}),V:({top:t},{y:e})=>({"margin-top":`${Math.round(e-t-T.height/2)}px`})}[l](y.srcRect,y.targetRect);Ti.Dom.setStyle(d,x),_.delay(()=>{Ti.Dom.setAttrs(u,{"tip-ready":"yes"})},10),this.$target=e,this.tipBox=g,this.targetRect=this.genRectScope(y.targetRect),this.tipRect=y.srcRect},genRectScope:(t,e=20)=>(t.width+=e,t.height+=e,t.updateBy("xywh")),getTipMeasureStyle(t){let e={};const i=(t,i)=>{/^[0-9]+$/.test(i)?e[t]=`${i}px`:e[t]=i};let n=/^(([.0-9]*)(r?em|px)?)[Xx:,-](([.0-9]*)(r?em|px)?)$/.exec(t);return n&&(i("width",n[1]),i("height",n[4])),e},getTipData(t,e){let i={},n=Ti.Dom.getData(t,(t,e)=>{let n=/^(tiTip)(Vars)?(.*)?$/.exec(t);if(n){if("Vars"==n[2])return void(i[_.lowerFirst(n[3])]=e);return _.camelCase(n[3]||"content")}});return n.vars=i,n},isInTargetRect(t){return this.isInRect("targetRect",t)},isInTipRect(t){return this.isInRect("tipRect",t)},isInRect(t,e={}){let i=this[t];return i&&i.hasPoint(e)},async OnHoverInTarget(t){this.$target!==t&&(await this.destroy(!0),this.createTip(t))},OnHoverInBody(){if(this.closeCheckerIsSet||!this.tipBox)return;let t=this.point;this.isInTipRect(t)||this.isInTargetRect(t)||(_.delay(()=>{this.closeCheckerIsSet=!1;let t=this.point;this.isInTipRect(t)||this.isInTargetRect(t)||(this.destroy(),this.tipBox=null)},this.checkDelay+1),this.closeCheckerIsSet=!0)},destroy(t=!1){if(!this.tipBox||!this.tipBox.app)return;let{$wrapper:e,$main:i,$foot:n}=this.getTipWarpper(!1);const s=()=>{this.$target=null,this.targetRect=null,this.tipRect=null,this.tipBox&&this.tipBox.app&&(this.tipBox.app.destroy(),this.tipBox=null),i.innerHTML="<div></div>",e.style=null,n.style=null};if(e){if(Ti.Dom.setAttrs(e,{"tip-ready":"no"}),!t)return new Promise(t=>{_.delay(()=>{s(),t(!0)},100)});s()}},getTipWarpper(t=!1){let e=this.$wrapper;if(!e){if(!t)return{};(e=Ti.Dom.find("#ti-tip-wrapper"))||(e=Ti.Dom.createElement({tagName:"div",attrs:{id:"ti-tip-wrapper"}}),Ti.Dom.appendToBody(e),this.$wrapper=e)}let i=Ti.Dom.find(":scope > div.ti-tip-box",e);if(!i){if(!t)return{$wrapper:e};e.innerHTML='<div class="ti-tip-box">\n          <main><div></div></main>\n          <footer><span class="tip-arrow"></span></footer>\n        </div>',i=Ti.Dom.find(":scope > div.ti-tip-box",e)}let n=Ti.Dom.find(":scope > main",i);return{$wrapper:e,$tip:i,$main:n,$foot:Ti.Dom.find(":scope > footer",i),$arrow:Ti.Dom.find(":scope > footer > .tip-arrow",i),$stub:Ti.Dom.find(":scope > div",n)}},drawHelper(t,e){let i=`ti-tip-box-helper-${t}`,n=Ti.Dom.find(`#${i}`);if(e){n||(n=Ti.Dom.createElement({attrs:{id:i},style:{position:"fixed",background:"rgba(255,255,0,0.3)",zIndex:99999999999}}),Ti.Dom.appendToBody(n));let t=e.toCss();Ti.Dom.updateStyle(n,t)}else n&&Ti.Dom.remove(n)},drawAllHelpers(){this.drawHelper("tip",this.tipRect),this.drawHelper("tag",this.targetRect)},watch(){document.addEventListener("mousemove",t=>{let i={x:t.clientX,y:t.clientY};e.point=i;let n=Ti.Dom.closest(t.target,"[data-ti-tip]",{includeSelf:!0});if(n){let i=_.lowerCase(n.getAttribute("data-ti-keyboard"));if(/^(ctrl|alt|shift|meta)$/.test(i)&&!t[`${i}Key`])return;e.OnHoverInTarget(n)}else e.OnHoverInBody()})},toTipBind({mode:t="H",size:e="auto",type:i="secondary",contentType:n="text",text:s,keyboard:r}={}){if(s)return{"data-ti-tip-mode":t,"data-ti-tip-size":e,"data-ti-tip-type":i,"data-ti-tip-contentType":n,"data-ti-tip":s,"data-ti-keyboard":r||void 0}}};return{Toptip:e}}(),{EditCode:EditCode}=function(){return{EditCode:async function(t="",{mode:e="text",title:i="i18n:view",position:n="top",width:s="62%",height:r="62%",textOk:a,textCancel:o,readonly:l}={}){return await Ti.App.Open({title:i,position:n,width:s,height:r,textOk:a,textCancel:o,result:t,comType:"TiTextCodeAce",comConf:{mode:e,readonly:l},components:["@com:ti/text/code/ace"]})}}}(),{Be:Be}=function(){const t={Draggable:function(){return function(t,e={}){let{trigger:i,viewport:n,watchZone:s,handler:r=null,speed:a=100,testActive:o=(()=>!0),activedRadius:l=0,activedDelay:h=0,prepare:c=_.identity,dragging:u=_.identity,actived:d=_.identity,done:p=_.identity,finished:m=_.identity}=e,f={};_.isNumber(l)?(f.x=l,f.y=l):_.assign(f,{x:-1,y:-1},_.pick(l,"x","y"));const g=function(e,i,n){return _.isFunction(i)?i(e)||n:_.isString(i)?Ti.Dom.find(i,t)||n:n};let y={setClientXY:function(t,e){let i=this.getPointerEvent(e);t.clientX=i.clientX,t.clientY=i.clientY}};Ti.Dom.isTouchDevice()?_.assign(y,{POINTER_DOWN:"touchstart",POINTER_MOVE:"touchmove",POINTER_UP:"touchend",getPointerEvent:t=>t.touches[0]}):_.assign(y,{POINTER_DOWN:"mousedown",POINTER_MOVE:"mousemove",POINTER_UP:"mouseup",POINTER_CLICK:"click",getPointerEvent:t=>t}),t.addEventListener(y.POINTER_DOWN,function(e){function l(t){t.preventDefault(),t.stopPropagation()}function T(t){let e={x:k.clientX,y:k.clientY};k.watchZone.hasPoint(e)?(y.setClientXY(k,t),k.evalScale(),k.actived&&(k.__already_call_actived||(d(k),k.__already_call_actived=!0,y.POINTER_CLICK&&k.$src.addEventListener(y.POINTER_CLICK,l,{capture:!0,once:!0})),u(k))):x(t)}function x(t){b.removeEventListener(y.POINTER_MOVE,T,!0),b.removeEventListener(y.POINTER_UP,x,!0),k.clientX=t.clientX,k.clientY=t.clientY,k.$stopEvent=t,k.actived&&(y.POINTER_CLICK&&k.$src.removeEventListener(y.POINTER_CLICK,l),p(k)),m(k)}let v=Ti.Dom.eventCurrentTarget(e,i,t);if(!_.isElement(v))return;let b=t.ownerDocument,w=t.ownerDocument.body,S=g(v,n,t),C=g(v,s,t.ownerDocument),$=g(v,r,t),k={};_.assign(k,{$event:e,$doc:b,$body:w,$viewport:S,$handler:$,$trigger:v,$watchZone:C}),y.setClientXY(k,e),k.$src=e.srcElement,o(k)&&_.isElement(S)&&_.isElement($)&&(k.__already_call_actived=!1,k.watchZone=Ti.Rects.createBy(C),k.viewport=Ti.Rects.createBy(S),k.handler=Ti.Rects.createBy($),k.startInMs=Date.now(),k.initScale=function(){let{left:t,top:e}=this.viewport;this.nowInMs=Date.now(),this.duInMs=this.nowInMs-this.startInMs;let i=this.clientX-t,n=this.clientY-e;this.startX=i,this.startY=n,this.x=i,this.y=n,this.offsetX=0,this.offsetY=0,this.moveX=0,this.moveY=0,this.scaleX=0,this.scaleY=0},k.evalScale=function(){let{width:t,height:e,left:i,top:n}=this.viewport;this.nowInMs=Date.now(),this.duInMs=this.nowInMs-this.startInMs;let s=this.clientX-i,r=this.clientY-n;if(this.offsetX=s-this.startX,this.offsetY=r-this.startY,this.offsetDistance=Math.sqrt(Math.pow(this.offsetX,2)+Math.pow(this.offsetY,2)),this.moveX=s-this.x,this.moveY=r-this.y,this.moveDistance=Math.sqrt(Math.pow(this.moveX,2)+Math.pow(this.moveY,2)),this.directionX=this.moveX<0?"left":"right",this.directionY=this.moveY<0?"up":"down",this.speed=this.moveDistance*a/this.duInMs,this.x=this.clientX-i,this.y=this.clientY-n,this.scaleX=s/t,this.scaleY=r/e,!this.actived){let t=Math.abs(this.offsetX),e=Math.abs(this.offsetY);this.duInMs>h&&(f.x<0||t>f.x)&&(f.y<0||e>f.y)&&(this.actived=!0)}},k.evalLeftBySpeed=function(t=0){let{viewport:e,$trigger:i,offsetX:n,speed:s}=this;s>1&&(t+=s*n);let r=i.scrollWidth,a=e.width-r;return t=_.clamp(t,a,0)},k.evalTopBySpeed=function(t=0){let{viewport:e,$trigger:i,offsetY:n,speed:s}=this;s>1&&(t+=s*n);let r=i.scrollHeight,a=e.height-r;return t=_.clamp(t,a,0)},k.initScale(),k=c(k,e)||k,b.addEventListener(y.POINTER_MOVE,T,!0),b.addEventListener(y.POINTER_UP,x,!0))})}}(),Open(t,{target:e="_blank",method:i="GET",params:n={},anchor:s,delay:r=100}={}){if(t&&t.url){let i=t;t=i.url,_.isEmpty(i.params)||(n=i.params),s=i.anchor||s,e=i.target||e}let a=t;return s&&(a=[t,s].join("#")),new Promise(s=>{let o=Ti.Dom.createElement({$p:document.body,tagName:"form",attrs:{target:e,method:i,action:a},props:{style:"display:none;"}});_.forEach(n,(t,e)=>{Ti.Dom.createElement({$p:o,tagName:"input",props:{name:e,value:t,type:"hidden"}})}),_.delay(function(){o.submit(),Ti.Dom.remove(o),s({url:t,target:e,method:i,params:n})},r)})},OpenLink:(e,{target:i="_blank",method:n="GET",delay:s=100}={})=>t.Open(e.url,{target:i,method:n,delay:s,params:e.params,anchor:e.anchor}),ScrollWindowTo({x:t=0,y:e=0}={}){window.scrollTo(t,e)},writeToClipboard(t){if(_.isString(t)||(t=Ti.Types.toStr(t)),navigator.clipboard)navigator.clipboard.writeText(t);else{let e=Ti.Dom.createElement({tagName:"textarea",style:{position:"fixed",top:"-100000px",left:"0px",width:"300px",height:"300px",opacity:-0,zIndex:1e4},props:{value:t},$p:document.body});e.focus(),e.select();try{document.execCommand("copy")||console.warn('fail to execCommand("copy") for text: ',t)}catch(t){console.warn("fail to copy text: ",t)}Ti.Dom.remove(e)}},BlinkIt:function(t,e){if(0!=(t=$(t)).length){"function"==typeof(e=e||{})?e={after:e}:"number"==typeof e&&(e={speed:e});var i=t.offset(),n=t[0].ownerDocument,s=$(n),r={width:t.outerWidth(),height:t.outerHeight(),"border-color":"#FF0",background:"#FFA",opacity:.8,position:"fixed",top:i.top-s.scrollTop(),left:i.left-s.scrollLeft(),"z-index":9999999},a=$(e.html||'<div class="z_blink_light">&nbsp;</div>');a.css(r).appendTo(n.body),a.animate({opacity:.1},e.speed||500,function(){$(this).remove(),"function"==typeof e.after&&e.after.apply(t)})}},EditIt(t,e={}){var i=$(t);if(0==i.length||i.hasClass("is-be-editing"))return;i.addClass("is-be-editing"),_.defaults(e,{text:null,width:0,height:0,extendWidth:!0,takePlace:!0,trim:!0,selectOnFocus:!0,copyStyle:["letter-spacing","margin","border","font-size","font-family","line-height","text-align"],ok:function(t,e){this.innerText=t},context:i[0]});const n={jEle:i,$el:i[0],options:e,oldValue:Ti.Util.fallback(e.text,i.text()),onCancel(){this.jMask.remove(),this.jDiv.remove(),this.jEle.css({visibility:""}).removeClass("is-be-editing")},onOk(){let t=this.jInput.val();e.trim&&(t=_.trim(t)),t!==this.oldValue&&e.ok.apply(e.context,[t,e.oldValue,e]),this.onCancel()}};let s=Ti.Rects.createBy(n.$el),r=e.width||s.width,a=e.height||s.height;const o=$('<div class="ti-be-editing as-con"><input></div>'),l=o.find("input"),h=$('<div class="ti-be-editing as-mask"></div>');if(_.assign(n,{jDiv:o,jInput:l,jMask:h,$div:o[0],$input:l[0],$mask:h[0],primaryWidth:r,primaryHeight:a}),h.css({position:"fixed",zIndex:999999,top:0,left:0,right:0,bottom:0}),o.css({position:"fixed",zIndex:1e6,top:s.top,left:s.left,width:r,height:a}),l.css({width:"100%",height:"100%",outline:"none",resize:"none",overflow:"hidden",padding:"0 .06rem",background:"rgba(255,255,50,0.8)",color:"#000",lineHeight:a}).attr({spellcheck:!1}).val(n.oldValue),!_.isEmpty(e.copyStyle)){const t=window.getComputedStyle(n.$el);let i=_.pick(t,e.copyStyle);l.css(i)}return n.jMask.appendTo(document.body),n.jDiv.appendTo(document.body),n.jEle.css({visibility:"hidden"}),e.selectOnFocus?n.$input.select():n.$input.focus(),l.one("blur",()=>{n.onOk()}),l.on("keydown",t=>{let e=t.which;27==e?n.onCancel():13==e&&n.onOk()}),n}};return{Be:t}}(),{Alg:Alg}=function(){return{Alg:{fillGrid(t=[],{flow:e="row",dense:i=!1,cols:n=3,rows:s=3,cellMeasure:r=(t=>({colStart:_.get(t,colStart),colSpan:Ti.Util.fallback(_.get(t,colSpan),1),rowStart:_.get(t,colStart),rowSpan:Ti.Util.fallback(_.get(t,colSpan),1)}))}={}){},sha1:t=>(_.isString(t)||(t=JSON.stringify(t)),CryptoJS.SHA1(t).toString()),gcd(t,e){return t=Math.round(t),(e=Math.round(e))?this.gcd(e,t%e):t},gcds(){var t=Array.from(arguments),e=_.flatten(t);if(0==e.length)return NaN;if(1==e.length)return e[0];for(var i=this.gcd(e[0],e[1]),n=2;n<e.length;n++)i=this.gcd(i,e[n]);return i},lcm(t,e){return t=Math.round(t),e=Math.round(e),t*e/this.gcd(t,e)},lcms(){var t=Array.from(arguments),e=_.flatten(t);if(0==e.length)return NaN;if(1==e.length)return e[0];for(var i=this.lcm(e[0],e[1]),n=2;n<e.length;n++)i=this.lcm(i,e[n]);return i}}}}(),{S:S}=function(){const TiStr={intToChineseNumber:(t,e=!1)=>e?TiStr._to_chinese_number(t,{CN_NC0:"零壹贰叁肆伍陆柒捌玖",CN_NU0:"个拾佰仟万亿"}):TiStr._to_chinese_number(t),_to_chinese_number(t,{CN_NC0:e="零一二三四五六七八九",CN_NU0:i="个十百千万亿"}={}){let n="";if(t<0&&(n+="负",t*=-1),0==t)return n+=e[0];if(t<10){return n+=e[t]}let s=[],r=0,a=t;for(;a>0;){let t=parseInt(a/10);s[r++]=a-10*t,a=t}let o,l,h,c=r-1;if(r>8){o=-1;for(let t=l=Math.min(c,11);t>=8;t--){if(0==(a=s[t])&&o<=0)continue;if(n+=e[a],t>8&&(a>0||o>0)){n+=i[t-8]}o=a}n[h=n.length-1]==e[0]?n[h]=i[5]:n+=i[5]}if(r>4){o=-1;for(let t=l=Math.min(c,7);t>=4;t--){if(0==(a=s[t])&&o<=0)continue;if(n+=e[a],t>4&&(a>0||o>0)){n+=i[t-4]}o=a}o>=0&&(n[h=n.length-1]==e[0]?n[h]=i[4]:n+=i[4])}o=-1;for(let t=l=Math.min(c,3);t>=0;t--){if(0==(a=s[t])&&0==o)continue;let r=e[a];if((1!=t||1!=a||l>1)&&(n+=r),t>0&&a>0){n+=i[t]}o=a}return h=n.length-1,n[h]==e[0]?n.substring(0,h):n},sBlank:(t,e)=>TiStr.isBlank(t)?e:t,isBlank:t=>!_.isNumber(t)&&!_.isBoolean(t)&&(_.isString(t)?!t||/^\s*$/.test(t):!t),splitIgnoreBlank(t,e=","){if(!t||!_.isString(t))return[];let i=t.split(e),n=_.filter(i,t=>!TiStr.isBlank(t));return _.map(n,t=>_.trim(t))},renderVars:(t={},e="",{iteratee:i,regex:n,safe:s}={})=>((_.isString(t)||_.isNumber(t))&&(t={val:t}),!t||_.isEmpty(t)?_.isArray(t)?[]:"":TiStr.renderBy(e,t,{iteratee:i,regex:n,safe:s})),renderBy(t="",e={},{iteratee:i,regex:n=/(\${1,2})\{([^}]+)\}/g,safe:s=!1}={}){if(!t)return _.isArray(e)?[]:"";if(e=e||{},s){let t=_.isRegExp(s)?s:void 0;e=TiStr.safeDeep(e,t)}if(_.isRegExp(i)&&(n=i,i=void 0),i||(i=(({varName:t,vars:e,matched:i}={})=>{if(i.startsWith("$$"))return i.substring(1);let n=i,s=t.indexOf("?");s>0&&(n=_.trim(t.substring(s+1)),t=_.trim(t.substring(0,s)));let r=!1;t.startsWith("i18n:")&&(r=!0,t=t.substring(5).trim());let a=Ti.Util.fallback(Ti.Util.getOrPick(e,t),n);return r?Ti.I18n.get(a):a})),_.isArray(e)){let i=[];for(let n=0;n<e.length;n++){let s=e[n],r=TiStr.renderBy(t,s);i.push(r)}return i}let r,a=[],o=0;for(;r=n.exec(t);){let s=r.index;s>o&&a.push(t.substring(o,s));let l=i({vars:e,matched:r[0],prefix:r[1],varName:r[2]});a.push(l),o=n.lastIndex}return o<t.length&&a.push(t.substring(o)),a.join("")},safeDeep(t={},e=/['"]/g){return _.isString(t)?t.replace(e,""):_.isArray(t)?_.map(t,t=>this.safeDeep(t,e)):_.isPlainObject(t)?_.mapValues(t,t=>this.safeDeep(t,e)):t},joinWithoutNil(t="",...e){let i=_.flattenDeep(e);return _.filter(i,t=>!Ti.Util.isNil(t)).join(t)},join(t=[],e="",i=null){let n=_.flattenDeep(t);return _.isFunction(i)&&(n=_.map(n,i)),n.join(e)},joinAs(t=[],e="",i=null){let n=null;return i&&(n=(t=>_.isPlainObject(t)?_.get(t,i):i)),TiStr.join(t,e,n)},toJsValue(t="",{autoJson:e=!0,autoDate:i=!0,autoNil:n=!1,trimed:s=!0,context:r={}}={}){if(_.isArray(t)){let a=[],o={autoJson:e,autoDate:i,autoNil:n,trimed:s,context:r};for(let e of t){let t=TiStr.toJsValue(e,o);a.push(t)}return a}if(_.isPlainObject(t)){let a={},o={autoJson:e,autoDate:i,autoNil:n,trimed:s,context:r};return _.forEach(t,(t,e)=>{let i=TiStr.toJsValue(t,o);a[e]=i}),a}if(Ti.Util.isNil(t)||_.isBoolean(t)||_.isNumber(t))return t;let a=s?_.trim(t):t,o=!1;if(a.endsWith("?")&&(o=!0,a=a.substring(0,a.length-1).trim()),n){if("undefined"==a)return;if("null"==a)return null}if(".."==a)return r;if(/^-?[\d.]+$/.test(a))return 1*a;let l=_.get(r,a);if(!_.isUndefined(l)||o)return l;if(/^(true|false|yes|no|on|off)$/.test(a))return/^(true|yes|on)$/.test(a);let h=/^'([^']*)'$/.exec(a);if(h)return h[1];if(e){let e=Ti.Types.safeParseJson(t);if(!_.isUndefined(e))return e}if(i)try{return Ti.Types.toDate(t)}catch(t){}return a},joinArgs(s,args=[],iteratee=TiStr.toJsValue){if(_.isString(s)){if(/^\{.*\}$/.test(s))try{return[eval(`(${s})`)]}catch(t){}let list=s.split(",");for(let t of list){let e=_.trim(t);if(!e)continue;let i=iteratee(e);args.push(i)}return args}if(_.isArray(s))for(let t of s){let e=iteratee(t);args.push(e)}else _.isUndefined(s)||args.push(s);return args},toArray(t,{sep:e=/[:,;\t\n\/]+/g,ignoreNil:i=!0}={}){if(Ti.Util.isNil(t))return[];if(_.isArray(t))return t;if(_.isString(t)&&e){let n=_.map(t.split(e),t=>_.trim(t));return i?_.without(n,""):n}return[t]},toArrayBy:(t,e=",")=>TiStr.toArray(t,{sep:e,ignoreNil:!0}),toObject(t,{sep:e=/[:,;\t\n\/]+/g,ignoreNil:i=!0,keys:n=["value","text?value","icon"]}={}){if(_.isPlainObject(t)||_.isNull(t)||_.isUndefined(t))return t;let s=TiStr.toArray(t,{sep:e,ignoreNil:i});_.isString(n)&&(n=TiStr.toArray(n,{sep:/[:,;\s]+/g}));let r=[],a=[];_.forEach(n,t=>{let e=TiStr.toArray(t,{sep:"?"});if(e.length>1){let t=e[0];r.push(t),a.push({name:t,backup:e[1]})}else r.push(t)});let o={};_.forEach(r,(t,e)=>{let n=_.nth(s,e);_.isUndefined(n)&&i||(o[t]=n)});for(let t of a)_.isUndefined(o[t.name])&&(o[t.name]=o[t.backup]);return o},toObjList(t,{sepLine:e=/[,;\n]+/g,sepPair:i=/[:|\/\t]+/g,ignoreNil:n=!0,keys:s=["value","text?value","icon"]}={}){let r=TiStr.toArray(t,{sep:e,ignoreNil:n});return _.map(r,t=>TiStr.toObject(t,{sep:i,ignoreNil:n,keys:s}))},base64ToU8Bytes(t){let e=new Uint8Array;for(let i=0;i<t.length;i++){let n=t.charCodeAt(i);n>=65536&&n<=1114111?(e.push(n>>18&7|240),e.push(n>>12&63|128),e.push(n>>6&63|128),e.push(63&n|128)):n>=2048&&n<=65535?(e.push(n>>12&15|224),e.push(n>>6&63|128),e.push(63&n|128)):n>=128&&n<=2047?(e.push(n>>6&31|192),e.push(63&n|128)):e.push(255&n)}return e},autoPrefixSearchStr(t,e="lower",i=!1){let n=_.trim(t);if(n)return(n=TiStr.toCase(n,e)).startsWith("^")?n:i?"^"+n:"^.*"+n},sizeText(t=0,{fixed:e=2,M:i=1024,bytes:n=!1,units:s=["Bytes","KB","MB","GB","PB","TB"]}={}){let r=t,a=0;for(;a<s.length;a++){let t=r/i;if(t<1)break;r=t}let o,l=s[a];return o=r==parseInt(r)?r+l:r.toFixed(e)+l,n&&a>0?o+` (${t} bytes)`:o},toPercent(t,{fixed:e=2,auto:i=!0}={}){if(!_.isNumber(t))return"NaN";let n=100*t,s=e>=0?n.toFixed(e):n+"";if(i){let t=s.lastIndexOf("."),e=s.lastIndexOf("0");if(t>=0&&e>t){let i=s.length-1;for(;i>=t&&"0"==s[i];i--);i==e||i==t||i++,i<s.length&&(s=s.substring(0,i))}}return s+"%"},toCase(t,e){if(Ti.Util.isNil(t)||!e)return t;let i=TiStr.getCaseFunc(e);return _.isFunction(i)?i(t):t},getCaseFunc:t=>({upper:t=>t?t.toUpperCase():t,lower:t=>t?t.toLowerCase():t,camel:t=>_.camelCase(t),snake:t=>_.snakeCase(t),kebab:t=>_.kebabCase(t),start:t=>_.startCase(t)})[t],toComType:t=>_.upperFirst(_.camelCase(t)),isValidCase:t=>_.isFunction(TiStr.getCaseFunc(t)),isPhoneNumber:(t="")=>/^(\+\d{2})? *(\d{11})$/.test(t)};return{S:TiStr}}(),{Tmpl:Tmpl}=function(){function t(t){return(e=[])=>e.push(t)}function e(t,e,i,n){let s=[],r=Ti.S.splitIgnoreBlank(i,";");for(let e of r)if("@trim"==e)s.push(t=>_.trim(t));else if(/^:/.test(e)){let i=e.substring(1).trim(),n={},r=Ti.S.splitIgnoreBlank(i,",");for(let e of r){let i=/^([^=]+)=(.+)$/.exec(e);i?n[i[1]]=i[2]:console.warn("Tmpl StringEle Invalid Mapping:",t)}s.push(t=>n[t]||t)}return(i=[],r={},a=!1)=>{let o=_.get(r,e)||n;for(let t of s)o=t(o);Ti.Util.isNil(o)?a&&i.push(t):i.push(o)}}function i(t,e,i,n){return(i=[],s={},r=!1)=>{let a=_.get(s,e)||n;if(Ti.Util.isNil(a))r&&i.push(t);else{let t=parseInt(a);i.push(t)}}}function n(t,e,i="false/true",n){let s=i.split("/");return(i=[],r={},a=!1)=>{let o=_.get(r,e)||n;Ti.Util.isNil(o)?a&&i.push(t):i.push(o?s[1]:s[0])}}function r(t,e,i,n){return(i=[],s={},r=!1)=>{let a=_.get(s,e)||n;if(Ti.Util.isNil(a))r&&i.push(t);else{let t=1*a;i.push(t)}}}function a(t,e,i="yyyy-MM-dd'T'HH:mm:ss",n){return(s=[],r={},a=!1)=>{let o=_.get(r,e)||n;if(Ti.Util.isNil(o))a&&s.push(t);else{let t=Ti.DateTime.format(o,i);s.push(t)}}}function o(t,e,i="cn",n){let r=i.indexOf("c")>=0;i.indexOf("n");return(i=[],a={},o=!1)=>{let l=_.get(a,e)||n;if(Ti.Util.isNil(s))o&&i.push(t);else{let t;if("-obj-"==l)t="{}";else if("-array-"==l)t="[]";else{let e=r?null:"   ";t=JSON.stringify(l,flt,e)}i.push(t)}}}const l=/^([^<>()?]+)([<(](int|long|boolean|float|double|date|string|json)?(\s*:\s*([^>]*))?[>)])?([?]\s*(.*)\s*)?$/;class h{constructor({regex:t,groupIndex:e=2,escapeIndex:i=3,getEscapeStr:n=(()=>"$")}={}){this.list=[],this.keys=[],this.groupIndex=e,this.escapeIndex=i,this.getEscapeStr=n,t?_.isRegExp(t)?this._P=t:this._P=new RegExp(t,"g"):this._P=/([$][{]([^}]+)[}])|([$][$])/g}parse(s){let h,c=0,u=new RegExp(this._P,"g");for(;h=u.exec(s);){let d=h.index;if(d>c){let e=s.substring(c,d);this.list.push(t(e))}let p=this.escapeIndex>0?h[this.escapeIndex]:null;if(Ti.S.isBlank(p)){let t=h[0],s=h[this.groupIndex],c=l.exec(s);if(!c)throw`Fail to parse tmpl key '${s}'`;let u=c[1],d=c[3]||"string",p=c[5],m=c[7];this.keys.push(u),{string:()=>{this.list.push(e(t,u,p,m))},int:()=>{this.list.push(i(t,u,0,m))},long:()=>{this.list.push(i(t,u,0,m))},boolean:()=>{this.list.push(n(t,u,p,m))},float:()=>{this.list.push(r(t,u,0,m))},double:()=>{this.list.push(r(t,u,0,m))},date:()=>{this.list.push(a(t,u,p,m))},json:()=>{this.list.push(o(t,u,p,m))}}[d]()}else{let e=this.getEscapeStr(h);this.list.push(t(e))}c=u.lastIndex}if(!(c>=s.length)){let e=s.substring(c);this.list.push(t(e))}return this}render(t={},e=!1){let i=[];for(let n of this.list)n(i,t,e);return i.join("")}}const c={parse(t,e){let i=new h(t,e);return i.parse(t),i},parseAs(t,{startChar:e="$",leftBrace:i="{",rightBrace:n="}"}={}){if(null==t)return null;let s="(["+e+"]["+("["==i?"\\[":i)+"]([^"+("]"==n?"\\]":n)+"]+)["+n+"])|(["+e+"]["+e+"])";return c.parse(t,{regex:s,groupIndex:2,escapeIndex:3,getEscapeStr:()=>e})},exec(t,e={},{regex:i,groupIndex:n,escapeIndex:s,getEscapeStr:r,startChar:a,leftBrace:o,rightBrace:l,showKey:h}={}){if(!t)return t;return(a?c.parseAs(t,{startChar:a,leftBrace:o,rightBrace:l}):c.parse(t,{regex:i,groupIndex:n,escapeIndex:s,getEscapeStr:r})).render(e,h)},_test_100000_exec(){let t={name:"zozoh",age:45,great:!0,bir:new Date},e=Date.now(),i=[];for(var n=0;n<1e5;n++){let e=Ti.Tmpl.exec("${name}[${age}] is ${great<boolean:no/yes>} since ${bir<date:yy年M月d日 HH点mm分ss秒.SSS毫秒>}",t);i.push(e)}let s=Date.now()-e;console.log(`in ${s}ms`)},_test_100000_render(){let t={name:"zozoh",age:45,great:!0,bir:new Date},e=Ti.Tmpl.parse("${name}[${age}] is ${great<boolean:no/yes>} since ${bir<date:yy年M月d日 HH点mm分ss秒.SSS毫秒>}"),i=Date.now(),n=[];for(var s=0;s<1e5;s++){let i=e.render(t);n.push(i)}let r=Date.now()-i;console.log(`in ${r}ms`)},_test_100000_str_render(){let t={name:"zozoh",age:45,great:!0,bir:new Date},e=Date.now(),i=[];for(var n=0;n<1e5;n++){let e=Ti.S.renderVars(t,"${name}[${age}] is ${great} since ${bir}");i.push(e)}let s=Date.now()-e;console.log(`in ${s}ms`)}};return{Tmpl:c}}(),{App:App}=function(){const{LoadTiAppInfo:t,LoadTiLinkedObj:e}=function(){function t(t){return/^@https?:\/\//.test(t)?t.substring(1):/^@!(js|css|html|mjs|text|json):\/\//.test(t)?t.substring(1):/^@\/{1,2}/.test(t)?t.substring(1):/^(@[A-Za-z0-9_-]+:?|\.\/)/.test(t)?t:/^(!(m?js|json|css|text):)/.test(t)?t:void 0}function e(i,{LT:n,dynamicPrefix:s,dynamicAlias:r}={}){if(_.isString(i)){if(!/^\.{3}/.test(i)){let a=t(i);if(a){let t=Ti.Config.cookUrl(a,{dynamicPrefix:s,dynamicAlias:r});if(!t)return;let{url:i,type:o}=t;n.isAlreadyInLoading(i)||(n.addItem(i),Ti.Load(i,{dynamicPrefix:s,dynamicAlias:r,cooked:!0,type:o}).then(t=>{let r=Ti.Util.getParentPath(i);e(t,{LT:n,dynamicPrefix:s,dynamicAlias:new Ti.Config.AliasMapping({"^./":r})}),n.loadedItem(i,t),n.tryFinished()}))}}}else if(_.isArray(i))for(let t=0;t<i.length;t++){e(i[t],{LT:n,dynamicPrefix:s,dynamicAlias:r})}else if(_.isPlainObject(i))for(let t in i){e(i[t],{LT:n,dynamicPrefix:s,dynamicAlias:r})}}function i(e,n,s={},{dynamicPrefix:r,dynamicAlias:a}){if(_.isString(e)){if(!/^\.{3}/.test(e)){let o=t(e);if(o){let t=Ti.Config.cookUrl(o,{dynamicPrefix:r,dynamicAlias:a});if(!t)return e;let{url:l,type:h}=t;if(s[l])return;let c=n[l].result,u=Ti.Util.getParentPath(l);return i(c,n,s=_.assign({},s,{[l]:!0}),{dynamicPrefix:r,dynamicAlias:new Ti.Config.AliasMapping({"^./":u})})}}}else{if(_.isArray(e)){let t=[];for(let o=0;o<e.length;o++){let l=i(e[o],n,s,{dynamicPrefix:r,dynamicAlias:a});_.isUndefined(l)||t.push(l)}return t}if(_.isPlainObject(e)){let t={};for(let o in e){let l=i(e[o],n,s,{dynamicPrefix:r,dynamicAlias:a});t[o]=l}return t}}return e}function n(t,{dynamicPrefix:n,dynamicAlias:r}={}){return _.isEmpty(t)?{}:new Promise((a,o)=>{let l=new s(e=>{let s=i(t,e,{},{dynamicPrefix:n,dynamicAlias:r});a(s)});e(t,{dynamicPrefix:n,dynamicAlias:r,LT:l})})}class s{constructor(t){this.itMap={},this.afterLoaded=t}isAlreadyInLoading(t){return!!this.itMap[t]}addItem(t){this.itMap[t]={done:!1,result:void 0}}loadedItem(t,e){let i=this.itMap[t];i.result=e,i.done=!0}tryFinished(){for(let t in this.itMap){if(!this.itMap[t].done)return}this.afterLoaded(this.itMap)}}return{LoadTiLinkedObj:n,LoadTiAppInfo:async function(t={},e=document){let i=await n(t,{"^./":"@MyApp:"});return Ti.IsInfo("TiApp")&&console.log("await LoadTiLinkedObj(conf)",i),i}}}(),{TiAppActionShortcuts:i}=function(){class t{constructor(){this.guards={},this.actions={}}addGuard(t,e,i){e&&_.isFunction(i)&&Ti.Util.pushValue(this.guards,e,{scope:t,func:i})}removeGuard(t,...e){this.guards=this.__remove_by(this.guards,t,e)}isWatched(t,e){let i=this.actions[e];if(_.isArray(i))for(let e of i)if(e.scope===t)return!0;return!1}watch(t,e=[],{$com:i,argContext:n={}}={}){let s=_.without(_.concat(e),null);_.forEach(s,e=>{if(_.isArray(e.items)&&e.items.length>0)this.watch(t,e.items,{$com:i,argContext:n});else if(e.action&&e.shortcut){if(this.isWatched(t,e.shortcut))return;let s=Ti.Shortcut.genActionInvoking(e.action,{$com:i,argContext:n,wait:e.wait});Ti.Util.pushValueBefore(this.actions,e.shortcut,{scope:t,func:s,prevent:Ti.Util.fallback(e.prevent,!0),stop:Ti.Util.fallback(e.stop,!0)})}})}unwatch(t,...e){this.actions=this.__remove_by(this.actions,t,e)}__remove_by(t,e,...i){let n=_.flattenDeep(i);if(!e&&_.isEmpty(n))return{};_.isEmpty(n)&&(n=_.keys(t));let s=Ti.Util.isNil(e),r={};return _.forEach(n,i=>{let n=[];_.forEach(t[i],t=>{s||t.scope===e||n.push(t)}),_.isEmpty(n)||(r[i]=n)}),r}fire(t,e,i={stop:!1,prevent:!1,quit:!1}){if(i.quit)return i;let n=Ti.Util.isNil(t),s=this.guards[e];if(_.isArray(s))for(let e of s)if((n||e.scope===t)&&!e.func())return i.quit=!0,i;let r=this.actions[e];if(!_.isArray(r))return i;for(let e of r)if((n||e.scope===t)&&(i.quit|=e.func(),i.stop|=e.stop,i.prevent|=e.prevent,i.quit))return i;return i}}return{TiAppActionShortcuts:t}}(),{TiVue:n}=function(){function t(t,e){let i=!1,n={};return _.forOwn(e,(e,s,r)=>{let a=/^\.{3}(.*)$/.exec(s);if(a){i=!0;let s=a[1];t&&_.assign(n,function(t,e){const i={};return _.forOwn(e,(e,n)=>{let s="map"+_.capitalize(n);t?_.assign(i,Vuex[s](t,e)):_.assign(i,Vuex[s](e))}),i}(s,e))}}),i?n:e}const e={StoreConfig(t={},i=null){let n=Ti.Util.merge({modules:{}},t.mixins);return!t.state&&n.state||(n.state=Ti.Util.genObj(t.state)),n.getters=_.assign(n.getters,Ti.Util.merge({},t.getters)),n.mutations=_.assign(n.mutations,Ti.Util.merge({},t.mutations)),n.actions=_.assign(n.actions,Ti.Util.merge({},t.actions)),Ti.I18n.put(t.i18n),i&&(n.namespaced=!0),_.forEach(t.modules,(t,i)=>{let s;s=i.startsWith(".")?e.StoreConfig(t):e.StoreConfig(t,i),n.modules[i]=s}),n.plugins=[].concat(t.plugins||[]),n},CreateStore:t=>new Vuex.Store({strict:Ti.IsForDev(),...t}),Options({global:i={},conf:n={},store:s}={}){_.isPlainObject(n.i18n)&&Ti.I18n.put(n.i18n);const r=_.pick(n,["data","props","watch"]),a=_.pick(n,["template","render","renderError"]),o=_.pick(n,["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","activated","deactivated","beforeDestroy","destroyed","errorCaptured"]),l=_.pick(n,["directives","filters","components"]);_.forOwn(l,function(t,n,s){const r=_.without(_.flattenDeep([t]),void 0,null),a=[];for(let t of r)t.globally?("components"==n&&(t=e.Options({conf:t,global:i})),Ti.Util.pushValue(i,n,t)):a.push(t);s[n]=a});const h=_.pick(n,["mixins","extends"]),c=_.pick(n,["name","delimiters","functional","model","inheritAttrs","comments","inject","provide"]);let u={..._.mapValues(r,t=>Ti.Util.merge({},t)),...a,..._.mapValues(o,Ti.Util.groupCall),directives:Ti.Util.merge({},l.directives),filters:Ti.Util.merge({},l.filters),components:function(){let t={};return _.map(l.components,n=>{let s=_.camelCase(n.name);t[s]=e.Options({conf:n,global:i})}),t}(),...h,...c};_.isFunction(u.data)||(u.data=Ti.Util.genObj(u.data||{}));const d=_.partial(t,s);return _.isArray(n.computed)?u.computed=Ti.Util.mergeWith(d,{},...n.computed):_.isObject(n.computed)&&(u.computed=n.computed),_.isArray(n.methods)?u.methods=Ti.Util.mergeWith(d,{},...n.methods):_.isObject(n.methods)&&(u.methods=n.methods),s&&(u.store=s),u},Setup(t={},i){const n={};return{global:n,options:e.Options({global:n,conf:t,store:i})}},CreateInstance(t,e){const i=Ti.Util.merge({},t.global.filters),n=Ti.Util.merge({},t.global.directives);_.forOwn(i,(t,e)=>{Vue.filter(e,t)}),_.forOwn(n,(t,e)=>{Vue.directive(e,t)});const s=(t,i)=>{if(_.forEach(t.components,s),delete t.components,Ti.I18n.put(t.i18n),_.isFunction(e)&&e(t),!t.name)throw console.warn(`com[${i}] without name`,t),"!!!";this.registerComponent(t.name,t)};return _.forEach(t.global.components,s),_.isFunction(e)&&e(t.options),new Vue(t.options)},registerComponent(t,e){let i=_.upperFirst(_.camelCase(t));Vue.component(i,e)}};return{TiVue:e}}(),{TiAppModal:s}=function(){class t{constructor(){this.className=void 0,this.icon=void 0,this.title=void 0,this.type="info",this.iconOk=void 0,this.textOk="i18n:ok",this.ok=(({result:t})=>t),this.iconCancel=void 0,this.textCancel="i18n:cancel",this.cancel=(()=>void 0),this.actions=null,this.transDelay=350,this.comType="ti-label",this.comConf={},this.explainComConf=!0,this.components=[],this.closer="default",this.escape=!0,this.mask=!0,this.clickMaskToClose=!1,this.changeToClose=!1,this.position="center",this.width="6.4rem",this.height=void 0,this.maxWidth=void 0,this.maxHeight=void 0,this.minWidth=void 0,this.minHeight=void 0,this.mainStyle=void 0,this.spacing=void 0,this.overflow=void 0,this.adjustable=!1,this.result=void 0,this.model={prop:"value",event:"change"},this.modules={},this.modState={},this.events={},this.topActions=[],this.ready=async function(t){},this.preload=async function(t){},this.beforeClosed=async function(t){}}async open(t=_.identity){let e=[];this.actions?e=this.actions:(_.isFunction(this.ok)&&this.textOk&&e.push({icon:this.iconOk,text:this.textOk,handler:this.ok}),_.isFunction(this.cancel)&&this.textCancel&&e.push({icon:this.iconCancel,text:this.textCancel,handler:this.cancel}));let i="";if(this.model){let{event:t,prop:e}=this.model;if(t&&(i+=` @${t}="OnChange"`),e)if(_.isString(e))i+=` :${e}="result"`;else if(_.isArray(e))for(let t of e)i+=` :${t}="result.${t}"`;else _.isObject(e)&&_.forEach(e,(t,e)=>{i+=` :${e}="result.${t}"`})}let n=_.defaults({viewport:"@mod:ti/viewport"},this.modules),s=_.cloneDeep(this.events),r=[];_.forEach(s,(t,e)=>{r.push(`@${e}="OnEvent('${e}', $event)"`)});let a={name:"app.modal",template:`<transition :name="TransName" @after-leave="OnAfterLeave">\n          <div class="ti-app-modal ${this.className||""}"\n            v-if="!hidden"\n              :class="TopClass"\n              :style="TopStyle"\n              @click.left="OnClickTop"\n              v-ti-activable>\n    \n              <div class="modal-con" \n                :class="ConClass"\n                :style="ConStyle"\n                @click.left.stop>\n    \n                <div class="modal-head"\n                  v-if="isShowHead">\n                    <div class="as-icon" v-if="icon"><ti-icon :value="icon"/></div>\n                    <div class="as-title">{{title|i18n}}</div>\n                    <div\n                      v-if="hasTopActionBar"\n                        class="as-bar">\n                          <ti-actionbar\n                            :items="topActions"\n                            align="right"\n                            :status="TopActionBarStatus"/>\n                    </div>\n                </div>\n    \n                <div class="modal-main" :style="MainStyle">\n                  <component\n                    v-if="comType"\n                      class="ti-fill-parent"\n                      :class="MainClass"\n                      :is="comType"\n                      v-bind="TheComConf"\n                      :on-init="OnMainInit"\n                      ${i}\n                      ${r.join(" ")}\n                      @close="OnClose"\n                      @ok="OnOk"\n                      @actions:update="OnActionsUpdated"/>\n                </div>\n    \n                <div class="modal-actions"\n                  v-if="hasActions">\n                    <div class="as-action"\n                      v-for="a of actions"\n                        @click.left="OnClickActon(a)">\n                        <div class="as-icon" v-if="a.icon">\n                          <ti-icon :value="a.icon"/></div>\n                        <div class="as-text">{{a.text|i18n}}</div>\n                    </div>\n                </div>\n    \n                <div class="modal-closer"\n                  v-if="hasCloser"\n                    :class="CloserClass">\n                      <ti-icon value="zmdi-close" @click.native="OnClose"/>\n                </div>\n            </div>\n        </div></transition>`,components:this.components,data:{hidden:!0,icon:this.icon,title:this.title,type:this.type,ready:this.ready,beforeClosed:this.beforeClosed,actions:e,topActions:this.topActions,comType:null,comConf:this.comConf,explainComConf:this.explainComConf,closer:this.closer,escape:this.escape,mask:this.mask,position:this.position,clickMaskToClose:this.clickMaskToClose,changeToClose:this.changeToClose,width:this.width,height:this.height,maxWidth:this.maxWidth,maxHeight:this.maxHeight,minWidth:this.minWidth,minHeight:this.minHeight,mainStyle:this.mainStyle,spacing:this.spacing,overflow:this.overflow,adjustable:this.adjustable,result:_.cloneDeep(this.result)},store:{modules:n},computed:{TopClass(){let t=Ti.Util.isNil(this.height);return this.getTopClass({"show-mask":this.isShowMask,"no-mask":!this.isShowMask,"has-height":!t,"nil-height":t},`at-${this.position}`)},TopStyle(){if("center"!=this.position)return{padding:Ti.Css.toSize(this.spacing)}},MainStyle(){return Ti.Css.toStyle(this.mainStyle)},TransName(){return`app-modal-trans-at-${this.position}`},isShowHead(){return this.icon||this.title||this.hasTopActionBar},hasTopActionBar(){return!_.isEmpty(this.topActions)},isShowMask(){return!!this.mask},hasActions(){return!_.isEmpty(this.actions)},hasCloser(){return!!this.closer},isCloserDefault(){return!0===this.closer||"default"==this.closer},ConClass(){return Ti.Css.mergeClassName({"is-show-header":this.isShowHead,"is-hide-header":!this.isShowHead,"is-show-actions":this.hasActions,"is-hide-actions":!this.hasActions,"is-closer-default":this.isCloserDefault,"has-top-action-bar":this.hasTopActionBar},`is-${this.type}`)},ConStyle(){return Ti.Css.toStyle({width:this.width,height:this.height,maxWidth:this.maxWidth,maxHeight:this.maxHeight,minWidth:this.minWidth,minHeight:this.minHeight})},MainClass(){return Ti.Css.mergeClassName(`modal-type-is-${this.type}`)},Main(){return this.$store.state.main},State(){return this.$store.state},RootState(){return this.$store.state},RootGetter(){return this.$store.getters},TopActionBarStatus(){return _.get(this.Main,"status")},CloserClass(){return Ti.Css.mergeClassName({"as-lamp-cord":!this.isCloserDefault,"as-default":this.isCloserDefault,[`at-${this.closer}`]:!this.isCloserDefault})},TheComConf(){return this.explainComConf?Ti.Util.explainObj(this,this.comConf):this.comConf}},methods:{OnClickTop(){this.clickMaskToClose&&(this.hidden=!0)},OnClose(){this.close()},OnOk(t){_.isUndefined(t)&&(t=this.result),this.close(t)},OnChange(t){this.result=t,this.changeToClose&&this.close(this.result)},OnActionsUpdated(t=[]){this.topActions=t,Ti.App(this).reWatchShortcut(t)},OnEvent(t,e){_.get(s,t).apply(this,[e])},async OnClickActon(t){if(!t)return;let e,i=Ti.App(this),n={close:!0},s=i.$vm();_.isFunction(t.handler)&&(e=await t.handler({$app:i,$body:s,$main:s.$main,result:_.cloneDeep(s.result),status:n})),n.close?this.close(e):_.isUndefined(e)||this.setResult(e)},OnAfterLeave(){Ti.App(this).destroy(!0),t(this.returnValue)},OnMainInit(t){let e=Ti.App(this);this.$main=t,e.$vmMain(t),this.escape&&e.watchShortcut([{action:"root:close",shortcut:"ESCAPE"}]),this.setActived(),this.ready(e)},__ti_shortcut(t){if(this.$main&&_.isFunction(this.$main.__ti_shortcut))return this.$main.__ti_shortcut(t)},close(t){_.isUndefined(t)||(this.returnValue=t),this.hidden=!0},setResult(t){this.returnValue=t}},mounted:function(){let t=Ti.App(this);Ti.App.pushInstance(t),this.$nextTick(()=>{this.hidden=!1})},beforeDestroy:async function(){let t=Ti.App(this);_.isFunction(this.beforeClosed)&&await this.beforeClosed(t),Ti.App.pullInstance(t)}},o=Ti.App(a,t=>{_.forEach(this.modState,({state:e,merge:i}={},n)=>{let s=_.get(t,`store.modules.${n}`);s&&s.state&&(i?_.merge(s.state,e):_.assign(s.state,e))})});await o.init();let l=Ti.Dom.createElement({$p:document.body,className:"the-stub"});await this.preload(o),o.mountTo(l),_.delay(()=>{o.$vm().comType=this.comType},this.transDelay||0)}}return{TiAppModal:t}}(),r=Symbol("ti-app"),a=Symbol("ti-info"),o=Symbol("ti-conf"),l=Symbol("ti-store"),h=Symbol("ti-vm"),c=Symbol("ti-vm-main"),u=Symbol("ti-vm-actived");class d{constructor(t={},e){this.appDecorator=e,this.$info(t),this.$conf(null),this.$store(null),this.$vm(null),this.$shortcuts=new i}name(){return this.$info().name}$info(t){return Ti.Util.geset(this,a,t)}$conf(t){return Ti.Util.geset(this,o,t)}$store(t){return Ti.Util.geset(this,l,t)}$vm(t){return Ti.Util.geset(this,h,t)}$vmMain(t){return Ti.Util.geset(this,c,t)}$state(){return this.$store().state}async init(){let e=this.$info(),i=await t(e);if(await this.appDecorator(i),this.$conf(i),Ti.IsInfo("TiApp")&&console.log("Ti.$conf",this.$conf()),i.i18n){let t=_.concat(i.i18n);for(let e of t)Ti.I18n.put(e)}i.importMethods&&_.assign(window,i.importMethods);let s;if(i.store){let t=n.StoreConfig(i.store);Ti.IsInfo("TiApp")&&console.log("TiVue.StoreConfig:",t),s=n.CreateStore(t),this.$store(s),s[r]=this,Ti.IsInfo("TiApp")&&console.log("Ti.$store",this.$store())}let a=n.Setup(i,s);Ti.IsInfo("TiApp")&&(console.log("TiVue.VueSetup(conf)"),console.log(" -- global:",a.global),console.log(" -- options:",a.options));let o=n.CreateInstance(a,t=>{Ti.Config.decorate(t)});return o[r]=this,this.$vm(o),this}mountTo(t){this.$el=Ti.Dom.find(t),this.$vm().$mount(this.$el),this.$el=this.$vm().$el,this.$el[r]=this}destroy(t=!1){this.$vm().$destroy(),this.$el[r]=null,t&&Ti.Dom.remove(this.$el)}setActivedVm(t=null){this[u]=t;let e=t.tiActivableComIdPath();this.$store().commit("viewport/setActivedIds",e)}setBlurredVm(t=null){if(this[u]==t){let e=t.tiParentActivableCom();this[u]=e;let i=e?e.tiActivableComIdPath():[];this.$store().commit("viewport/setActivedIds",i)}}getActivedVm(){return this[u]}reWatchShortcut(t=[]){this.unwatchShortcut(),this.watchShortcut(t)}watchShortcut(t=[]){this.$shortcuts.watch(this,t,{$com:()=>this.$vmMain(),argContext:this.$state()})}unwatchShortcut(...t){this.$shortcuts.unwatch(this,...t)}guardShortcut(t,e,i){this.$shortcuts.addGuard(t,e,i)}pulloutShortcut(t,e,i){this.$shortcuts.removeGuard(t,e,i)}fireShortcut(t,e){let i={stop:!1,prevent:!1,quit:!1},n=this.getActivedVm();if(n||(n=this.$vm()),n){let e=n.tiActivableComPath(!1);for(let n of e)if(_.isFunction(n.__ti_shortcut)){let e=n.__ti_shortcut(t)||{};if(i.stop|=e.stop,i.prevent|=e.prevent,i.quit|=e.quit,i.quit)break}}return this.$shortcuts.fire(this,t,i),i.prevent&&e&&_.isFunction(e.preventDefault)&&e.preventDefault(),i.stop&&e&&_.isFunction(e.stopPropagation)&&e.stopPropagation(),i}async exec(t,e){let i=t;if(_.isString(i)){let t=/^(commit|dispatch|root|main):(.+)$/.exec(i);if(!t)return;i={method:t[1],name:t[2]}}return await this[i.method](i.name,e)}commit(t,e){this.$store().commit(t,e)}async dispatch(t,e){Ti.IsInfo("TiApp")&&console.log("TiApp.dispatch",t,e);try{return await this.$store().dispatch(t,e)}catch(t){console.error(t),await Ti.Toast.Open(t,"error")}}root(t,e){Ti.IsInfo("TiApp")&&console.log("TiApp.self",t,e);let i=this.$vm()[t];if(_.isFunction(i))return i(e);if(_.isUndefined(i))throw Ti.Err.make("e-ti-app-self",{nm:t,payload:e});return i}main(t,...e){Ti.IsInfo("TiApp")&&console.log("TiApp.main",t,e);let i=this.$vmMain()[t];if(_.isFunction(i))return i(...e);if(!_.isUndefined(i))return i;throw Ti.Err.make("e-ti-app-main",{nm:t,args:e})}global(t,...e){let i=_.get(window,t);if(_.isFunction(i))return i.apply(this,e);throw Ti.Err.make("e-ti-app-main",{nm:t,args:e})}get(t){return t?this.$vm()[t]:this.$vm()}async loadView(t,i){const s=(e,{modState:n,modSetup:s}={})=>{if(_.assign(e.state,n),s){let n=Ti.Util.genInvoking(s,{dft:null,partial:"right"});if(_.isFunction(n))return n({moConf:e,meta:i,view:t})}return e};let r,a;if(t.modType){let i=await Ti.Load(t.modType),a=await e(i,{dynamicAlias:new Ti.Config.AliasMapping({"^./":t.modType+"/"})});a.state||(a.state={}),a=await s(a,t)||a,r=n.StoreConfig(a,!0)}if(t.extModules){let i={};for(let r in t.extModules){let a=t.extModules[r]||{},{modType:o}=a;if(!o)continue;let l=await e(o,{dynamicAlias:new Ti.Config.AliasMapping({"^./":a.modType+"/"})});l=await s(l,a)||l;let h=n.StoreConfig(l,!0);i[r]=h}t.modules=i}let o={};t.comType&&(o=await Ti.Load(t.comType)),_.isEmpty(t.components)||Ti.Util.pushValue(o,"components",t.components);let l=await e(o,{dynamicAlias:new Ti.Config.AliasMapping({"^./":t.comType+"/"})}),h=n.Setup(l);return t.comType&&(a=h.options.name||Ti.Util.getLinkName(t.comType),Ti.IsInfo("TiApp")&&(console.log("TiApp.loadView:",a),console.log(" -- global:",h.global),console.log(" -- options:",h.options)),Ti.Config.decorate(h.options),n.registerComponent(a,h.options)),_.map(h.global.components,t=>{Ti.Config.decorate(t),n.registerComponent(t.name,t)}),{...t,comName:a,mod:r}}}const p=function(t,e=_.identity){if(Ti.Util.isNil(t))return null;if(_.isString(t))return Ti.Load(t).then(t=>new d(t,e));if(_.isElement(t)){let e=t,i=e[r];for(;!i&&e.parentElement;)i=(e=e.parentElement)[r];return i}return t instanceof Vue?t.$root[r]:t instanceof Vuex.Store?t[r]:_.isPlainObject(t)?new d(t,e):void 0},m=[];return p.pushInstance=function(t){t&&m.push(t)},p.pullInstance=function(t){t&&_.pull(m,t)},p.topInstance=function(){return _.last(m)},p.hasTopInstance=function(){return m.length>0},p.eachInstance=function(t=_.identity){_.forEach(m,t)},p.allInstance=function(t=_.identity){return m},p.Open=function(t){return new Promise(e=>{let i=new s;_.assign(i,t),i.open(e)})},{App:p}}(),{Err:Err}={Err:{make(t="",e,i){let n=t;_.isString(t)&&(n={code:t,data:e});let s=n.code.replace(/[.]/g,"-");i||(i=Ti.I18n.get(s)),Ti.Util.isNil(e)||(_.isPlainObject(e)||_.isArray(e)?i+=" : "+JSON.stringify(e):i+=" : "+e);let r=new Error(i.trim());return _.assign(r,n,{errMsg:i})}}},{Config:Config}=function(){const t={prefix:{},alias:{},suffix:{},comProps:{}};class e{constructor(t){this.list=[],this.reset(t)}reset(t={}){return this.list=[],_.forOwn(t,(t,e)=>{this.list.push({regex:new RegExp(e),newstr:t})}),this}get(t="",e){let i=t;for(let t of this.list)t.regex.test(i)&&(i=i.replace(t.regex,t.newstr));return i||(_.isUndefined(e)?t:e)}}const i=(new e).reset();class n{constructor(t){this.list=[],this.reset(t)}reset(t={}){return _.forOwn(t,(t,e)=>{this.list.push({regex:new RegExp(e),suffix:t})}),this}get(t="",e){let i=t;for(let t of this.list)if(t.regex.test(i)&&!i.endsWith(t.suffix)){i+=t.suffix;break}return i||(_.isUndefined(e)?t:e)}}const s=(new n).reset(),r={AliasMapping:e,version:()=>t.version,set({prefix:e,alias:n,suffix:r,lang:a,comProps:o}={}){e&&(t.prefix=e),n&&(t.alias=n,i.reset(t.alias)),r&&(t.suffix=r,s.reset(t.suffix)),a&&(t.lang=a),_.assign(t.comProps,o)},assignComProp(e,i={}){let n=t[e]||{};_.assign(n,i),t[e]=n},update({prefix:e,alias:n,suffix:r,lang:a,comProps:o}={}){e&&_.assign(t.prefix,e),n&&(_.assign(t.alias,n),i.reset(t.alias)),r&&(_.assign(t.suffix,r),s.reset(t.suffix)),a&&(t.lang=a),_.assign(t.comProps,o)},get:(e=null)=>e?_.get(t,e):t,getComProp(e,i,n){let s=_.get(t.comProps,`${e}.${i}`);return Ti.Util.fallback(s,n)},decorate(t){let e=t.name||"Unkown";Ti.Util.pushValue(t,"mixins",{computed:{tiComType:()=>_.upperFirst(_.camelCase(e))}})},lang:()=>r.get("lang")||"zh-cn",cookUrl(t,{dynamicPrefix:e={},dynamicAlias:i}={}){let n,s=t,a=/^(!(m?js|json|css|text|asyncjs):)?(.+)$/.exec(t);a&&(n=a[2],s=a[3]);let o=r.url(s,{dynamicPrefix:e,dynamicAlias:i});if(o)return n||(n=(a=/\.(m?js|css|json)$/.exec(o))?a[1]:"text"),{type:n,url:o}},url(n="",{dynamicPrefix:r={},dynamicAlias:a}={}){if(/^(((https?|vscode-webview):)?\/\/)/.test(n))return n;let o=n;if(a){o=(a instanceof e?a:(new e).reset(a)).get(n,null)}o=i.get(o||n),/^.+\.(css|js|mjs|json|txt|text|html|xml)$/.test(o)||(o=s.get(o));let l=/^(@([^:]+):?)(.*)/.exec(o);if(!l)return o;let[h,c]=l.slice(2),u=r[h]||t.prefix[h];if(Ti.Util.isNil(u))return;return u+c}};return{Config:r}}(),{Dom:Dom}=function(){const t={createElement({tagName:e="div",attrs:i={},props:n={},data:s={},className:r="",style:a={},$p:o=null,$refer:l=null},h=document){const c=h.createElement(e);return r&&(c.className=Ti.Css.joinClassNames(r)),Ti.Dom.setStyle(c,a),t.setAttrs(c,i),t.setData(c,s),_.forEach(n,(t,e)=>{c[e]=t}),l&&!o&&(o=l.parentElement),o&&o.insertBefore(c,l),c},appendToHead(t,e=document.head){_.isElement(t)&&_.isElement(e)&&e.appendChild(t)},appendToBody(t,e=document.body){_.isElement(t)&&_.isElement(e)&&e.appendChild(t)},appendTo(t,e){_.isElement(t)&&_.isElement(e)&&e.appendChild(t)},prependTo(t,e){e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t)},wrap(t,e){t.insertAdjacentElement("afterend",e),e.appendChild(t)},unwrap(t){let e=t.parentNode,i=[];for(let e=0;e<t.childNodes.length;e++){let n=t.childNodes[e];i.push(n)}for(let n of i)e.insertBefore(n,t);Ti.Dom.remove(t)},replace:(e,i,n=!1)=>(e.insertAdjacentElement("afterend",i),n&&(i.innerHTML=e.innerHTML),t.remove(e),i),attrFilter(e){if(_.isString(e)){if(e.startsWith("^")&&e.endsWith("$")){let t=new RegExp(e);return e=>t.test(e)}return t=>e===t}if(_.isFunction(e))return e;if(_.isBoolean(e))return()=>e;if(_.isRegExp(e))return t=>e.test(t);if(_.isArray(e)){let i=[];for(let n of e)i.push(t.attrFilter(n));return t=>{for(let e of i)if(e(t))return!0;return!1}}throw"Unsupport attrFilter: "+e},attr:(t,e,i)=>e&&_.isElement(t)?t.getAttribute(e):i,attrs(t,e=!0){e=this.attrFilter(e);let i={};for(let n=0;n<t.attributes.length;n++){let{name:s,value:r}=t.attributes[n],a=e(s,r),o=r;_.isBoolean(a)?a=s:_.isPlainObject(a)&&(o=a.value,a=a.name),a&&("true"==o?o=!0:"false"==o&&(o=!1),i[a]=o)}return i},getClassList(t,{filter:e=(()=>!0),dftList:i=[]}={}){if(!t)return i;if(_.isArray(t))return 0==t.length?i:_.uniq(t);_.isElement(t)&&(t=t.className);let n=_.without(t.split(/\s+/),""),s=[];for(let t of n)e(t)&&s.push(t);return s=_.uniq(s),_.isEmpty(s)?i:s},getStyle(t,e=!0){e=this.attrFilter(e);let i={};for(var n=0;n<t.style.length;n++){let s=t.style[n],r=e(s,t.style[s]);if(r){_.isBoolean(r)&&(r=_.camelCase(s));let e=t.style[r];i[r]=e}}return i},getOwnStyle(t,e=!0){if(_.isElement(t))return Ti.Css.parseCssRule(t.getAttribute("style"),e)},parseCssRule:(t="",e=!0)=>(console.warn("!Deprecate call: Ti.Dom.parseCssRule -> Ti.Css.parseCssRule"),Ti.Css.parseCssRule(t,e)),renderCssRule:(t={})=>(console.warn("!Deprecate call: Ti.Dom.renderCssRule -> Ti.Css.renderCssRule"),Ti.Css.renderCssRule(t)),removeAttrs(t,e=!1){e=this.attrFilter(e);let i={};for(let n=0;n<t.attributes.length;n++){let{name:s,value:r}=t.attributes[n],a=e(s,r);a&&(_.isBoolean(a)&&(a=s),i[a]=r,t.removeAttribute(s))}return i},getData(t,e=!0){e=this.attrFilter(e);let i={};for(let n=0;n<t.attributes.length;n++){let{name:s,value:r}=t.attributes[n];if(s.startsWith("data-")){let t=e(s=_.camelCase(s.substring(5)),r);t&&(_.isBoolean(t)?i[s]=r:t.name?i[t.name]=t.value:i[t]=r)}}return i},setData(t,e={}){_.forEach(e,(e,i)=>{Ti.Util.isNil(e)?t.removeAttribute(`data-${_.kebabCase(i)}`):t.setAttribute(`data-${_.kebabCase(i)}`,e)})},copyAttributes(t,e,i=(()=>!0)){let n=t.attributes;for(let t=0;t<n.length;t++){let{name:s,value:r}=n[t];i(s,r)&&e.setAttribute(s,r)}},renameElement(t,e,i=(()=>!0)){if(!_.isString(e))return t;if(e=e.toUpperCase(),t.tagName==e)return t;let n=t.ownerDocument.createElement(e);return Ti.Dom.copyAttributes(t,n,i),Ti.Dom.replace(t,n,!0)},getHeadingLevel(t){if(!_.isElement(t))return 0;let e=/^H([1-6])$/.exec(t.tagName);return e?parseInt(e[1]):0},getMyHeadingLevel(t){let e=Ti.Dom.seek(t,t=>/^H([1-6])$/.exec(t.tagName),t=>t.previousElementSibling?t.previousElementSibling:t.parentElement?t.parentElement:void 0);return Ti.Dom.getHeadingLevel(e)},remove(e,i){if(_.isString(e)){let n=t.findAll(e,i);for(let e of n)t.remove(e)}else _.isElement(e.parentNode)&&e.parentNode.removeChild(e)},findAll(t="*",e=document){if(!e)return[];return[...e.querySelectorAll(t)]},find:(t,e=document)=>e?_.isUndefined(t)?e:_.isNull(t)?null:_.isElement(t)?t:e.querySelector(t):null,elementFilter(e){if(_.isString(e)){if(e.startsWith("^")&&e.endsWith("$")){let t=new RegExp(e);return e=>t.test(e.tagName)}return i=>t.is(i,e)}if(_.isFunction(e))return e;if(_.isElement(e))return t=>e===t;if(_.isBoolean(e))return()=>e;if(_.isRegExp(e))return t=>e.test(t.tagName);if(_.isArray(e)){let i=[];for(let n of e)i.push(t.elementFilter(n));return t=>{for(let e of i)if(e(t))return!0;return!1}}throw"Unsupport elementFilter: "+e},seekUntil(e,i,{by:n,iteratee:s=(t=>t),includeSelf:r=!1,includeStop:a=!0,reverse:o=!1}={}){if(!i||!_.isFunction(n))return[e];Ti.Util.isNil(i)&&(i=e.ownerDocument.documentElement),i=t.elementFilter(i);let l=[],h=e;for(r&&l.push(h),h=n(h);h;){if(i(h)){a&&l.push(h);break}let t=s(h);t&&(_.isBoolean(t)?l.push(h):l.push(t)),h=n(h)}return o?l.reverse():l},seek(e,i,n){if(!_.isElement(e))return;if(!_.isFunction(n))return e;i=t.elementFilter(i);let s=e;for(;s;){if(i(s))return s;s=n(s)}return null},seekByTagName(e,i,n){if(!i||!_.isFunction(n))return!1;let s=Ti.AutoMatch.parse(i);return t.seek(e,({tagName:t})=>s(t),n)},prev:(e,i)=>t.seek(e,i,t=>t.previousElementSibling),prevByTagName:(e,i)=>t.seekByTagName(e,i,t=>t.previousElementSibling),prevUtil:(e,i,n={})=>t.seekUtil(e,i,{...n,by:t=>t.previousElementSibling}),next:(e,i)=>t.seek(e,i,t=>t.nextElementSibling),nextByTagName:(e,i)=>t.seekByTagName(e,i,t=>t.nextElementSibling),nextUtil:(e,i,n={})=>t.seekUtil(e,i,{...n,by:t=>t.nextElementSibling}),closest(e,i,{includeSelf:n=!1}={}){if(!_.isElement(e))return;let s=n?e:e.parentElement;return t.seek(s,i,t=>t.parentElement)},closestByTagName(e,i,{includeSelf:n=!1}={}){if(!_.isElement(e))return;let s=n?e:e.parentElement;return t.seekByTagName(s,i,t=>t.parentElement)},parentsUntil(e,i,n={}){if(_.isElement(e))return t.seekUntil(e,i,{...n,by:t=>t.parentElement})},eventCurrentTarget(e,i,n){let s=e.srcElement;if(!i)return s;if(_.isFunction(i))return i(s,n,e);for(;s;){if(s===n)return;if(t.is(s,i))return s;s=s.parentElement}},ownerWindow:t=>t.defaultView?t.defaultView:t.ownerDocument?t.ownerDocument.defaultView:t,isTouchDevice(){let t=window.navigator.userAgent||"";return!!/^.+(\((ipad|iphone);|linux;\s*android).+$/i.test(t)||!!(/macintosh/i.test(t)&&window.navigator.maxTouchPoints>1)},autoRootFontSize({$win:t=window,phoneMaxWidth:e=540,tabletMaxWidth:i=768,designWidth:n=1e3,max:s=100,min:r=80,callback:a}={}){const o=t.document,l=o.documentElement,h=Ti.Rects.createBy(t);let c=h.width/n*s,u=Math.min(Math.max(c,r),s);if(_.isFunction(a)){a({$win:t,$doc:o,$root:l,mode:h.width>i?"desktop":h.width>e?"tablet":"phone",fontSize:u,width:h.width,height:h.height})}},watchDocument(t,e){document.addEventListener(t,e)},unwatchDocument(t,e){document.removeEventListener(t,e)},watchAutoRootFontSize(e={},i,n=window){_.isFunction(e)&&(n=i||window,i=e,e=void 0);let s=_.assign({},e,{$win:n,callback:i});n.addEventListener("resize",()=>{t.autoRootFontSize(s)}),_.delay(()=>{t.autoRootFontSize(s)},1)},formatStyle(t={},e){let i={},n=Ti.S.getCaseFunc(e),s=_.keys(t);for(let e of s){let s=t[e];n&&(e=n(e)),/^(opacity|z-index|zIndex|order)$/.test(e)?i[e]=1*s:_.isNumber(s)||/^\d+(\.\d+)?$/.test(s)?i[e]=`${s}px`:i[e]=s}return i},setStyleValue(t,e,i,n){(_.isUndefined(n)||n!=i)&&(i&&"none"!=i?_.isNumber(i)||/^\d+(\.\d+)?$/.test(i)?t.style[e]=`${i}px`:t.style[e]=i:t.style[e]="")},setStyle(t,e={}){if(!t)return;if(_.isEmpty(e))return void(t.style="");let i=Ti.Css.renderCssRule(e);t.style=i},updateStyle(t,e={}){t&&(_.isEmpty(e)?t.style="":_.forOwn(e,(e,i)=>{if(_.isNull(e)||_.isUndefined(e))return;let n=_.kebabCase(i);if(""===e)t.style.removeProperty(n);else{let i=_.isNumber(e)?e+"px":e;t.style.setProperty(n,i)}}))},setAttrs(t,e={},i){t&&_.isElement(t)&&_.forEach(e,(e,n)=>{let s=i?i+n:n,r=_.kebabCase(s);if("style"==r)if(Ti.Util.isNil(e))t.removeAttribute("style");else{let i=Ti.Css.renderCssRule(e);t.style=i}else{if(_.isUndefined(e))return;if(_.isNull(e))t.removeAttribute(r);else{let i=e;(_.isArray(e)||_.isPlainObject(e))&&(i=JSON.stringify(e)),t.setAttribute(r,i)}}})},setClass(t,...e){let i=_.flattenDeep(e).join(" ");t.className=i},addClass(t,...e){let i=_.flattenDeep(e),n={};_.forEach(t.classList,t=>{n[t]=!0});for(let e of i){let i=_.trim(e);n[i]||t.classList.add(i)}},is(t,e){if(t.matches)return t.matches(e);throw"Slot Element matched"},isBody:t=>t.ownerDocument.body===t,isEmpty(e){if(!_.isElement(e))return!0;if(/^(IMG|VIDEO|AUDIO)$/.test(e.tagName))return!1;if(!Ti.Util.isBlank(e.textContent))return!1;let i=e.children;if(i.length>0)for(let e of i)if(!t.isEmpty(e))return!1;return!0},removeClass(t,...e){let i=_.flattenDeep(e);for(let e of i){let i=_.trim(e);t.classList.remove(i)}},hasClass(t,...e){if(!_.isElement(t))return!1;for(let i of e)if(!t.classList.contains(i))return!1;return!0},hasOneClass(t,...e){if(!_.isElement(t))return!1;for(let i of e)if(t.classList.contains(i))return!0;return!1},applyRect(e,i,n="tlwh",s={}){let r=e.ownerDocument.defaultView;_.defaults(s,{width:r.innerWidth,height:r.innerHeight});let a=i.toCss(s,n);t.updateStyle(e,a)},dockTo(e,i,{mode:n="H",axis:s={},posListX:r,posListY:a,space:o,coord:l="win",viewportBorder:h=4,position:c}={}){if(!_.isElement(e)||!_.isElement(i))return;c&&(e.style.position=c);let u={src:Ti.Rects.createBy(e),ta:Ti.Rects.createBy(i),win:Ti.Rects.createBy(e.ownerDocument.defaultView)};const d=(t,e,i)=>t<=e?i[0]:t>e&&t<=2*e?i[1]:i[2];if(_.defaults(s,{x:"auto",y:"auto"}),"auto"==s.x){let t=r||{H:["left","right"],V:["right","left"]}[n];s.x=d(u.ta.x,u.win.width/t.length,t)}if("auto"==s.y){let t=a||{H:["bottom","top"],V:["top","center","bottom"]}[n];s.y=d(u.ta.y,u.win.height/t.length,t)}let p=u.win.clone();"H"==n&&"win"==l&&("bottom"==s.y?p.top=u.ta.bottom:"top"==s.y&&(p.bottom=u.ta.top),p.updateBy("tlbr"));let m=u.src.dockTo(u.ta,n,{axis:s,space:o,viewport:p,viewportBorder:h,wrapCut:!0});if("target"==l)u.src.translate({x:-1*u.ta.left,y:-1*u.ta.top});else{"absolute"==window.getComputedStyle(e).position&&window.pageYOffset>0&&(u.src.top+=window.pageYOffset,u.src.update())}return _.delay(()=>{t.applyRect(e,u.src,m)},0),{axis:s,dockMode:m,srcRect:u.src,targetRect:u.ta,viewport:p}},getRemBase(t=document){_.isElement(t)&&t.ownerDocument&&(t=t.ownerDocument);let e=t.documentElement.style.fontSize||"100px";return Ti.Css.toAbsPixel(e)},pendingMoreWhenScrolling({$view:t,$more:e}={}){if(!_.isElement(t)||!_.isElement(e))return;let i=Ti.Rects.createBy(t).bottom,n=Ti.Rects.createBy(e),s=n.top,r=n.bottom,a=Math.min(i,r);return Math.max(a-s,0)/n.height},getFromClipBoard(t,e){let i=t&&t.items;if(_.isFunction(e)&&!_.isEmpty(i))for(let t=0;t<i.length;t++){let n=e(i[t],t);if(n)return n}},getImageDataFromClipBoard:e=>t.getFromClipBoard(e,(t,e)=>{if(t&&/^image\//.test(t.type))return t.getAsFile()}),async loadImageRawData(e,{asBase64:i=!0,dataUrlPrefix:n}={},s=document){const r=function(s){let r=t.createElement({tagName:"canvas"});r.width=s.width,r.height=s.height;var a=r.getContext("2d");a.drawImage(s,0,0,s.width,s.height);try{if(i){if(!n){let t=Ti.Util.getSuffixName(e,!0);n=`image/${{jpg:"jpeg"}[t]||t}`}return{width:s.width,height:s.height,data:r.toDataURL(n)}}return a.getImageData(0,0,s.width,s.height)}finally{t.remove(r)}};let a=t.find(`img[src="${e}"]`,s);return a?r(a):(a=t.createElement({tagName:"img",$p:s.body}),new Promise(t=>{a.addEventListener("load",function(e){let i=r(e.srcElement);t(i)}),a.src=e}))},scrollBarSize:function(){if(!window.SCROLL_BAR_SIZE){var t=0;$("body").append("<div id='div_out' style='position:relative;width:100px;height:100px;overflow-y:scroll;overflow-x:scroll'></div>"),$("#div_out").append("<div id='div_in' style='position:absolute;width:100%;height:100%;'></div>");var e=$("#div_out"),i=$("#div_in");t=e.width()-i.width(),$("#div_out").remove(),$("#div_in").remove(),window.SCROLL_BAR_SIZE=t}return window.SCROLL_BAR_SIZE},scrollIntoView(t,e,{to:i="auto",axis:n="xy"}={}){if(!_.isElement(t)||!_.isElement(e))return;let s=Ti.Rects.createBy(t),r=Ti.Rects.createBy(e),a={xy:"contains",x:"containsX",y:"containsY"}[n],o=i;if("auto"==i&&(o=r.bottom>s.bottom?"bottom":"top"),!s[a](r)){let e={center:()=>r.y-s.bottom+s.height/2,top:()=>r.top-s.top,bottom:()=>{t.scrollTop+=r.bottom-s.bottom+s.height/2}}[o];if(!_.isFunction(e))throw`Invalid scrollTo : '${o}'`;let i=e();t.scrollTop+=i}}};return{Dom:t}}(),{Rect:Rect,Rects:Rects}=function(){function t(t,e,n){let s={},r=i.explainToArray(e,!1);for(let e of r){let i=Ti.Util.fallback(t[e],n);_.isUndefined(i)||(s[e]=i)}return s}class e{constructor(){_.assign(this,{t:"top",l:"left",w:"width",h:"height",r:"right",b:"bottom",x:"x",y:"y"})}explainToArray(t,e=!0){let i=[],n=function(t,e=!0){if(!t)return[];if(_.isArray(t))return t;let i=t.toLowerCase().split("");return e?i.sort():i}(t,e);for(let t of n){let e=this[t];e&&i.push(e)}return i}getKey(t){return this[t]}}const i=new e;class n{constructor(t,e){this.__ti_rect__=!0,this.set(t,e)}set(t={top:0,left:0,width:0,height:0},e){const i=["bottom","height","left","right","top","width","x","y"];if(_.isUndefined(e)){let n=[];for(let e of i){let i=t[e];if(_.isNumber(i)){this[e]=i;let t=e.substring(0,1);n.push(t)}}e=n.join("")}else for(let e of i){let i=t[e];_.isNumber(i)&&(this[e]=i)}return"bhlrtwxy"==e?this:this.updateBy(e)}toString(e="tlwh"){let i=t(this,e,"NaN"),n=[];return _.forEach(i,(t,e)=>{let i=e[0].toUpperCase();n.push(`${i}=${Math.round(t)}`)}),n.join(",")}valueOf(){return this.toString()}update(t){return this.updateBy(t)}updateBy(t="tlwh"){return{"height/left/top/width":()=>{this.right=this.left+this.width,this.bottom=this.top+this.height,this.x=this.left+this.width/2,this.y=this.top+this.height/2},"height/right/top/width":()=>{this.left=this.right-this.width,this.bottom=this.top+this.height,this.x=this.left+this.width/2,this.y=this.top+this.height/2},"bottom/height/left/width":()=>{this.top=this.bottom-this.height,this.right=this.left+this.width,this.x=this.left+this.width/2,this.y=this.top+this.height/2},"bottom/height/right/width":()=>{this.top=this.bottom-this.height,this.left=this.right-this.width,this.x=this.left+this.width/2,this.y=this.top+this.height/2},"bottom/left/right/top":()=>{this.width=this.right-this.left,this.height=this.bottom-this.top,this.x=this.left+this.width/2,this.y=this.top+this.height/2},"height/width/x/y":()=>{let t=this.width/2,e=this.height/2;this.top=this.y-e,this.bottom=this.y+e,this.left=this.x-t,this.right=this.x+t},"height/left/width/y":()=>{let t=this.width/2,e=this.height/2;this.top=this.y-e,this.bottom=this.y+e,this.x=this.left+t,this.right=this.left+this.width},"height/right/width/y":()=>{let t=this.width/2,e=this.height/2;this.top=this.y-e,this.bottom=this.y+e,this.x=this.right-t,this.left=this.right-this.width},"height/top/width/x":()=>{let t=this.width/2,e=this.height/2;this.y=this.top+e,this.bottom=this.top+this.height,this.left=this.x-t,this.right=this.x+t},"bottom/height/width/x":()=>{let t=this.width/2,e=this.height/2;this.y=this.bottom-e,this.top=this.bottom-this.height,this.left=this.x-t,this.right=this.x+t}}[i.explainToArray(t).join("/")](),this}raw(e="tlwh",i){return t(this,e,i)}toCss(e={width:window.innerWidth,height:window.innerHeight},i="tlwh",n){var s={top:this.top,left:this.left,width:this.width,height:this.height,right:e.width-this.right,bottom:e.height-this.bottom};return Ti.IsDebug()&&console.log("CSS:",s),t(s,i,n)}relative(t,e={x:0,y:0}){return this.top=this.top-(t.top-e.y),this.left=this.left-(t.left-e.x),this.updateBy("tlwh")}zoom({x:t=1,y:e=t,centre:i=this}={}){return this.top=(this.top-i.y)*e+i.y,this.left=(this.left-i.x)*t+i.x,this.width=this.width*t,this.height=this.height*e,this.updateBy("tlwh")}zoomTo({width:t,height:e,mode:i="contain",round:s=!1}={}){if("contain"==i){if(new n({top:0,left:0,width:t,height:e}).contains(this))return this}let r,a,o=t,l=e,h=this.width/this.height,c=o/l;return h>c?"cover"==i?(a=l,r=l*h):(r=o,a=o/h):h<c?"cover"==i?(r=o,a=o/h):(a=l,r=l*h):(r=o,a=l),this.width=s?Math.round(r):r,this.height=s?Math.round(a):a,this.updateBy("tlwh")}centreTo({width:t,height:e,top:i=0,left:n=0}={},{xAxis:s=!0,yAxis:r=!0}={}){if(s&&t>0){let e=t-this.width;this.left=n+e/2}if(r&&e>0){let t=e-this.height;this.top=i+t/2}return this.updateBy("tlwh")}translate({x:t=0,y:e=0}={}){return this.y+=e,this.x+=t,this.updateBy("xywh")}moveTo(t={},e={},n="tl"){_.defaults(t,{x:0,y:0}),_.defaults(e,{x:0,y:0});return{"left/top":()=>{this.left=t.x-e.x,this.top=t.y-e.y,this.updateBy("tlwh")},"right/top":()=>{this.right=t.x+e.x,this.top=t.y-e.y,this.updateBy("trwh")},"bottom/left":()=>{this.left=t.x-e.x,this.bottom=t.y+e.y,this.updateBy("blwh")},"bottom/right":()=>{this.right=t.x+e.x,this.bottom=t.y+e.y,this.updateBy("brwh")}}[i.explainToArray(n).join("/")](),this}dockTo(t,e="H",{axis:i={},space:n={},viewport:r={},viewportBorder:a=4,wrapCut:o=!1}={}){_.isNumber(n)&&(n={x:n,y:n}),_.defaults(i,{x:"center",y:"bottom"}),_.defaults(n,{x:0,y:0});({"V:left/top":()=>{this.right=t.left-n.x,this.top=t.top+n.y,this.updateBy("rtwh")},"V:left/center":()=>{this.right=t.left-n.x,this.y=t.y+n.y,this.updateBy("rywh")},"V:left/bottom":()=>{this.right=t.left-n.x,this.bottom=t.bottom-n.y,this.updateBy("rbwh")},"V:right/top":()=>{this.left=t.right+n.x,this.top=t.top+n.y,this.updateBy("ltwh")},"V:right/center":()=>{this.left=t.right+n.x,this.y=t.y+n.y,this.updateBy("lywh")},"V:right/bottom":()=>{this.left=t.right+n.x,this.bottom=t.bottom-n.y,this.updateBy("lbwh")},"H:left/top":()=>{this.left=t.left+n.x,this.bottom=t.top-n.y,this.updateBy("lbwh")},"H:left/bottom":()=>{this.left=t.left+n.x,this.top=t.bottom+n.y,this.updateBy("ltwh")},"H:center/top":()=>{this.x=t.x+n.x,this.bottom=t.top-n.y,this.updateBy("xbwh")},"H:center/bottom":()=>{this.x=t.x+n.x,this.top=t.bottom+n.y,this.updateBy("xtwh")},"H:right/top":()=>{this.right=t.right-n.x,this.bottom=t.top-n.y,this.updateBy("rbwh")},"H:right/bottom":()=>{this.right=t.right-n.x,this.top=t.bottom+n.y,this.updateBy("rtwh")}})[e+":"+i.x+"/"+i.y]();let l="tl";if(o&&s.isRect(r)){let t=r.clone(a);t.wrap(this),t.contains(this)||(this.overlap(t),l="tlwh")}return l}dockIn(t,e={},i={}){_.defaults(e,{x:"center",y:"center"}),_.defaults(i,{x:0,y:0});return{"left/top":()=>{this.left=t.left+i.x,this.top=t.top+i.y,this.updateBy("ltwh")},"left/center":()=>{this.left=t.left+i.x,this.y=t.y+i.y,this.updateBy("lywh")},"left/bottom":()=>{this.left=t.left+i.x,this.bottom=t.bottom-i.y,this.updateBy("lbwh")},"right/top":()=>{this.right=t.right-i.x,this.top=t.top+i.y,this.updateBy("rtwh")},"right/center":()=>{this.right=t.right-i.x,this.y=t.y+i.y,this.updateBy("rywh")},"right/bottom":()=>{this.right=t.right-i.x,this.bottom=t.bottom-i.y,this.updateBy("brwh")},"center/center":()=>{this.x=t.x+i.x,this.x=t.y+i.y,this.updateBy("xywh")}}[e.x+"/"+e.y](),this}wrap(t){let e=["w","h"];return this.containsX(t)||(t.left>this.left&&t.right>this.right?(t.right=this.right,e.push("r")):(t.left=this.left,e.push("l"))),this.containsY(t)?3==e.length&&e.push("t"):t.top>this.top&&t.bottom>this.bottom?(t.bottom=this.bottom,e.push("b")):(t.top=this.top,e.push("t")),3==e.length&&e.push("l"),4==e.length?t.updateBy(e.join("")):t}wrapCut(t){return this.wrap(t),this.contains(t)||t.overlap(this),t}union(...t){for(let e of t)this.top=Math.min(this.top,e.top),this.left=Math.min(this.left,e.left),this.right=Math.max(this.right,e.right),this.bottom=Math.max(this.bottom,e.bottom);return this.updateBy("tlbr")}overlap(...t){for(let e of t)this.top=Math.max(this.top,e.top),this.left=Math.max(this.left,e.left),this.right=Math.min(this.right,e.right),this.bottom=Math.min(this.bottom,e.bottom);return this.updateBy("tlbr")}contains(t,e=0){return this.containsX(t,e)&&this.containsY(t,e)}containsX(t,e=0){return this.left+e<=t.left&&this.right-e>=t.right}containsY(t,e=0){return this.top+e<=t.top&&this.bottom-e>=t.bottom}hasPoint({x:t,y:e}={},i=0){return this.hasPointX(t,i)&&this.hasPointY(e,i)}hasPointX(t=0,e=0){return this.left+e<=t&&this.right-e>=t}hasPointY(t=0,e=0){return this.top+e<=t&&this.bottom-e>=t}isOverlap(t){let e=Math.max(this.top,t.top),i=Math.max(this.left,t.left),n=Math.min(this.right,t.right),s=Math.min(this.bottom,t.bottom);return n-i>0&&s-e>0}area(){return this.width*this.height}clone(t=0){return new n({left:this.left+t,right:this.right-t,top:this.top+t,bottom:this.bottom-t},"tlbr")}}const s={create:(t,e)=>new n(t,e),createBy(t){if(!t)return;if(!t.ownerDocument){let e=Ti.Dom.ownerWindow(t);return new n({top:0,left:0,width:e.document.documentElement.clientWidth,height:e.document.documentElement.clientHeight})}let e=t.getBoundingClientRect();return new n(e,"tlwh")},union(...t){if(0==t.length)return new n;let e=new n(t[0]);return e.union(...t.slice(1)),e},overlap(...t){if(0==t.length)return new n;let e=new n(t[0]);return e.overlap(...t.slice(1)),e},isRect:t=>t&&t.__ti_rect__&&t instanceof n};return{Rect:n,TiRects:s,Rects:s}}(),{Load:Load}=function(){async function t(e=[],{dynamicPrefix:i,dynamicAlias:n,cooked:s,type:a}={}){if(_.isFunction(e)){return t(e(),{dynamicPrefix:i})}if(_.isArray(e)){let s=[],r=[];return e.forEach((e,a)=>{s.push(t(e,{dynamicPrefix:i,dynamicAlias:n}).then(t=>r[a]=t))}),Promise.all(s).then(()=>r)}if(!_.isString(e))throw Ti.Err.make("e-ti-use-url_must_string",e);if(!s){let t=Ti.Config.cookUrl(e,{dynamicPrefix:i,dynamicAlias:n});if(!t)throw`Fail to cook URL: ${e}`;a=t.type,e=t.url}let o=Ti.MatchCache(e);if(o)return o;try{return o=await r[a](e)}catch(t){throw Ti.IsWarn("TiLoad")&&console.warn(`TiLoad Fail: [${a}]`,`"${e}"`),t}}const{importModule:e}=function(){function t(t){return new Promise((e,i)=>{const n="$importModule$"+Math.random().toString(32).slice(2),s=document.createElement("script"),r=()=>{delete window[n],s.onerror=null,s.onload=null,s.remove(),URL.revokeObjectURL(s.src),s.src=""};s.defer="defer",s.type="module",s.crossOrigin="use-credentials",s.onerror=(()=>{i(new Error(`Failed to import: ${t}`)),r()}),s.onload=(()=>{e(window[n]),r()});const a=`import * as m from "${function(t){const e=document.createElement("a");return e.setAttribute("href",t),e.cloneNode(!1).href}(t)}"; window.${n} = m;`,o=new Blob([a],{type:"text/javascript"});s.src=URL.createObjectURL(o),document.head.appendChild(s)})}return{importModule:t}}();class i{constructor(t=(t=>t)){this.cached={},this.loading={},this.doLoad=t}async tryLoad(t,e){let i=this.cached[t];if(!_.isUndefined(i))return void e(i);let n=this.loading[t];if(_.isArray(n)&&n.length>0)return void n.push(e);this.loading[t]=[e];let s=await this.doLoad(t);this.cached[t]=s;let r=this.loading[t];this.loading[t]=null;for(let t of r)t(s)}}const n=new i(async t=>{try{return(window.navigator.userAgent||"").indexOf("QQBrowser")>0?await e(t):await import(t)}catch(e){throw Ti.IsWarn("TiLoad")&&console.warn("ti.load.mjs",t,e),e}}),s=new i(async t=>{try{return await Ti.Http.get(t)}catch(e){throw Ti.IsWarn("TiLoad")&&console.warn("ti.load.text",t,e),e}}),r={js:t=>new Promise((e,i)=>{let n=Ti.Dom.find(`script[src="${t}"]`);n?_.defer(e,n):((n=Ti.Dom.createElement({tagName:"script",props:{src:t}})).addEventListener("load",function(t){e(n)},{once:!0}),n.addEventListener("error",function(t){i(t)},{once:!0}),Ti.Dom.appendToHead(n))}),asyncjs:t=>new Promise((e,i)=>{let n=Ti.Dom.find(`script[src="${t}"]`);n?_.defer(e,n):((n=Ti.Dom.createElement({tagName:"script",props:{src:t,async:!0}})).addEventListener("load",function(t){e(n)},{once:!0}),n.addEventListener("error",function(t){i(t)},{once:!0}),Ti.Dom.appendToHead(n))}),mjs:t=>new Promise((e,i)=>{n.tryLoad(t,t=>{e(t.default)})}),css:t=>new Promise((e,i)=>{let n=Ti.Dom.find(`link[href="${t}"]`);n?_.defer(e,n):((n=Ti.Dom.createElement({tagName:"link",props:{rel:"stylesheet",type:"text/css",href:t}})).addEventListener("load",function(t){e(n)},{once:!0}),n.addEventListener("error",function(t){i(t)},{once:!0}),Ti.Dom.appendToHead(n))}),async json(t){try{let e=await r.text(t);return _.isPlainObject(e)?e:JSON.parse(e)}catch(e){throw Ti.IsWarn("TiLoad")&&console.warn("ti.load.json!!",t,e),e}},text:t=>new Promise((e,i)=>{s.tryLoad(t,e)})};return{Load:t}}(),{Http:Http}=function(){const t={arraybuffer(t){throw"No implement yet!"},blob(t){throw"No implement yet!"},document(t){throw"No implement yet!"},xml(t){throw"No implement yet!"},ajax(e){let i=t.json(e);if(i.ok)return i.data;throw i},json(t){let e=t.responseText,i=_.trim(e)||null;if(!i)return null;try{return JSON.parse(i)}catch(t){return Ti.Types.safeParseJson(i,i)}},jsonOrText(t){let e=t.responseText;try{let t=_.trim(e)||null;return t?JSON.parse(t):null}catch(t){}return e},text:t=>t.responseText},e={send(t,i={}){if(Ti.IsInfo("TiHttp")&&console.log("TiHttp.send",t,i),!t)return;let{method:n="GET",params:s={},body:r=null,file:a=null,headers:o={},cleanNil:l=!0,progress:h=_.identity,created:c=_.identity,beforeSend:u=_.identity,finished:d=_.identity,readyStateChanged:p=_.identity}=i;if(n=_.upperCase(n),l){let t={};Ti.Util.walk(s,{leaf:(e,i)=>{Ti.Util.isNil(e)||_.set(t,i,e)}}),s=t}let{urlToSend:m,sendData:f}=Ti.Invoke({GET:()=>{let i=e.encodeFormData(s);return{urlToSend:i?t+"?"+i:t}},POST:()=>(_.defaults(o,{"Content-type":"application/x-www-form-urlencoded; charset=utf-8"}),a?{urlToSend:[t,e.encodeFormData(s)].join("?"),sendData:a}:Ti.Util.isNil(r)?{urlToSend:t,sendData:e.encodeFormData(s)}:{urlToSend:[t,e.encodeFormData(s)].join("?"),sendData:r})}[n])||{urlToSend:t},g=new XMLHttpRequest;if(a){if(!g.upload)throw Ti.Err.make("e.ti.http.upload.NoSupported");g.upload.addEventListener("progress",h)}return c(g),new Promise((t,e)=>{g.onreadystatechange=(()=>{p(g,i),4==g.readyState&&(d(g),200==g.status?t(g):e(g))}),g.open(n,m),_.forOwn(o,(t,e)=>{g.setRequestHeader(e,t)}),u(g),g.send(f)})},sendAndProcess:(i,n={})=>e.send(i,n).then(e=>(function(e,{as:i="text"}={}){return Ti.InvokeBy(t,i,[e])})(e,n)).catch(({responseText:t}={})=>{throw _.trim(t)}),get:(t,i={})=>e.sendAndProcess(t,_.assign({},i,{method:"GET"})),post:(t,i={})=>e.sendAndProcess(t,_.assign({},i,{method:"POST"})),encodeFormData(t={}){let e=[];return _.forOwn(t,(t,i)=>{let n=Ti.Types.toStr(t);e.push(`${i}=${encodeURIComponent(n)}`)}),e.join("&")}};return{Http:e}}(),{I18n:I18n}=function(){function t(t){let i=_.get(e,t);if(i)return i;if(_.isString(t)){let i=t.replace(/\./g,"-");return e[i]}return t}const e={},i={all:()=>e,put(t){if(_.isArray(t))for(let e of t)i.put(e);else if(_.isPlainObject(t)){if(_.isBoolean(t.ok))return void console.warn("invalid msgs",t);_.assign(e,t)}},get(e,n){if(e&&e.key&&_.isPlainObject(e))return i.getf(e.key,e.vars);if(e instanceof Error)return e.code?Ti.S.join([i.get(e.code),e.data]," : "):e.message;let s=t(e);return _.isUndefined(s)?_.isUndefined(n)?e:n:s},text(t,e){if(t&&t.text&&_.isPlainObject(t))return i.textf(t.text,t.vars);if(t instanceof Error)return i.get(t);let n=/^i18n:(.+)$/.exec(t);return n?i.get(n[1],e):Ti.Util.fallback(t,e)},getf(e,i={}){if(_.isString(e)){let n=t(e)||e;return Ti.S.renderBy(n,i)}return e},textf(t,e={}){let n=/^i18n:(.+)$/.exec(t);return n?i.getf(n[1],e):Ti.S.renderBy(t,e)},render:(t={},e)=>i.textf(e,t),explain(t){let e=_.trim(t),n=e.indexOf(":");if(n>0){let t=_.trim(e.substring(0,n)),s=_.trim(e.substring(n+1));return console.log({code:t,data:s}),i.getf(t,{val:s})}return i.get(e)},translate(t){let e=_.trim(t),n=e.indexOf(":");if(n>0){let t=_.trim(e.substring(0,n)),s=_.trim(e.substring(n+1));return i.get(t)+" : "+s}return i.get(e)}};return{I18n:i}}(),{Icons:Icons}=function(){const t={"7z":"fas-file-archive",apk:"zmdi-android",bin:"fas-file",css:"fab-css3",csv:"fas-file-csv",doc:"far-file-word",docx:"fas-file-word",dmg:"fab-apple",exe:"im-windows-o",gz:"fas-file-archive",hmaker_site:"zmdi-globe-alt",html:"fab-html5",js:"fab-node-js",json:"fas-quote-right",less:"fab-first-order-alt",md:"fab-markdown",mjs:"fab-node-js",mkv:"far-file-video",mp:"fas-file-signature",mp3:"far-file-audio",mp4:"far-file-video",msi:"fab-windows",pdf:"far-file-pdf",py:"fab-python",rar:"fas-file-archive",rss:"fas-rss-square",sass:"fab-first-order",tar:"far-file-archive",tgz:"fas-file-archive",comt:"im-flask",wnml:"fas-file-code",xls:"far-file-excel",xlsx:"fas-file-excel",xml:"far-file-code",youtube:"fab-youtube",zip:"fas-file-archive",category:"zmdi-folder",article:"zmdi-file-text"},e={audio:"far-file-audio",image:"far-file-image",text:"far-file-alt",video:"far-file-video","text/css":"fab-css3","text/html":"fab-html5","application/x-zip-compressed":"fas-file-archive","application/x-javascript":"fab-js-square","text/javascript":"fab-js-square"},i={add:"zmdi-plus",alert:"zmdi-notifications-none",backward:"zmdi-chevron-left",close:"zmdi-close",confirm:"zmdi-help",create:"zmdi-audio",del:"zmdi-delete",done:"fas-thumbs-up",download:"zmdi-download",edit:"zmdi-edit",error:"zmdi-alert-octagon",forward:"zmdi-chevron-right",help:"zmdi-help-outline",info:"zmdi-info-outline",loading:"fas-spinner fa-spin",moved:"zmdi-gamepad",processing:"zmdi-settings zmdi-hc-spin",ok:"zmdi-check-circle",prompt:"zmdi-keyboard",refresh:"zmdi-refresh",removed:"far-trash-alt",setting:"zmdi-settings",success:"zmdi-check-circle",track:"zmdi-notifications-none",warn:"zmdi-alert-triangle"},n={FILE:"far-file",DIR:"fas-folder"},s={...t,...e,...n,...i},r={put({types:s,mimes:r,races:a,names:o,dft:l}={}){_.assign(t,s),_.assign(e,r),_.assign(i,o),_.assign(n,a),_.assign("zmdi-cake",l)},evalIcon(r,a){if(!r)return a;if(_.isString(r))return s[r]||a;let{tp:o,type:l,mime:h,race:c,name:u,icon:d}=r;if(d)return d;let p=null;if(h){let t=/^([a-z0-9]+)\/(.+)$/.exec(h);t&&(p=t[1])}return t[l||o]||e[h]||e[p]||n[c]||i[u]||a},get:(t,e="zmdi-cake")=>r.evalIcon(t,e),getByName:(t,e=null)=>Ti.Util.fallback(i[t],e,"zmdi-cake"),evalIconObj(t,e){if(!t)return e;if(_.isString(t)){let e=/^(fa\w|zmdi|im)-([\d\w-]+)$/.exec(t);if(e){let[t,i,n]=e;return{type:"font",value:t,cate:i,name:n}}return{type:"image",value:t}}return t},parseFontIcon(t,e={}){if(!t)return e;let i={className:"material-icons",text:t},n=/^([a-z]+)-(.+)$/.exec(t);return n&&(/^fa[a-z]$/.test(n[1])?(i.className=n[1]+" fa-"+n[2],i.text=null):(i.className=n[1]+" "+t,i.text=null)),i},fontIconHtml(t,e=""){if(!t)return e;let i=r.parseFontIcon(t);return _.isEmpty(i)?e:`<i class="${i.className}">${i.text||""}</i>`}};return{Icons:r}}(),{Fuse:Fuse}=function(){class t{constructor({key:t,everythingOk:e,fail:i,once:n=!1}={}){_.assign(this,{key:t,everythingOk:e,fail:i,once:n})}async explode(){return!!await this.everythingOk()||(await this.fail(),!1)}}class e{constructor(){this.detonators=[]}async fire(){for(let t of this.detonators)if(!await t.explode())return!1;return _.remove(this.detonators,t=>t.once),!0}add(e={}){_.defaults(e,{key:"det-"+this.detonators.length}),e instanceof t?this.detonators.push(e):this.detonators.push(new t(e))}remove(...t){_.pullAllWith(this.detonators,t,(t,e)=>t.key==e)}clear(){this.detonators=[]}}class i{constructor(){this.fuses={}}get(t="main"){return this.fuses[t]}getOrCreate(t="main"){let i=this.get(t);return i||(i=new e,this.fuses[t]=i),i}async fire(t="main"){let e=this.get(t);return!e||await e.fire()}removeFuse(t){let e=this.get(t);return e&&delete this[t],e}clear(t="main"){let e=this.get(t);return e&&e.clear(),e}}return{Fuse:new i}}(),{Random:Random}=function(){const t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".split("");return{Random:{str(e=4,i=t){let n="";for(let s=0;s<e;s++){n+=i[_.random(0,t.length-1)]}return n},obj:(e=t)=>e[_.random(0,t.length-1)],list(t=[],e=t.length){let i=Math.min(e,t.length)-1;for(;i>0;i--){let e=_.random(0,i),n=t[i],s=t[e];t[i]=s,t[e]=n}return t}}}}(),{Storage:Storage}=function(){class t{constructor(t){this.storage=t}get(t,e,i=_.identity){let n=this.storage.getItem(t);return Ti.Util.isNil(n)?e:i(n)}getString(t,e=null){return this.get(t,e)}getObject(t,e={}){return this.get(t,e,t=>JSON.parse(t))}getInt(t,e=-1){return this.get(t,e,t=>parseInt(t))}getBoolean(t,e=!1){return this.get(t,e,t=>!!/^(true|yes|on|ok)$/.test(t))}getNumber(t,e=-1){return this.get(t,e,t=>1*t)}set(t,e){if(_.isNull(e)||_.isUndefined(e))this.remove(t);else{let i=e+"";this.storage.setItem(t,i)}}setObject(t,e={}){(_.isNull(e)||_.isUndefined(e))&&this.remove(t);let i=JSON.stringify(e);this.storage.setItem(t,i)}mergeObject(t,e={}){let i=this.getObject(t);_.merge(i,e),this.setObject(t,i)}remove(t){this.storage.removeItem(t)}clear(){this.storage.clear()}}return{Storage:{session:new t(window.sessionStorage),local:new t(window.localStorage)}}}(),{Shortcut:Shortcut}=function(){const t={genEventActionInvoking(e,i={}){if(!e)return;let{app:n,context:s,funcSet:r}=i,a=[];if(_.isArray(e))for(let n of e){let e=t.genEventActionInvoking(n,i);e&&a.push(e)}else if(_.isString(e)){let t=/^(commit|dispatch|root|main):([^()]+)(\((.+)\))?$/.exec(e);if(t){let e=t[1],i=_.trim(t[2]),r=_.trim(t[4]),a=Ti.S.joinArgs(r,[],t=>_.isString(t)||_.isArray(t)?Ti.S.toJsValue(t,{context:s}):t);return function(){n[e](i,...a)}}let i=Ti.Util.genInvoking(e,{context:s,dft:null,funcSet:r});i&&a.push(i)}else if(_.isFunction(e))a.push(e);else{let t=Ti.Util.explainObj(s,e.payload,{evalFunc:!0});e.commit&&a.push(function(){n.commit(e.commit,t)}),e.dispatch&&a.push(function(){n.dispatch(e.dispatch,t)}),e.global&&a.push(function(){n.global(e.global,t)}),e.main&&a.push(function(){n.main(e.main,t)}),e.root&&a.push(function(){n.root(e.root,t)}),Ti.Util.isNil(e.eventRewrite)||a.push(function(){return e.eventRewrite})}return _.isEmpty(a)?void 0:1==a.length?a[0]:async function(...t){let e;for(let i of a)e=await i.apply(s,t);return e}},genActionInvoking(t,{$com:e,argContext:i={},wait:n=0}={}){const s=t=>n>0?_.debounce(t,n,{leading:!0}):t,r=t=>_.isFunction(t)?t():t;if(_.isFunction(t))return s(t);let a,o,l;if(_.isString(t)){let e=/^((global|commit|dispatch|root|main|\$\w+):|=>)([^()]+)(\((.*)\))?$/.exec(t);if(!e)throw Ti.Err.make("e.action.invalid : "+t,{action:t});a=e[2]||e[1],o=e[3],l=e[5]}else _.isPlainObject(t)&&(a=t.mode,o=t.name,l=t.args);let h,c=Ti.S.joinArgs(l,[],t=>Ti.S.toJsValue(t,{context:i}));if("=>"==a){let i=_.get(window,o);if(!_.isFunction(i))throw Ti.Err.make("e.action.invoke.NotFunc : "+t,{action:t});h=(()=>{let t=r(e);i.apply(t,c)})}else h="$emit"==a||"$notify"==a?()=>{let i=r(e);if(!i)throw Ti.Err.make("e.action.emit.NoCom : "+t,{action:t});i[a](o,...c)}:"$parent"==a?()=>{let i=r(e),n=i[o];if(!_.isFunction(n))throw Ti.Err.make("e.action.call.NotFunc : "+t,{action:t});n.apply(i,c)}:()=>{let t=r(e),i=Ti.App(t),n=i[a],s=_.concat(o,c);n.apply(i,s)};if(!_.isFunction(h))throw Ti.Err.make("e.invalid.action : "+t,{action:t});return s(h)},getUniqueKey(t,{sep:e="+",mode:i="upper"}={}){let n=[];t.altKey&&n.push("ALT"),t.ctrlKey&&n.push("CTRL"),t.metaKey&&n.push("META"),t.shiftKey&&n.push("SHIFT");let s=Ti.S.toCase(t.key,i);return/^(ALT|CTRL|CONTROL|SHIFT|META)$/.test(s)||n.push(" "===s?"SPACE":s),n.join(e)},startListening(){this.isListening||(window.addEventListener("keydown",e=>{let i=t.getUniqueKey(e),n=Ti.App.topInstance();n&&n.fireShortcut(i,e)}),this.isListening=!0)}};return{Shortcut:t}}(),{TiWebsocket:TiWebsocket}={TiWebsocket:{listenRemote({watchTo:t=null,watched:e=_.identity,received:i=_.identity,closed:n=_.identity,error:s=_.identity}={}){let r=window.location.hostname,a=window.location.port,o={"http:":"ws","https:":"wss"}[window.location.protocol],l=[r];a>80&&l.push(a);var h=`${o}://${l.join(":")}/websocket`,c=new WebSocket(h);return _.isPlainObject(t)&&(c.onmessage=function(n){var s=JSON.parse(n.data);if("hi"==s.event){let e=JSON.stringify(t);this.send(e)}else"watched"==s.event?e(s):i(s)}),c.onclose=n,c.onerror=s,c}}},{Validate:Validate}=function(){const t={notNil:t=>!Ti.Util.isNil(t),notEmpty:t=>!_.isEmpty(t),notBlank:t=>!Ti.S.isBlank(t),isNil:t=>Ti.Util.isNil(t),isEmpty:t=>_.isEmpty(t),isBlank:t=>Ti.S.isBlank(t),isPlainObject:t=>_.isPlainObject(t),isBoolean:t=>_.isBoolean(t),isTrue:t=>!0===t,isFalse:t=>!1===t,isTruthy:t=>!!t,isFalsy:t=>!t,isNumber:t=>_.isNumber(t),isString:t=>_.isString(t),isDate:t=>_.isDate(t),inRange:(t,...e)=>_.inRange(t,...e),isMatch:(t,e)=>_.isMatch(t,e),isEqual:(t,e)=>_.isEqual(t,e),isOf:(t,...e)=>{for(let i of e)if(_.isEqual(i,t))return!0;return!1},matchRegex:(t,e)=>_.isRegExp(e)?e.test(t):new RegExp(e).test(t)},e={get(e,i=[],n){_.isFunction(e)&&(e=e());let s=_.get(t,e);if(!_.isFunction(s))throw`Invalid Validate: ${e}`;let r;return r=_.isEmpty(i)?s:_.partialRight(s,...i),n?t=>!r(t):r},evalBy(e,i={}){let n=!1;e.startsWith("!")&&(n=!0,e=_.trim(e.substring(1)));let s=Ti.Util.genInvoking(e,{context:i,funcSet:t,partial:"right"});if(!_.isFunction(s))throw`Invalid TiValidator: "${e}"`;return n?t=>!s(t):s},getBy(t){if(_.isBoolean(t))return()=>t;if(_.isFunction(t))return t;if(_.isString(t))return e.evalBy(t);if(_.isPlainObject(t)){let i=t.name,n=_.isUndefined(t.args)?[]:[].concat(t.args),s=!!t.not;return/^!/.test(i)&&(i=i.substring(1).trim(),s=!0),e.get(i,n,s)}if(_.isArray(t)&&t.length>0){let i=t[0],n=t.slice(1,t.length),s=!1;return/^!/.test(i)&&(i=i.substring(1).trim(),s=!0),e.get(i,n,s)}},checkBy(t,i){let n=e.getBy(t);return!!_.isFunction(n)&&!!n(i)},match(t={},i={},n=!1){if(!t||_.isEmpty(t))return n;if(_.isFunction(i))return!!i(t);if(_.isBoolean(i))return!!i;if(_.isArray(i)){for(let e of i)if(Ti.Validate.match(t,e,n))return!0;return!1}let s=_.keys(i);for(let n of s){let s=_.get(i,n),r=_.get(t,n);if(!e.checkBy(s,r))return!1}return!0},compile:(t,i)=>n=>e.match(n,t,i)};return{Validate:e}}(),{AutoMatch:AutoMatch}=function(){function t(t,e){if(_.isFunction(e))return e(t);if(_.isArray(e)){let i=t.split("."),n=[];for(let t=0;t<i.length;t++){let s=i[t],r=_.nth(e,t);r?n.push(r[s]||s):n.push(s)}return n.join(".")}return e?_.get(e,t)||t:t}function e(a){if(Ti.Util.isNil(a))return new n;if(_.isBoolean(a))return function(t){let e=!!t,i=function(t){return e===t};return i.explainText=function({boolTrue:t="i18n:am-boolTrue",boolFalse:i="i18n:am-boolFalse"}={}){return e?Ti.I18n.text(t):Ti.I18n.text(i)},i}(a);if(_.isNumber(a))return function(t){let e=function(e){return e==t};return e.explainText=function({equals:e="i18n:am-equals"}={}){let i=Ti.I18n.text(e);return Ti.S.renderBy(i,{val:t})},e}(a);if(_.isFunction(a))return a;if(_.isArray(a)){let t=[];for(let i of a){let n=e(i);t.push(n)}return function(...t){let e=function(e){if(_.isEmpty(t))return!1;for(let i of t)if(i(e))return!0;return!1};return e.explainText=function(e={}){if(_.isEmpty(t))return"";if(1==t.length)return t[0].explainText(e);let i=[];for(let n of t)i.push(n.explainText(e));let n=e.or||"i18n:am-or",s=Ti.I18n.text(n);return i.join("; "+s)},e}(...t)}if(_.isPlainObject(a))return a.$Nil?n(a.$Nil):a.$NotNil?function(t){if(!t)return t=>!Ti.Util.isNil(t);let e=e=>{let i=_.get(e,t);return!Ti.Util.isNil(i)};return e.explainText=function({notNil:e="i18n:am-notNil",notNilOf:i="i18n:am-notNilOf"}={}){if(!t)return Ti.I18n.textf(e);let n=Ti.I18n.text(i);return Ti.S.renderBy(n,{val:t})},e}(a.$NotNil):a.$Null?function(t){if(!t)return t=>_.isNull(t);let e=e=>{let i=_.get(e,t);return _.isNull(i)};return e.explainText=function(e={null:"i18n:am-null",nullOf:"i18n:am-nullOf"}){if(!t)return Ti.I18n.textf(e.null);let i=Ti.I18n.text(e.nullOf);return Ti.S.renderBy(i,{val:t})},e}(a.$Null):a.$Undefined?function(t){if(!t)return t=>_.isUndefined(t);let e=e=>{let i=_.get(e,t);return _.isUndefined(i)};return e.explainText=function(e={undefined:"i18n:am-undefined",undefinedOf:"i18n:am-undefinedOf"}){if(!t)return Ti.I18n.textf(e.undefined);let i=Ti.I18n.text(e.undefinedOf);return Ti.S.renderBy(i,{val:t})},e}(a.$Undefined):a.$Type?function(t){let e=t,i=t=>e==typeof t;return i.explainText=function({equalsType:t="i18n:am-equalsType"}={}){let i=Ti.I18n.text(t);return Ti.S.renderBy(i,{val:e})},i}(a.$Type):"findInArray"==a.matchMode&&a.matchBy?function(t){let e=r.parse(t.matchBy),i=!!t.not,n=function(t){let n=_.concat(t);for(let t of n)if(e(t))return!!(!0^i);return!!(!1^i)};return n.explainText=function(t={}){let i=e.explainText(t),n=t.findInArray||"i18n:am-findInArray",s=Ti.I18n.text(n);return Ti.S.renderBy(s,{val:i})},n}(a):function(n){let r=[];_.forEach(n,(t,n)=>{let a,o=n.startsWith("!"),l=!1;o&&(n=n.substring(1).trim()),null!=t&&("[EXISTS]"==t?(a=i(n,o),l=!0):"![EXISTS]"==t&&(a=i(n,o=!o),l=!0)),a||(a=e(t),o&&(a=s(a))),r.push({key:n,m:a,explainIgnoreKey:l})});let a=function(t){if(!t||!_.isPlainObject(t))return!1;for(let e of r){let i=e.key,n=_.get(t,i);if(!(0,e.m)(n))return!1}return!0};return a.explainText=function(e={}){if(_.isEmpty(r))return Ti.I18n.text(e.emptyItems||"i18n:hm-am-empty");let i=[],n=e.keyDisplayBy;for(let s of r){let r=s.m.explainText(e);if(s.explainIgnoreKey)i.push(r);else{let e=t(s.key,n);i.push(`'${e}'${r}`)}}let s=e.and||"i18n:am-and",a=Ti.I18n.text(s);return i.join(a)},a}(a);if(_.isString(a))return function(t){if(Ti.Util.isNil(t))return n();if(""==t)return function(){let t=function(t){return _.isEmpty(t)};return t.explainText=function({empty:t="i18n:am-empty"}={}){return Ti.I18n.text(t)},t}();let e=t=>t;t.startsWith("!")&&(e=(t=>s(t)),t=t.substring(1).trim());if(Ti.S.isBlank(t)||"[BLANK]"==t)return e(function(){let t=function(t){return Ti.Util.isNil(t)||Ti.S.isBlank(t)};return t.explainText=function({blank:t="i18n:am-blank"}={}){return Ti.I18n.text(t)},t}());let i=/^([(\[])([^\]]+)([)\]])$/.exec(t);if(i)return e(function(t){let e=t;_.isString(t)&&(e=/^([(\[])([^\]]+)([)\]])$/.exec(t));if(!e)return function(){return!1};let i=_.trim(e[2]).split(/[,:;~]/g),n={val:_.trim(_.first(i)),open:"("==e[1]},s={val:_.trim(_.last(i)),open:")"==e[3]};_.isString(n.val)&&n.val?n.val*=1:n.val=NaN;_.isString(s.val)&&s.val?s.val*=1:s.val=NaN;let r=function(t){let e=1*t;if(isNaN(e))return!1;if(!isNaN(n.val)){if(n.open&&e<=n.val)return!1;if(e<n.val)return!1}if(!isNaN(s.val)){if(s.open&&e>=s.val)return!1;if(e>s.val)return!1}return n.val!==s.val||(n.open||s.open?t!=n.val:t==n.val)};return r.explainText=function({equals:t="i18n:am-equals",notEquals:e="i18n:am-notEquals",and:i="i18n:am-and",gt:r="i18n:am-gt",gte:a="i18n:am-gte",lt:o="i18n:am-lt",lte:l="i18n:am-lte"}={}){if(n.val==s.val){let i;return i=n.open||s.open?Ti.I18n.text(e):Ti.I18n.text(t),Ti.S.renderBy(i,{val:n.val})}let h=[];if(!isNaN(n.val)){let t=n.open?Ti.I18n.text(r):Ti.I18n.text(a);h.push(Ti.S.renderBy(t,{val:n.val}))}if(!isNaN(s.val)){let t=s.open?Ti.I18n.text(o):Ti.I18n.text(l);h.push(Ti.S.renderBy(t,{val:s.val}))}if(h.length>1){let t=Ti.I18n.text(i);return h.join(t)}return h[0]},r}(i));if(/^!?\^/.test(t))return e(function(t){let e=!1;t.startsWith("!")&&(e=!0,t=t.substring(1).trim());let i=new RegExp(t),n=function(t){return Ti.Util.isNil(t)?e:i.test(t)?!e:e};return n.explainText=function({matchOf:t="i18n:am-matchOf",notMatchOf:n="i18n:am-notMatchOf"}){let s=e?n:t,r=Ti.I18n.text(s);return Ti.S.renderBy(r,{val:i})},n}(t));if(/\*/.test(t))return e(function(t){let e=!1;t.startsWith("!")&&(e=!0,t=t.substring(1).trim());let i="^"+t.replaceAll("*",".*")+"$",n=new RegExp(i),s=function(t){return Ti.Util.isNil(t)?e:n.test(t)?!e:e};return s.explainText=function({matchOf:e="i18n:am-matchOf"}={}){let i=Ti.I18n.text(e);return Ti.S.renderBy(i,{val:t})},s}(t));return e(function(t){let e=!1;t.startsWith("~~")&&(e=!0,t=t.substring(2).toUpperCase());let i=function(i){return Ti.Util.isNil(i)?Ti.Util.isNil(t):e?t==i.toUpperCase():t==i};return i.explainText=function({equalsIgnoreCase:i="i18n:am-equalsIgnoreCase",equals:n="i18n:am-equals"}){let s=e?i:n,r=Ti.I18n.text(s);return Ti.S.renderBy(r,{val:t})},i}(t))}(a);if(_.isRegExp(a))return function(t){return a.test(t)};throw Ti.Err.make("e.match.unsupport",a)}function i(e,i=!1){let n=function(t){return!_.isUndefined(t)^i};return n.explainText=function({exists:n="i18n:am-exists",noexists:s="i18n:am-noexists",keyDisplayBy:r}={}){let a=i?s:n,o=Ti.I18n.text(a),l=t(e,r);return Ti.S.renderBy(o,{val:l})},n}function n(t){if(!t)return t=>Ti.Util.isNil(t);let e=e=>{let i=_.get(e,t);return Ti.Util.isNil(i)};return e.explainText=function(e={nil:"i18n:am-nil",nilOf:"i18n:am-nilOf"}){if(!t)return Ti.I18n.textf(e.nil);let i=Ti.I18n.text(e.nilOf);return Ti.S.renderBy(i,{val:t})},e}function s(t){let e=function(e){return!t(e)};return e.explainText=function(e={}){return Ti.I18n.text(e.not||"i18n:am-not")+t.explainText(e)},e}const r={parse(t){if(_.isFunction(t))return t.explainText=(()=>Ti.I18n.get("am-not-sure")),t;if(Ti.Util.isNil(t)){let t=()=>!1;return t.explainText=(()=>Ti.I18n.get("am-must-false")),t}if(_.isBoolean(t)){let e=()=>t;return e.explainText=(()=>Ti.I18n.get(t?"am-must-true":"am-must-false")),e}return e(t)},test:(t,i)=>_.isFunction(t)?t(i):!Ti.Util.isNil(t)&&(_.isBoolean(t)?t:e(t)(i))};return{AutoMatch:r}}(),{DateTime:DateTime}=function(){const t=["sun","mon","tue","wed","thu","fri","sat"],e=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],i={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6,sunday:0,monday:1,tuesday:2,wednesday:3,thursday:4,friday:5,saturday:6},n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],s=new RegExp("^((\\d{2,4})([/\\\\-])?(\\d{1,2})?([/\\\\-])?(\\d{1,2})?)?(([ T])?(\\d{1,2})(:)(\\d{1,2})((:)(\\d{1,2}))?((.)(\\d{1,3}))?)?(([+-])(\\d{1,2})(:\\d{1,2})?)?(Z(\\d*))?$"),r={parseTime:(t,e)=>Ti.Types.toTime(t,e),parse(t){if(_.isUndefined(t)||"today"===t||"now"===t)return new Date;if(!t||_.isArray(t)&&_.isEmpty(t))return null;if(_.isDate(t))return new Date(t);if(_.isNumber(t))return new Date(t);if(_.isString(t)){let e=_.trim(t);if(/\d{13,}/.test(e))return new Date(1*e);let i=s.exec(e);if(i){let t=(t,e,i)=>{let n=t[e];return n?parseInt(n):i},e=new Date,n=i[2];2==n.length&&(n="20"+n);let s=parseInt(n),r=t(i,4,i[2]?1:e.getMonth()+1),a=t(i,6,i[2]?1:e.getDate()),o=t(i,9,0),l=t(i,11,0),h=t(i,14,0),c=t(i,17,0),u=[_.padStart(s,4,"0"),"-",_.padStart(r,2,"0"),"-",_.padStart(a,2,"0"),"T",_.padStart(o,2,"0"),":",_.padStart(l,2,"0"),":",_.padStart(h,2,"0"),".",_.padStart(c,3,"0")];i[18]&&u.push(i[18]);let d=u.join(""),p=new Date(d),m=Ti.Env("TIMEZONE_DIFF");return _.isNumber(m)&&0!==m&&(p=new Date(p.getTime()-m)),p}}throw"i18n:invalid-date"},genFormatContext(i){if(_.isDate(i)||(i=r.parse(i)),!i)return{};let s=i.getFullYear(),a=i.getMonth()+1,o=i.getDate(),l=i.getHours(),h=i.getMinutes(),c=i.getSeconds(),u=i.getMilliseconds(),d=n[i.getMonth()],p=Ti.I18n.get(`cal.abbr.${d}`),m=Ti.I18n.get(d),f=i.getDay(),g=_.upperFirst(t[f]),y=_.upperFirst(e[f]),T=Ti.I18n.get(g),x=Ti.I18n.get(y);return{yyyy:s,M:a,d:o,H:l,m:h,s:c,S:u,yyy:s,yy:(""+s).substring(2,4),MM:_.padStart(a,2,"0"),dd:_.padStart(o,2,"0"),HH:_.padStart(l,2,"0"),mm:_.padStart(h,2,"0"),ss:_.padStart(c,2,"0"),SS:_.padStart(u,3,"0"),SSS:_.padStart(u,3,"0"),E:T,EE:T,EEE:T,EEEE:x,MMM:p,MMMM:m}},format(t,e="yyyy-MM-dd HH:mm:ss"){if(_.isArray(t)){let i=[];for(let n of t)i.push(r.format(n,e));return i}if(_.isDate(t)||(t=r.parse(t)),!t)return null;let i=Ti.Env("TIMEZONE_DIFF");_.isNumber(i)&&0!==i&&(t=new Date(t.getTime()+i));let n,s=r.genFormatContext(t),a=/(y{2,4}|M{1,4}|dd?|HH?|mm?|ss?|S{1,3}|E{1,4}|'([^']+)')/g,o=[],l=0;for(;n=a.exec(e);){l<n.index&&o.push(e.substring(l,n.index));let t=Ti.Util.fallback(n[2],s[n[1]],n[1]);o.push(t),l=a.lastIndex}l<e.length&&o.push(e.substring(l));let h=o.join("");return h.endsWith(" 00:00:00")?h.substring(0,h.length-9):h},getWeekDayAbbr(e){let i=_.clamp(e,0,t.length-1);return t[i]},getWeekDayName(t){let i=_.clamp(t,0,e.length-1);return e[i]},getWeekDayValue(t,e=-1){let n=_.trim(_.lowerCase(t)),s=i[n];return _.isNumber(s)?s:e},getMonthAbbr(t){let e=_.clamp(t,0,11);return n[e]},setTime:(t,e=0,i=0,n=0,s=0)=>(_.inRange(e,0,24)&&t.setHours(e),_.inRange(i,0,60)&&t.setMinutes(i),_.inRange(n,0,60)&&t.setSeconds(n),_.inRange(s,0,1e3)&&t.setMilliseconds(s),t),setDayLastTime:t=>r.setTime(t,23,59,59,999),today(){let t=new Date;return r.setTime(t),t},todayInMs:()=>r.today().getTime(),moveYear:(t,e=0)=>(_.isDate(t)&&t.setFullYear(t.getFullYear+e),t),moveMonth:(t,e=0)=>(_.isDate(t)&&t.setMonth(t.getMonth()+e),t),moveDate:(t,e=0)=>(_.isDate(t)&&t.setDate(t.getDate()+e),t),countMonthDay(t){let e=new Date(t);return e.setDate(32),e.setDate(0),e.getDate()},moveToLastDateOfMonth:t=>(t.setDate(1),r.moveMonth(t,1),t.setDate(0),t),createDate(t,e=0){if(_.isDate(t)){let i=new Date(t);return i.setDate(i.getDate()+e),i}},parseMsRange:t=>Ti.Types.toMsRange(t),formatMsDateRange(t,e="yyyy-MM-dd",i="[NilMsRange]",...n){let s=Ti.Types.toMsRange(t);return s?s.toDateString(e,...n):i},rangeStr({date:t,time:e="3h"}={},i="[${from},${to}]"){let n={from:`${t=t||"now"}-${e}`,to:t};return Ti.S.renderBy(i,n)},rangeFrom({from:t,to:e}={},i="[${from},${to}]"){let n=[];t&&(n[0]=r.parse(t).getTime()),e&&(n[1]=r.parse(e).getTime()),0==n.length&&(n[1]=Date.now()),n[0]||(n[0]=n[1]-864e5),n[1]||(n[1]=n[0]+864e5);let[s,a]=n;n[0]=Math.min(s,a),n[1]=Math.max(s,a);let o={from:n[0],to:n[1]};return Ti.S.renderBy(i,o)},toBoolStr(t,e=6e4,i="No",n="Yes"){let s=0;t&&(s=r.parse(t).getTime());return Date.now()-s>e?i:n},timeText(t,{justNow:e=10,i18n:i=Ti.I18n.get("time")}={}){if(t=r.parse(t),!_.isDate(t))return null;let n=t.getTime(),s=Date.now()-n,a=s>0?"past-":"future-";s=Math.abs(s);let o=Math.round(s/6e4);if(o<e)return i[`${a}in-min`];if(o<60)return Ti.S.renderBy(i[`${a}in-hour`],{min:o});let l=Math.round(s/36e5);if(l<24)return Ti.S.renderBy(i[`${a}in-day`],{min:o,hour:l});let h=Math.round(l/24);if(h<7)return Ti.S.renderBy(i[`${a}in-week`],{min:o,hour:l,day:h});return t.getFullYear()==(new Date).getFullYear()?r.format(t,i["in-year"]):r.format(t,i["any-time"])}};return{DateTime:r}}(),{Types:Types}=function(){class TiMsRange{constructor(t){let e;if(t instanceof TiMsRange)return t.invalid&&(this.invalid=t.invalid),t.left&&(this.left=_.assign({},t.left)),void(t.right&&(this.right=_.assign({},t.right)));let i=[];if(_.isString(t)){i=/^([(\[])([^\]]+)([)\]])$/.exec(t);e=_.trim(i[2]).split(/[,:;~]/g)}else _.isArray(t)?e=t:(e=[],this.invalid=!0);let n={val:_.trim(_.first(e)),open:"("==i[1]},s={val:e.length>1?_.trim(_.last(e)):NaN,open:")"==i[3]};_.isString(n.val)&&n.val?n.val*=1:n.val=NaN,_.isString(s.val)&&s.val?s.val*=1:s.val=NaN,this.left=n,this.right=s}toString({format:t=(t=>t),separator:e=",",leftOpen:i="(",leftClose:n="[",rightOpen:s=")",rightClose:r="]"}={}){if(this.invalid)return"<!!!Invalid MsRange!!!>";let a=[];if(this.left){if(a.push(Ti.I18n.text(this.left.open?i:n)),!isNaN(this.left.val)){let e=t(this.left.val);a.push(e)}this.right&&e&&a.push(Ti.I18n.text(e))}if(this.right){if(!isNaN(this.right.val)){let e=t(this.right.val);a.push(e)}a.push(Ti.I18n.text(this.right.open?s:r))}return a.join("")}toDateString(t="yyyy-MM-dd",e=",",i="(",n="[",s=")",r="]"){let a=Ti.I18n.text(t);return this.toString({format:t=>TiTypes.formatDate(t,a),separator:e,leftOpen:i,leftClose:n,rightOpen:s,rightClose:r})}toDateTimeString(t="yyyy-MM-dd HH:mm:ss",e=",",i="(",n="[",s=")",r="]"){let a=Ti.I18n.text(t);return this.toString({format:t=>TiTypes.formatDateTime(t,a),separator:e,leftOpen:i,leftClose:n,rightOpen:s,rightClose:r})}}class TiTime{constructor(t,e){this.hours=0,this.minutes=0,this.seconds=0,this.milliseconds=0,this.__cached={},this.update(t,e)}clone(){return new TiTime(this)}setHours(t=0){this.__cached={},this.hours=_.clamp(t,0,23)}setMinutes(t=0){this.__cached={},this.minutes=_.clamp(t,0,59)}setSeconds(t=0){this.__cached={},this.seconds=_.clamp(t,0,59)}setMilliseconds(t=1){this.__cached={},this.milliseconds=_.clamp(t,0,999)}setTimes({hours:t,minutes:e,seconds:i,milliseconds:n}={}){this.__cached={},this.hours=_.clamp(Ti.Util.fallback(t,this.hours),0,23),this.minutes=_.clamp(Ti.Util.fallback(e,this.minutes),0,59),this.seconds=_.clamp(Ti.Util.fallback(i,this.seconds),0,59),this.milliseconds=_.clamp(Ti.Util.fallback(n,this.milliseconds),0,999)}update(t,e="ms"){if(this.__cached={},_.isDate(t))this.hours=t.getHours(),this.minutes=t.getMinutes(),this.seconds=t.getSeconds(),this.milliseconds=t.getMilliseconds();else if(t instanceof TiTime)this.hours=t.hours,this.minutes=t.minutes,this.seconds=t.seconds,this.milliseconds=t.milliseconds;else if(_.isNumber(t)){let i={ms:t=>Math.round(t),s:t=>Math.round(1e3*t),min:t=>Math.round(1e3*t*60),hr:t=>Math.round(1e3*t*60*60)}[e](t);i=_.clamp(i,0,864e5);let n=parseInt(i/1e3);this.milliseconds=i-1e3*n,this.hours=parseInt(n/3600),n-=3600*this.hours,this.minutes=parseInt(n/60),this.seconds=n-60*this.minutes}else if(_.isString(t)){let e=/^PT((\d+)H)?((\d+)M)?((\d+)S)?$/.exec(t);if(e)return this.hours=e[2]?1*e[2]:0,this.minutes=e[4]?1*e[4]:0,this.seconds=e[6]?1*e[6]:0,this.milliseconds=0,this;(e=/^([0-9]{1,2}):?([0-9]{1,2})(:?([0-9]{1,2})([.,]([0-9]{1,3}))?)?$/.exec(t))&&(e[3]?e[5]?(this.hours=_.clamp(parseInt(e[1]),0,23),this.minutes=_.clamp(parseInt(e[2]),0,59),this.seconds=_.clamp(parseInt(e[4]),0,59),this.milliseconds=_.clamp(parseInt(e[6]),0,999)):(this.hours=_.clamp(parseInt(e[1]),0,23),this.minutes=_.clamp(parseInt(e[2]),0,59),this.seconds=_.clamp(parseInt(e[4]),0,59),this.milliseconds=0):(this.hours=_.clamp(parseInt(e[1]),0,23),this.minutes=_.clamp(parseInt(e[2]),0,59),this.seconds=0,this.milliseconds=0))}return this}get value(){if(!_.isNumber(this.__cached.value)){let t=3600*this.hours+60*this.minutes+this.seconds+Math.round(this.milliseconds/1e3);this.__cached.value=t}return this.__cached.value}get valueInMilliseconds(){if(!_.isNumber(this.__cached.valueInMilliseconds)){let t=36e5*this.hours+6e4*this.minutes+1e3*this.seconds+this.milliseconds;this.__cached.valueInMilliseconds=t}return this.__cached.valueInMilliseconds}toString(t="auto"){"auto"==t?t=this.milliseconds>0?"HH:mm:ss.SSS":this.seconds>0?"HH:mm:ss":"HH:mm":"min"==t&&(t=this.hours<=0?"mm:ss":"HH:mm:ss");let e,i="",n=/a|HH?|KK?|hh?|kk?|mm?|ss?|S(SS)?/g,s=0;for(;e=n.exec(t);){let r=e.index;r>s&&(i+=t.substring(s,r)),s=n.lastIndex;i+={a:()=>this.value>43200?"PM":"AM",H:()=>this.hours,k:()=>this.hours+1,K:()=>this.hours%12,h:()=>this.hours%12+1,m:()=>this.minutes,s:()=>this.seconds,S:()=>this.milliseconds,HH:()=>_.padStart(this.hours,2,"0"),kk:()=>_.padStart(this.hours+1,2,"0"),KK:()=>_.padStart(this.hours%12,2,"0"),hh:()=>_.padStart(this.hours%12+1,2,"0"),mm:()=>_.padStart(this.minutes,2,"0"),ss:()=>_.padStart(this.seconds,2,"0"),SSS:()=>_.padStart(this.milliseconds,3,"0")}[e[0]]()}return s<t.length&&(i+=t.substring(s)),i}}const QUICK_COLOR_TABLE={red:[255,0,0,1],green:[0,255,0,1],blue:[0,0,255,1],yellow:[255,255,0,1],black:[0,0,0,1],white:[255,255,255,1]};class TiColor{constructor(t){this.red=0,this.green=0,this.blue=0,this.alpha=1,this.__cached={},this.update(t)}clone(){return new TiColor([this.red,this.green,this.blue,this.alpha])}setRGBA({r:t,g:e,b:i,a:n}={}){this.__cached={},_.isNumber(t)&&(this.red=_.clamp(t,0,255)),_.isNumber(e)&&(this.green=_.clamp(e,0,255)),_.isNumber(i)&&(this.blue=_.clamp(i,0,255)),_.isNumber(n)&&(this.alpha=_.clamp(n,0,1))}update(t){if(this.__cached={},_.isString(t)){let e=QUICK_COLOR_TABLE[t.toLowerCase()];if(e)this.red=e[0],this.green=e[1],this.blue=e[2],this.alpha=e[3];else{let e,i=t.replace(/[ \t\r\n]+/g,"").toUpperCase();(e=/^#?([0-9A-F])([0-9A-F])([0-9A-F]);?$/.exec(i))?(this.red=parseInt(e[1]+e[1],16),this.green=parseInt(e[2]+e[2],16),this.blue=parseInt(e[3]+e[3],16)):(e=/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2});?$/.exec(i))?(this.red=parseInt(e[1],16),this.green=parseInt(e[2],16),this.blue=parseInt(e[3],16)):(e=/^RGB\((\d+),(\d+),(\d+)\)$/.exec(i))?(this.red=parseInt(e[1],10),this.green=parseInt(e[2],10),this.blue=parseInt(e[3],10)):(e=/^RGBA\((\d+),(\d+),(\d+),([\d.]+)\)$/.exec(i))?(this.red=parseInt(e[1],10),this.green=parseInt(e[2],10),this.blue=parseInt(e[3],10),this.alpha=1*e[4]):(e=/^0[xX]([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2});?$/.exec(i))&&(this.alpha=parseInt(e[1],16)/255,this.red=parseInt(e[2],16),this.green=parseInt(e[3],16),this.blue=parseInt(e[4],16))}}else if(_.isNumber(t)){let e=_.clamp(Math.round(t),0,255);this.red=e,this.green=e,this.blue=e,this.alpha=1}else _.isArray(t)&&t.length>=3?(this.red=_.clamp(Math.round(t[0]),0,255),this.green=_.clamp(Math.round(t[1]),0,255),this.blue=_.clamp(Math.round(t[2]),0,255),this.alpha=t.length>3?t[3]:1):t instanceof TiColor&&(this.red=t.red,this.green=t.green,this.blue=t.blue,this.alpha=t.alpha);return this}get hex(){if(!this.__cached.hex){let t=["#"];t.push(_.padStart(this.red.toString(16).toUpperCase(),2,"0")),t.push(_.padStart(this.green.toString(16).toUpperCase(),2,"0")),t.push(_.padStart(this.blue.toString(16).toUpperCase(),2,"0")),this.__cached.hex=t.join("")}return this.__cached.hex}get rgb(){if(!this.__cached.rgb){let t=[this.red,this.green,this.blue];this.__cached.rgb=`RGB(${t.join(",")})`}return this.__cached.rgb}get rgba(){if(!this.__cached.rgba){return`RGBA(${[this.red,this.green,this.blue,this.alpha].join(",")})`}return this.__cached.rgba}light(t=10){this.red=_.clamp(this.red+t,0,255),this.green=_.clamp(this.green+t,0,255),this.blue=_.clamp(this.blue+t,0,255)}dark(t=10){this.red=_.clamp(this.red-t,0,255),this.green=_.clamp(this.green-t,0,255),this.blue=_.clamp(this.blue-t,0,255)}between(t,e=.5,{}={}){e=_.clamp(e,0,1);let i=t.red-this.red,n=t.green-this.green,s=t.blue-this.blue,r=t.alpha-this.alpha,a=this.red+i*e,o=this.green+n*e,l=this.blue+s*e,h=this.alpha+r*e;return new TiColor([_.clamp(Math.round(a),0,255),_.clamp(Math.round(o),0,255),_.clamp(Math.round(l),0,255),_.clamp(h,0,1)])}updateByHSL({h:t,s:e,l:i}={}){let n=this.toHSL();return _.isNumber(t)&&(n.h=_.clamp(t,0,1)),_.isNumber(e)&&(n.s=_.clamp(e,0,1)),_.isNumber(i)&&(n.l=_.clamp(i,0,1)),this.fromHSL(n)}adjustByHSL({h:t=0,s:e=0,l:i=0}={}){let n=this.toHSL();return n.h=_.clamp(n.h+t,0,1),n.s=_.clamp(n.s+e,0,1),n.l=_.clamp(n.l+i,0,1),this.fromHSL(n)}toHSL(){let t=this.red,e=this.green,i=this.blue;t/=255,e/=255,i/=255;let n,s,r=Math.max(t,e,i),a=Math.min(t,e,i),o=(r+a)/2;if(r===a)n=s=0;else{var l=r-a;switch(s=o>.5?l/(2-r-a):l/(r+a),r){case t:n=(e-i)/l+(e<i?6:0);break;case e:n=(i-t)/l+2;break;case i:n=(t-e)/l+4}n/=6}return{h:n,s:s,l:o}}fromHSL({h:t,s:e,l:i}={}){let n,s,r,a=function(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t};if(0===e)n=s=r=i;else{let o=i<.5?i*(1+e):i+e-i*e,l=2*i-o;n=a(l,o,t+1/3),s=a(l,o,t),r=a(l,o,t-1/3)}return this.red=Math.round(255*n),this.green=Math.round(255*s),this.blue=Math.round(255*r),this}toString(){return 1==this.alpha?this.hex:this.rgba}}const TiTypes={toStr(t,e,i){if(_.isFunction(e))return e(t)||i;if(Ti.Util.isNil(t))return Ti.Util.fallback(i,null);if(_.isNumber(t)){if(_.isArray(e))return Ti.Util.fallback(_.nth(e,t),t);if(_.isString(e))return Ti.S.renderVars(t,e);let i=""+t;return _.isPlainObject(e)?e[i]:i}if(_.isString(t))return _.isPlainObject(e)?Ti.Util.getOrPick(e,t):_.isString(e)?Ti.S.renderVars(t,e):t;if(_.isArray(t))return t.join(e||",");if(_.isBoolean(t))return(e||["false","true"])[1*t];if(_.isDate(t))return TiTypes.formatDateTime(t,e);if(t instanceof TiTime)return t.toString(e);if(t instanceof TiColor)return t.toString();if(_.isPlainObject(t)){if(!Ti.S.isBlank(e)){if(_.isString(e))return Ti.S.renderVars(t,e);_.isPlainObject(e)&&(t=Ti.Util.translate(t,e))}return JSON.stringify(t,null,e)}return""+t},toNumber(t){if(_.isBoolean(t))return t?1:0;if(_.isDate(t))return t.getTime();if(Ti.S.isBlank(t))return NaN;let e=1*t;return isNaN(e)?NaN:e},toInteger(t,{mode:e="int",dft:i=NaN,range:n=[],border:s=[!0,!0]}={}){if(_.isBoolean(t))return t?1:0;if(_.isDate(t))return t.getTime();let r={round:t=>Math.round(t),ceil:t=>Math.ceil(t),floor:t=>Math.floor(t),int:t=>parseInt(t)}[e](t);if(isNaN(r)&&(r=i),_.isArray(n)&&2==n.length){_.isArray(s)||(s=[s,s]);let[t,e]=s,[i,a]=n;if(isNaN(r))return Math.round((i+a)/2);if(!_.isNull(i)){if(t&&r<i)return i;if(!t&&r<=i)return i+1}if(!_.isNull(a)){if(e&&r>a)return a;if(!e&&r>=a)return a-1}}return r},toFloat(t,{precision:e=2,dft:i=NaN}={}){if(Ti.Util.isNil(t))return i;let n=1*t;if(isNaN(n))return i;if(e>=0){let t=Math.pow(10,e);return Math.round(n*t)/t}return n},toPercent:(t,{fixed:e=2,auto:i=!0}={})=>Ti.S.toPercent(t,{fixed:e,auto:i}),toBoolean:t=>0!=t&&(!_.isNull(t)&&!_.isUndefined(t)&&!/^(no|off|false)$/i.test(t)),toBoolStr:(t,e="No",i="Yes")=>t?i:e,toObject(t,e){let i=t;if(_.isPlainObject(t)&&_.isPlainObject(e))return Ti.Util.translate(i,e);if(_.isArray(t))return Ti.S.toObject(t,e);if(_.isString(t)){if(/^\{/.test(t)&&/\}$/.test(t)||/^\[/.test(t)&&/\]$/.test(t))try{return JSON.parse(t)}catch(e){return t}return Ti.S.toObject(t,e)}return i},toObjByPair(t={},{nameBy:e="name",valueBy:i="value",dft:n={}}={}){let s=t[e];if(!s)return n;let r=_.assign({},n),a=t[i],o=[];const l=function(t,e){_.isUndefined(e)?o.push(t):t.startsWith(".")?r[t]=e:_.set(r,t,e)};if(_.isString(s))".."==s?_.assign(r,a):l(s,a);else if(_.isArray(s))for(let t of s){l(t,_.get(a,t))}return o.length>0&&(r=_.omit(r,o)),r},toArray(t,{sep:e=/[ ,;\/、，；\r\n]+/}={}){if(Ti.Util.isNil(t))return t;if(_.isArray(t))return t;if(_.isString(t)){if(_.isRegExp(e)){let i=t.split(e);for(let t=0;t<i.length;t++)i[t]=_.trim(i[t]);return _.without(i,void 0,null,"")}return[t]}return[t]},toDate(t,e=null){if(_.isNull(t)||_.isUndefined(t))return e;if(_.isArray(t)){let e=[];return _.forEach(t,t=>{e.push(Ti.DateTime.parse(t))}),e}return Ti.DateTime.parse(t)},toDateSec(t,e=null){if(_.isNull(t)||_.isUndefined(t))return e;if(_.isArray(t)){let e=[];return _.forEach(t,t=>{_.isNumber(t)&&(t*=1e3),e.push(Ti.DateTime.parse(t))}),e}return _.isNumber(t)&&(t*=1e3),Ti.DateTime.parse(t)},toTime:(t,{dft:e,unit:i}={})=>_.isNull(t)||_.isUndefined(t)?e:new TiTime(t,i),toMsRange:t=>_.isNull(t)||_.isUndefined(t)?null:new TiMsRange(t),toColor:(t,e=new TiColor)=>_.isNull(t)||_.isUndefined(t)?e:t instanceof TiColor?t:new TiColor(t),toAMS(t){let e=Ti.DateTime.parse(t);return _.isDate(e)?e.getTime():null},toSec(t){let e=TiTypes.toDateSec(t);return _.isDate(e)?Math.round(e.getTime()/1e3):null},toJson:(t,e="  ")=>JSON.stringify(t,null,e),toFilter(t={},e={}){let i={},{keyword:n,match:s,majorKey:r,majorValue:a}=t||{},o=e.keyword||{"=id":"^[\\d\\w]{26}(:.+)?$","=nm":"^[\\d\\w_.-]{3,}$",title:"^.+"};if(n){let t="title",e=_.keys(o);for(let i of e){let e=o[i];if(new RegExp(e).test(n)){t=i;break}}t.startsWith("=")?i[t.substring(1).trim()]=n:i[t]="^.*"+n}return _.isEmpty(s)||_.assign(i,s),r&&!Ti.Util.isNil(a)&&_.set(i,r,a),i},safeParseJson(str,dft){if(Ti.Util.isNil(str))return null;if(!_.isString(str))return str;try{return JSON.parse(str)}catch(E){let json=_.trim(str.replace(/(function|=>)/g,"Function"));if(/^\{.+\}$/.test(json)||/^\[.+\]$/.test(json))try{return eval("("+json+")")}catch(t){}}return dft},formatTime(t,e="ms",i="auto"){if(_.isUndefined(t)||_.isNull(t))return"";if(_.isArray(t)){let e=[];for(let n of t)e.push(TiTypes.formatTime(n,i));return e}return t instanceof TiTime||(t=new TiTime(t,e)),t.toString(i)},formatDate(t,e="yyyy-MM-dd"){if(t)return Ti.DateTime.format(t,e)},formatDateTime(t,e="yyyy-MM-dd HH:mm:ss"){if(t)return Ti.DateTime.format(t,e)},getDateFormatValue(t,e="yyyy-MM-dd"){if(t)return Ti.DateTime.format(t,e)},toAjaxReturn(t,e){let i=t;if(_.isString(t))try{i=JSON.parse(t)}catch(t){return{ok:!1,errCode:"e.invalid.json_format",data:e}}return _.isBoolean(i.ok)?i:{ok:!0,data:i}},Time:TiTime,Color:TiColor,getFuncByType:(t="String",e="transformer")=>_.get({String:{transformer:"toStr",serializer:"toStr"},Number:{transformer:"toNumber",serializer:"toNumber"},Integer:{transformer:"toInteger",serializer:"toInteger"},Float:{transformer:"toFloat",serializer:"toFloat"},Boolean:{transformer:"toBoolean",serializer:"toBoolean"},Object:{transformer:"toObject",serializer:"toObject"},Array:{transformer:"toArray",serializer:"toArray"},DateTime:{transformer:"toDate",serializer:"formatDateTime"},AMS:{transformer:"toDate",serializer:"toAMS"},ASEC:{transformer:"toDateSec",serializer:"toSec"},Time:{transformer:"toTime",serializer:"formatTime"},Date:{transformer:"toDate",serializer:"formatDate"},Color:{transformer:"toColor",serializer:"toStr"}},`${t}.${e}`),getFuncBy(t={},e,i=TiTypes){let n=TiTypes.evalFunc(t[e],i);if(_.isFunction(n))return n;if(!n&&t.type&&(n=TiTypes.getFuncByType(t.type,e)),_.isString(n))return _.get(i,n);if(_.isPlainObject(n)&&n.name){let t=_.get(i,n.name);if(!_.isFunction(t))return;return _.isArray(n.args)&&n.args.length>0?_.partialRight(t,...n.args):_.isUndefined(n.args)||_.isNull(n.args)?t:_.partialRight(t,n.args)}},getFunc:(t={},e)=>TiTypes.getFuncBy(t,e),evalFunc(t,e=TiTypes){if(_.isFunction(t))return t;if(_.isString(t))return _.get(e,t);if(_.isPlainObject(t)&&t.name){let i=_.get(e,t.name);if(!_.isFunction(i))return;return _.isArray(t.args)&&t.args.length>0?_.partialRight(i,...t.args):_.isUndefined(t.args)||_.isNull(t.args)?i:_.partialRight(i,t.args)}},getJsType:(t,e="Object")=>_.isUndefined(t)?e:_.isNull(t)?"Object":_.isNaN(t)?"Number":_.isNumber(t)?parseInt(t)==t?"Integer":"Number":_.isBoolean(t)?"Boolean":_.isString(t)?"String":_.isArray(t)?"Array":"Object",parseTowStageID(t,e=":"){if(!_.isString(t))return{};let i=t.indexOf(e);return i<0?{homeId:null,myId:_.trim(t)}:{homeId:_.trim(t.substring(0,i)),myId:_.trim(t.substring(i+1))}},getFormFieldVisibility({hidden:t,visible:e,disabled:i,enabled:n}={},s={}){let r=!1;const a=function(t){if(_.isArray(t)){let e=[];for(let i of t)_.isString(i)?e.push({[i]:t=>!!t}):e.push(i);return e}return t};if(!Ti.Util.isNil(t)){let e=a(t);r=Ti.AutoMatch.test(e,s)}if(!Ti.Util.isNil(e)){let t=a(e);_.isArray(t)&&_.isEmpty(t)||(r=!Ti.AutoMatch.test(t,s))}let o=!1;if(!Ti.Util.isNil(i)){let t=a(i);o=Ti.AutoMatch.test(t,s)}if(!Ti.Util.isNil(n)){let t=a(n);_.isArray(t)&&_.isEmpty(t)||(o=!Ti.AutoMatch.test(t,s))}return{hidden:r,visible:!r,disabled:o,enabled:!o}},assertDataByForm(t={},e=[]){if(!_.isEmpty(e))for(let i of e){if(!i.required)continue;let{hidden:e,disabled:n}=Ti.Types.getFormFieldVisibility(i,t);if(e||n)continue;let s=_.get(t,i.name);if(Ti.Util.isNil(s))throw Ti.Err.make("e.form.fldInNil",i)}}};return{TiMsRange:TiMsRange,TiTime:TiTime,TiColor:TiColor,Types:TiTypes}}(),{Util:Util}=function(){const t={...function(){const t={getLinkName(e){let i=e.lastIndexOf("/"),n=e.lastIndexOf(":"),s=Math.max(i,n),r=s>=0?e.substring(s+1):e;return t.getMajorName(r)},getFileName(t,e=""){if(!t)return e;for(;t.endsWith("/");)t=t.substring(0,t.length-1);let i=t.lastIndexOf("/");return i>=0?t.substring(i+1):t},getMajorName(t,e=""){if(!t)return e;for(;t.endsWith("/");)t=t.substring(0,t.length-1);for(var i=t.length,n=0,s=i,r=s-1;r>0;r--)if(s==i&&"."==t[r]&&(s=r),"/"==t[r]||"\\"==t[r]){n=r+1;break}return t.substring(n,s)},getSuffixName(t,e){if(!t)return"";var i=t.lastIndexOf("."),n=t.lastIndexOf("/");if(-1==i||i<n)return"";var s=t.substring(i+1);return e?s.toLowerCase():s},getSuffix(t,e){if(!t)return"";var i=t.lastIndexOf("."),n=t.lastIndexOf("/");if(-1==i||i<n)return"";var s=t.substring(i);return e?s.toLowerCase():s},splitPathToFullAncestorList(t){if(!t)return[];let e=[],i=0,n=0;for(;(n=t.indexOf("/",n))>1;)e.push(t.substring(0,n)),i=++n;return i<t.length&&e.push(t),e},appendPath(...t){let e=[];for(let i of t){if(_.isEmpty(i))continue;let t=/\/*$/.exec(i);t&&(i=i.substring(0,t.index)),e.length>0&&!/^\//.test(i)&&e.push("/"),e.push(i)}return e.join("")},getParentPath(t=""){if(!t)return t;for(;t.endsWith("/");)t=t.substring(0,t.length-1);let e=t.lastIndexOf("/");return e<0?"":t.substring(0,e+1)},getRelativePath(t="",e="",i="."){if(_.isEqual(t,e))return i;let n=t.endsWith("/"),s=e.endsWith("/"),r=_.without(t.split("/"),""),a=_.without(e.split("/"),""),o=Math.min(r.length,a.length),l=0;for(;l<o;l++){if(r[l]!=a[l])break}let h=[],c=r.length;n||c--;for(let t=l;t<c;t++)h.push("..");for(let t=l;t<a.length;t++)h.push(a[t]);return s&&h.push(""),h.join("/")},explainEventName(t){let e={},i=/^(([^>]+)>)?(.+)$/.exec(t);return i&&(e.block=_.trim(i[2]),e.event=_.trim(i[3])),e},parseHref(t=""){let e=/^((https?):)?((\/\/([^/:]+))(:(\d+))?)?([^?#]*)(\?([^#]*))?(#(.*))?$/.exec(t);if(e){let i={href:t,protocol:e[2],host:e[5],port:1*(e[7]||80),path:e[8],search:e[9],query:e[10],hash:e[11],anchor:e[12],toUrlPath(){let t=[];return this.protocol&&t.push(`:${this.protocol}`),this.host&&t.push(`//${this.host}`),this.port>80&&t.push(`:${this.port}`),this.path&&t.push(this.path),t.join("")},toString(){let t=this.toUrlPath();if(!_.isEmpty(this.params)){let e=[];_.forEach(this.params,(t,i)=>{e.push(`${i}=${t}`)}),t+="?"+e.join("&")}return this.hash&&(t+=this.hash),t}};if(i.query){let t={},e=i.query.split("&");for(let i of e){let e=i.indexOf("=");if(e>0){let n=i.substring(0,e),s=i.substring(e+1);t[n]=decodeURIComponent(s)}else t[i]=!0}i.params=t}return i}return{path:t}},parseAnchorFilter:t=>t?Ti.Util.AnchorFilter(t):null};return t}(),...function(){class t{constructor(t){this.set(t)}set(t=""){this.__S=null,this.keyword=null,this.match={},this.sort={};let e=t.split(/;/g);for(let t of e){let e=t.indexOf("=");if(e<=0)continue;let i=_.trim(t.substring(0,e))||"",n=_.trim(t.substring(e+1))||"";if("k"==i)this.keyword=n;else if("s"==i){let t=n.split(/,/);for(let e of t){let t=e.indexOf(":");if(t>0){let i=_.trim(e.substring(0,t)),n=parseInt(e.substring(t+1));this.sort[i]=n}else this.sort[e]=1}}else this.match[i]=n}}}class e{constructor({url:t,params:e,anchor:i,ignoreNil:n}={}){this.set({url:t,params:e,anchor:i,ignoreNil:n})}set({url:t="",params:e={},anchor:i,ignoreNil:n=!1}={}){return this.url=t,this.params=e,this.anchor=i,this.ignoreNil=n,this.__S=null,this}valueOf(){return this.toString()}toString(){if(!this.__S){let t=[this.url],e=[];_.forEach(this.params,(t,i)=>{this.ignoreNil&&Ti.Util.isNil(t)||e.push(`${i}=${t}`)}),e.length>0&&t.push(e.join("&"));let i=t.join("?");this.anchor&&(/^#/.test(this.anchor)?i+=this.anchor:i+="#"+this.anchor),this.__S=i}return this.__S}}return{Link:({url:t,params:i,anchor:n,ignoreNil:s}={})=>new e({url:t,params:i,anchor:n,ignoreNil:s}),AnchorFilter:e=>new t(e)}}(),...function(){const t={genTableFieldsByForm2:(e=[],i="yy-MM-dd")=>t.genTableFieldsByForm(e,{isCan:t=>!!t.candidateInTable,dataFormat:i}),genTableFieldsByForm(t=[],{isCan:e=(()=>!1),isIgnore:i=(()=>!1),dataFormat:n="yy-MM-dd",iteratee:s=(t=>t)}={}){const r=function(t,r=[]){if(_.isEmpty(t)||i(t))return;let{title:a,name:o,type:l,comType:h,comConf:c={}}=t,{options:u}=c;if(!o||!_.isString(o)||!a)return;let d={title:a,candidate:e(t)};/^#/.test(u)?d.display=`${u}(${o})`:"TiInputDate"==h||/^(AMS|Date(Time)?)$/.test(l)?d=Ti.Util.genTableTimeField(a,o,{can:e(t),format:n}):d.display="TiInputTags"==h?{key:o,comType:"TiTags",comConf:{className:"is-nowrap"}}:"Array"==l?{key:o,comType:"TiLabel",comConf:{className:"is-nowrap",format:t=>_.isArray(t)?t.join(", "):t}}:o,(d=s(d,o))&&r.push(d)};let a=[];for(let e of t)if(_.isArray(e.fields))for(let t of e.fields)r(t,a);else r(e,a);return a},genTableTimeField:(t,e,{can:i=!0,format:n="yy-MM-dd",className:s="is-nowrap"}={})=>({title:t,candidate:i,display:{key:e,transformer:`Ti.Types.formatDate('${n}')`,comConf:{className:s}}}),pickFormData(t=[],e={},i=(()=>!0)){let n=[];const s=function(t){if(t)if(_.isArray(t.fields))for(let e of t.fields)s(e);else{let{hidden:i}=Ti.Types.getFormFieldVisibility(t,e);if(i)return;n.push(t)}};for(let e of t)s(e);let r={};for(let t of n){let{name:n}=t,s=_.concat(n);for(let t of s){let n=_.get(e,t);i(t,n)&&(Ti.Util.isNil(n)||_.set(r,t,n))}}return r},getFormVisibleFields(t=[],e={}){let i=[];const n=function(t){if(t)if(_.isArray(t.fields))for(let e of t.fields)n(e);else{let{hidden:n}=Ti.Types.getFormFieldVisibility(t,e);if(n)return;i.push(t)}};for(let e of t)n(e);return i},checkFormRequiredFields(t=[],e={}){let i=[];const n=function(t){if(t)if(_.isArray(t.fields)){let{hidden:i}=Ti.Types.getFormFieldVisibility(t,e);if(i)return;for(let e of t.fields)n(e)}else if(t.required){if(!_.isBoolean(t.required)&&!Ti.AutoMatch.test(t.required,e))return;let{hidden:n}=Ti.Types.getFormFieldVisibility(t,e);if(n)return;i.push(t)}};for(let e of t)n(e);for(let t of i){let{name:i,title:n,tip:s}=t,r=_.concat(i);for(let t of r){let i=_.get(e,t);if(Ti.Util.isNil(i)||_.isString(i)&&_.isEmpty(i))return Ti.I18n.getf("e-form-incomplete",{title:n,name:t,tip:s})}}}};return t}(),toStdComType:t=>_.upperFirst(_.camelCase(t)),merge:(e={},...i)=>t.mergeWith(void 0,e,...i),mergeWith(e=_.identity,i={},...n){const s=_.flattenDeep(n);for(let n of s){if(!n)continue;let s=e(n);_.isArray(s)?t.merge(i,...s):_.isFunction(s)?i[s.name]=s:_.isPlainObject(s)&&_.merge(i,s)}return i},deepMergeObj:(t={},...e)=>_.mergeWith(t,...e,(t,e)=>{if(_.isArray(t)||_.isArray(e))return e}),pushEle(t={},e,...i){if(!i||0==i.length)return;let n=t[e];if(_.isArray(n))for(let t=0;t<i.length;t++)n.push(i[t]);else if(n){n=[n];for(let t=0;t<i.length;t++)n.push(i[t])}else n=i;return t[e]=n,t},grouping(t=[],e,{titles:i=[],otherTitle:n={value:"Others",text:"Others"},asList:s=!1}={}){let r={},a=[];_.forEach(i,t=>{t.text&&!Ti.Util.isNil(t.value)&&(a[t.value]=t)});let o=[];return _.forEach(t,t=>{let i=_.get(t,e);if(i){let e=a[i]||{text:i,value:i},n=r[i];n||(n={...e,list:[]},r[i]=n),n.list.push(t)}else o.push(t)}),_.isEmpty(o)||(r[n.value]={...n,list:o}),s?_.values(r):r},insertToArray(t=[],e=-1,...i){if(!_.isArray(t)||_.isEmpty(i))return-1;if(_.isEmpty(t))return t.push(...i),0;let n=Ti.Num.scrollIndex(e,t.length+1);return t.length==n?t.push(...i):t.splice(n,0,...i),n},findNextItemBy(t=[],e=(()=>!1)){let i=-1,n=null;if(!_.isArray(t)||_.isEmpty(t))return{index:i,item:n};i=0,n=t[0];let s=!1;for(let r=0;r<t.length;r++){let a=t[r];if(e(a,r,t))s=!0;else if(i=r,n=a,s)break}return s?{index:i,item:n}:{index:0,item:t[0]}},moveInArray(t=[],e,i){if(e==i||e<0||i<0||e>=t.length||i>=t.length)return;let n=t[e];return t.splice(e,1),t.splice(i,0,n),t},moveArrayElementBy(t=[],e,i="prev"){if(!_.isFunction(e))return[...t];if(!/^(head|tail|prev|next)$/.test(i))throw`moveArrayElementBy() : direction must be 'head|tail|prev|next', but you give me ${i}`;let n={firstAt:-1,lastAt:-1,items:[]},s=[];if(_.forEach(t,(i,r)=>{e(i,r,t)?(n.firstAt<0&&(n.firstAt=r),n.lastAt=Math.max(n.lastAt,r),n.items.push(i)):s.push({index:r,item:i})}),_.isEmpty(n.items))return remain;let r=[],a={head:()=>0,tail:()=>t.length,prev:()=>Math.max(0,n.firstAt-1),next:()=>Math.min(t.length,n.lastAt+2)}[i](),o=0;for(;o<s.length;o++){let{index:t,item:e}=s[o];if(t>=a)break;r.push(e)}for(r.push(...n.items);o<s.length;o++){let{item:t}=s[o];r.push(t)}return r},RemoveStateDataItems(t,e=[],i="data",n="list",s="pager"){let r;r=".."==i?t[n]:_.get(t,`${i}.${n}`),_.isArray(e)||(e=[e]);let a={};if(_.forEach(e,t=>{_.isString(t)?a[t]=!0:t.id&&(a[t.id]=!0)}),_.isArray(r)&&!_.isEmpty(a)){let e=[];if(_.forEach(r,t=>{a[t.id]||e.push(t)}),".."==i)t[n]=e;else{let r=t[i][s];t[i]={[n]:e,[s]:r}}}},MergeStateDataItem(t,e,i="data",n="list",s="pager",r="currentId"){let a;a=".."==i?t[n]:_.get(t,`${i}.${n}`);let o=t[r],l=!1,h=[];if(_.isArray(a))for(let t of a)o==t.id?(h.push(_.assign({},t,e)),l=!0):h.push(t);if(l)if(".."==i)t[n]=h;else{let e=t[i][s];t[i]={[n]:h,[s]:e}}},UpsertStateDataItemAt(e,i,n=1,s="data",r="list",a="pager"){if(_.isEmpty(i)||!i||!i.id)return;if(_.isArray(i)){for(let s of i)t.UpsertStateDataItemAt(e,s,n);return}let o;o=".."==s?e[r]:_.get(e,`${s}.${r}`);let l;if(_.isArray(o)){o=_.cloneDeep(o),l=[];let t=!1;for(let e of o)t||e.id!=i.id&&e.nm!=i.nm?l.push(e):(l.push(i),t=!0);t||(n>0?l.push(i):n<0&&(l=_.concat(i,o)))}else l=[i];if(".."==s)e[r]=l;else{let t=e[s][a];e[s]={[r]:l,[a]:t}}},appendToObject(t={},e=null,i={}){let n={};return Ti.Util.isNil(e)?_.assign(n,t,i):_.forEach(t,(t,s)=>{n[s]=t,e==s&&_.assign(n,i)}),n},walk(t={},{root:e=_.identity,all:i=_.identity,leaf:n=_.identity,node:s=_.identity}={}){const r=(t,a=[])=>{let o=_.isArray(t),l=_.isPlainObject(t);if(i(t,a),o||l?_.isEmpty(a)?e(t,a):s(t,a):n(t,a),o)for(let e=0;e<t.length;e++){let i=t[e],n=a.concat(e);r(i,n)}else if(l){let e=_.keys(t);for(let i of e){let e=t[i],n=a.concat(i);r(e,n)}}};r(t)},inset(t=[],e=_.identity){let i=[];for(let n of t){let t=e(n);if(_.isArray(t)&&!_.isEmpty(t))for(let e of t)i.push(e);_.isUndefined(t)||i.push(t)}return i},selectValue(e,i=[],n={}){if(t.fallback(n.autoParse,!0)&&_.isString(i))try{let s=JSON.parse(i);return t.selectValue(e,s,n)}catch(t){}let{explain:s=!1,by:r=(([t,e],i)=>{if(!e||Ti.AutoMatch.test(e,i))return t})}=n;if(!_.isArray(i))return s?t.explainObj(e,i):i;for(let n of i){if(!_.isArray(n))return n;let i=r(n,e);if(!_.isUndefined(i))return s?t.explainObj(e,i):i}},explainObj(t={},e,{evalFunc:i=!1,iteratee:n=_.identity}={}){const s=e=>{if(Ti.Util.isNil(e))return e;let r=e;if(_.isString(r)){let e=/^:(:*(=|==|!=|=>>?|->)(.*))$/.exec(r);if(e)return n(e[1]);let i,a,o;if(e=/^(==?>>?\??|->)(.*)$/.exec(r))i=e[1],a=_.trim(e[2]);else if(e=/^(==?|!=)([^?]+)(\?(.*))?$/.exec(r))if(i=e[1],a=_.trim(e[2]),o=e[4],/^=/.test(o)){let t=s(o);o=Ti.S.toJsValue(t)}else"=="==i?(o=Ti.S.toJsValue(o),o=!!o):"!="==i?(o=Ti.S.toJsValue(o),o=!o):o&&(o=_.trim(o));if(i){let e={"==>":e=>{let i=_.get(window,e);return _.isFunction(i)?i:Ti.Util.genInvoking(e,{context:t,partial:"left"})},"==>?":e=>{let i=_.get(window,e);return _.isFunction(i)?i:Ti.Util.genInvoking(e,{context:t,partial:"left?"})},"==>>":e=>Ti.Util.genInvoking(e,{context:t,partial:"right"}),"==>>?":e=>Ti.Util.genInvoking(e,{context:t,partial:"right?"}),"==":e=>{let i=_.get(t,e);return Ti.Util.isNil(i)?Ti.Util.fallbackNil(o,!1):!!i},"!=":e=>{let i=_.get(t,e);return Ti.Util.isNil(i)?Ti.Util.fallback(o,!0):!i},"=":(e,i)=>{if(".."==e)return t;let n=Ti.Util.getOrPick(t,e);return Ti.Util.isBlank(n)&&!_.isUndefined(i)?i:n},"=>>":e=>{return Ti.Util.genInvoking(e,{context:t,partial:"right"})()},"=>>?":e=>{return Ti.Util.genInvoking(e,{context:t,partial:"right?"})()},"=>":e=>{return Ti.Util.genInvoking(e,{context:t,partial:"left"})()},"=>?":e=>{return Ti.Util.genInvoking(e,{context:t,partial:"left?"})()},"->":e=>{let i=/^(([\w\d_.]+)\?\?)?(.+)$/.exec(e),n=i[2],s=i[3];if(!n||!Ti.Util.isNil(_.get(t,n)))return Ti.S.renderBy(s,t)}}[i];if(_.isFunction(e))return e(a,o);throw"invalid dynamic value: "+r}return n(r)}if(_.isFunction(r)){if(i){let e=r(t);return n(e)}return r}if(_.isArray(r)){let t=[];for(let e of r){let i=s(e);t.push(n(i))}return t}if(r.__invoke&&r.name){let{name:e,args:i,partial:n}=r;i=Ti.Util.explainObj(t,i);let s=Ti.Util.genInvoking({name:e,args:i},{context:t,partial:n});if(_.isFunction(s))return s()}else if(r.__function&&r.name){let{name:e,args:i,partial:n}=r;i=Ti.Util.explainObj(t,i);let s=Ti.Util.genInvoking({name:e,args:i},{context:t,partial:n});if(_.isFunction(s))return s}else if(_.isPlainObject(r)){let t={};return _.forEach(r,(e,i)=>{let r=s(e),a=n(r);"..."==i?_.isPlainObject(a)?_.assign(t,a):t[i]=a:/^\.{3,}$/.test(i)?t[i.substring(1)]=a:t[i]=a}),t}return n(e)};return s(e)},explainObjs(e=[],i={},n){if(_.isArray(e)){let s=[];for(let r of e){let e=t.explainObj(r,i,n);s.push(e)}return s}return t.explainObj(e,i,n)},genObj:(t={})=>_.partial(_.cloneDeep,t),groupCall(...t){const e=_.flattenDeep(t).filter(t=>_.isFunction(t));if(0!=e.length)return 1==e.length?e[0]:function(...t){for(let i of e)i.apply(this,t)}},pushValue(t,e,i,n=!1){let s=_.get(t,e)||[];n?t[e]=_.concat(s,i||[]):_.set(t,e,_.concat(s,i||[]))},pushValueBefore(t,e,i,n=!1){let s=_.get(t,e)||[];n?t[e]=_.concat(i||[],s):_.set(t,e,_.concat(i||[],s))},pushUniqValue(t,e,i,n=!1){let s=_.get(t,e)||[];n?t[e]=_.uniq(_.concat(s,i||[])):_.set(t,e,_.uniq(_.concat(s,i||[])))},pushUniqValueBefore(t,e,i,n=!1){let s=_.get(t,e)||[];n?t[e]=_.uniq(_.concat(i||[],s)):_.set(t,e,_.uniq(_.concat(i||[],s)))},setTo(t={},e,i,n){_.isString(e)&&!_.isUndefined(i)?t[e]=_.isNull(i)?n:i:_.isPlainObject(e)&&(n=i,_.forOwn(e,(e,i)=>{_.isUndefined(e)||(t[i]=_.isNull(e)?n:e)}))},nth(t=[],e=0,i=null){let n=t.length;if(n<=0)return i;return t[Ti.Num.scrollIndex(e,n)]},anyKey(e,i,n="-"){if(t.isNil(e))return e;let s=[];return i&&s.push(i),_.isArray(e)||_.isPlainObject(e)?(_.forEach(e,t=>s.push(t)),s.join("-")):(s.push(e),s.join(n))},reverMapping(t={}){let e={};return _.forEach(t,(t,i)=>{e[t]=i}),e},translate(e={},i={},n=_.identity){if(_.isEmpty(i))return _.cloneDeep(e);if(_.isArray(e)){let s=[];for(let r=0;r<e.length;r++){let a=e[r],o=t.translate(a,i,n);s.push(o)}return s}if(_.isString(i)){let t=i.split(/[:;]/g),e={};for(let i of t){i=_.trim(i);let t=/^([^=]+)=(.+)$/.exec(i);t&&(e[t[1]]=t[2])}i=e}if(_.isString(e))return _.get(i,e);let s={};return _.forEach(i,(i,r)=>{let a;a=".."==i?e:t.getOrPick(e,i),a=n(a),_.set(s,r,a)}),s},pureCloneDeep(e){if(_.isArray(e)){let i=[];return _.forEach(e,(e,n)=>{_.isUndefined(e)||_.isFunction(e)||(i[n]=t.pureCloneDeep(e))}),i}if(_.isPlainObject(e)){let i={};return _.forEach(e,(e,n)=>{_.isUndefined(e)||_.isFunction(e)||(i[n]=t.pureCloneDeep(e))}),i}return _.cloneDeep(e)},setKey(t={},e,i){const n=function(t,e=[],i=0,s){if(i>=e.length)return t;if(_.isArray(t)){let r=[],a=parseInt(e[i]);for(let o=0;o<t.length;o++)if(o==a){let a=n(t[o],e,i+1,s);r.push(a)}else r.push(t[o]);return r}if(_.isPlainObject(t)){let r={},a=_.keys(t);if(e.length==i+1){let n=e[i];for(let e of a){let i=t[e];n==e?r[s]=i:r[e]=i}}else for(let o of a){let a=t[o],l=n(a,e,i+1,s);r[o]=l}return r}return t};return _.isString(e)&&(e=e.split(".")),n(t,e,0,i)},getValue(e,...i){if(_.isArray(e)){let n=[];for(let s of e){let e=t.getValue(s,i);n.push(e)}return n}for(let t of i){let i=_.get(e,t);if(!_.isUndefined(i)&&!_.isNull(i))return i}},getValueAs(e,i,...n){if(_.isArray(i)){let s=[];for(let r of i){let i=t.getValueAs(e,r,n);s.push(i)}return s}for(let t of n){let n=_.get(i,t);if(!_.isUndefined(n)&&!_.isNull(n))return Ti.S.renderBy(e,{val:n})}return e},getOrPick(t,e,i){if(_.isArray(e))return Ti.Util.fallback(_.pick(t,e),i);if(_.isFunction(e))return Ti.Util.fallback(e(t),i);if(_.isString(e)){let n=e.split("|");if(n.length>1)return Ti.Util.fallback(Ti.Util.getFallbackNil(t,n),i)}return Ti.Util.fallback(_.get(t,e),i)},getOrPickNoBlank(t,e,i){if(_.isArray(e))return Ti.Util.fallback(_.pick(t,e),i);if(_.isFunction(e))return Ti.Util.fallback(e(t),i);if(_.isString(e)){let n=e.split("|");if(n.length>1)return Ti.Util.fallback(Ti.Util.getFallbackBlank(t,n),i)}return Ti.Util.fallback(_.get(t,e),i)},getTruthyKeyInArray:e=>_.isArray(e)?_.isEmpty(e)?[]:_.concat([],e):t.truthyKeys(e),getTruthyKeyInMap(e){let i={};if(_.isArray(e))for(let n of e)t.isNil(n)||(i[n]=!0);else _.isEmpty(e)||_.forEach(e,(t,e)=>{t&&(i[e]=!0)});return i},truthyKeys(t={}){let e=[];return _.forEach(t,(t,i)=>{t&&e.push(i)}),e},joinTruthyKeys:(e={},i=",")=>t.truthyKeys(e).join(i),getFallback(t,...e){let i=_.flattenDeep(e);for(let e of i)if(e){let i=_.get(t,e);if(!_.isUndefined(i))return i}},getFallbackNil(e,...i){let n=_.flattenDeep(i);for(let i of n)if(i){let n=_.get(e,i);if(!t.isNil(n))return n}},getFallbackEmpty(t,...e){let i=_.flattenDeep(e);for(let e of i)if(e){let i=_.get(t,e);if(!_.isEmpty(i))return i}},getFallbackBlank(t,...e){let i=_.flattenDeep(e);for(let e of i)if(e){let i=_.get(t,e);if(!Ti.Util.isBlank(i))return i}},getFallbackNaN(t,...e){let i=_.flattenDeep(e);for(let e of i)if(e){let i=_.get(t,e);if(!isNaN(i))return i}},fallback(...t){for(let e of t)if(!_.isUndefined(e))return e},fallbackNil(...e){for(let i of e)if(!t.isNil(i))return i},trueGet:(t=!1,e,i)=>_.isBoolean(t)?t?e:i:t,fallbackEmpty(...t){for(let e of t)if(!_.isEmpty(e))return e},fallbackBlank(...t){for(let e of t)if(!Ti.S.isBlank(e))return e},fallbackNaN(...t){for(let e of t)if(!isNaN(e))return e},notEmpty:t=>!_.isEmpty(t),notNil:e=>!t.isNil(e),notEmptyOf(t,e){let i=_.get(t,e);return!_.isEmpty(i)},notNilOf(e,i){let n=_.get(e,i);return!t.isNil(n)},isEqual:(t,e)=>_.isEqual(t,e),notEqual:(t,e)=>!_.isEqual(t,e),notEquals(t,...e){for(let i=0;i<e.length;i++)if(_.isEqual(t,e[i]))return!1;return!0},isNil:t=>_.isUndefined(t)||_.isNull(t),isBlank:t=>_.isUndefined(t)||_.isNull(t)||""===t||/^[ \t]*$/.test(t),notBlank:e=>!t.isBlank(e),geset:(t={},e,i)=>_.isPlainObject(e)?(_.assign(t,e),t):_.isArray(e)?_.pick(t,e):_.isUndefined(i)?_.isUndefined(e)?t:t[e]:(t[e]=i,t),async invoke(t={},e,i=[],n=this){let s=_.get(t,e);if(_.isFunction(s)){let t=_.concat(i);await s.apply(n,t)}},first:(t=[])=>_.isArray(t)?_.first(t):t,last:(t=[])=>_.isArray(t)?_.last(t):t,genGetter(e,{indexPrefix:i,dftKeys:n=[],context:s={},funcSet:r=window,dftValue:a,notNil:o=!1,partial:l="right"}={}){if(_.isFunction(e))return t=>e(t);if(e){if(i)return(t,n)=>Ti.Util.fallbackNil(Ti.Types.toStr(_.get(t,e)),`${i}${n}`);let n=/^'(.+)'$/.exec(e);if(n)return()=>n[1];if(n=/^=>(.+)$/.exec(e)){let e=n[1];return t.genInvoking(e,{context:s,funcSet:r,partial:l})}return t=>Ti.Util.getOrPick(t,e)}return _.isEmpty(n)?!_.isUndefined(a)||o?t=>a:void 0:t=>Ti.Util.getFallback(t,...n)},genGetterNotNil:(t,e)=>Ti.Util.genGetter(t,_.assign({},e,{notNil:!0})),parseInvoking(t){let e,i,n;if(_.isObject(t)&&t.name)e=t.name,i=[],_.isUndefined(t.args)||(i=_.concat(t.args),n=t.partial);else{let n=/^([^()]+)(\((.+)\))?$/.exec(t);n&&(e=_.trim(n[1]),i=_.trim(n[3]))}return{name:e,args:Ti.S.joinArgs(i,[],t=>t),partial:n}},genInvoking(e,{context:i={},args:n,dft:s=(()=>e),funcSet:r=window,partial:a="left"}={}){if(_.isFunction(e))return e;let o=t.parseInvoking(e),l=o.name,h=o.args;a=o.partial||a,_.isArray(n)&&n.length>0?h=n:Ti.Util.isNil(n)||(h=[n]);let c=_.get(r,l);if(_.isFunction(c)){let t=_.map(h,t=>_.isString(t)||_.isArray(t)?Ti.S.toJsValue(t,{context:i}):t);return _.isEmpty(t)?c:"right"==a?function(...e){let i=e,n=_.concat([],i,t);return c.apply(this,n)}:"right?"==a?function(...e){let i=_.without(e,void 0),n=_.concat([],i,t);return c.apply(this,n)}:"left"==a?function(...e){let i=e,n=_.concat([],t,i);return c.apply(this,n)}:"left?"==a?function(...e){let i=_.without(e,void 0),n=_.concat([],t,i);return c.apply(this,n)}:()=>c(...t)}return s},genItemMatcher:(t,e=!1)=>_.isFunction(t)?(e,i)=>t(e,i):_.isString(t)?e?(e,i)=>_.indexOf(Ti.Util.getOrPick(e,t),i)>=0:(e,i)=>_.isEqual(Ti.Util.getOrPick(e,t),i):_.isArray(t)?(i,n)=>{for(let s of t){let t=Ti.Util.getOrPick(i,s);if(e){if(_.indexOf(t,n)>=0)return!0}else if(_.isEqual(t,n))return!0}return!1}:(t,e)=>!1,genItemValueGetter:(t,e)=>_.isFunction(t)?i=>t(i,e):_.isString(t)?i=>Ti.Util.getOrPick(i,t,e):function(){return e},genRowIdGetter:(t,e=["id","value"])=>_.isFunction(t)?(e,i)=>{let n=t(e,i);return Ti.Types.toStr(n)}:_.isString(t)?(e,i)=>Ti.Util.fallbackNil(Ti.Types.toStr(_.get(e,t)),`Row-${i}`):_.isEmpty(e)?void 0:t=>Ti.Util.getFallback(t,...e),genRowDataGetter:t=>_.isFunction(t)?e=>t(e):_.isString(t)?e=>_.get(e,t):_.isObject(t)?e=>Ti.Util.translate(e,t):t=>t};return{Util:t}}(),{Trees:Trees}=function(){const t={path:(t=[])=>Ti.Util.isNil(t)?[]:_.isArray(t)?t:_.map(_.without(t.split("/"),""),t=>/^\d+$/.test(t)?1*t:t),walkDeep(e,i=(()=>({})),{idBy:n="id",nameBy:s="name",childrenBy:r="children"}={}){let a=t.asRootHie(e,{idBy:n,nameBy:s,childrenBy:r});const o=t=>{let[e,l]=_.concat(i(t)||[null,!1]);if(l)return[e,l];let h=_.get(t.node,r);if(_.isArray(h)){let e={depth:t.depth+1,parent:t,ancestors:_.concat(t.ancestors,t)},i=0,r=h.length-1;for(let l of h){let h=_.get(l,n),c=_.get(l,s),u={index:i,isFirst:0==i,isLast:r==i,id:h,name:c,node:l,path:_.concat(t.path,c||i),root:a,...e},[d,p]=o(u);if(i++,p)return[d,p]}}return[]};let[l]=o(a);return l},walkBreadth(e,i=(()=>({})),{idBy:n="id",nameBy:s="name",childrenBy:r="children"}={}){let a=t.asRootHie(e,{idBy:n,nameBy:s,childrenBy:r}),[o,l]=_.concat(i(a)||[null,!1]);if(l)return[o,l];const h=t=>{let e=_.get(t.node,r);if(_.isArray(e)){let r=[],o={depth:t.depth+1,parent:t,ancestors:_.concat(t.ancestors,t)},l=0,c=e.length-1;for(let h of e){let e=_.get(h,n),u=_.get(h,s),d={index:l,isFirst:0==l,isLast:c==l,id:e,name:u,node:h,path:_.concat(t.path,u||l),root:a,...o},[p,m]=_.concat(i(d)||[null,!1]);if(l++,m)return[p,m];r.push(d)}for(let t of r){let[e,i]=h(t);if(i)return[e,i]}}return[]};let[c]=h(a);return c},getById(e,i,n){if(!Ti.Util.isNil(i))return t.walkDeep(e,t=>{if(t.id==i)return[t,!0]},n)},getByPath(e,i=[],n){let s=t.path(i);return t.walkDeep(e,t=>{if(_.isEqual(s,t.path))return[t,!0]},n)},getNodeById(e,i,n){let s=t.getById(e,i,n);if(s)return s.node},getNodeByPath(e,i=[],n){let s=t.getByPath(e,i,n);if(s)return s.node},asRootHie:(t,{idBy:e="id",nameBy:i="name",childrenBy:n="children"}={})=>({index:0,isFirst:!0,isLast:!0,id:_.get(t,e),name:_.get(t,i),node:t,path:[],depth:0,parent:null,ancestors:[]}),pushPath(e,i,{idBy:n="id",nameBy:s="name",childrenBy:r="children",genPathNode:a=((t,e)=>({[n]:_.concat(e.path,t).join("/"),[s]:t}))}={}){let o=t.asRootHie(e,{idBy:n,nameBy:s,childrenBy:r}),l=t.path(i);const h=function(t,e,i=0){if(i>=e.length)return t;let l=_.get(t.node,r);l||(l=[],_.set(t.node,r,l));let c,u=e[i],d=_.findIndex(l,t=>t[s]==u);return d<0?(d=l.length,c=a(u,t,{path:e,off:i}),l.push(c)):c=l[d],t={index:d,isFirst:0==d,isLast:l.length-1==d,id:_.get(c,n),name:_.get(c,s),node:c,root:o,depth:t.depth+1,parent:t,ancestors:_.concat(t.ancestors,t)},h(t,e,i+1)};return h(o,l)},insertBefore(t,e,{nameBy:i="name",childrenBy:n="children"}={}){if(!t||_.isUndefined(e))return;let s,r;t.parent?(r=_.get(t.parent.node,n),s=t.index):(r=t.node.children,s=0);let a=Ti.Util.insertToArray(r,s,e),o=_.cloneDeep(t.path),l=_.get(e,i);o[o.length-1]=l;return{hierarchy:{index:a,node:e,path:o,depth:t.depth,parent:t.parent,ancestors:t.ancestors},children:r,item:e,index:a}},insertAfter(t,e,{nameBy:i="name",childrenBy:n="children"}={}){if(!t||_.isUndefined(e))return;let s,r;t.parent?(r=_.get(t.parent.node,n),s=t.index+1):(r=t.node.children,s=-1);let a=Ti.Util.insertToArray(r,s,e),o=_.cloneDeep(t.path),l=_.get(e,i);o[o.length-1]=l;return{hierarchy:{index:a,node:e,path:o,depth:t.depth,parent:t.parent,ancestors:t.ancestors},children:r,item:e,index:a}},prepend(t,e,{nameBy:i="name",childrenBy:n="children",autoChildren:s=!1}={}){if(!t||_.isUndefined(e))return;let r,a=_.get(t.node,n);_.isArray(a)?r=0:s?(a=[],t.node.children=a,r=0):(a=_.get(t.parent.node,n),r=t.index+1);let o=Ti.Util.insertToArray(a,r,e),l=_.get(e,i);return{hierarchy:{index:o,node:e,path:_.concat(l,t.path),depth:t.depth+1,parent:t,ancestors:_.concat(t.ancestors,t)},children:a,item:e,index:o}},append(t,e,{nameBy:i="name",childrenBy:n="children",autoChildren:s=!1}={}){if(!t||_.isUndefined(e))return;let r,a=_.get(t.node,n);_.isArray(a)?r=0:s?(a=[],t.node.children=a,r=0):(a=_.get(t.parent.node,n),r=t.index);let o=Ti.Util.insertToArray(a,r,e),l=_.get(e,i);return{hierarchy:{index:o,node:e,path:_.concat(t.path,l),depth:t.depth+1,parent:t,ancestors:_.concat(t.ancestors,t)},children:a,item:e,index:o}},replace(t,e,{nameBy:i="name",childrenBy:n="children"}={}){if(!t||!t.parent||_.isUndefined(e))return;let s=_.get(t.parent.node,n);s[t.index]=e;let r=_.cloneDeep(t.path),a=_.get(e,i);r[r.length-1]=a;return{hierarchy:{index:t.index,node:e,path:r,depth:t.depth,parent:t.parent,ancestors:t.ancestors},children:s,item:e,index:t.index}},remove(t,{childrenBy:e="children"}={}){if(!t||!t.parent)return;let i=t.index,n=_.get(t.parent.node,e);return _.remove(n,(t,e)=>e==i).length>0},nextCandidate(t){if(!t||!t.parent)return;let e,i,n=t.parent.node.children;return n.length<=1?(e=t.parent.node,i=_.isEmpty(t.parent.path)?null:t.parent.path.slice(0,t.parent.path.length-1)):t.index+1<n.length?(e=n[t.index+1],i=t.parent.path):(e=n[t.index-1],i=t.parent.path),{node:e,path:i}},movePrev(t,{childrenBy:e="children"}={}){if(t.isFirst)return;let i=_.get(t.parent.node,e);if(_.isEmpty(i))return;let n=t.index,s=t.index-1,r=t.node;i[n]=i[s],i[s]=r},moveNext(t,{childrenBy:e="children"}={}){if(t.isLast)return;let i=_.get(t.parent.node,e);if(_.isEmpty(i))return;let n=t.index,s=t.index+1,r=t.node;i[n]=i[s],i[s]=r},moveOut(t,{childrenBy:e="children"}={}){if(t.depth<=1)return;let i=_.get(t.parent.node,e),n=_.get(t.parent.parent.node,e),s=t.node,r=t.parent.index;n.splice(r+1,0,s),i.splice(t.index,1)},moveInto(t,{childrenBy:e="children"}={}){if(t.isFirst)return;let i=_.get(t.parent.node,e),n=i[t.index-1],s=_.get(n,e);s||(s=[],_.set(n,e,s));let r=t.node;s.push(r),i.splice(t.index,1)}};return{Trees:t}}(),{Viewport:Viewport}=function(){class t{constructor(){this.reset()}reset(t=null){return this.scrolling=[],this.resizing=[],this}watch(t,{scroll:e,resize:i}={}){_.isFunction(e)&&this.scrolling.push({context:t,handler:e}),_.isFunction(i)&&this.resizing.push({context:t,handler:i})}unwatch(t){_.remove(this.scrolling,({context:e})=>e===t),_.remove(this.resizing,({context:e})=>e===t)}notifyResize(t={}){_.delay(()=>{this.resize(t)})}notifyScroll(t={}){_.delay(()=>{this.scroll(t)})}resize(t={}){for(let e of this.resizing)e.handler.apply(e.context,[t])}scroll(t={}){Ti.Toptip.destroy();for(let e of this.scrolling)e.handler.apply(e.context,[t])}startListening(){let t=this;this.isListening||(window.addEventListener("resize",e=>{t.resize()}),window.addEventListener("scroll",e=>{t.scroll()}),this.isListening=!0)}}return{Viewport:new t}}(),{WWW:WWW}=function(){const t={explainNavigation(e=[],{base:i="/",depth:n=0,suffix:s=".html",iteratee:r=_.identity,idBy:a,indexPath:o=[],idPath:l=[]}={}){let h=[];for(let c=0;c<e.length;c++){let u=e[c],d=[].concat(o,c),p=Ti.Util.explainObj(u,a,{evalFunc:!0});Ti.Util.isNil(p)&&(p="it-"+d.join("-"));let m=[].concat(l,p),f={id:p,index:c,depth:n,idPath:m,indexPath:d,type:"page",..._.pick(u,"icon","title","type","value","href","target","params","rawData")};if("page"==u.type){if(!f.href&&u.value){let e=u.value;e.endsWith(s)||(e+=s);let n=Ti.Util.appendPath(i,e);f.value=e,f.href=t.joinHrefParams(n,u.params,u.anchor)}f.highlightBy=t.evalHighlightBy(u.highlightBy||f.value,u),!f.target&&u.newTab&&(f.target="_blank")}else"href"==f.type?(f.highlightBy=t.evalHighlightBy(u.highlightBy||f.value,u),f.href||(f.href=t.joinHrefParams(u.value,u.params,u.anchor)),!f.target&&u.newTab&&(f.target="_blank")):f.highlightBy=(()=>!1);_.isArray(u.items)&&(f.items=t.explainNavigation(u.items,{base:i,suffix:s,iteratee:r,depth:n+1,idBy:a,indexPath:d,idPath:m})),f=r(f),h.push(f)}return h},evalHighlightBy(t=!1,e={}){if(_.isFunction(t))return t;if(_.isString(t)){if(t.startsWith("^")||t.endsWith("$")){let e=new RegExp(t);return _.bind(function({path:t,value:e}){return this.test(e)||this.test(t)},e)}return({path:i,params:n,value:s})=>!(Ti.Util.isNil(s)||e.value!=s&&e.id!=s)||!!_.isEqual(i,t)&&!(!_.isEmpty(e.params)&&n&&!_.isEqual(e.params,n))}return Ti.Util.isNil(t)?({value:t})=>Ti.Util.isNil(t):_.isRegExp(t)?_.bind(function({path:t,value:e}){return this.test(e)||this.test(t)},t):_.isBoolean(t)?function(){return t}:function(){return!1}},joinHrefParams(t,e,i){if(!t)return null;let n;return _.isEmpty(e)||(n=[],_.forEach(e,(t,e)=>{if(!Ti.Util.isNil(t)){let i=encodeURIComponent(t);n.push(`${e}=${i}`)}}),n.length>0&&(t=t+"?"+n.join("&"))),i&&(i.startsWith("#")?t+=i:t+="#"+i),t},evalFee:({price:t=0,amount:e=1}={})=>t*e,getCurrencyPrefix:t=>({RMB:"￥",USD:"$",EUR:"€",GBP:"￡"})[_.upperCase(t)],feeText(e=0,i="RMB",{autoSuffix:n=!0}={}){let s=_.upperCase(i),r=t.getCurrencyPrefix(s),a=[];return r&&a.push(r),a.push(e),n&&r||a.push(s),a.join("")},evalObjPreviewSrc(t,{previewKey:e,previewObj:i,sha1Path:n=4,apiTmpl:s,cdnTmpl:r,dftSrc:a}={}){if(t){if(_.isString(t))return t;if(r){let e=".."!=i&&i?_.get(t,i):t;if(e&&e.sha1)return e=_.cloneDeep(e),e.sha1Path=n>0?e.sha1.substring(0,n)+"/"+e.sha1.substring(n):e.sha1,Ti.S.renderBy(r,e)}if(s){let i=".."!=e&&e?_.get(t,e):t;if(/^https?:\/\//.test(i))return i;if(i)return Ti.S.renderBy(s,t)}return a}},getSSRData(t,{root:e=document.documentElement,as:i="text",trimed:n=!0,autoRemove:s=!0,ssrFinger:r,dft:a}={}){let o=`.wn-ssr-data[data-ssr-key="${t}"]`,l=Ti.Dom.find(o,e);if(_.isElement(l)){if(!Ti.Util.isNil(r)){if(l.getAttribute("data-ssr-finger")!=r)return a}let t=l.textContent;return n&&(t=_.trim(t)),s&&Ti.Dom.remove(l),"json"==i?JSON.parse(t):t}return a},genQuery(t,{vkey:e="val",wrapArray:i=!1,errorAs:n,blankAs:s="[]"}={}){if(_.isFunction(t))return t;if(_.isArray(t))return i?()=>t:t;if(_.isString(t))throw"www:unsupport query: "+t},hydrateApi({base:t="/",siteApis:e={},apis:i={},joinSiteGlobal:n=!0}={}){let s={};const r=function(e,i,n={}){let s=_.cloneDeep(i);_.defaults(s,{name:e,method:"GET",headers:{},params:{},vars:{},as:"json",autoResetData:"GET"});if(s.path)return _.assign(s.vars,n.vars),_.assign(s.headers,n.headers),_.assign(s.params,n.params),"INVOKE"!=s.method&&(/^(https?:\/\/|\/)/.test(s.path)?s.url=s.path:s.url=Ti.Util.appendPath(t,s.path)),_.assign(s,_.pick(n,"body","preload","force","ssr","test","explainTest","transformer","dataKey","dataMerge","rawDataKey","rawDataMerge","autoResetData","after")),_.defaults(s,{bodyType:"form",dataKey:e}),s;console.warn(`!!!API[${e}] without defined in site!!!`,s)};return n&&_.forEach(e,(t,e)=>{t.pages&&(t=r(e,t))&&(s[e]=t)}),_.forEach(i,(t,i)=>{let n=_.get(e,t.apiName||i),a=r(i,n,t);a&&(s[i]=a)}),s},async runApi(t={},e,{vars:i,params:n,headers:s,body:r,dispatch:a}={}){e=_.cloneDeep(e),_.assign(e.vars,i),_.assign(e.params,n),_.assign(e.headers,s),Ti.Util.isNil(r)||(e.body=r),_.defaults(i,e.vars);let o=e.url;if(!_.isEmpty(e.vars)){let i=Ti.Util.explainObj(t,e.vars);o=Ti.S.renderBy(o,i)}let l=_.pick(e,["method","as"]);if(l.headers=Ti.Util.explainObj(t,e.headers),l.params=Ti.Util.explainObj(t,e.params),"POST"==e.method&&e.body){let i=Ti.Util.explainObj(t,e.body);"json"==e.bodyType?l.body=JSON.stringify(i):"text"==e.bodyType?l.body=Ti.Types.toStr(i):l.body=Ti.Http.encodeFormData(i)}let h,c;if("INVOKE"==e.method)h=await a(e.path,l.params,{root:!0});else{if(e.ssr&&"GET"==e.method){let t=JSON.stringify(l.params||{}),i=_.pick(l,"as");i.dft=void 0,i.ssrFinger=Ti.Alg.sha1(t),h=Ti.WWW.getSSRData(`api-${e.name}`,i)}_.isUndefined(h)&&(h=await Ti.Http.sendAndProcess(o,l))}if(c=h,e.transformer){"BCHC.TagsToDict"==e.transformer&&console.log("transform",e.transformer);let i=_.cloneDeep(e.transformer),n=Ti.Util.fallback(i.partial,"right");if(i.explain){let e=_.pick(i,"name","args");i=Ti.Util.explainObjs(t,e)}let s=Ti.Util.genInvoking(i,{context:t,partial:n});_.isFunction(s)&&(c=await s(h))}return{reo:h,data:c}},async runApiAndPrcessReturn(t={},e,{vars:i,params:n,headers:s,body:r,ok:a,fail:o,dispatch:l,mergeData:h,updateData:c,doAction:u}={}){let d;try{d=await Ti.WWW.runApi(t,e,{vars:i,params:n,headers:s,body:r,dispatch:l})}catch(t){console.warn("Fail to invoke API",{api:e,err:t,vars:i,params:n,headers:s,body:r});let a=Ti.Util.explainObj({api:e,vars:i,params:n,headers:s,body:r,err:t,errText:t.responseText},o);return void await u(a)}let{reo:p,data:m}=d,f={...t,reo:p,params:n,vars:i};if(e.dataKey){let t=Ti.Util.explainObj(f,e.dataKey);if(t)if(e.dataMerge){let e={};_.set(e,t,m),h(e)}else c({key:t,value:m})}if(e.rawDataKey){let t=Ti.Util.explainObj(f,e.rawDataKey);if(t)if(e.rawDataMerge){let e={};_.set(e,t,p),h(e)}else c({key:t,value:p})}let g=Ti.Util.explainObj({api:e,vars:i,params:n,headers:s,body:r,data:m,reo:p},a);return await u(g),m},groupPreloadApis(t,e=(()=>!0)){let i=[],n=[];return _.forEach(t,(t,s)=>{if(!e(s,t))return;let r=t.preload;if(_.isBoolean(r)){if(!r)return;r=1}if(_.isNumber(r))if(r>=0){let t=_.nth(i,r);_.isArray(t)||(t=[],i[r]=t),t.push(s)}else n.push(s)}),{preloads:_.filter(i,t=>!!t),afterLoads:n}}},e={getFbAlumThumbImage(t=[],e=500){let i,n,s;for(let r of t){let t="height";r.width<r.height&&(t="width"),i?r[t]<i[t]&&(i=r):(i=r,s=r),e>0&&s[t]>e&&r[t]<=e&&(s=r),n?r[t]>n[t]&&(n=r):n=r}return e<0?n:0==e?i:s},setImages(t,i=[],{preview:n={type:"font",value:"fas-images"},thumbMinSize:s=500}={}){let r=e.getFbAlumThumbImage(i,s),a=e.getFbAlumThumbImage(i,-1),o={};return o.width=_.get(a,"width"),o.height=_.get(a,"height"),o.src=_.get(a,"source"),o.thumb_src=_.get(r,"source"),o.thumb_src?o.preview={type:"image",value:o.thumb_src}:o.preview=n,_.assign(t,o),o},setObjListPreview(t,i){_.forEach(t,t=>{e.setObjPreview(t,t.images,i)})},setObjPreview:(t,i,n)=>e.setImages(t,i,n)};return t.FB=e,{WWW:t}}(),{GPS:GPS}=function(){const t=3.141592653589793,e=6378245,i=.006693421622965943,n={WGS84_TO_GCJ02(s,r){if(n.outOfChina(s,r))return{lat:s,lng:r};let a=n.transformLat(r-105,s-35),o=n.transformLng(r-105,s-35),l=s/180*t,h=Math.sin(l);h=1-i*h*h;let c=Math.sqrt(h);return{lat:s+(a=180*a/(e*(1-i)/(h*c)*t)),lng:r+(o=180*o/(e/c*Math.cos(l)*t))}},WGS84_TO_BD09(t,e){let i=n.WGS84_TO_GCJ02(t,e);return n.GCJ02_TO_BD09(i.lat,i.lng)},GCJ02_TO_WGS84(t,e){let i=n.transform(t,e),s=2*e-i.lng;return{lat:2*t-i.lat,lng:s}},GCJ02_TO_BD09(e,i){let n=i,s=e,r=Math.sqrt(n*n+s*s)+2e-5*Math.sin(s*t),a=Math.atan2(s,n)+3e-6*Math.cos(n*t),o=r*Math.cos(a)+.0065;return{lat:r*Math.sin(a)+.006,lng:o}},BD09_TO_GCJ02(e,i){let n=i-.0065,s=e-.006,r=Math.sqrt(n*n+s*s)-2e-5*Math.sin(s*t),a=Math.atan2(s,n)-3e-6*Math.cos(n*t),o=r*Math.cos(a);return{lat:r*Math.sin(a),lng:o}},BD09_TO_WGS84(t,e){let i=n.BD09_TO_GCJ02(t,e);return n.GCJ02_TO_WGS84(i.lat,i.lng)},outOfChina:(t,e)=>e<72.004||e>137.8347||(t<.8293||t>55.8271),transform(s,r){if(n.outOfChina(s,r))return{lat:s,lng:r};let a=n.transformLat(r-105,s-35),o=n.transformLng(r-105,s-35),l=s/180*t,h=Math.sin(l);h=1-i*h*h;let c=Math.sqrt(h);return{lat:s+(a=180*a/(e*(1-i)/(h*c)*t)),lng:r+(o=180*o/(e/c*Math.cos(l)*t))}},transformLat(e,i){let n=2*e-100+3*i+.2*i*i+.1*e*i+.2*Math.sqrt(Math.abs(e));return n+=2*(20*Math.sin(6*e*t)+20*Math.sin(2*e*t))/3,n+=2*(20*Math.sin(i*t)+40*Math.sin(i/3*t))/3,n+=2*(160*Math.sin(i/12*t)+320*Math.sin(i*t/30))/3},transformLng(e,i){let n=300+e+2*i+.1*e*e+.1*e*i+.1*Math.sqrt(Math.abs(e));return n+=2*(20*Math.sin(6*e*t)+20*Math.sin(2*e*t))/3,n+=2*(20*Math.sin(e*t)+40*Math.sin(e/3*t))/3,n+=2*(150*Math.sin(e/12*t)+300*Math.sin(e/30*t))/3},getLngToWest(t,e){let i=t-e;return e<0&&t>0?360-i:i},getLatToSouth:(t,e)=>t-e,normlizedLat:t=>t,normlizedLng:t=>(t>360&&(t%=360),t>180?t-360:(t<-360&&(t%=360),t<-180?t+360:t)),getBounds(t=[]){let e=void 0,i=void 0,n=void 0,s=void 0;for(let r of t)e=_.isUndefined(e)?r.lng:Math.max(e,r.lng),i=_.isUndefined(i)?r.lng:Math.min(i,r.lng),n=_.isUndefined(n)?r.lat:Math.max(n,r.lat),s=_.isUndefined(s)?r.lat:Math.min(s,r.lat);return e-i>180?[{lat:s,lng:e},{lat:n,lng:i}]:[{lat:s,lng:i},{lat:n,lng:e}]},getCenter(t=[]){let[e,i]=n.getBounds(t);return{lat:(i.lat+e.lat)/2,lng:(i.lng+e.lng)/2}}};return{GPS:n}}(),{GIS:GIS}=function(){const t=3.141592653589793,e=6378245,i=.006693421622965943,n={isInBounds(t,e,i){let{N:n,S:s,E:r,W:a}=i;return!(t>n||t<s)&&!(e>r||e<a)},isLatLngObjInBounds:({lat:t,lng:e},i)=>n.isInBounds(t,e,i),isLatLngPairInBounds:([t,e],i)=>n.isInBounds(t,e,i),__build_bounds:({N:t,S:e,E:i,W:n}={})=>({N:t,S:e,E:i,W:n,NE:{lat:t,lng:i},NW:{lat:t,lng:n},SE:{lat:e,lng:i},SW:{lat:e,lng:n},lat:(t+e)/2,lng:(n+i)/2}),getLatlngPairBounds(t=[]){let e={N:-90,S:90,W:180,E:-180};return _.forEach(t,([t,i])=>{_.isNumber(i)&&_.isNumber(t)&&(e.N=Math.max(t,e.N),e.S=Math.min(t,e.S),e.E=Math.max(i,e.E),e.W=Math.min(i,e.W))}),n.__build_bounds(e)},getLnglatPairBounds(t=[]){let e={N:-90,S:90,W:180,E:-180};return _.forEach(t,([t,i])=>{_.isNumber(t)&&_.isNumber(i)&&(e.N=Math.max(i,e.N),e.S=Math.min(i,e.S),e.E=Math.max(t,e.E),e.W=Math.min(t,e.W))}),n.__build_bounds(e)},getLatlngObjBounds(t=[]){let e={N:-90,S:90,W:180,E:-180};return _.forEach(t,({lat:t,lng:i})=>{_.isNumber(i)&&_.isNumber(t)&&(e.N=Math.max(t,e.N),e.S=Math.min(t,e.S),e.E=Math.max(i,e.E),e.W=Math.min(i,e.W))}),n.__build_bounds(e)},latlngPairToObj:([t,e]=[])=>({lat:t,lng:e}),lnglatPairToObj:([t,e]=[])=>({lat:e,lng:t}),objToLatlngPair:({lat:t,lng:e}={})=>[t,e],objToLnglatPair:({lat:t,lng:e}={})=>[e,t],transLatlngPair(t,e="WGS84_TO_GCJ02"){let{lat:i,lng:s}=n[e](...t);return[i,s]},transLnglatPair(t,e="WGS84_TO_GCJ02"){let[i,s]=t,{lat:r,lng:a}=n[e](s,i);return[a,r]},transLatlngObj(t,e="WGS84_TO_GCJ02",i=!1){let{lat:s,lng:r}=t,a=n[e](s,r);return i?{...t,...a}:a},WGS84_TO_GCJ02(s,r){if(n.outOfChina(s,r))return{lat:s,lng:r};let a=n.transformLat(r-105,s-35),o=n.transformLng(r-105,s-35),l=s/180*t,h=Math.sin(l);h=1-i*h*h;let c=Math.sqrt(h);return{lat:s+(a=180*a/(e*(1-i)/(h*c)*t)),lng:r+(o=180*o/(e/c*Math.cos(l)*t))}},WGS84_TO_BD09(t,e){let i=n.WGS84_TO_GCJ02(t,e);return n.GCJ02_TO_BD09(i.lat,i.lng)},GCJ02_TO_WGS84(t,e){let i=n.transform(t,e),s=2*e-i.lng;return{lat:2*t-i.lat,lng:s}},GCJ02_TO_BD09(e,i){let n=i,s=e,r=Math.sqrt(n*n+s*s)+2e-5*Math.sin(s*t),a=Math.atan2(s,n)+3e-6*Math.cos(n*t),o=r*Math.cos(a)+.0065;return{lat:r*Math.sin(a)+.006,lng:o}},BD09_TO_GCJ02(e,i){let n=i-.0065,s=e-.006,r=Math.sqrt(n*n+s*s)-2e-5*Math.sin(s*t),a=Math.atan2(s,n)-3e-6*Math.cos(n*t),o=r*Math.cos(a);return{lat:r*Math.sin(a),lng:o}},BD09_TO_WGS84(t,e){let i=n.BD09_TO_GCJ02(t,e);return n.GCJ02_TO_WGS84(i.lat,i.lng)},outOfChina:(t,e)=>e<72.004||e>137.8347||(t<.8293||t>55.8271),transform(s,r){if(n.outOfChina(s,r))return{lat:s,lng:r};let a=n.transformLat(r-105,s-35),o=n.transformLng(r-105,s-35),l=s/180*t,h=Math.sin(l);h=1-i*h*h;let c=Math.sqrt(h);return{lat:s+(a=180*a/(e*(1-i)/(h*c)*t)),lng:r+(o=180*o/(e/c*Math.cos(l)*t))}},transformLat(e,i){let n=2*e-100+3*i+.2*i*i+.1*e*i+.2*Math.sqrt(Math.abs(e));return n+=2*(20*Math.sin(6*e*t)+20*Math.sin(2*e*t))/3,n+=2*(20*Math.sin(i*t)+40*Math.sin(i/3*t))/3,n+=2*(160*Math.sin(i/12*t)+320*Math.sin(i*t/30))/3},transformLng(e,i){let n=300+e+2*i+.1*e*e+.1*e*i+.1*Math.sqrt(Math.abs(e));return n+=2*(20*Math.sin(6*e*t)+20*Math.sin(2*e*t))/3,n+=2*(20*Math.sin(e*t)+40*Math.sin(e/3*t))/3,n+=2*(150*Math.sin(e/12*t)+300*Math.sin(e/30*t))/3}};return{GIS:n}}(),{Bank:Bank}=function(){const t={AUD:{token:"$",icon:"fas-dollar-sign",text:"i18n:currency-AUD"},CAD:{token:"$",icon:"fas-dollar-sign",text:"i18n:currency-CAD"},EUR:{token:"€",icon:"fas-euro-sign",text:"i18n:currency-EUR"},GBP:{token:"£",icon:"fas-pound-sign",text:"i18n:currency-GBP"},HKD:{token:"¥",icon:"fas-yen-sign",text:"i18n:currency-HKD"},JPY:{token:"¥",icon:"fas-yen-sign",text:"i18n:currency-JPY"},MOP:{token:"¥",icon:"fas-yen-sign",text:"i18n:currency-MOP"},RMB:{token:"¥",icon:"fas-yen-sign",text:"i18n:currency-RMB"},USD:{token:"$",icon:"fas-dollar-sign",text:"i18n:currency-USD"}},e={exchange(t,{from:i="RMB",to:n="RMB",bridge:s="RMB",exrs:r={},dft:a=-1}={}){let{cent:o,currency:l}=e.parseCurrency(t,{currency:i,unit:_.isNumber(t)?1:100});if(i=l||i,t=o,i==n)return t;let h=r[`${i}_${n}`];if(h>0)return t*h;if((h=r[`${n}_${i}`])>0)return t/h;let c=r[`${i}_${s}`]||r[`${s}_${i}`],u=r[`${n}_${s}`]||r[`${s}_${n}`];if(c>0&&u>0){let a=e.exchange(t,{from:i,to:s,exrs:r});return e.exchange(a,{from:s,to:n,exrs:r})}return a},parseExchangeKey(t){let e=/^([A-Z]{3})_([A-Z]{3})$/.exec(t);if(!e)return;let i=e[1],n=e[2];return{from:i,to:n,fromName:Ti.I18n.text(Ti.Bank.getCurrencyText(i)),toName:Ti.I18n.text(Ti.Bank.getCurrencyText(n))}},getCurrencyChar:(e="RMB")=>_.get(t[e],"token"),getCurrencyToken:(e="RMB")=>_.get(t[e],"token"),getCurrencyText:(e="RMB")=>_.get(t[e],"text"),getCurrencyIcon:(e="RMB")=>_.get(t[e],"icon"),getCurrencyList(){let e=[];return _.forEach(t,(t,i)=>{e.push({key:i,value:i,token:t.token,icon:t.icon,text:Ti.I18n.text(t.text)})}),e},parseCurrency(t,{unit:e=100,currency:i="RMB"}={}){let n,s;if(t&&t.currency)n=t.cent,s=t.yuan,i=t.currency,Ti.Util.isNil(n)?Ti.Util.isNil(s)?s=(n=t.value*e)/100:n=100*s:Ti.Util.isNil(s)&&(n=100*s);else if(_.isNumber(t))n=Math.round(t*e);else{let s=/^(\d*\.?\d+)([A-Z]{3})?$/.exec(t);s?s[2]?(i=s[2],n=Math.round(s[1]*e)):n=Math.round(s[1]*e):n=NaN}return s=n/100,{cent:n,yuan:s,currency:i}},toYuanText:(t=0,i=2)=>e.autoYuanTokenText(t,{currency:null,precision:i,auto:!0}),toYuanTokenText:(t=0,i="RMB",n=2)=>e.autoYuanTokenText(t,{currency:i,precision:n,auto:!0}),autoYuanTokenText(t=0,{currency:i="RMB",precision:n=2,auto:s=!0}={}){let r=(t=Math.round(t))<0?"-":"";t=Math.abs(t);let a=e.getCurrencyToken(i)||"",o=`${_.round(t/100,n)}`;if(n>0&&!s){let t=o.lastIndexOf(".");if(t<0)o=o+"."+_.repeat("0",n);else{let e=o.substring(t+1);e.length<n&&(e=_.padEnd(e,n,"0"),o=o.substring(0,t+1)+e)}}return o=e.toBankText(o),`${r}${a}${o}`},toYuanTokenText2:(t=0,i="RMB",n=2)=>`${e.toYuanTokenText(t,i,n)}${i}`,toZeroText:(t=0,{precision:i=2,placeholder:n="---"}={})=>t?e.toYuanText(t,i):n,toZeroTokenText:(t=0,{currency:i="RMB",precision:n=2,placeholder:s="---"}={})=>t?e.toYuanTokenText(t,i,n):s,toZeroTokenText2:(t=0,{currency:i="RMB",precision:n=2,placeholder:s="---"}={})=>t?e.toYuanTokenText2(t,i,n):s,toChineseText(t=0,e=!1){let i=parseInt(t/100),n=Math.round(100*(t-100*i)),s=[Ti.S.intToChineseNumber(i,e)];if(n>0){let t=_.padStart(n+"",4,"0");s.push("元");for(let i=0;i<t.length;i++){let n=1*t[i];if(n>0){let t=Ti.S.intToChineseNumber(n,e);s.push(t),s.push("角分厘毫"[i])}else"零"!=s[s.length-1]&&s.push("零")}}else s.push("元整");return s.join("")},toBankText(t,{part:e=3,sep:i=",",to:n="left"}={}){if(Ti.Util.isNil(t))return t;let s=t+"",r=s.indexOf(".");r<0&&(r=s.length);let a=s.split("");if("left"==n)for(let t=r;t>0;t-=e)t<r&&a.splice(t,0,i);else if("right"==n){let t=0;for(let n=0;n<r;n+=e)n>0&&(a.splice(n+t,0,i),t+=i.length)}return a.join("")},isValidPayType:t=>({"wx.qrcode":!0,"zfb.qrcode":!0,paypal:!0})[t]||!1,getPayTypeText(t,e=!1){let i=null;if(_.isString(t)&&(i=`pay-by-${t.replace(".","-")}`),i)return e?Ti.I18n.get(i):i},getPayTypeChooseI18nText(t,{text:e="pay-step-choose-tip2",nil:i="pay-step-choose-nil"}={}){let n=Ti.Bank.getPayTypeText(t,!0);return n?Ti.I18n.getf(e,{val:n}):Ti.I18n.get(i)}};return{Bank:e}}(),{Num:Num}=function(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZ";return{Num:{scopeToLimit(t,e){let i=/^([1-9]\d*)[:,_-](\d+)$/.exec(_.trim(t));if(!i){if(!e)throw Ti.Err.make("e-data-InvalidScope",t);return e}let n=Math.max(parseInt(1*i[1]),1),s=Math.max(parseInt(i[2]),0),r=Math.min(n,s),a=Math.max(n,s),o=Math.max(0,r-1),l=a-o;if(l<=0||o<0)throw Ti.Err.make("e-data-InvalidScope",t);return{limit:l,skip:o}},fillSteps(t=0,e=1,{ary:i=[],step:n=1}={}){for(let s=0;s<e;s++)i[s]=t+s*n;return i},scrollIndex(t,e=0){if(e>0){let i=t%e;return i>=0?i:e+i}return-1},precise(t,e=2){if(e>=0){var i=Math.pow(10,e);return Math.round(t*i)/i}return t},padTo(t,e=1){if(e>1){return Math.round(t/e)*e}return t},ceilUnit(t,e=0){if(_.isNumber(t)&&e>0){return Math.ceil(t/e)*e}return t},floorUnit(t,e=0){if(_.isNumber(t)&&e>0){return Math.floor(t/e)*e}return t},toBase26(e){e=Math.abs(Math.round(e));let i=[];for(;e>=26;){let n=parseInt(e/26),s=parseInt(e-26*n);i.push(t[s]),e=n-1}return i.push(t[e]),i.reverse().join("")},fromBase26(t){let e=_.trim(t).toUpperCase().split("").reverse().join(""),i=0,n=e.length,s=1;for(let r=0;r<n;r++){let n=e.charCodeAt(r);if(n<65||n>90)throw`Invalid base26 number : ${t}`;let a=n-65;r>0&&(a+=1),i+=a*s,s*=26}return i}}}}(),{Css:Css}=function(){const t={scaleSize:(t=1,e,i)=>i&&e?{width:e,height:i}:i?{width:t*i,height:i}:e?{width:e,height:e/t}:void 0,toPixel(e,i=100,n=0){if(Ti.Util.isNil(e))return e;if(_.isNumber(e))return e>-1&&e<1?e*i:e;let s={base:i,dft:n,remBase:Ti.Dom.getRemBase()};return t.toAbsPixel(e,s)},toAbsPixel(t,{base:e=100,dft:i=0,remBase:n=100,emBase:s=14}={}){if(Ti.Util.isNil(t))return t;if(_.isNumber(t))return t;let r=/^(-?[\d.]+)(px|rem|em|%)?$/.exec(t);if(r){let t=1*r[1],i={px:t=>t,rem:t=>t*n,em:t=>t*s,"%":t=>t*e/100}[r[2]];return i?i(t):t}return i},toSize:(t,{autoPercent:e=!1,remBase:i=0}={})=>_.isNumber(t)||/^[0-9]+$/.test(t)?0==t?t:e&&t>=-1&&t<=1?100*t+"%":i>0?t/i+"rem":t+"px":t,toSize2:e=>t.toSize(e,{autoPercent:!1}),toSizeRem100(e,i){let n=_.assign({},i,{remBase:100});return t.toSize(e,n)},toStyle:(e,i)=>_.mapValues(e,(e,n)=>{let s=_.kebabCase(n);return/^(opacity|z-index|order)$/.test(s)?e:t.toSize(e,i)}),toStyleRem100(e,i){let n=_.assign({},i,{remBase:100});return t.toStyle(e,n)},toBackgroundUrl(t,e=""){if(t)return e&&(t=Ti.Util.appendPath(e,t)),`url("${t}")`},toBackgroundUrlBy(t,e=""){if(t)return e&&(t=Ti.S.renderBy(e,t)),`url("${t}")`},toBackgroundUrlAsPreview(t,e,i,n){if(t&&!_.isEmpty(t))return t=Ti.WWW.evalObjPreviewSrc(t,{apiTmpl:e,cdnTmpl:i,dftSrc:n}),`url("${t}")`},toNumStyle:e=>t.toStyle(e,!1),mergeClassName:(...e)=>t.mergeClassNameBy({},...e),mergeClassNameBy(t={},...e){let i={};const n=e=>{if(!Ti.Util.isNil(e))if(_.isFunction(e)){let i=e(t);n(i)}else if(_.isString(e)){let t=_.without(_.split(e,/\s+/g),"");for(let e of t)i[e]=!0}else if(_.isArray(e))for(let t of e)n(t);else _.isPlainObject(e)&&_.forEach(e,(t,e)=>{if(t){let t=_.kebabCase(e);i[t]=!0}})};return n(e),i},joinClassNames(...e){let i=t.mergeClassName(...e),n=[];return _.forEach(i,(t,e)=>{t&&n.push(e)}),n.join(" ")},parseCssRule(t="",e=!0){if(t=_.trim(t),Ti.S.isBlank(t))return{};e=Ti.Dom.attrFilter(e);let i={},n=t.split(";");for(let t of n){if(Ti.S.isBlank(t))continue;let n=t.indexOf(":");if(n<=0)continue;let s=_.trim(t.substring(0,n)),r=_.trim(t.substring(n+1)),a=e(s,r);a&&(_.isBoolean(a)&&(a=_.camelCase(s)),i[a]=r)}return i},parseAndTidyCssRule(e={},{filter:i,parseBackground:n=!0,nameCase:s="kebab",urlRewrite:r}={}){if(_.isString(e)&&(e=t.parseCssRule(e,i)),n){let i=Ti.S.getCaseFunc(s);if(e.background){let i=t.parseBackground(e.background,{nameCase:s});delete e.background,_.assign(e,i)}let n=i("background-image");e[n]&&_.isFunction(r)&&(e[n]=r(e[n]));let a=i("background-position");if(e[a]){const t=function(t,e=[]){return/^0(%|px|rem|em|pt)?$/.test(t)?e[0]:"50%"==t?e[1]:"100%"==t?e[2]:t};let n=e[a].split(/\s+/),s=_.first(n),r=_.last(n);delete e[a],e[i("background-position-x")]=t(s,["left","center","right"]),e[i("background-position-y")]=t(r,["top","center","bottom"])}}return e},parseBackground(t="",{nameCase:e="kebab"}={}){let i=Ti.S.getCaseFunc(e),n=(t||"").replace(/[ ]{2,}/g," ").replace(/[ ]*([\/,])[ ]*/g,"$1").replace(/[ ]\)/g,")").replace(/\([ ]/g,"("),s="(#[0-9a-f]{3,}|rgba?\\([\\d, .]+\\))";s+="|(url\\([^\\)]+\\))",s+="|(",s+="(left|right|center|\\d+(%|em|px|cm|ch))",s+=" *(top|bottom|center|\\d+(%|em|px|cm|ch)?)",s+="/(auto|cover|contain|\\d+(%|em|px)( \\d+(%|em|px))?|auto( auto)?)",s+=")",s+="|(repeat|no-repeat)",s+="|((padding|border|content)-box)",s+="|(scroll|fixed)";let r,a=new RegExp(s,"gi"),o={backgroundColor:1,backgroundImage:2,backgroundPositionX:4,backgroundPositionY:6,backgroundSize:8,backgroundRepeat:13,backgroundOrigin:14,backgroundAttachment:16},l={};for(;null!==(r=a.exec(n));)for(var h in o){var c=o[h];if(r[c]){l[i(h)]=r[c]}}return l},renderCssRule(t={}){if(_.isEmpty(t))return"";if(_.isString(t))return t;let e=[];return _.forEach(t,(t,i)=>{if(_.isNull(t)||_.isUndefined(t)||Ti.S.isBlank(t))return;let n=_.kebabCase(i);/^(opacity|z-index|order)$/.test(n)?e.push(`${n}:${t}`):_.isNumber(t)?e.push(`${n}:${t}px`):e.push(`${n}:${t}`)}),e.join(";")},renderCssStyleSheet(e=[]){e=_.concat(e);let i=[];for(let n of e){let{selectors:e,rules:s}=n;e=_.concat(e),_.isEmpty(e)||_.isEmpty(s)||(i.push(e.join(",")+"{"),i.push(t.renderCssRule(s)),i.push("}"))}return i.join("\n")}};return{Css:t}}(),{Mapping:Mapping}=function(){class t{constructor(t,e){this.data=e,_.isString(t)?this.path=_.without(t.split("/"),""):_.isArray(t)&&(this.path=t)}match(t){let e=_.isArray(t)?t:_.without(t.split("/"),"");for(let t=0;t<e.length;t++){let i=e[t],n=this.path[t];if("*"!=n&&i!=n)return!1}return!0}}class e{constructor(t,e){this.data=e,this.regex=new RegExp(t)}match(t){return this.regex.test(t)}}class i{constructor(t={}){this.parse(t)}parse(i={}){this.maps={},this.regexs=[],this.paths=[],_.forEach(i,(i,n)=>{let s=_.map(n.split(","),t=>_.trim(t));for(let n of s)n.startsWith("^")?this.regexs.push(new e(n,i)):n.indexOf("/")>=0?this.paths.push(new t(n,i)):this.maps[n]=i})}get(t,e){if(!Ti.Util.isNil(t)){let e=this.maps[t];if(!_.isUndefined(e))return e;for(let e of this.paths){let i=_.without(t.split("/"),"");if(e.match(i))return e.data}for(let e of this.regexs)if(e.match(t))return e.data}return e}}return{Mapping:i}}(),{Dict:Dict,DictFactory:DictFactory}=function(){class t{constructor(t,e){this.$dict=t,this.filterArgs=e,this.__ID=`${t.__ID}_wrapper`}async getItem(t){return await this.$dict.getItem(t)}async getData(t=!1){return!_.isArray(this.filterArgs)||_.isEmpty(this.filterArgs)?await this.$dict.getData(t):await this.$dict.getChildren(...this.filterArgs)}async queryData(t){return Ti.Util.isNil(t)?await this.getData():await this.$dict.queryData(t)}async getChildren(t){return this.$dict.getChildren(t)}getBy(t=".text",e,i){return this.$dict.getBy(t,e,i)}async checkItem(t){return this.$dict.checkItem(t)}async getItemText(t){return this.$dict.getItemText(t)}async getItemTip(t){return this.$dict.getItemTip(t)}async getItemIcon(t){return this.$dict.getItemIcon(t)}async getItemAs(t,e){return this.$dict.getItemAs(t,e)}}const e=["item","data","query","children","getValue","getText","getIcon","isMatched","itemCache","dataCache"];class i{constructor(){this.__ID=Ti.Random.str(6),this.__data_loading=void 0,this.__item_loading={},this.item=_.idendity,this.data=(()=>[]),this.dataChildrenKey=null,this.query=(t=>[]),this.children=(t=>[]),this.getValue=(t=>Ti.Util.getFallback(t,"value","id")),this.getText=(t=>Ti.Util.getFallback(t,"text","title","name","nm")),this.getIcon=(t=>_.get(t,"icon")),this.getTip=(t=>_.get(t,"tip")),this.isMatched=((t,e)=>{let i=this.getValue(t);if(e==i||_.isEqual(e,i))return!0;if(_.isString(i)&&_.isString(e)){let t=_.toLower(i),n=_.toLower(e);if(t.indexOf(n)>=0)return!0}let n=this.getText(t);return!!(n&&n.indexOf(e)>=0)}),this.itemCache={},this.dataCache=null}invoke(t,...e){let i=this[t];if(_.isFunction(i))return i.apply(this,[...e,this])}async invokeAsync(t,...e){let i=this[t];if(_.isFunction(i)){return await i.apply(this,[...e,this])}}setFunc(t){_.forEach(t,(t,e)=>{_.isFunction(t)&&(this[e]=t)})}duplicate({cache:t=!0,dataCache:n=!0,itemCache:s=!0}={}){let r=new i;return _.forEach(e,t=>{r[t]=this[t]}),t||(r.itemCache={},r.dataCache=null),n||(r.dataCache=null),s||(r.itemCache={}),r}isItemCached(t){return!Ti.Util.isNil(this.itemCache[t])}addItemToCache(t,e){t=Ti.Util.fallback(t,null);let i=e;if(Ti.Util.isNil(i)&&(i=this.getValue(t)),_.isUndefined(t)||Ti.Util.isNil(i)||(this.itemCache[i]=t),this.dataChildrenKey){let e=t[this.dataChildrenKey];if(_.isArray(e)&&e.length>0)for(let t of e)this.addItemToCache(t)}}clearCache(){this.itemCache={},this.dataCache=null}findItem(t,e=[]){for(let i of e){let e=this.getValue(i);if(_.isEqual(t,e))return i}}async hasItem(t){let e=await this.__get_raw_item(t);return!_.isEmpty(e)}async __get_raw_item(t){if(Ti.Util.isNil(t))return null;let e=this.itemCache[t];if(_.isUndefined(e)){let i=this.__item_loading[t];if(i)return await new Promise(t=>{i.push(t)});i=[],this.__item_loading[t]=i,(e=await this.invokeAsync("item",t))&&_.isPlainObject(e)&&this.addItemToCache(e,t);for(let t of i)t(e||null);delete this.__item_loading[t]}return _.isArray(e)&&console.warn("!!!! Dict.getItem=>[] !!! 靠，又出现了 val=",t),e}async getItem(t){let e=await this.__get_raw_item(t);return _.cloneDeep(e)}async getData(t=!1){let e=this.dataCache;if(t||_.isEmpty(e)){if(this.__data_loading)return await new Promise(t=>{this.__data_loading.push(t)});this.__data_loading=[];try{e=await this.invokeAsync("data"),_.forEach(e,(t,i)=>{_.isPlainObject(t)||(t={text:t,value:t},e[i]=t),this.addItemToCache(t)}),this.dataCache=e;for(let t of this.__data_loading)t(e)}finally{this.__data_loading=void 0}}return _.cloneDeep(e)||[]}async queryData(t){let e,i=_.trim(t);return i?(e=await this.invokeAsync("query",i),_.forEach(e,t=>{this.addItemToCache(t)}),_.cloneDeep(e)||[]):e=await this.getData()}async getChildren(t){if(!t)return await this.getData();let e=await this.invokeAsync("children",t);return _.forEach(e,t=>{this.addItemToCache(t)}),_.cloneDeep(e)||[]}getBy(t=".text",e,i){return t&&".text"!=t?".icon"==t?this.getIcon(e):".tip"==t?this.getTip(e):".value"==t?this.getValue(e):Ti.Util.fallback(Ti.Util.getOrPick(e,t),i,this.getValue(e)):this.getText(e)}async checkItem(t){let e=await this.getItem(t);if(!e)throw Ti.Err.make("e.dict.no-item",{dictName:dictName,val:t});return e}async getItemText(t){let e=await this.getItem(t);if(e)return this.getText(e)}async getItemTip(t){let e=await this.getItem(t);if(e)return this.getTip(e)}async getItemIcon(t){let e=await this.getItem(t);if(e)return this.getIcon(e)}async getItemAs(t,e){let i=await this.getItem(e);if(i)return this.getBy(t,i,e)}}const n={},s={definations:{},instances:{}},r={__debug_static:()=>n,__debug_dynamic:()=>s,DictReferName(t){if(_.isString(t)){let e=/^(@Dict:|#)(.+)$/.exec(t);if(e)return _.trim(e[2])}},GetOrCreate(t={},{name:e}={}){let s;if(t.data instanceof i)s=t.data;else{let i=e||r.DictReferName(t.data);i&&(s=n[i])}return s||r.CreateDict(t,{name:e})},CreateDict({data:t,query:e,item:s,children:r,dataChildrenKey:a,getValue:o,getText:l,getIcon:h,isMatched:c}={},{name:u}={}){if(_.isString(t)||_.isArray(t)){let e=Ti.S.toObjList(t);t=(()=>e)}else t||(t=(()=>[]));s||(s=(async(t,e)=>(await e.getData(),e.itemCache[t]))),e||(e=(async(t,e)=>{let i=await e.getData(),n=[];for(let s of i)e.isMatched(s,t)&&n.push(s);return n})),r||(r=(()=>[]));let d=new i;return d.dataChildrenKey=a,d.setFunc({data:t,query:e,item:s,children:r,getValue:o,getText:l,getIcon:h,isMatched:c}),u&&(n[u]=d),d},hasDict:t=>!!n[t],GetDict:t=>n[t],CheckDict(e){let i=r.GetDict(e);if(i)return i;let{name:n,args:s}=r.explainDictName(e);if(i=r.GetDict(n))return _.isEmpty(s)?i:new t(i,s);throw`e.dict.noexists : ${e}`},explainDictName(t){let e={},i=/^([^:()]+)(\(([^)]*)\))?(:(.+))?$/.exec(t);return i&&(e.name=i[1],e.args=Ti.S.joinArgs(i[3]),e.vkey=i[5],1==e.args.length&&/^=/.test(e.args[0])&&(e.dynamic=!0,e.dictKey=_.trim(e.args[0].substring(1)))),e},CreateDictBy(t,{valueBy:e,textBy:i,iconBy:n,vars:s={},whenLoading:a=function({loading:t}){},callbackValueKey:o=_.idendity}={}){if(t instanceof Ti.Dict)return t;if(_.isString(t)){let e=r.DictReferName(t);if(e){let{name:t,dynamic:i,dictKey:n,vkey:l}=r.explainDictName(e);if(l&&o(l),i){let e=_.get(s,n);return e?r.GetDynamicDict({name:t,key:e,vars:s},a):null}return r.CheckDict(e,a)}}return r.CreateDict({data:t,getValue:Ti.Util.genGetter(e||"value|id"),getText:Ti.Util.genGetter(i||"title|text|name"),getIcon:Ti.Util.genGetter(n||"icon")})},CreateDynamicDict(t,e){e&&_.isFunction(t)?s.definations[e]=t:console.error("Can not CreateDynamicDict",{factory:t,name:e})},GetDynamicDict({name:t,key:e,vars:i}={}){let n=`${t}.${e}`,r=_.get(s.instances,n);if(!r){let e=s.definations[t];if(!e)return null;if(!(r=e(i)))return null;_.set(s.instances,n,r)}return r},CheckDynamicDict({name:t,key:e,vars:i}={}){let n=r.GetDynamicDict({name:t,key:e,vars:i});if(n)return n;throw`e.dict.dynamic.WithoutDefined : ${JSON.stringify({name:t,key:e,vars:i})}`},async getBy(t,e){if(Ti.Util.isNil(e))return e;let{name:i,vKey:n}=r.explainDictName(t),s=r.CheckDict(i);return await s.getItemAs(n,e)},async getAll(t){try{let e=r.CheckDict(t);return await e.getData()}catch(e){console.error(`e.dict.getAll : ${t}`,e)}},async getText(t,e){try{let i=r.CheckDict(t);return await i.getItemText(e)}catch(e){console.error(`e.dict.getText : ${t}`,e)}},async getIcon(t,e){try{let i=r.CheckDict(t);return await i.getItemIcon(e)}catch(e){console.error(`e.dict.getIcon : ${t}`,e)}}};return{DictWrapper:t,Dict:i,DictFactory:r}}(),{VueEventBubble:VueEventBubble}=function(){const t=function(t,e,i=!1){t.$parent&&!i&&(_.isFunction(t.__before_bubble)&&(e=t.__before_bubble(e)||e),t.$parent.$notify(e.name,...e.args))},e=function(e,...i){let n,s={name:e,args:i},r=!1;if(_.isFunction(this.__on_events)&&(n=this.__on_events(e,...i)),_.isFunction(n)||(n=_.get(this.$listeners,e)),_.isFunction(n)||(n=this.$tiEventTryFallback(e,this.$listeners)),_.isFunction(n)){let e=this;const i=function(i){r=!0,_.isBoolean(i)?r=i:i&&_.isBoolean(i.stop)&&(r=i.stop,s.name=i.name||s.name),t(e,s,r)};let a=n(...s.args);a instanceof Promise?a.then(i):i(a)}else t(this,s)};return{VueEventBubble:{install(t,{overrideEmit:i=!1}={}){_.assign(t.prototype,{$notify:e,$tiEventTryFallback(t,e={}){let i=_.split(t,"::");for(;i.length>1;){let[,...t]=i,n=t.join("::"),s=_.get(e,n);if(s)return s;i=t}let n=_.keys(e);for(let i of n)if(Ti.AutoMatch.test(i,t))return e[i]}}),i&&t.mixin({created:function(){this.$emit=e}})}}}}(),{VueTiCom:VueTiCom}=function(){const t={inheritAttrs:!1,computed:{...Vuex.mapGetters("viewport",["viewportMode","isViewportModeDesktop","isViewportModeTablet","isViewportModePhone","isViewportModeDesktopOrTablet","isViewportModePhoneOrTablet"]),tiComId(){return`${this._uid}:${this.tiComType}`},getTopClass(){return(...t)=>Ti.Css.mergeClassNameBy(this,{},t,this.className)}},props:{className:void 0,onInit:void 0,onReady:void 0},created:async function(){_.isFunction(this.onInit)&&this.onInit(this)},mounted:function(){_.isFunction(this.onReady)&&this.onReady(this)},beforeDestroyed:function(){Ti.App(this).setBlurredVm(this)}},e={tiActivableComIdPath(t=!0){let e=this.tiActivableComPath(t);return _.map(e,t=>t.tiComId)},tiActivableComPath(t=!0){let e=[this],i=this.$parent;for(;i;)i.__ti_activable__&&e.push(i),i=i.$parent;return t&&e.reverse(),e},tiParentActivableCom(){let t=this.$parent;for(;t&&!t.__ti_activable__;)t=t.$parent;return t},tiParentCom(t){let e=_.upperFirst(_.camelCase(t)),i=this.$parent;for(;i&&i.tiComType!=e;)i=i.$parent;return i},setActived(){},findComBy(t=(()=>!0)){if(this.$children&&this.$children.length>0)for(let e of this.$children){if(t(e))return e;let i=e.findComBy(t);if(i)return i}},findComListBy(t=(()=>!0),e=[]){if(this.$children&&this.$children.length>0)for(let i of this.$children)t(i)?e.push(i):this.findComListBy(t,e);return e}};return{VueTiCom:{install(i){i.mixin(t),_.assign(i.prototype,e),i.filter("i18n",function(t,e={}){return/^i18n:(.+)/.test(t)?Ti.I18n.textf(t,e):Ti.I18n.getf(t,e)}),i.filter("i18nTxt",function(t,e={}){return/^i18n:(.+)/.test(t)?Ti.I18n.textf(t,e):t}),i.filter("percent",function(t,e=2,i=!0){return Ti.S.toPercent(1*t,{fixed:e,auto:i})}),i.filter("float",function(t,e=2,i=0){return Ti.Types.toFloat(t,{precision:e,dft:i})}),i.filter("datetime",function(t,e="yyyy-MM-dd"){return Ti.DateTime.format(t,e)}),i.directive("dropFiles",{bind:function(t,e){let i=null,n=null,s=e.modifiers.mask;_.isArray(e.value)?(i=e.value.length>0?e.value[0]:null,n=e.value.length>1?e.value[1]:null):_.isFunction(e.value)&&(i=e.value),i&&(s&&(n=Ti.I18n.text(n||"i18n:drop-file-here-to-upload")),t.__drag_enter_count=0,t.addEventListener("dragenter",function(e){t.turnOffTiDropFile||(t.__drag_enter_count++,1==t.__drag_enter_count&&(t.setAttribute("ti-is-drag",""),s&&(t.$ti_drag_mask=Ti.Dom.createElement({className:"ti-drag-mask",$p:t}),t.$ti_drag_mask.innerHTML=`<span>${n}</span>`)))}),t.addEventListener("dragover",function(e){t.turnOffTiDropFile||(e.preventDefault(),e.stopPropagation())}),t.addEventListener("dragleave",function(e){t.turnOffTiDropFile||(t.__drag_enter_count--,t.__drag_enter_count<=0&&(t.removeAttribute("ti-is-drag"),t.$ti_drag_mask&&(Ti.Dom.remove(t.$ti_drag_mask),delete t.$ti_drag_mask)))}),t.addEventListener("drop",function(e){t.turnOffTiDropFile||(e.preventDefault(),e.stopPropagation(),t.__drag_enter_count=0,t.removeAttribute("ti-is-drag"),t.$ti_drag_mask&&(Ti.Dom.remove(t.$ti_drag_mask),delete t.$ti_drag_mask),_.isFunction(i)&&i(e.dataTransfer.files))}))}}),i.directive("dropOff",{bind:function(t,e){t.addEventListener("dragover",function(t){t.preventDefault(),t.stopPropagation()}),t.addEventListener("drop",function(t){t.preventDefault(),t.stopPropagation()})}}),i.directive("dragOff",{bind:function(t,e){t.addEventListener("dragstart",function(t){t.preventDefault(),t.stopPropagation()})}}),i.directive("tiActivable",{bind:function(t,{value:e},{context:i}){let n=i;n.__ti_activable__=!0,t.addEventListener("click",function(t){t.__ti_activable_used__||(t.__ti_activable_used__=!0,n.setActived())})}}),i.directive("tiDraggable",{bind:function(t,{value:e},{context:i}){Ti.Be.Draggable(t,e)}})}}}}(),{Album:Album}=function(){const t=["flex-none","item-margin-md","item-padding-no","pic-fit-cover","hover-to-zoom","at-bottom","title-wrap-ellipsis"];class e{constructor(e,i){Ti.Dom.addClass(e,"ti-widget-album"),this.$el=e,this.setup=_.assign({live:!1,attrPrefix:"wn-obj-",dftWallClass:t,itemToPhoto:{name:"=name",link:"=link",thumb:"=thumb",src:"=src",brief:"=brief"}},i);let n=this.getData();this.setup.live&&n.fullpreview&&Ti.Dom.setAttrs(this.$el,{widget:"album-fullpreview",titleKey:`${this.setup.attrPrefix}title`},"ti-live-")}setData(t={}){let{attrPrefix:e}=this.setup,i=this.formatData(t);Ti.Dom.setStyle(this.$el,i.style),Ti.Dom.setAttrs(this.$el,_.omit(i,"style"),e),Ti.Dom.setAttrs(this.$el,{tiAlbumFallsWidth:null,tiAlbumFallsCount:null})}formatData(t={}){let{dftWallClass:e}=this.setup,{id:i,name:n,link:s,linkText:r,newtab:a,layout:o,fullpreview:l,autoopen:h,style:c,exLinkStyle:u,wallStyle:d,partLeftStyle:p,partRightStyle:m,tileStyle:f,imageStyle:g,titleStyle:_,briefStyle:y,wallClass:T}=t;return T=Ti.Dom.getClassList(T,{dftList:e}),c=Ti.Dom.formatStyle(c),u=Ti.Dom.formatStyle(u),d=Ti.Dom.formatStyle(d),f=Ti.Dom.formatStyle(f),p=Ti.Dom.formatStyle(p),m=Ti.Dom.formatStyle(m),g=Ti.Dom.formatStyle(g),_=Ti.Dom.formatStyle(_),y=Ti.Dom.formatStyle(y),{id:i,name:n,link:s,linkText:r,newtab:a,layout:o,fullpreview:l,autoopen:h,wallClass:T.join(" "),style:Ti.Css.renderCssRule(c),exLinkStyle:Ti.Css.renderCssRule(u),wallStyle:Ti.Css.renderCssRule(d),tileStyle:Ti.Css.renderCssRule(f),partLeftStyle:Ti.Css.renderCssRule(p),partRightStyle:Ti.Css.renderCssRule(m),imageStyle:Ti.Css.renderCssRule(g),titleStyle:Ti.Css.renderCssRule(_),briefStyle:Ti.Css.renderCssRule(y)}}getData(){let{attrPrefix:t,styleUrlRewrite:e}=this.setup,i=t.length,n=Ti.Dom.attrs(this.$el,e=>"style"==e?e:e.startsWith(t)?_.camelCase(e.substring(i)):void 0),s={urlRewrite:e,nameCase:"camel"},{style:r,wallClass:a,wallStyle:o,exLinkStyle:l,partLeftStyle:h,partRightStyle:c,tileStyle:u,imageStyle:d,titleStyle:p,briefStyle:m}=n;return n.wallClass=Ti.Dom.getClassList(a).join(" "),n.style=Ti.Css.parseAndTidyCssRule(r,s),n.exLinkStyle=Ti.Css.parseAndTidyCssRule(l,s),n.wallStyle=Ti.Css.parseAndTidyCssRule(o,s),n.tileStyle=Ti.Css.parseAndTidyCssRule(u,s),n.partLeftStyle=Ti.Css.parseAndTidyCssRule(h,s),n.partRightStyle=Ti.Css.parseAndTidyCssRule(c,s),n.imageStyle=Ti.Css.parseAndTidyCssRule(d,s),n.titleStyle=Ti.Css.parseAndTidyCssRule(p,s),n.briefStyle=Ti.Css.parseAndTidyCssRule(m,s),n.type=this.$el.getAttribute("ti-album-type"),n}covertToPhotos(t=[]){let{itemToPhoto:e}=this.setup;return _.map(t,t=>{let i=Ti.Util.explainObj(t,e,{evalFunc:!0});return i.item=t,t.brief&&console.log(i),i})}renderItems(t=[]){let e=this.covertToPhotos(t);this.renderPhotos(e)}renderPhotos(t=[]){let{attrPrefix:e}=this.setup,i=this.getData(),n=Ti.Css.mergeClassName(i.wallClass)||{};n["photo-wall"]=!0,n[`layout-${i.layout||"wall"}`]=!0,n["text-in"]||n["text-out"]||(n["text-in"]=!0);let s=Ti.Dom.createElement({tagName:"div",className:n,style:i.wallStyle});if("falls"==i.layout?this.renderPhotosAsFalls(t,{$wall:s,album:i,attrPrefix:e}):"rows"==i.layout?this.renderPhotosAsRows(t,{$wall:s,album:i,attrPrefix:e}):this.renderPhotosAsWall(t,{$wall:s,album:i,attrPrefix:e}),this.$el.innerHTML="",Ti.Dom.appendTo(s,this.$el),i.link){let t=Ti.Dom.createElement({$p:this.$el,tagName:"a",className:"album-ex-link",style:i.exLinkStyle,attrs:{href:i.link,target:i.newtab?"_blank":void 0}}),e=i.linkText||i.name;t.innerText=e}else Ti.Dom.remove(".album-ex-link",this.$el)}renderPhotosAsWall(t=[],{$wall:e,album:i,attrPrefix:n}){for(let s=0;s<t.length;s++)this.createPhotoTileElement(e,t[s],i,n)}renderPhotosAsRows(t=[],{$wall:e,album:i,attrPrefix:n}){for(let s=0;s<t.length;s++)this.createPhotoTileElement(e,t[s],i,n)}renderPhotosAsFalls(t=[],{$wall:e,album:i,attrPrefix:n}){let{count:s,width:r}=this.evalColumns(e,i);Ti.Dom.setAttrs(this.$el,{count:s,width:r},"ti-album-falls-");let a=[];for(let t=0;t<s;t++){let t=Ti.Dom.createElement({$p:e,tagName:"div",className:"falls-group",style:{width:r}});a.push(t)}let{tileStyle:o,imageStyle:l,titleStyle:h,briefStyle:c}=i,u={tileStyle:o=_.omit(o,"width","maxWidth","minWidth"),imageStyle:l,titleStyle:h,briefStyle:c};for(let e=0;e<t.length;e++){let i=a[e%s];this.createPhotoTileElement(i,t[e],u,n)}}createPhotoTileElement(t,e,{layout:i,tileStyle:n,partLeftStyle:s,partRightStyle:r,imageStyle:a,titleStyle:o,briefStyle:l},h){let{thumb:c,src:u,link:d,name:p,brief:m,item:f}=e,g=Ti.Dom.createElement({$p:t,tagName:"a",className:"wall-tile",style:n,attrs:{href:d||null,title:p||null,target:"_blank"}}),_=g;"rows"==i&&(_=Ti.Dom.createElement({$p:g,tagName:"span",className:"part-left",style:s}));let y=Ti.Dom.createElement({$p:_,tagName:"img",style:a,attrs:{src:c||u,srcLarge:u}}),T=g;if("rows"==i&&(T=Ti.Dom.createElement({$p:g,tagName:"span",className:"part-right",style:r})),p&&!Ti.S.isBlank(p)){let t=Ti.Dom.createElement({$p:T,tagName:"span",className:"tile-title",style:o}),e=p.replace("<","&lt;").replace(/(\r?\n|(\\r)?\\n)/g,"<br>");t.innerHTML=e}if(m&&!Ti.S.isBlank(m)){Ti.Dom.createElement({$p:T,tagName:"span",className:"tile-brief",style:l}).innerText=m}Ti.Dom.setAttrs(y,f,h)}evalColumns(t,e){let{count:i,width:n}=Ti.Dom.attrs(this.$el,(t,e)=>"ti-album-falls-width"==t?"width":"ti-album-falls-count"==t?{name:"count",value:1*e}:void 0);if(i>0)return{count:i,width:n};this.$el.innerHTML="",Ti.Dom.appendTo(t,this.$el),this.showLoading(t);let s=Ti.Dom.find(".album-loading-stub",t),r=s.clientWidth,a=s.ownerDocument.documentElement.style.fontSize||"100px",o={remBase:Ti.Css.toAbsPixel(a),base:r},l=_.get(e,"tileStyle.width")||"25%",h=Ti.Css.toAbsPixel(l,o);if(h>0)return Ti.Dom.remove(s),{count:Math.floor(r/h),width:l};throw"Fail to eval falls columns count: itW: "+l}getPhotos(){let t=`${this.setup.attrPrefix}layout`;if("falls"==this.$el.getAttribute(t))return this.getFallsPhotos();return this.getWallPhotos()}getFallsPhotos(){let t=[],e=Ti.Dom.find(":scope > .photo-wall",this.$el),i=Ti.Dom.findAll(".falls-group",e);if(!_.isEmpty(i)){let e=[],n=0;for(let t of i){let i=Ti.Dom.findAll(".wall-tile",t),s=[];for(let t=0;t<i.length;t++){let e=this.getPhotoDataFromTile(i[t]);s.push(e),n++}e.push(s)}for(;n>0;)for(let i=0;i<e.length;i++){let s=e[i];if(s.length>0){let e=s.shift();t.push(e),n--}}}return t}getWallPhotos(){let t=[],e=Ti.Dom.find(":scope > .photo-wall",this.$el),i=Ti.Dom.findAll(".wall-tile",e);for(let e=0;e<i.length;e++){let n=this.getPhotoDataFromTile(i[e]);t.push(n)}return t}getPhotoDataFromTile(t){let e=this.setup.attrPrefix,i=e.length,n=Ti.Dom.find("img",t),s=Ti.Dom.find(".tile-brief",t),r=Ti.Dom.attrs(n,(t,n)=>{if(t.startsWith(e)){let e=_.camelCase(t.substring(i)),s=n;if(/^\{.*\}$/.test(n))try{s=JSON.parse(n)}catch(t){}return{name:e,value:s}}});return{name:t.getAttribute("title")||null,brief:s?s.innerText:null,link:t.getAttribute("href")||null,thumb:n.getAttribute("src")||null,src:n.getAttribute("src-large")||null,item:r}}convertToItems(t=[]){return _.map(t,t=>t.item)}getItems(){let t=this.getPhotos();return this.convertToItems(t)}showLoading(t){(t=t||this.$el).innerHTML=['<div class="album-loading-stub">','<i class="fas fa-spinner fa-spin"></i>',"</div>"].join("")}}return{Album:{getEditFormConfig(t){let e=_.kebabCase(t);return{className:"no-status",spacing:"tiny",fields:[{title:`i18n:hmk-${e}-info`,fields:[{title:`i18n:hmk-${e}-id`,name:"id",comConf:{className:"is-nowrap",fullField:!1}},{title:`i18n:hmk-${e}-name`,name:"name"},{title:"i18n:href",name:"link",comType:"ti-input"},{title:"i18n:href-text",name:"linkText",comType:"ti-input"},{title:"i18n:newtab",name:"newtab",type:"Boolean",comType:"ti-toggle"},{title:"i18n:hmk-w-edit-album-fullpreview",name:"fullpreview",type:"Boolean",comType:"TiToggle"},{title:"i18n:hmk-w-edit-album-autoopen",name:"autoopen",type:"Boolean",comType:"TiToggle"}]},{title:"i18n:hmk-aspect",fields:[{title:"i18n:layout",name:"layout",defaultAs:"wall",comType:"TiSwitcher",comConf:{options:[{value:"wall",text:"i18n:hmk-layout-wall"},{value:"rows",text:"i18n:hmk-layout-rows"},{value:"falls",text:"i18n:hmk-layout-falls"}]}},{title:"i18n:style",name:"wallClass",emptyAs:null,comType:"HmPropClassPicker",comConf:{valueType:"String",dialogHeight:640,form:{fields:[{title:"i18n:hmk-class-flex",name:"flexMode",comType:"TiSwitcher",comConf:{options:[{value:"flex-none",text:"i18n:hmk-class-flex-none"},{value:"flex-both",text:"i18n:hmk-class-flex-both"},{value:"flex-grow",text:"i18n:hmk-class-flex-grow"},{value:"flex-shrink",text:"i18n:hmk-class-flex-shrink"}]}},{title:"i18n:hmk-class-item-padding",name:"itemPadding",comType:"TiSwitcher",comConf:{options:[{value:"item-padding-no",text:"i18n:hmk-class-sz-no"},{value:"item-padding-xs",text:"i18n:hmk-class-sz-xs"},{value:"item-padding-sm",text:"i18n:hmk-class-sz-sm"},{value:"item-padding-md",text:"i18n:hmk-class-sz-md"},{value:"item-padding-lg",text:"i18n:hmk-class-sz-lg"},{value:"item-padding-xl",text:"i18n:hmk-class-sz-xl"}]}},{title:"i18n:hmk-class-item-margin",name:"itemMargin",comType:"TiSwitcher",comConf:{options:[{value:"item-margin-no",text:"i18n:hmk-class-sz-no"},{value:"item-margin-xs",text:"i18n:hmk-class-sz-xs"},{value:"item-margin-sm",text:"i18n:hmk-class-sz-sm"},{value:"item-margin-md",text:"i18n:hmk-class-sz-md"},{value:"item-margin-lg",text:"i18n:hmk-class-sz-lg"},{value:"item-margin-xl",text:"i18n:hmk-class-sz-xl"}]}},{title:"i18n:hmk-class-text-at",name:"textAt",comType:"TiSwitcher",comConf:{options:[{value:"at-top",text:"i18n:hmk-class-at-top"},{value:"at-center",text:"i18n:hmk-class-at-center"},{value:"at-bottom",text:"i18n:hmk-class-at-bottom"}]}},{title:"i18n:hmk-class-text-mode",name:"textMode",comType:"TiSwitcher",comConf:{options:[{value:"text-in",text:"i18n:hmk-class-text-in"},{value:"text-out",text:"i18n:hmk-class-text-out"}]}},{title:"i18n:hmk-class-text-at",name:"textAt",comType:"TiSwitcher",comConf:{options:[{value:"at-top",text:"i18n:hmk-class-at-top"},{value:"at-center",text:"i18n:hmk-class-at-center"},{value:"at-bottom",text:"i18n:hmk-class-at-bottom"}]}},{title:"i18n:hmk-class-title-wrap",name:"titleWrap",defaultAs:"title-warp",comType:"TiSwitcher",comConf:{options:[{value:"title-wrap-auto",text:"i18n:hmk-class-text-wrap-auto"},{value:"title-wrap-clip",text:"i18n:hmk-class-text-wrap-clip"},{value:"title-wrap-ellipsis",text:"i18n:hmk-class-text-wrap-ellipsis"}]}},{title:"i18n:hmk-class-object-fit",name:"picFit",comType:"TiSwitcher",comConf:{options:[{value:"pic-fit-fill",text:"i18n:hmk-class-object-fit-fill"},{value:"pic-fit-cover",text:"i18n:hmk-class-object-fit-cover"},{value:"pic-fit-contain",text:"i18n:hmk-class-object-fit-contain"},{value:"pic-fit-none",text:"i18n:hmk-class-object-fit-none"}]}},{title:"i18n:hmk-class-hover",name:"textHover",comType:"TiSwitcher",comConf:{options:[{value:"hover-to-up",text:"i18n:hmk-class-hover-to-up"},{value:"hover-to-scale",text:"i18n:hmk-class-hover-to-scale"},{value:"hover-to-zoom",text:"i18n:hmk-class-hover-to-zoom"}]}}]}}}]},{title:"i18n:hmk-style-adv",fields:[{title:"i18n:hmk-style-outside",name:"style",type:"Object",emptyAs:null,comType:"HmPropCssRules",comConf:{rules:"#BLOCK"}},{title:"i18n:hmk-style-inside",name:"wallStyle",type:"Object",emptyAs:null,comType:"HmPropCssRules",comConf:{rules:"#BLOCK"}},{title:"i18n:hmk-style-tile",name:"tileStyle",type:"Object",emptyAs:null,comType:"HmPropCssRules",comConf:{rules:"#BLOCK"}},{title:"i18n:hmk-style-part-left",name:"partLeftStyle",type:"Object",emptyAs:null,hidden:{"!layout":"rows"},comType:"HmPropCssRules",comConf:{rules:"#BLOCK"}},{title:"i18n:hmk-style-part-right",name:"partRightStyle",type:"Object",emptyAs:null,hidden:{"!layout":"rows"},comType:"HmPropCssRules",comConf:{rules:"#BLOCK"}},{title:"i18n:hmk-style-image",name:"imageStyle",type:"Object",emptyAs:null,comType:"HmPropCssRules",comConf:{rules:"#IMG"}},{title:"i18n:hmk-style-title",name:"titleStyle",type:"Object",emptyAs:null,comType:"HmPropCssRules",comConf:{rules:"#TEXT-BLOCK"}},{title:"i18n:hmk-style-brief",name:"briefStyle",type:"Object",emptyAs:null,comType:"HmPropCssRules",comConf:{rules:"#TEXT-BLOCK"}},{title:"i18n:hmk-style-exlink",name:"exLinkStyle",type:"Object",emptyAs:null,comType:"HmPropCssRules",comConf:{rules:"#TEXT-BLOCK"}}]}]}},registryTinyMceMenuItem(t,{prefix:e,settings:i,GetCurrentAlbumElement:n}){const s=(...t)=>_.camelCase(t.join("-"));let r=_.kebabCase(["wn",e].join("-")),a=s("Wn",e,"Prop"),o=s("Wn",e,"Reload"),l=s("Wn",e,"AutoFitWidth"),h=s("Wn",e,"Margin"),c=s("Wn",e,"ClrSize"),u=s("Set",e,"Style"),d=s("Reload",e),p=s("Show",e,"Prop"),m=_.kebabCase(e);return t.ui.registry.addMenuItem(c,{text:Ti.I18n.text(`i18n:hmk-${m}-clrsz`),onAction(){t.execCommand(u,t,{width:"",height:"",maxWidth:"",maxHeight:"",minWidth:"",minHeight:""})}}),t.ui.registry.addMenuItem(l,{text:Ti.I18n.text(`i18n:hmk-${m}-autofit`),onAction(){t.execCommand(u,t,{width:"100%",maxWidth:"",minWidth:""})}}),t.ui.registry.addMenuItem(h,{text:Ti.I18n.text(`i18n:hmk-${m}-margin`),getSubmenuItems:function(){const e=function(e,i){let s=n(t),r=!0;if(s){r=i==(s.style.marginLeft||s.style.marginRight)}return e.setActive(r),function(){}};return[{type:"togglemenuitem",text:Ti.I18n.text("i18n:hmk-margin-sm"),onAction(){t.execCommand(u,t,{margin:"1em"})},onSetup:function(t){return e(t,"1em")}},{type:"togglemenuitem",text:Ti.I18n.text("i18n:hmk-margin-md"),onAction(){t.execCommand(u,t,{margin:"2em"})},onSetup:function(t){return e(t,"2em")}},{type:"togglemenuitem",text:Ti.I18n.text("i18n:hmk-margin-lg"),onAction(){t.execCommand(u,t,{margin:"3em"})},onSetup:function(t){return e(t,"3em")}},{type:"menuitem",icon:"align-center",text:Ti.I18n.text("i18n:hmk-margin-center"),onAction(){t.execCommand(u,t,{margin:"0 auto"})}},{type:"menuitem",icon:"square-6",text:Ti.I18n.text("i18n:hmk-margin-no"),onAction(){t.execCommand(u,t,{margin:""})}}]}}),t.ui.registry.addMenuItem(o,{icon:"sync-alt-solid",text:Ti.I18n.text(`i18n:hmk-${m}-refresh`),onAction(){t.execCommand(d,t,i)}}),t.ui.registry.addMenuItem(a,{text:Ti.I18n.text(`i18n:hmk-${m}-prop`),onAction(){t.execCommand(p,t,i)}}),t.ui.registry.addContextMenu(r,{update:function(e){let i=n(t);return _.isElement(i)?[[c,l].join(" "),[h,o].join(" "),a].join(" | "):[]}}),{NM_MENU:r,NM_PROP:a,NM_RELOAD:o,NM_AUTO_FIT_WIDTH:l,NM_MARGIN:h,NM_CLR_SZ:c,CMD_SET_STYLE:u,CMD_RELOAD:d,CMD_PROP:p}},getOrCreate:(t,i={})=>(t.__ti_photo_wall||(t.__ti_photo_wall=new e(t,i)),t.__ti_photo_wall)}}}(),{PhotoGallery:PhotoGallery}=function(){class t{constructor(t,e){this.currentIndex=0,this.$doc=t.ownerDocument,this.$el=t,this.setup=_.assign({className:"ti-widget-photo-gallery",topStyle:{},viewportStyle:{},scrollerStyle:{},tileStyle:{},imgStyle:{},indicatorStyle:{},indicatorUlStyle:{},indicatorItStyle:{},indicatorItImgStyle:{},thumbKey:"src",largeKey:"src-large",titleKey:"title",zoomStep:-.1},e),this.$top=null,this.zoomScale=1,this.translateX=0,this.translateY=0}getData(){let{thumbKey:t,largeKey:e,titleKey:i,getData:n}=this.setup;if(_.isFunction(n))return n(this);let s=[],r=Ti.Dom.findAll("img[src]",this.$el);for(let n=0;n<r.length;n++){let a,o=r[n],l=o.getAttribute(t),h=o.getAttribute(e),c=o.getAttribute(i),u=Ti.Dom.closest(o,"a[href]");u&&("#"!=(a=u.getAttribute("href"))&&"void(0)"!=a||(a=void 0)),s.push({index:n,srcThumb:l,srcLarge:h,link:a,title:c,src:h||l})}return s}findPhotoIndex(t,e=this.data){let i=t;if(_.isElement(i)&&(i=i.getAttribute("src")),_.isArray(e))for(let t=0;t<e.length;t++){let n=e[t];if(n.srcLarge==i||n.srcThumb==i)return t}return-1}scrollToPrev(){this.currentIndex>0&&this.scrollTo(this.currentIndex-1)}scrollToNext(){this.currentIndex<this.data.length-1&&this.scrollTo(this.currentIndex+1)}scrollTo(t=this.currentIndex){let{imgStyle:e}=this.setup;this.resizePhotos(this.$scroller),this.zoomScale=1,this.translateX=0,this.translateY=0,this.applyImageTransform();let i=this.$viewport.clientWidth,n=t||0;this.currentIndex=n;let s=i*this.currentIndex*-1;this.$scroller.style.left=`${s}px`;let r=this.getImageTile(n);if(r&&"yes"==r.getAttribute("img-nil")){let t=r.getAttribute("src-thumb"),i=Ti.Dom.find("span",r);i&&Ti.Dom.updateStyle(i,{backgroundImage:`url(${t})`});let n=r.getAttribute("src-large");if(Ti.Dom.createElement({$p:r,tagName:"img",style:e,attrs:{src:n}}).addEventListener("load",()=>{r.removeAttribute("img-nil"),r.setAttribute("img-loaded","yes")},{once:!0}),_.isElement(this.$opener)){let t=_.trim(r.getAttribute("href"))||null;Ti.Dom.setAttrs(this.$opener,{href:t})}}this.$currentImg=Ti.Dom.find("img",r);let a=Ti.Dom.find("a.is-current",this.$indicatorUl);a&&Ti.Dom.removeClass(a,"is-current"),(a=Ti.Dom.find(`a[gallery-index="${n}"]`,this.$indicatorUl))&&Ti.Dom.addClass(a,"is-current"),0==this.currentIndex?Ti.Dom.addClass(this.$top,"no-prev"):Ti.Dom.removeClass(this.$top,"no-prev"),this.currentIndex>=this.data.length-1?Ti.Dom.addClass(this.$scroller,"no-next"):Ti.Dom.removeClass(this.$scroller,"no-next")}scrollIndicatorToPage(t=-1){let e=Ti.Css.toPixel(this.$indicatorUl.style.left||0),i=this.$indicatorCon.clientWidth;this.scrollIndicatorTo(e+i*t)}scrollIndicatorTo(t=0){let e=this.$indicatorCon.clientWidth-this.$indicatorCon.scrollWidth,i=_.clamp(t,e,0);this.$indicatorUl.style.left=`${i}px`}getImageTile(t=this.currentIndex){return Ti.Dom.find(`.as-tile[gallery-index="${t}"]`,this.$scroller)}applyImageTransform(){let t={transform:1!=this.zoomScale?`scale(${this.zoomScale})`:"",left:this.translateX?`${this.translateX}px`:"",top:this.translateY?`${this.translateY}px`:""};Ti.Dom.updateStyle(this.$currentImg,t);let e=Ti.Dom.closest(this.$currentImg,".as-tile");e&&(this.zoomScale>1?e.setAttribute("img-zoom","in"):this.zoomScale<1?e.setAttribute("img-zoom","out"):e.removeAttribute("img-zoom"))}changeZoomScale(t){t>0?this.zoomScale+=this.zoomScale*this.setup.zoomStep:t<0&&(this.zoomScale-=this.zoomScale*this.setup.zoomStep,this.zoomScale=Math.max(0,this.zoomScale)),this.applyImageTransform()}resizePhotos(t=this.$scroller){let e=`${this.$viewport.clientWidth}px`,i=`${this.$viewport.clientHeight}px`,n=Ti.Dom.findAll(".as-tile",t);for(let t of n)t.style.width=e,t.style.height=i;let s=this.$indicatorCon;s.scrollWidth>s.clientWidth?this.$indicator.setAttribute("item-overflow","yes"):this.$indicator.removeAttribute("item-overflow"),this.renderClipIndicatorPhotos()}renderClipIndicatorPhotos(){let{indicatorItImgStyle:t}=this.setup,e=Ti.Rects.createBy(this.$indicatorCon),i=Ti.Dom.findAll("a[img-nil]",this.$indicatorUl);for(let n=0;n<i.length;n++){let s=i[n],r=Ti.Rects.createBy(s);if(e.isOverlap(r)){let e=s.getAttribute("src-thumb");s.innerHTML="",s.removeAttribute("img-nil"),Ti.Dom.createElement({$p:s,tagName:"img",style:t,attrs:{src:e}})}}}renderPhotos(t=this.data){let{tileStyle:e,indicatorItStyle:i}=this.setup,n=Ti.Dom.createElement({tagName:"div"}),s=Ti.Dom.createElement({tagName:"ul"});if(_.isArray(t)){let r=0;for(let a of t){let t=r++,o=Ti.Dom.createElement({$p:n,tagName:"div",className:"as-tile",style:e,attrs:{galleryIndex:t,href:a.link,target:"_blank",srcThumb:a.srcThumb,srcLarge:a.srcLarge,imgNil:"yes"}});Ti.Dom.createElement({$p:o,tagName:"span",className:"nil-img"}).innerHTML='<i class="fas fa-spinner fa-spin"></i>',a.title&&(Ti.Dom.createElement({$p:o,tagName:"header"}).innerText=a.title.replace(/\r?\n/g," "));let l=Ti.Dom.createElement({$p:s,tagName:"a",style:i,attrs:{href:`javascript:void(${t})`,galleryIndex:t,srcThumb:a.srcThumb,imgNil:"yes"}});Ti.Dom.createElement({$p:l,tagName:"span",className:"nil-img"})}}this.currentIndex=0,this.$scroller.innerHTML=n.innerHTML,this.$indicatorUl.innerHTML=s.innerHTML,this.resizePhotos()}redraw(){if(this.$top)return;let{className:t,topStyle:e,viewportStyle:i,scrollerStyle:n,indicatorStyle:s,indicatorUlStyle:r,showOpener:a}=this.setup;this.$top=Ti.Dom.createElement({tagName:"div",className:t||"ti-widget-photo-gallery",style:e}),Ti.Dom.addClass(this.$top,"no-ready"),this.$con=Ti.Dom.createElement({$p:this.$top,tagName:"div",className:"photo-gallery-con"}),this.$viewport=Ti.Dom.createElement({$p:this.$con,tagName:"div",className:"as-viewport",style:i}),this.$scroller=Ti.Dom.createElement({$p:this.$viewport,tagName:"div",className:"as-scroller",style:n}),a&&(this.$opener=Ti.Dom.createElement({$p:this.$viewport,tagName:"a",className:"as-opener",attrs:{target:"_blank"}}),this.$opener.innerHTML='<i class="zmdi zmdi-open-in-new"></i>'),this.$toolbar=Ti.Dom.createElement({$p:this.$viewport,tagName:"div",className:"as-toolbar"}),this.$zoomIn=Ti.Dom.createElement({$p:this.$toolbar,tagName:"a",className:"as-zoom-in",attrs:{href:"javascript:void(0)"}}),this.$zoomIn.innerHTML='<i class="zmdi zmdi-zoom-in"></i>',this.$zoomOut=Ti.Dom.createElement({$p:this.$toolbar,tagName:"a",className:"as-zoom-out",attrs:{href:"javascript:void(0)"}}),this.$zoomOut.innerHTML='<i class="zmdi zmdi-zoom-out"></i>',this.$indicator=Ti.Dom.createElement({$p:this.$con,tagName:"div",className:"as-indicator",style:s}),this.$indicatorCon=Ti.Dom.createElement({$p:this.$indicator,tagName:"div",className:"as-indi-con"}),this.$indicatorUl=Ti.Dom.createElement({$p:this.$indicatorCon,tagName:"ul",style:_.assign({left:0},r)}),this.$indiBtnToPrev=Ti.Dom.createElement({$p:this.$indicator,tagName:"div",className:"as-indi-btn to-prev"}),this.$indiBtnToPrev.innerHTML='<span><i class="fas fa-chevron-left"></i></span>',this.$indiBtnToNext=Ti.Dom.createElement({$p:this.$indicator,tagName:"div",className:"as-indi-btn to-next"}),this.$indiBtnToNext.innerHTML='<span><i class="fas fa-chevron-right"></i></span>',this.$switcher=Ti.Dom.createElement({$p:this.$con,tagName:"div",className:"as-switcher"}),this.$btnPrev=Ti.Dom.createElement({$p:this.$switcher,tagName:"div",className:"as-switcher-btn is-prev"}),this.$btnPrev.innerHTML='<span><i class="zmdi zmdi-chevron-left"></i></span>',this.$btnNext=Ti.Dom.createElement({$p:this.$switcher,tagName:"div",className:"as-switcher-btn is-next"}),this.$btnNext.innerHTML='<span><i class="zmdi zmdi-chevron-right"></i></span>',this.$closer=Ti.Dom.createElement({$p:this.$con,tagName:"div",className:"as-closer"}),this.$closer.innerHTML='<a href="javascript:void(0)"><i class="zmdi zmdi-close"></i></a>',Ti.Dom.appendTo(this.$top,this.$doc.body),this.data=this.getData(),this.renderPhotos(),this.$closer.addEventListener("click",()=>this.close()),Ti.Dom.find("span",this.$btnPrev).addEventListener("click",()=>{this.scrollToPrev()}),Ti.Dom.find("span",this.$btnNext).addEventListener("click",()=>{this.scrollToNext()}),this.$indicator.addEventListener("click",({srcElement:t})=>{let e=Ti.Dom.closest(t,"[gallery-index]");if(e){let t=1*e.getAttribute("gallery-index");return void(t>=0&&this.scrollTo(t))}let i=Ti.Dom.closest(t,".as-indi-btn");if(i){let t=Ti.Dom.hasClass(i,"to-prev")?1:-1;this.scrollIndicatorToPage(t)}});let o=this;this.OnResize=function(){Ti.Dom.addClass(o.$top,"is-resizing"),o.resizePhotos(),o.scrollTo(),_.delay(()=>{Ti.Dom.removeClass(o.$top,"is-resizing")},100)},this.OnWheel=function(t){t.preventDefault(),t.stopPropagation(),this.changeZoomScale(t.deltaY)},Ti.Dom.removeClass(this.$top,"no-ready"),Ti.Dom.addClass(this.$top,"is-ready")}watchEvents(){this.$doc.defaultView.addEventListener("resize",this.OnResize,!0),this.$top.onwheel=(t=>{this.OnWheel(t)}),this.$top.ondblclick=(t=>{Ti.Dom.closest(t.srcElement,".as-toolbar")||(this.zoomScale=1,this.translateX=0,this.translateY=0,this.applyImageTransform())}),Ti.Dom.isTouchDevice()?(this.$zoomIn.ontouchstart=(t=>{t.stopPropagation(),this.changeZoomScale(-1)}),this.$zoomOut.ontouchstart=(t=>{t.stopPropagation(),this.changeZoomScale(1)})):(this.$zoomIn.onclick=(t=>{t.stopPropagation(),this.changeZoomScale(-1)}),this.$zoomOut.onclick=(t=>{t.stopPropagation(),this.changeZoomScale(1)})),this.$indicatorUl.addEventListener("transitionend",_.debounce(()=>{this.renderClipIndicatorPhotos()},500)),Ti.Be.Draggable(this.$viewport,{prepare:t=>{t.$event.preventDefault(),t._x=this.translateX,t._y=this.translateY},actived:()=>{Ti.Dom.addClass(this.$scroller,"is-moving")},dragging:({_x:t,_y:e,offsetX:i,offsetY:n})=>{this.translateX=t+i,this.translateY=e+n,this.applyImageTransform()},done:()=>{Ti.Dom.removeClass(this.$scroller,"is-moving")}})}unwatchEvents(){this.$doc.defaultView.removeEventListener("resize",this.OnResize,!0)}close(){_.isFunction(this.setup.onBeforeClose)&&this.setup.onBeforeClose(),this.$top&&(this.$top.addEventListener("transitionend",()=>{Ti.Dom.remove(this.$top),this.$top=null,_.isFunction(this.setup.onClosed)&&this.setup.onClosed()},{once:!0}),Ti.Dom.removeClass(this.$top,"is-ready"),Ti.Dom.addClass(this.$top,"no-ready"),this.unwatchEvents())}}return{PhotoGallery:{bind(e,i={}){if(e){if(!e.__ti_photo_gallery){let n=new t(e,i);e.addEventListener("click",function(t){if(_.isFunction(i.ignoreSrcElement)&&i.ignoreSrcElement(t.srcElement))return;t.preventDefault(),t.stopPropagation(),n.redraw(),n.watchEvents();let e=t.srcElement;n.currentIndex=Math.max(0,n.findPhotoIndex(e)),n.scrollTo()},!0),e.__ti_photo_gallery=n}return e.__ti_photo_gallery}}}}}(),{WalnutAppMain:WalnutAppMain}=function(){return{WalnutAppMain:async function({rs:t="/gu/rs/",appName:e="wn.manager",preloads:i=[],debug:n=!1,logging:s={root:"warn"},shortcute:r=!0,theme:a,lang:o="zh-cn",viewport:l={phoneMaxWidth:540,tabletMaxWidth:768,designWidth:1e3,max:100,min:80}}={}){Ti.AddResourcePrefix(t),Vue.use(Ti.Vue.EventBubble),Vue.use(Ti.Vue.TiCom),Ti.SetForDev(n),Ti.SetLogLevel(s.root),_.forEach(s.names,(t,e)=>{Ti.SetLogLevel(t,e)}),r&&Ti.Shortcut.startListening(),l&&Ti.Viewport.startListening(),Ti.SetAppName(e),Ti.Config.set({prefix:{app:"/a/load/",MyApp:`/a/load/${e}/`,theme:`${t}ti/theme/`,lib:`${t}ti/lib/`,deps:`${t}ti/deps/`,dist:`${t}ti/dist/`,mod:`${t}ti/mod/`,com:`${t}ti/com/`,i18n:`${t}ti/i18n/`},alias:{"^./":"@MyApp:","^@MyApp:?$":"@MyApp:_app.json","^@i18n:(.+)$":`@i18n:${o}/$1`,"/i18n/":`/i18n/${o}/`,"^(@[A-Za-z]+):i18n/(.+)$":`$1:i18n/${o}/$2`},suffix:{"^@theme:":".css","^@app:":"/_app.json","(^@mod:|[/:]mod/)":"/_mod.json","(^@com:|[/:]com/)":"/_com.json","(^@i18n:|[/:]i18n/)":".i18n.json"},lang:o});let h=await Wn.Sys.exec("ti config -cqn",{appName:e,as:"json"});if(_.isEmpty(h)||Ti.Config.update(h),!_.isEmpty(i)){let t=[];_.forEach(i,e=>{t.push(Ti.Load(e))}),await Promise.all(t)}if(h.icons&&Ti.Icons.put(h.icons),h.i18n&&Ti.I18n.put(await Ti.Load(h.i18n)),h.css){let t=[].concat(h.css);for(let e of t){let t=Ti.S.renderBy(e,{theme:a});await Ti.Load(t)}}let c=await Ti.Load("@MyApp");if(_.assign(c.data,h.gui),_.isEmpty(h.components)||Ti.Util.pushUniqValue(c,"components",h.components),_.isEmpty(h.deps)||Ti.Util.pushUniqValue(c,"deps",h.deps),!_.isEmpty(h.preloads)){let t=[];_.forEach(h.preloads,e=>{t.push(Ti.Load(e))}),await Promise.all(t)}if(!_.isEmpty(h.rsPrefixes)){let t=_.concat(h.rsPrefixes);Ti.AddResourcePrefix(...t)}for(let t of _.keys(h.global)){let e=h.global[t],i=await Ti.Load(e);window[t]=i}Ti.I18n.put(await Ti.Load(["@i18n:_ti","@i18n:_wn","@i18n:_net","@i18n:web","@i18n:hmaker","@i18n:ti-datetime"])),Wn.Dict.setup(h.dictionary);let u=Ti.App(c,async t=>{_.merge(t.data,h.data)});await u.init(),Ti.Dom.watchAutoRootFontSize(l,({$root:t,mode:e,fontSize:i})=>{t.style.fontSize=i+"px",t.setAttribute("as",e),Ti.App.eachInstance(t=>{t.commit("viewport/setMode",e)})}),u.commit("session/set",_app.session),await Wn.Session.setup(_app.session),Wn.Session.loadMyPvg(),Ti.Env(Wn.Session.env()),u.mountTo("#app"),Ti.App.pushInstance(u);let d="~";return _app.obj&&(d="id:"+_app.obj.id),await u.dispatch("viewport/reload"),await u.dispatch("current/reload",d),Ti.Toptip.watch(),u.get("obj")}}}(),{WebAppMain:WebAppMain}=function(){return{WebAppMain:async function({rs:t="/gu/rs/",siteRs:e="/",vars:i={},lang:n="zh-cn",appJson:s,siteId:r,domain:a,preloads:o=[],debug:l=!1,logging:h={root:"warn"},shortcute:c=!0,viewport:u={phoneMaxWidth:640,tabletMaxWidth:900,designWidth:1200,max:100,min:70}}={}){const d=Ti.Util.parseHref(window.location.href);t=_.get(i,"rs")||t,e=_.get(i,"siteRs")||e;let p=_.get(i,"confHome")||`/gu/mnt/project/${a}/_ti/`;if(n=_.get(i,"lang")||n,s.langInPath){let{match:t,group:e}=s.langInPath||{};if(t&&e){let i=new RegExp(t).exec(d.path);i&&(n=_.kebabCase(i[e]))}}if(Ti.AddResourcePrefix(t,e),Vue.use(Ti.Vue.EventBubble),Vue.use(Ti.Vue.TiCom),Ti.SetForDev(l),Ti.SetLogLevel(h.root),_.forEach(h.names,(t,e)=>Ti.SetLogLevel(e,t)),c&&Ti.Shortcut.startListening(),u&&Ti.Viewport.startListening(),Ti.Config.set({prefix:{Site:`${e}`,Conf:`${p}`,theme:`${t}ti/theme/`,lib:`${t}ti/lib/`,deps:`${t}ti/deps/`,dist:`${t}ti/dist/`,mod:`${t}ti/mod/`,com:`${t}ti/com/`,i18n:`${t}ti/i18n/`},alias:{"^./":"@Site:","^@Site:?$":"@Site:_app.json","^@i18n:(.+)$":`@i18n:${n}/$1`,"[:/]i18n/":`$&${n}/`},suffix:{"^@theme:":".css","^@app:":"/_app.json","(^@mod:|(^|[/:])mod/)":"/_mod.json","(^@com:|(^|[/:])com/)":"/_com.json","(^@i18n:|(^|[/:])i18n/)":".i18n.json"},lang:n}),!_.isEmpty(o))for(let t of o)await Ti.Load(t);if(s.css){let t=_.concat(s.css),e={theme:s.theme||"light"};for(let i of t)if(i){let t=Ti.S.renderBy(i,e);await Ti.Load(t)}s.css=void 0}_.isArray(i.deps)&&Ti.Util.pushUniqValue(s,"deps",i.deps),Ti.I18n.put(await Ti.Load(["@i18n:_ti","@i18n:_net","@i18n:_wn","@i18n:web","@i18n:ti-datetime"]));let m=await Ti.App(s,e=>(_.assign(e.store.state,i,{loading:!1,siteId:r,domain:a,rs:t,lang:n}),e));return await m.init(),Ti.App.pushInstance(m),window.TiWebApp=m,Ti.SetAppName(m.name()),Ti.Dom.watchAutoRootFontSize(u,({$root:t,mode:e,fontSize:i})=>{t.style.fontSize=i+"px",t.setAttribute("as",e),Ti.App.eachInstance(t=>{t.commit("viewport/setMode",e)})}),m.mountTo("#app"),await m.dispatch("reload",{loc:d,lang:n}),m}}}(),LOAD_CACHE={};let RS_PREFIXs=[];const ENV={version:"1.2.3",dev:!1,appName:null,session:{},log:{ROOT:0}},LOG_LEVELS={error:0,warn:1,info:2,debug:3,trace:4},G_FUNCS={},Ti={Alg:Alg,Be:Be,S:S,Tmpl:Tmpl,Util:Util,App:App,Err:Err,Config:Config,Dom:Dom,Css:Css,Load:Load,Http:Http,Icons:Icons,I18n:I18n,Shortcut:Shortcut,Fuse:Fuse,Random:Random,Storage:Storage,Types:Types,Viewport:Viewport,WWW:WWW,GPS:GPS,GIS:GIS,Validate:Validate,DateTime:DateTime,Num:Num,Trees:Trees,Bank:Bank,Mapping:Mapping,Dict:Dict,DictFactory:DictFactory,Rects:Rects,Rect:Rect,AutoMatch:AutoMatch,Websocket:TiWebsocket,Widget:{Album:Album,PhotoGallery:PhotoGallery},Preload:Preload,MatchCache:MatchCache,AddResourcePrefix:AddResourcePrefix,RS_PREFIXs:RS_PREFIXs,LOAD_CACHE:LOAD_CACHE,WalnutAppMain:WalnutAppMain,WebAppMain:WebAppMain,Vue:{EventBubble:VueEventBubble,TiCom:VueTiCom},Alert:Alert,Confirm:Confirm,Prompt:Prompt,Toast:Toast,Captcha:Captcha,Toptip:Toptip,EditCode:EditCode,Env:(t,e)=>(_.isObject(t)&&_.forEach(t,(t,e)=>{_.set(ENV,e,t)}),_.isUndefined(t)?ENV:Ti.Util.geset(ENV,t,e)),Version:()=>Ti.Env("version"),SetForDev(t=!0){Ti.Env({dev:t})},IsForDev:()=>Ti.Env("dev"),SetAppName(t){Ti.Env({appName:t})},GetAppName:()=>Ti.Env("appName"),SetLogLevel(t=0,e="ROOT"){_.isString(t)&&(t=LOG_LEVELS[t]||0),ENV.log[e]=t},IsError:t=>_IS_LOG(t,LOG_LEVELS.error),IsWarn:t=>_IS_LOG(t,LOG_LEVELS.warn),IsInfo:t=>_IS_LOG(t,LOG_LEVELS.info),IsDebug:t=>_IS_LOG(t,LOG_LEVELS.debug),IsTrace:t=>_IS_LOG(t,LOG_LEVELS.trace),Invoke(t,e=[],i){if(_.isFunction(t))return i=i||this,t.apply(i,e)},InvokeBy(t={},e,i=[],n){if(t)return Ti.Invoke(t[e],i,n||t)},async DoInvoke(t,e=[],i){if(_.isFunction(t))return i=i||this,await t.apply(i,e)},async DoInvokeBy(t={},e,i=[],n){if(t)return await Ti.DoInvoke(t[e],i,n||t)},AddGlobalFuncs(t){_.assign(G_FUNCS,t)},GlobalFuncs:()=>_.assign({},Ti.Types,G_FUNCS)};export default Ti;window&&(window.Ti=Ti);