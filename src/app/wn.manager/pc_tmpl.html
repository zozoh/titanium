<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${title}</title>
  <!--link rel="stylesheet" type="text/css"
        href="${rs}/core/css/font-md/css/material-design-iconic-font.css"-->
  <script src="${rs}/ti/deps/axios.min.js"></script>
  <script src="${rs}/ti/deps/lodash.min.js"></script>
  <script src="${rs}/ti/deps/vue.js"></script>
  <script src="${rs}/ti/deps/vuex.js"></script>

  <link rel="stylesheet" href="${rs}/ti/deps/element-ui/index.css">
  <script src="${rs}/ti/deps/element-ui/index.js"></script>

  <!--link rel="stylesheet" href="${rs}/ti/deps/muse-ui/muse-ui.css">
  <script src="${rs}/ti/deps/muse-ui/muse-ui.js"></script-->
</head>
<body class="main-body">
<div id="app">
  Loading...
</div>
</body>
<script type="module">
import {Ti} from "${rs}/ti/core/ti.mjs"
//---------------------------------------
window._app = ${app};
//---------------------------------------
Ti.SetForDev(true)
Ti.SetLogLevel("debug")
//---------------------------------------
Ti.Config.set({
  prefix : {
    "app"   : "/a/load/",
    "MyApp" : "/a/load/${appName}/",
    "theme" : "${rs}/ti/theme/",
    "lib"   : "${rs}/ti/lib/",
    "deps"  : "${rs}/ti/deps/",
    "mod"   : "${rs}/ti/mod/",
    "com"   : "${rs}/ti/com/",
    "i18n"  : "${rs}/ti/i18n/"
  },
  alias : {
    "^.+[.](css|js|mjs|json|txt|text)$"  : "$&",
    "^\./"          : "@MyApp:",
    "@lib:walnut"   : "@lib:walnut/walnut.mjs",
    "^@MyApp:?$"    : "@MyApp:_app.json",
    "^@theme:.+$"   : "$&.css",
    "^@app:[^\/]+$"   : "$&/_app.json",
    "\/?mod\/[^\/]+$" : "$&/_mod.json",
    "\/?com\/[^\/]+$" : "$&/_com.json",
    "^@mod:[^.]+$"    : "$&/_mod.json",
    "^@com:[^.]+$"    : "$&/_com.json",
    "^@i18n:(.+)$"    : "@i18n:zh-cn/$1.i18n.json"
  },
  lang : "zh-cn"
})
//---------------------------------------
Ti.Dom.watchAutoRootFontSize({callback:({$root, mode})=>{
  $root.setAttribute("as", mode)
}})
//---------------------------------------
Ti.Install()
Ti.Shortcut.startListening()
//---------------------------------------
async function main(){
  // setup the i18n
  Ti.I18n.put(await Ti.Load("@i18n:_ti"))
  // Load main app
  let app = await Ti.App("@MyApp")
  await app.init()
  //console.log(app)
  app.commit("wn-session/set", _app.session)
  app.mountTo("#app")

  // main obj path
  let basePath = "~"
  if(_app.obj) {
    basePath = "id:" + _app.obj.id
  }
  await app.dispatch("wn-obj-meta/reload", basePath)
  
  // just for fun
  return app.get("obj")
}
//---------------------------------------
main().then(o=>{
  console.log("get!!!", o)
}).catch(err=>{
  throw err
})

//---------------------------------------
</script>
</html>